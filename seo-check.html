<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SEO实时检查工具</title>
  <style>
    body { font-family: system-ui, -apple-system, sans-serif; margin: 0; padding: 20px; background: #f8fafc; }
    .container { max-width: 800px; margin: 0 auto; }
    .card { background: white; border-radius: 12px; padding: 24px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
    .title { font-size: 20px; font-weight: 700; margin-bottom: 16px; color: #1e293b; }
    .check-item { display: flex; align-items: center; padding: 12px; margin-bottom: 8px; border-radius: 8px; font-size: 14px; }
    .check-item.pass { background: #dcfce7; color: #166534; }
    .check-item.fail { background: #fef2f2; color: #991b1b; }
    .check-item.warn { background: #fef3c7; color: #92400e; }
    .icon { margin-right: 8px; font-weight: bold; }
    .value { font-family: monospace; background: rgba(0,0,0,0.05); padding: 2px 6px; border-radius: 4px; margin-left: 8px; }
    .btn { background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; }
    .btn:hover { background: #2563eb; }
    .lang-toggle { margin-bottom: 16px; }
    .lang-btn { padding: 8px 16px; border: 1px solid #ddd; background: white; cursor: pointer; margin-right: 8px; border-radius: 4px; }
    .lang-btn.active { background: #3b82f6; color: white; border-color: #3b82f6; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="title">🔍 SVTR.AI SEO实时检查</div>
      <div class="lang-toggle">
        <button class="lang-btn active" onclick="checkSEO('zh-CN')" id="btn-zh">中文检查</button>
        <button class="lang-btn" onclick="checkSEO('en')" id="btn-en">English Check</button>
      </div>
      <div style="margin: 16px 0;">
        <label style="margin-right: 10px;">检查页面:</label>
        <select id="pageSelect" onchange="updateCheckUrl()">
          <option value="/">主页 (index.html)</option>
          <option value="/pages/ai-weekly.html">AI周报</option>
          <option value="/pages/trading-picks.html">交易精选</option>
          <option value="/pages/ai-100.html">AI 100</option>
        </select>
      </div>
      <button class="btn" onclick="runFullCheck()">运行完整检查</button>
      <div id="status" style="margin-top: 10px; font-size: 14px; color: #666;"></div>
    </div>

    <div class="card">
      <div class="title">📊 基础SEO检查</div>
      <div id="basic-checks"></div>
    </div>

    <div class="card">
      <div class="title">🌐 社交媒体检查</div>
      <div id="social-checks"></div>
    </div>

    <div class="card">
      <div class="title">🏢 结构化数据检查</div>
      <div id="schema-checks"></div>
    </div>

    <div class="card">
      <div class="title">⚡ 性能检查</div>
      <div id="performance-checks"></div>
    </div>
  </div>

  <script>
    let currentCheckUrl = '/';
    let pageData = null;

    function createCheckItem(status, text, value = '') {
      const icons = { pass: '✅', fail: '❌', warn: '⚠️' };
      return `
        <div class="check-item ${status}">
          <span class="icon">${icons[status]}</span>
          <span>${text}</span>
          ${value ? `<span class="value">${value}</span>` : ''}
        </div>
      `;
    }

    function updateCheckUrl() {
      currentCheckUrl = document.getElementById('pageSelect').value;
      document.getElementById('status').innerHTML = `正在检查: ${currentCheckUrl}`;
      runFullCheck();
    }

    async function fetchPageData(url) {
      try {
        document.getElementById('status').innerHTML = `正在获取页面数据: ${url}`;
        const response = await fetch(url);
        const html = await response.text();
        
        // 创建临时DOM来解析HTML
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        return doc;
      } catch (error) {
        console.error('获取页面数据失败:', error);
        document.getElementById('status').innerHTML = `❌ 获取页面数据失败: ${error.message}`;
        return null;
      }
    }

    function checkSEO(lang) {
      // Update active button
      document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById(`btn-${lang === 'zh-CN' ? 'zh' : 'en'}`).classList.add('active');
      
      // Simulate language change (in real app, this would trigger i18n)
      if (window.i18n) {
        window.i18n.updateLanguage(lang);
      }
      
      setTimeout(() => runFullCheck(), 100);
    }

    async function runFullCheck() {
      pageData = await fetchPageData(currentCheckUrl);
      if (pageData) {
        checkBasicSEO();
        checkSocialMedia();
        checkStructuredData();
        checkPerformance();
        document.getElementById('status').innerHTML = `✅ 检查完成: ${currentCheckUrl}`;
      }
    }

    function checkBasicSEO() {
      const container = document.getElementById('basic-checks');
      let checks = '';
      
      if (!pageData) {
        container.innerHTML = createCheckItem('fail', '无法获取页面数据', '请刷新页面重试');
        return;
      }
      
      // Check title
      const titleElement = pageData.querySelector('title');
      const title = titleElement ? titleElement.textContent : '';
      if (title && title.length >= 30 && title.length <= 60) {
        checks += createCheckItem('pass', '页面标题长度适中', `${title.length}字符`);
      } else {
        checks += createCheckItem('warn', '页面标题长度不当或缺失', `${title ? title.length : 0}字符`);
      }
      
      // Check meta description
      const desc = pageData.querySelector('meta[name="description"]');
      if (desc && desc.content.length >= 75 && desc.content.length <= 160) {
        checks += createCheckItem('pass', 'Meta描述长度适中', `${desc.content.length}字符`);
      } else {
        checks += createCheckItem('warn', 'Meta描述长度不当或缺失', `${desc ? desc.content.length : 0}字符`);
      }
      
      // Check canonical
      const canonical = pageData.querySelector('link[rel="canonical"]');
      checks += createCheckItem(canonical ? 'pass' : 'fail', 'Canonical链接', canonical ? canonical.href : '缺失');
      
      // Check robots meta
      const robots = pageData.querySelector('meta[name="robots"]');
      checks += createCheckItem(robots ? 'pass' : 'warn', 'Robots指令', robots ? robots.content : '未设置');
      
      container.innerHTML = checks;
    }

    function checkSocialMedia() {
      const container = document.getElementById('social-checks');
      let checks = '';
      
      if (!pageData) {
        container.innerHTML = createCheckItem('fail', '无法获取页面数据', '');
        return;
      }
      
      // Check Open Graph
      const ogTitle = pageData.querySelector('meta[property="og:title"]');
      const ogDesc = pageData.querySelector('meta[property="og:description"]');
      const ogImage = pageData.querySelector('meta[property="og:image"]');
      
      checks += createCheckItem(ogTitle ? 'pass' : 'fail', 'Open Graph标题', ogTitle ? '已设置' : '缺失');
      checks += createCheckItem(ogDesc ? 'pass' : 'fail', 'Open Graph描述', ogDesc ? '已设置' : '缺失');
      checks += createCheckItem(ogImage ? 'pass' : 'fail', 'Open Graph图片', ogImage ? '已设置' : '缺失');
      
      // Check Twitter Cards
      const twitterCard = pageData.querySelector('meta[name="twitter:card"]');
      const twitterTitle = pageData.querySelector('meta[name="twitter:title"]');
      
      checks += createCheckItem(twitterCard ? 'pass' : 'fail', 'Twitter卡片类型', twitterCard ? twitterCard.content : '缺失');
      checks += createCheckItem(twitterTitle ? 'pass' : 'fail', 'Twitter标题', twitterTitle ? '已设置' : '缺失');
      
      container.innerHTML = checks;
    }

    function checkStructuredData() {
      const container = document.getElementById('schema-checks');
      let checks = '';
      
      if (!pageData) {
        container.innerHTML = createCheckItem('fail', '无法获取页面数据', '');
        return;
      }
      
      // Check JSON-LD
      const jsonLD = pageData.querySelectorAll('script[type="application/ld+json"]');
      if (jsonLD.length > 0) {
        checks += createCheckItem('pass', 'JSON-LD结构化数据', `${jsonLD.length}个脚本`);
        
        // Try to parse and validate
        try {
          jsonLD.forEach((script, index) => {
            const data = JSON.parse(script.textContent);
            if (data['@context'] && (data['@type'] || data['@graph'])) {
              const type = data['@type'] || (data['@graph'] ? data['@graph'][0]?.['@type'] : '未知');
              checks += createCheckItem('pass', `结构化数据 #${index + 1}`, `类型: ${type}`);
            }
          });
        } catch (e) {
          checks += createCheckItem('fail', 'JSON-LD解析错误', e.message);
        }
      } else {
        checks += createCheckItem('fail', 'JSON-LD结构化数据', '未找到');
      }
      
      container.innerHTML = checks;
    }

    function checkPerformance() {
      const container = document.getElementById('performance-checks');
      let checks = '';
      
      if (!pageData) {
        container.innerHTML = createCheckItem('fail', '无法获取页面数据', '');
        return;
      }
      
      // Check preload links
      const preloads = pageData.querySelectorAll('link[rel="preload"]');
      checks += createCheckItem(preloads.length > 0 ? 'pass' : 'warn', '资源预加载', `${preloads.length}个资源`);
      
      // Check WebP images
      const webpSources = pageData.querySelectorAll('source[srcset*=".webp"]');
      const webpImages = pageData.querySelectorAll('img[src*=".webp"]');
      const totalWebP = webpSources.length + webpImages.length;
      checks += createCheckItem(totalWebP > 0 ? 'pass' : 'warn', 'WebP图片格式', `${totalWebP}个图片`);
      
      // Check external links with rel
      const externalLinks = pageData.querySelectorAll('a[href^="http"]:not([href*="svtr.ai"]):not([href*="localhost"])');
      const linksWithRel = pageData.querySelectorAll('a[href^="http"]:not([href*="svtr.ai"]):not([href*="localhost"])[rel]');
      const relRatio = externalLinks.length > 0 ? (linksWithRel.length / externalLinks.length * 100).toFixed(0) : 100;
      
      checks += createCheckItem(relRatio >= 80 ? 'pass' : 'warn', '外部链接rel属性', `${relRatio}%设置了rel`);
      
      // Check image alt attributes
      const images = pageData.querySelectorAll('img');
      const imagesWithAlt = pageData.querySelectorAll('img[alt]');
      const altRatio = images.length > 0 ? (imagesWithAlt.length / images.length * 100).toFixed(0) : 100;
      
      checks += createCheckItem(altRatio >= 90 ? 'pass' : 'warn', '图片Alt属性', `${altRatio}%设置了alt`);
      
      container.innerHTML = checks;
    }

    // Run initial check
    runFullCheck();
    
    // Auto-refresh every 30 seconds
    setInterval(runFullCheck, 30000);
  </script>
</body>
</html>