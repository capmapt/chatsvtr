<!DOCTYPE html>
<html>
<head>
    <title>调试认证按钮</title>
</head>
<body>
    <h1>调试主页面认证按钮</h1>
    
    <script>
        // 等待页面完全加载
        window.addEventListener('load', () => {
            console.log('页面已加载，开始调试...');
            
            // 检查按钮是否存在
            const loginBtn = document.querySelector('.btn-member-login');
            const subscribeBtn = document.querySelector('.btn-email-subscribe');
            
            console.log('登录按钮:', loginBtn);
            console.log('订阅按钮:', subscribeBtn);
            
            // 检查user-actions实例
            console.log('SVTRUserActions实例:', window.svtrUserActions);
            
            // 直接测试API
            fetch('/api/auth', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    action: 'send_code',
                    email: 'debug-direct@svtr.ai'
                })
            }).then(res => res.json()).then(data => {
                console.log('直接API测试结果:', data);
            }).catch(err => {
                console.error('直接API测试失败:', err);
            });
        });
        
        // 强制加载主页面到iframe中进行调试
        setTimeout(() => {
            const iframe = document.createElement('iframe');
            iframe.src = '/';
            iframe.style.width = '100%';
            iframe.style.height = '600px';
            iframe.style.border = '1px solid #ccc';
            document.body.appendChild(iframe);
            
            iframe.onload = () => {
                console.log('主页面已在iframe中加载');
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    const loginBtn = iframeDoc.querySelector('.btn-member-login');
                    console.log('iframe中的登录按钮:', loginBtn);
                    
                    if (loginBtn) {
                        loginBtn.addEventListener('click', (e) => {
                            console.log('登录按钮被点击！', e);
                        });
                        
                        // 手动触发点击
                        console.log('手动触发登录按钮点击...');
                        loginBtn.click();
                    }
                } catch (error) {
                    console.error('无法访问iframe内容 (可能是跨域):', error);
                }
            };
        }, 1000);
    </script>
</body>
</html>