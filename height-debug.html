<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é«˜åº¦è°ƒè¯•å·¥å…·</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
      background: #f0f0f0;
    }
    
    .debug-panel {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .debug-panel h3 {
      margin-top: 0;
      color: #333;
    }
    
    .measurement-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .measure-item {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      border-left: 4px solid #007bff;
    }
    
    .measure-item strong {
      color: #007bff;
    }
    
    .iframe-test {
      border: 3px solid #dc3545;
      border-radius: 8px;
      margin: 20px 0;
      position: relative;
    }
    
    .iframe-test::before {
      content: attr(data-label);
      position: absolute;
      top: -30px;
      left: 0;
      background: #dc3545;
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
    }
    
    .test-iframe {
      width: 100%;
      border: none;
      display: block;
    }
    
    .height-controls {
      display: flex;
      gap: 10px;
      align-items: center;
      margin: 15px 0;
    }
    
    .height-controls button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #28a745;
      color: white;
    }
    
    .height-controls button:hover {
      background: #218838;
    }
    
    .optimal-height {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      border-radius: 4px;
      padding: 15px;
      margin: 15px 0;
    }
    
    .optimal-height h4 {
      margin-top: 0;
      color: #155724;
    }
    
    .scrollbar-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
    }
    
    .scrollbar-indicator.no-scroll {
      background: #d4edda;
      color: #155724;
    }
    
    .scrollbar-indicator.has-scroll {
      background: #f8d7da;
      color: #721c24;
    }
  </style>
</head>
<body>
  <div class="debug-panel">
    <h3>ğŸ” Stats Widget é«˜åº¦è°ƒè¯•å·¥å…·</h3>
    
    <div class="measurement-grid" id="measurements">
      <div class="measure-item">
        <strong>å®¹å™¨å®½åº¦:</strong> <span id="container-width">--</span>px
      </div>
      <div class="measure-item">
        <strong>å†…å®¹é«˜åº¦:</strong> <span id="content-height">--</span>px
      </div>
      <div class="measure-item">
        <strong>æ»šåŠ¨é«˜åº¦:</strong> <span id="scroll-height">--</span>px
      </div>
      <div class="measure-item">
        <strong>å¯è§†é«˜åº¦:</strong> <span id="client-height">--</span>px
      </div>
      <div class="measure-item">
        <strong>body padding:</strong> <span id="body-padding">--</span>px
      </div>
      <div class="measure-item">
        <strong>å¡ç‰‡æ•°é‡:</strong> <span id="card-count">--</span>ä¸ª
      </div>
      <div class="measure-item">
        <strong>å¡ç‰‡å¹³å‡é«˜åº¦:</strong> <span id="card-height">--</span>px
      </div>
      <div class="measure-item">
        <strong>é—´è·æ€»å’Œ:</strong> <span id="gap-total">--</span>px
      </div>
    </div>
    
    <div class="height-controls">
      <button onclick="measureHeight()">ğŸ”„ é‡æ–°æµ‹é‡</button>
      <button onclick="calculateOptimal()">ğŸ“ è®¡ç®—æœ€ä¼˜é«˜åº¦</button>
      <button onclick="testDifferentSizes()">ğŸ“± æµ‹è¯•ä¸åŒå°ºå¯¸</button>
    </div>
    
    <div class="optimal-height" id="optimal-result" style="display: none;">
      <h4>ğŸ“Š æœ€ä¼˜é«˜åº¦å»ºè®®</h4>
      <div id="optimal-content"></div>
    </div>
  </div>
  
  <div class="debug-panel">
    <h3>ğŸ“± ç§»åŠ¨ç«¯å°ºå¯¸æµ‹è¯•</h3>
    
    <div class="iframe-test" data-label="375px (iPhone)" style="width: 375px;">
      <div class="scrollbar-indicator" id="indicator-375">æ£€æµ‹ä¸­...</div>
      <iframe src="./pages/stats-widget.html" class="test-iframe" id="iframe-375" style="height: 350px;"></iframe>
    </div>
    
    <div class="iframe-test" data-label="360px (Android)" style="width: 360px;">
      <div class="scrollbar-indicator" id="indicator-360">æ£€æµ‹ä¸­...</div>
      <iframe src="./pages/stats-widget.html" class="test-iframe" id="iframe-360" style="height: 350px;"></iframe>
    </div>
    
    <div class="iframe-test" data-label="320px (å°å±)" style="width: 320px;">
      <div class="scrollbar-indicator" id="indicator-320">æ£€æµ‹ä¸­...</div>
      <iframe src="./pages/stats-widget.html" class="test-iframe" id="iframe-320" style="height: 290px;"></iframe>
    </div>
  </div>
  
  <script>
    let measurements = {};
    
    function measureHeight() {
      const iframe = document.getElementById('iframe-375');
      
      setTimeout(() => {
        try {
          const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
          const container = iframeDoc.querySelector('.stats-container');
          const body = iframeDoc.body;
          const cards = iframeDoc.querySelectorAll('.stat-card');
          
          measurements.containerWidth = container.offsetWidth;
          measurements.contentHeight = body.offsetHeight;
          measurements.scrollHeight = body.scrollHeight;
          measurements.clientHeight = body.clientHeight;
          
          // è®¡ç®—body padding
          const bodyStyle = window.getComputedStyle(body);
          const paddingTop = parseFloat(bodyStyle.paddingTop);
          const paddingBottom = parseFloat(bodyStyle.paddingBottom);
          measurements.bodyPadding = paddingTop + paddingBottom;
          
          // è®¡ç®—å¡ç‰‡é«˜åº¦
          measurements.cardCount = cards.length;
          let totalCardHeight = 0;
          cards.forEach(card => {
            totalCardHeight += card.offsetHeight;
          });
          measurements.cardHeight = totalCardHeight / cards.length;
          
          // è®¡ç®—é—´è·
          const containerStyle = window.getComputedStyle(container);
          const gap = parseFloat(containerStyle.gap || containerStyle.gridGap || '0');
          measurements.gapTotal = gap * (cards.length - 1);
          
          updateMeasurements();
        } catch (e) {
          console.error('æµ‹é‡å¤±è´¥:', e);
        }
      }, 1000);
    }
    
    function updateMeasurements() {
      document.getElementById('container-width').textContent = measurements.containerWidth || '--';
      document.getElementById('content-height').textContent = measurements.contentHeight || '--';
      document.getElementById('scroll-height').textContent = measurements.scrollHeight || '--';
      document.getElementById('client-height').textContent = measurements.clientHeight || '--';
      document.getElementById('body-padding').textContent = measurements.bodyPadding || '--';
      document.getElementById('card-count').textContent = measurements.cardCount || '--';
      document.getElementById('card-height').textContent = Math.round(measurements.cardHeight) || '--';
      document.getElementById('gap-total').textContent = measurements.gapTotal || '--';
    }
    
    function calculateOptimal() {
      if (!measurements.contentHeight) {
        alert('è¯·å…ˆç‚¹å‡»"é‡æ–°æµ‹é‡"æŒ‰é’®');
        return;
      }
      
      const optimalHeight = measurements.scrollHeight + 10; // åŠ 10pxç¼“å†²
      const resultDiv = document.getElementById('optimal-result');
      const contentDiv = document.getElementById('optimal-content');
      
      contentDiv.innerHTML = `
        <p><strong>å½“å‰iframeé«˜åº¦:</strong> ${measurements.clientHeight}px</p>
        <p><strong>å®é™…å†…å®¹é«˜åº¦:</strong> ${measurements.scrollHeight}px</p>
        <p><strong>å»ºè®®iframeé«˜åº¦:</strong> ${optimalHeight}px</p>
        <p><strong>å·®å¼‚:</strong> ${optimalHeight - measurements.clientHeight}px</p>
        <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 4px;">
          <strong>CSSå»ºè®®:</strong><br>
          <code>768pxæ–­ç‚¹: height: ${optimalHeight}px;</code><br>
          <code>480pxæ–­ç‚¹: height: ${Math.round(optimalHeight * 0.85)}px;</code>
        </div>
      `;
      
      resultDiv.style.display = 'block';
    }
    
    function checkScrollbars(iframeId, indicatorId) {
      const iframe = document.getElementById(iframeId);
      const indicator = document.getElementById(indicatorId);
      
      try {
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        const hasVerticalScroll = iframeDoc.documentElement.scrollHeight > iframeDoc.documentElement.clientHeight;
        const hasHorizontalScroll = iframeDoc.documentElement.scrollWidth > iframeDoc.documentElement.clientWidth;
        
        if (hasVerticalScroll || hasHorizontalScroll) {
          indicator.textContent = `âŒ æœ‰æ»šåŠ¨æ¡ (V:${hasVerticalScroll ? 'æ˜¯' : 'å¦'} H:${hasHorizontalScroll ? 'æ˜¯' : 'å¦'})`;
          indicator.className = 'scrollbar-indicator has-scroll';
        } else {
          indicator.textContent = 'âœ… æ— æ»šåŠ¨æ¡';
          indicator.className = 'scrollbar-indicator no-scroll';
        }
      } catch (e) {
        indicator.textContent = 'â“ æ£€æµ‹å¤±è´¥';
        indicator.className = 'scrollbar-indicator';
      }
    }
    
    function testDifferentSizes() {
      const sizes = ['375', '360', '320'];
      sizes.forEach(size => {
        checkScrollbars(`iframe-${size}`, `indicator-${size}`);
      });
    }
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(() => {
        measureHeight();
        testDifferentSizes();
      }, 1500);
      
      // å®šæœŸæ£€æŸ¥
      setInterval(testDifferentSizes, 3000);
    });
  </script>
</body>
</html>