<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ä¿®å¤éªŒè¯æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        #response { 
            border: 1px solid #ddd; 
            padding: 15px; 
            margin: 15px 0; 
            min-height: 200px;
            background: #f9f9f9;
            white-space: pre-wrap;
        }
        button { 
            background: #28a745; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            cursor: pointer; 
            margin: 5px;
            border-radius: 4px;
        }
        button:hover { background: #218838; }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h2>âœ… AIèŠå¤©ä¿®å¤éªŒè¯</h2>
        <p>æµ‹è¯•AIæ˜¯å¦è¿˜ä¼šé‡å¤è¾“å‡º"æ­£åœ¨åˆ†æ"</p>
        
        <button onclick="testQuestion('ä½ å¥½')">æµ‹è¯•: ä½ å¥½</button>
        <button onclick="testQuestion('SVTR.AIæ˜¯ä»€ä¹ˆï¼Ÿ')">æµ‹è¯•: SVTR.AIæ˜¯ä»€ä¹ˆï¼Ÿ</button>
        <button onclick="testQuestion('AIåˆ›æŠ•å¸‚åœºæ€ä¹ˆæ ·ï¼Ÿ')">æµ‹è¯•: AIåˆ›æŠ•å¸‚åœº</button>
        <button onclick="clearResponse()">æ¸…ç©º</button>
        
        <div id="status">å‡†å¤‡æµ‹è¯•...</div>
        <div id="response">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
    </div>

    <script>
        async function testQuestion(question) {
            const response = document.getElementById('response');
            const status = document.getElementById('status');
            
            status.innerHTML = `<span style="color: blue;">ğŸ§ª æµ‹è¯•é—®é¢˜: ${question}</span>`;
            response.textContent = 'ğŸ¤– AIå›å¤:\n';
            
            try {
                const res = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [{ role: 'user', content: question }]
                    })
                });
                
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                
                const reader = res.body.getReader();
                const decoder = new TextDecoder();
                let aiResponse = '';
                let hasAnalysisText = false;
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\\n');
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ') && !line.includes('[DONE]')) {
                            try {
                                const data = JSON.parse(line.slice(6));
                                if (data.delta?.content) {
                                    const content = data.delta.content;
                                    aiResponse += content;
                                    
                                    // æ£€æŸ¥æ˜¯å¦åŒ…å«"æ­£åœ¨åˆ†æ"
                                    if (content.includes('æ­£åœ¨åˆ†æ') || content.includes('åˆ†æä¸­')) {
                                        hasAnalysisText = true;
                                    }
                                    
                                    response.textContent = `ğŸ¤– AIå›å¤:\\n${aiResponse}`;
                                }
                            } catch (e) {
                                console.log('è§£æé”™è¯¯:', e);
                            }
                        }
                    }
                }
                
                // æµ‹è¯•ç»“æœåˆ¤æ–­
                if (hasAnalysisText) {
                    status.innerHTML = `<span class="error">âŒ ä»ç„¶åŒ…å«"æ­£åœ¨åˆ†æ"æ–‡æœ¬</span>`;
                } else if (aiResponse.length > 10) {
                    status.innerHTML = `<span class="success">âœ… ä¿®å¤æˆåŠŸï¼AIæä¾›äº†æ­£å¸¸å›ç­”</span>`;
                } else {
                    status.innerHTML = `<span style="color: orange;">âš ï¸ å›ç­”è¿‡çŸ­ï¼Œå¯èƒ½æœ‰å…¶ä»–é—®é¢˜</span>`;
                }
                
            } catch (error) {
                status.innerHTML = `<span class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</span>`;
                response.textContent = `é”™è¯¯: ${error.message}`;
            }
        }
        
        function clearResponse() {
            document.getElementById('response').textContent = 'ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...';
            document.getElementById('status').textContent = 'å‡†å¤‡æµ‹è¯•...';
        }
    </script>
</body>
</html>