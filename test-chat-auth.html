<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>èŠå¤©è®¤è¯æµ‹è¯• - SVTR</title>
  <link rel="stylesheet" href="assets/css/chat-login-overlay.css">
  <link rel="stylesheet" href="assets/css/chat-auth-styles.css">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
    }
    
    .test-info {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid #2196F3;
    }
    
    .auth-status {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 600;
    }
    
    .auth-status.logged-in {
      background: #e8f5e8;
      color: #4caf50;
      border-left: 4px solid #4caf50;
    }
    
    .auth-status.logged-out {
      background: #fff3e0;
      color: #ff9800;
      border-left: 4px solid #ff9800;
    }
    
    .debug-panel {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ” SVTR èŠå¤©è®¤è¯æµ‹è¯•</h1>
      <p>æµ‹è¯•èŠå¤©ç³»ç»Ÿçš„ç™»å½•è¦æ±‚åŠŸèƒ½</p>
    </div>
    
    <div class="test-info">
      <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
      <ul>
        <li>èŠå¤©åŠŸèƒ½ç°åœ¨éœ€è¦ç”¨æˆ·ç™»å½•æ‰èƒ½ä½¿ç”¨</li>
        <li>æœªç™»å½•ç”¨æˆ·å°†çœ‹åˆ°ç™»å½•æç¤ºé®ç½©</li>
        <li>æ”¯æŒé‚®ç®±éªŒè¯ç ç™»å½•å’ŒMagic Linkç™»å½•</li>
        <li>ç™»å½•åå¯æ­£å¸¸ä½¿ç”¨AIåŠ©æ‰‹åŠŸèƒ½</li>
      </ul>
    </div>
    
    <div id="auth-status" class="auth-status logged-out">
      ğŸ”„ æ­£åœ¨æ£€æŸ¥ç™»å½•çŠ¶æ€...
    </div>
    
    <div id="user-info" style="display: none;">
      <h3>ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯</h3>
      <div id="user-details"></div>
    </div>
    
    <div id="debug-panel" class="debug-panel">
      <h4>ğŸ› ï¸ è°ƒè¯•ä¿¡æ¯</h4>
      <div id="debug-info">åŠ è½½ä¸­...</div>
    </div>
    
    <!-- èŠå¤©å®¹å™¨ -->
    <h3>ğŸ’¬ èŠå¤©æµ‹è¯•åŒºåŸŸ</h3>
    <div id="svtr-chat-container"></div>
    
    <div style="margin-top: 30px; text-align: center;">
      <button id="refresh-btn" onclick="location.reload()" 
              style="background: #2196F3; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
        ğŸ”„ åˆ·æ–°é¡µé¢
      </button>
    </div>
  </div>

  <!-- åŠ è½½è®¤è¯ç³»ç»Ÿ -->
  <script src="assets/js/chat-auth-manager.js"></script>
  <script src="assets/js/chat-optimized-auth.js"></script>
  
  <script>
    // è°ƒè¯•å’ŒçŠ¶æ€æ˜¾ç¤º
    function updateAuthStatus() {
      const statusEl = document.getElementById('auth-status');
      const userInfoEl = document.getElementById('user-info');
      const userDetailsEl = document.getElementById('user-details');
      const debugEl = document.getElementById('debug-info');
      
      // æ£€æŸ¥è®¤è¯ç®¡ç†å™¨
      if (window.chatAuthManager) {
        const isLoggedIn = window.chatAuthManager.isLoggedIn();
        const user = window.chatAuthManager.getCurrentUser();
        const token = window.chatAuthManager.getCurrentToken();
        
        if (isLoggedIn && user) {
          statusEl.className = 'auth-status logged-in';
          statusEl.innerHTML = `âœ… å·²ç™»å½• - æ¬¢è¿ï¼Œ${user.name}ï¼`;
          
          userInfoEl.style.display = 'block';
          userDetailsEl.innerHTML = `
            <p><strong>å§“å:</strong> ${user.name}</p>
            <p><strong>é‚®ç®±:</strong> ${user.email}</p>
            <p><strong>ç”¨æˆ·ID:</strong> ${user.id}</p>
            <p><strong>ç™»å½•æ–¹å¼:</strong> ${user.provider}</p>
            <p><strong>æœ€åç™»å½•:</strong> ${new Date(user.lastLoginAt).toLocaleString()}</p>
          `;
        } else {
          statusEl.className = 'auth-status logged-out';
          statusEl.innerHTML = 'âŒ æœªç™»å½• - è¯·å…ˆç™»å½•ä»¥ä½¿ç”¨èŠå¤©åŠŸèƒ½';
          userInfoEl.style.display = 'none';
        }
        
        // è°ƒè¯•ä¿¡æ¯
        debugEl.innerHTML = `
          <strong>è®¤è¯ç®¡ç†å™¨çŠ¶æ€:</strong> âœ… å·²åŠ è½½<br>
          <strong>ç™»å½•çŠ¶æ€:</strong> ${isLoggedIn ? 'âœ… å·²ç™»å½•' : 'âŒ æœªç™»å½•'}<br>
          <strong>Tokenå­˜åœ¨:</strong> ${token ? 'âœ… æ˜¯' : 'âŒ å¦'}<br>
          <strong>ç”¨æˆ·æ•°æ®:</strong> ${user ? 'âœ… å·²åŠ è½½' : 'âŒ æ— '}<br>
          <strong>localStorage:</strong> ${localStorage.getItem('svtr_user') ? 'âœ… æœ‰ç”¨æˆ·æ•°æ®' : 'âŒ æ— ç”¨æˆ·æ•°æ®'}<br>
          <strong>å½“å‰æ—¶é—´:</strong> ${new Date().toLocaleString()}
        `;
      } else {
        statusEl.className = 'auth-status logged-out';
        statusEl.innerHTML = 'â³ è®¤è¯ç³»ç»ŸåŠ è½½ä¸­...';
        
        debugEl.innerHTML = `
          <strong>è®¤è¯ç®¡ç†å™¨çŠ¶æ€:</strong> âŒ æœªåŠ è½½<br>
          <strong>é‡è¯•ä¸­...</strong> è¯·ç¨å€™
        `;
        
        // é‡è¯•
        setTimeout(updateAuthStatus, 500);
      }
    }
    
    // ç›‘å¬è®¤è¯äº‹ä»¶
    window.addEventListener('chatAuthLogin', (event) => {
      console.log('ğŸ‰ æ”¶åˆ°ç™»å½•äº‹ä»¶:', event.detail);
      setTimeout(updateAuthStatus, 100);
    });
    
    window.addEventListener('chatAuthLogout', () => {
      console.log('ğŸ‘‹ æ”¶åˆ°é€€å‡ºäº‹ä»¶');
      setTimeout(updateAuthStatus, 100);
    });
    
    // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥çŠ¶æ€
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(updateAuthStatus, 500);
      
      // å®šæœŸæ›´æ–°çŠ¶æ€
      setInterval(updateAuthStatus, 5000);
    });
    
    console.log('ğŸ§ª èŠå¤©è®¤è¯æµ‹è¯•é¡µé¢å·²åŠ è½½');
  </script>
</body>
</html>