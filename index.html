<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title data-i18n="title">硅谷科技评论</title>
  <style>
    /* ...样式代码保持不变... */
  </style>
</head>
<body>
  <!-- ...主体结构保持不变... -->
  <script>
    const translations = {
      // ...翻译内容保持不变...
    };

    function updateLanguage(lang) {
      // ...函数内容保持不变...
    }

    document.getElementById('btnZh').addEventListener('click', () => updateLanguage('zh-CN'));
    document.getElementById('btnEn').addEventListener('click', () => updateLanguage('en'));

    const toggle = document.querySelector('.menu-toggle');
    const sidebar = document.querySelector('.sidebar');
    const overlay = document.querySelector('.overlay');
    const content = document.querySelector('.content');

    toggle.addEventListener('click', () => {
      sidebar.classList.toggle('open');
      overlay.classList.toggle('active');
      content.classList.toggle('shifted');
    });
    overlay.addEventListener('click', () => {
      sidebar.classList.remove('open');
      overlay.classList.remove('active');
      content.classList.remove('shifted');
    });

    // initialize
    updateLanguage('zh-CN');

    // Automatically close sidebar after 2 seconds
    setTimeout(() => {
      const sidebarElement = document.querySelector('.sidebar');
      const overlayElement = document.querySelector('.overlay');
      const contentElement = document.querySelector('.content');
      if (sidebarElement && overlayElement && contentElement) {
        sidebarElement.classList.remove('open');
        overlayElement.classList.remove('active');
        contentElement.classList.remove('shifted');
      }
    }, 2000);

    // 候补名单弹窗逻辑
    document.getElementById('joinBtn').onclick = function() {
      document.getElementById('waitlistModal').style.display = 'flex';
      document.getElementById('waitlistEmail').focus();
    };
    document.getElementById('waitlistClose').onclick = function() {
      document.getElementById('waitlistModal').style.display = 'none';
      document.getElementById('waitlistForm').reset();
      document.getElementById('waitlistSuccessMsg').textContent = '';
      document.getElementById('waitlistErrorMsg').textContent = '';
    };
    document.getElementById('waitlistModal').addEventListener('click', function(e){
      if(e.target === this){
        this.style.display = 'none';
        document.getElementById('waitlistForm').reset();
        document.getElementById('waitlistSuccessMsg').textContent = '';
        document.getElementById('waitlistErrorMsg').textContent = '';
      }
    });

    // 表单提交逻辑，已更新为真实 Worker API 地址
    document.getElementById('waitlistForm').onsubmit = async function(e) {
      e.preventDefault();
      const email = document.getElementById('waitlistEmail').value.trim();
      const successMsg = document.getElementById('waitlistSuccessMsg');
      const errorMsg = document.getElementById('waitlistErrorMsg');
      successMsg.textContent = '';
      errorMsg.textContent = '';
      if (!email) {
        errorMsg.textContent = '请输入有效的邮箱地址。';
        return;
      }
      // 邮箱格式简单校验
      if (!/^[\w\-\.]+@[\w\-]+\.[\w\-\.]+$/.test(email)) {
        errorMsg.textContent = '邮箱格式不正确。';
        return;
      }
      try {
        // 调用 Cloudflare Worker API
        const res = await fetch('https://waitlist-api.liumin-gsm.workers.dev/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });
        const data = await res.json();
        if (data.ok) {
          successMsg.textContent = '提交成功，感谢您的预约！';
          document.getElementById('waitlistForm').reset();
        } else {
          errorMsg.textContent = data.error || '提交失败，请稍后重试。';
        }
      } catch {
        errorMsg.textContent = '提交失败，请稍后重试。';
      }
    };
  </script>
</body>
</html>
