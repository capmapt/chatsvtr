{
  "version": 3,
  "sources": ["../bundle-Xg2GE4/checked-fetch.js", "../../../functions/lib/hybrid-rag-service.ts", "../../../functions/api/chat.ts", "../../../functions/lib/company-analysis-formatter.ts", "../../../functions/api/chat-optimized.ts", "../../../functions/api/feishu-webhook.ts", "../../../functions/lib/free-tier-manager.ts", "../../../functions/api/quota-status.ts", "../../../functions/api/subscribe.ts", "../../../functions/lib/conversation-context.ts", "../../../functions/api/suggestions.ts", "../../../functions/webhook/feishu.js", "../../../functions/scheduled-sync.ts", "../../../functions/_middleware.ts", "functionsRoutes-0.24042877420898856.mjs", "../../../node_modules/path-to-regexp/src/index.ts", "../../../node_modules/wrangler/templates/pages-template-worker.ts", "../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-Xg2GE4/middleware-insertion-facade.js", "../../../node_modules/wrangler/templates/middleware/common.ts", "../bundle-Xg2GE4/middleware-loader.entry.ts"],
  "sourceRoot": "/home/lium/chatsvtr/.wrangler/tmp/pages-Sjl4bC/functionsWorker-0.36387113164103724.mjs",
  "sourcesContent": ["const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "/**\n * SVTR.AI \u6DF7\u5408RAG\u670D\u52A1\n * \u7ED3\u5408\u591A\u79CD\u68C0\u7D22\u7B56\u7565\uFF0C\u5B9E\u73B0\u6210\u672C\u4F18\u5316\u548C\u8D28\u91CF\u4FDD\u8BC1\n * \u589E\u5F3A\u7248\uFF1A\u96C6\u6210\u67E5\u8BE2\u6269\u5C55\u548C\u8BED\u4E49\u4F18\u5316\n */\n\n// \u79FB\u9664\u4E0D\u5B58\u5728\u7684\u4F9D\u8D56\u670D\u52A1\uFF0C\u4F7F\u7528\u5185\u8054\u5B9E\u73B0\n\ninterface HybridRAGConfig {\n  useOpenAI: boolean;\n  useCloudflareAI: boolean;\n  useKeywordSearch: boolean;\n  useWebSearch: boolean;\n  fallbackEnabled: boolean;\n}\n\nexport class HybridRAGService {\n  private config: HybridRAGConfig;\n  private vectorize: any;\n  private ai: any;\n  private openaiApiKey?: string;\n  private requestContext?: Request;\n\n  constructor(vectorize: any, ai: any, openaiApiKey?: string, kvNamespace?: any, webSearchConfig?: any, requestContext?: Request) {\n    this.vectorize = vectorize;\n    this.ai = ai;\n    this.openaiApiKey = openaiApiKey;\n    this.requestContext = requestContext;\n    \n    // \u667A\u80FD\u914D\u7F6E\uFF1A\u6839\u636E\u53EF\u7528\u8D44\u6E90\u81EA\u52A8\u9009\u62E9\u7B56\u7565 - \u6DF7\u5408\u77E5\u8BC6\u5E93+\u5B9E\u65F6\u641C\u7D22\n    this.config = {\n      useOpenAI: !!openaiApiKey,\n      useCloudflareAI: !!ai,\n      useKeywordSearch: true,\n      useWebSearch: true, // \u542F\u7528\u6539\u8FDB\u7684\u7F51\u7EDC\u641C\u7D22\n      fallbackEnabled: true\n    };\n  }\n\n  /**\n   * \u667A\u80FD\u68C0\u7D22\uFF1A\u589E\u5F3A\u9519\u8BEF\u5904\u7406\u7248\u672C\n   */\n  async performIntelligentRAG(query: string, options: any = {}) {\n    const startTime = Date.now();\n    console.log('\uD83D\uDD0D \u5F00\u59CBRAG\u68C0\u7D22...');\n    \n    try {\n      // \u8F93\u5165\u9A8C\u8BC1\n      if (!query || typeof query !== 'string' || query.trim().length === 0) {\n        throw new Error('\u67E5\u8BE2\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A');\n      }\n\n      // \u7279\u6B8A\u5904\u7406\uFF1A\u8054\u7CFB\u65B9\u5F0F\u67E5\u8BE2\u9A8C\u8BC1\n      const isContactQuery = this.isContactInfoQuery(query);\n      if (isContactQuery) {\n        console.log('\uD83D\uDCDE \u68C0\u6D4B\u5230\u8054\u7CFB\u65B9\u5F0F\u67E5\u8BE2\uFF0C\u542F\u7528\u7279\u6B8A\u8FC7\u6EE4\u903B\u8F91');\n        options.contactInfoQuery = true;\n        options.strictFiltering = true;\n      }\n      \n      const strategies = [];\n      \n      // \u7B56\u75651: \u5411\u91CF\u68C0\u7D22\uFF08\u5982\u679C\u53EF\u7528\uFF09\n      if (this.config.useOpenAI || this.config.useCloudflareAI) {\n        strategies.push(this.vectorSearch(query, options));\n      }\n      \n      // \u7B56\u75652: \u5173\u952E\u8BCD\u68C0\u7D22\n      strategies.push(this.keywordSearch(query, options));\n      \n      // \u7B56\u75653: \u8BED\u4E49\u6A21\u5F0F\u5339\u914D\n      strategies.push(this.semanticPatternMatch(query, options));\n      \n      // \u786E\u4FDD\u81F3\u5C11\u6709\u4E00\u4E2A\u7B56\u7565\n      if (strategies.length === 0) {\n        throw new Error('\u6CA1\u6709\u53EF\u7528\u7684\u68C0\u7D22\u7B56\u7565');\n      }\n\n      // \u5E76\u884C\u6267\u884C\u6240\u6709\u7B56\u7565\uFF0C\u8BBE\u7F6E\u8D85\u65F6\n      const results = await Promise.allSettled(strategies);\n      \n      // \u9A8C\u8BC1\u662F\u5426\u6709\u6210\u529F\u7684\u7ED3\u679C\n      const successfulResults = results.filter(r => r.status === 'fulfilled');\n      if (successfulResults.length === 0) {\n        console.warn('\u6240\u6709\u68C0\u7D22\u7B56\u7565\u90FD\u5931\u8D25\u4E86\uFF0C\u8FD4\u56DE\u9ED8\u8BA4\u54CD\u5E94');\n        return this.getDefaultResponse(query);\n      }\n\n      // \u5408\u5E76\u548C\u6392\u5E8F\u7ED3\u679C\n      const mergedResults = this.mergeResults(results, query);\n      \n      // \u6784\u5EFA\u6700\u7EC8\u7ED3\u679C\n      const finalResults = {\n        ...mergedResults,\n        searchQuery: query,\n        fromCache: false,\n        responseTime: Date.now() - startTime,\n        enhancedFeatures: {\n          multiStrategyRetrieval: true,\n          successfulStrategies: successfulResults.length,\n          totalStrategies: strategies.length\n        }\n      };\n      \n      return finalResults;\n    } catch (error) {\n      console.error('RAG\u68C0\u7D22\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF:', error);\n      return this.getErrorResponse(query, error.message);\n    }\n  }\n\n  /**\n   * \u5411\u91CF\u68C0\u7D22\uFF08\u652F\u6301\u591A\u6A21\u578B\uFF09\n   */\n  private async vectorSearch(query: string, options: any) {\n    try {\n      let queryVector;\n      \n      if (this.config.useOpenAI) {\n        queryVector = await this.getOpenAIEmbedding(query);\n      } else if (this.config.useCloudflareAI) {\n        queryVector = await this.getCloudflareEmbedding(query);\n      } else {\n        throw new Error('No embedding service available');\n      }\n      \n      return await this.vectorize.query(queryVector, {\n        topK: options.topK || 5,\n        returnMetadata: 'all'\n      });\n      \n    } catch (error) {\n      console.log('\u5411\u91CF\u68C0\u7D22\u5931\u8D25\uFF0C\u4F7F\u7528\u5907\u7528\u65B9\u6848');\n      return { matches: [], source: 'vector-failed' };\n    }\n  }\n\n  /**\n   * \u5173\u952E\u8BCD\u68C0\u7D22\uFF08\u7EAF\u6587\u672C\u5339\u914D\uFF09\n   */\n  private async keywordSearch(query: string, options: any) {\n    // \u5B9E\u73B0\u57FA\u4E8E\u5173\u952E\u8BCD\u7684\u68C0\u7D22\u903B\u8F91\n    const keywords = this.extractKeywords(query);\n    const matches = await this.findKeywordMatches(keywords);\n    \n    return {\n      matches: matches.map(match => ({\n        ...match,\n        score: match.keywordScore,\n        source: 'keyword'\n      })),\n      source: 'keyword'\n    };\n  }\n\n\n  /**\n   * \u8BED\u4E49\u6A21\u5F0F\u5339\u914D\n   */\n  private async semanticPatternMatch(query: string, options: any) {\n    const patterns = {\n      investment: ['\u6295\u8D44', '\u878D\u8D44', '\u8F6E\u6B21', 'vc', 'funding'],\n      startup: ['\u516C\u53F8', '\u521B\u4E1A', '\u4F01\u4E1A', 'startup', 'company'],  \n      trend: ['\u8D8B\u52BF', '\u5E02\u573A', '\u524D\u666F', 'trend', 'market'],\n      technology: ['\u6280\u672F', 'ai', '\u4EBA\u5DE5\u667A\u80FD', 'tech']\n    };\n    \n    const queryLower = query.toLowerCase();\n    const scores = {};\n    \n    for (const [category, keywords] of Object.entries(patterns)) {\n      scores[category] = keywords.reduce((score, keyword) => {\n        return score + (queryLower.includes(keyword) ? 1 : 0);\n      }, 0);\n    }\n    \n    const bestCategory = Object.entries(scores)\n      .sort(([,a], [,b]) => b - a)[0][0];\n    \n    return {\n      matches: await this.getCategoryContent(bestCategory),\n      source: 'pattern',\n      category: bestCategory\n    };\n  }\n\n  /**\n   * \u7ED3\u679C\u5408\u5E76\u548C\u6392\u5E8F\n   */\n  private mergeResults(results: any[], query: string) {\n    const allMatches = [];\n    \n    results.forEach((result, index) => {\n      if (result.status === 'fulfilled' && result.value.matches) {\n        result.value.matches.forEach(match => {\n          allMatches.push({\n            ...match,\n            strategy: result.value.source,\n            strategyIndex: index\n          });\n        });\n      }\n    });\n    \n    // \u53BB\u91CD\u548C\u8BC4\u5206\n    const deduplicated = this.deduplicateMatches(allMatches);\n    const scored = this.rescoreMatches(deduplicated, query);\n    \n    return {\n      matches: scored.slice(0, 8), // \u8FD4\u56DEtop 8\n      sources: this.extractSources(scored),\n      confidence: this.calculateConfidence(scored),\n      strategies: results.length\n    };\n  }\n\n  /**\n   * \u63D0\u53D6\u5173\u952E\u8BCD\n   */\n  private extractKeywords(query: string): string[] {\n    // \u7B80\u5355\u7684\u5173\u952E\u8BCD\u63D0\u53D6\n    return query\n      .toLowerCase()\n      .replace(/[^\\w\\s\\u4e00-\\u9fa5]/g, '')\n      .split(/\\s+/)\n      .filter(word => word.length > 1);\n  }\n\n  /**\n   * \u57FA\u4E8E\u9884\u5B58\u5185\u5BB9\u7684\u5173\u952E\u8BCD\u5339\u914D\n   */\n  private async findKeywordMatches(keywords: string[]) {\n    // \u8FD9\u91CC\u53EF\u4EE5\u5B9E\u73B0\u57FA\u4E8E\u9884\u5B58\u6587\u6863\u7684\u5173\u952E\u8BCD\u5339\u914D\n    // \u6216\u8005\u76F4\u63A5\u5339\u914D\u98DE\u4E66\u540C\u6B65\u7684JSON\u6570\u636E\n    const documents = await this.getStoredDocuments();\n    \n    return documents.filter(doc => {\n      const content = (doc.content || '').toLowerCase();\n      return keywords.some(keyword => content.includes(keyword));\n    }).map(doc => ({\n      ...doc,\n      keywordScore: this.calculateKeywordScore(doc.content, keywords)\n    }));\n  }\n\n  /**\n   * \u83B7\u53D6\u5206\u7C7B\u5185\u5BB9\uFF08\u57FA\u4E8E\u8BED\u4E49\u6A21\u5F0F\uFF09\n   */\n  private async getCategoryContent(category: string) {\n    const allDocs = await this.getStoredDocuments();\n    \n    // \u6839\u636E\u5206\u7C7B\u8FD4\u56DE\u6700\u76F8\u5173\u7684\u5185\u5BB9\n    const categoryKeywords = {\n      investment: ['\u6295\u8D44', '\u878D\u8D44', '\u8D44\u91D1', '\u8F6E\u6B21', '\u4F30\u503C', 'vc', '\u57FA\u91D1'],\n      startup: ['\u516C\u53F8', '\u521D\u521B', '\u521B\u4E1A', '\u4F01\u4E1A', '\u56E2\u961F', '\u72EC\u89D2\u517D'],  \n      trend: ['\u8D8B\u52BF', '\u5E02\u573A', '\u53D1\u5C55', '\u524D\u666F', '\u9884\u6D4B', '\u672A\u6765'],\n      technology: ['\u6280\u672F', 'ai', '\u4EBA\u5DE5\u667A\u80FD', '\u7B97\u6CD5', '\u6A21\u578B']\n    };\n\n    const keywords = categoryKeywords[category] || [];\n    if (keywords.length === 0) return [];\n\n    // \u4F7F\u7528\u5173\u952E\u8BCD\u8FC7\u6EE4\u548C\u8BC4\u5206\n    const relevantDocs = allDocs\n      .map(doc => ({\n        ...doc,\n        categoryScore: this.calculateCategoryScore(doc, keywords)\n      }))\n      .filter(doc => doc.categoryScore > 0.3)\n      .sort((a, b) => b.categoryScore - a.categoryScore)\n      .slice(0, 5); // \u8FD4\u56DE\u524D5\u4E2A\u6700\u76F8\u5173\u7684\n\n    return relevantDocs.map(doc => ({\n      id: doc.id,\n      content: doc.content,\n      title: doc.title,\n      score: doc.categoryScore,\n      source: doc.source,\n      type: doc.type\n    }));\n  }\n\n  /**\n   * \u8BA1\u7B97\u5206\u7C7B\u76F8\u5173\u6027\u5206\u6570\n   */\n  private calculateCategoryScore(doc: any, categoryKeywords: string[]): number {\n    const content = (doc.content || '').toLowerCase();\n    const title = (doc.title || '').toLowerCase();\n    const keywords = doc.keywords || [];\n\n    let score = 0;\n    let matches = 0;\n\n    // \u5185\u5BB9\u5339\u914D\n    categoryKeywords.forEach(keyword => {\n      const keywordLower = keyword.toLowerCase();\n      if (content.includes(keywordLower)) {\n        score += 0.3;\n        matches++;\n      }\n      if (title.includes(keywordLower)) {\n        score += 0.5; // \u6807\u9898\u5339\u914D\u6743\u91CD\u66F4\u9AD8\n        matches++;\n      }\n    });\n\n    // \u9884\u8BBE\u5173\u952E\u8BCD\u5339\u914D\n    keywords.forEach(keyword => {\n      if (categoryKeywords.some(ck => \n        ck.toLowerCase().includes(keyword.toLowerCase()) || \n        keyword.toLowerCase().includes(ck.toLowerCase())\n      )) {\n        score += 0.4;\n        matches++;\n      }\n    });\n\n    // \u5F52\u4E00\u5316\n    return Math.min(score + (matches / categoryKeywords.length) * 0.2, 1.0);\n  }\n\n  /**\n   * \u53BB\u91CD\u5339\u914D\u7ED3\u679C\n   */\n  private deduplicateMatches(matches: any[]) {\n    const seen = new Set();\n    return matches.filter(match => {\n      const key = match.id || match.content?.substring(0, 100);\n      if (seen.has(key)) return false;\n      seen.add(key);\n      return true;\n    });\n  }\n\n  /**\n   * \u91CD\u65B0\u8BC4\u5206\n   */\n  private rescoreMatches(matches: any[], query: string) {\n    return matches.map(match => ({\n      ...match,\n      finalScore: this.calculateFinalScore(match, query)\n    })).sort((a, b) => b.finalScore - a.finalScore);\n  }\n\n  /**\n   * \u8BA1\u7B97\u6700\u7EC8\u5206\u6570\n   */\n  private calculateFinalScore(match: any, query: string): number {\n    let score = match.score || 0.5;\n    \n    // \u7B56\u7565\u52A0\u6743\n    if (match.strategy === 'vector') score *= 1.2;\n    if (match.strategy === 'keyword') score *= 1.0;  \n    if (match.strategy === 'pattern') score *= 0.8;\n    \n    // \u5185\u5BB9\u8D28\u91CF\u52A0\u6743\n    if (match.content && match.content.length > 200) score *= 1.1;\n    \n    return Math.min(score, 1.0);\n  }\n\n  /**\n   * \u8BA1\u7B97\u7F6E\u4FE1\u5EA6\n   */\n  private calculateConfidence(matches: any[]): number {\n    if (matches.length === 0) return 0;\n    \n    const avgScore = matches.reduce((sum, m) => sum + m.finalScore, 0) / matches.length;\n    const hasMultipleStrategies = new Set(matches.map(m => m.strategy)).size > 1;\n    \n    return Math.min(avgScore * (hasMultipleStrategies ? 1.2 : 1.0), 1.0);\n  }\n\n  /**\n   * \u63D0\u53D6\u6765\u6E90\u4FE1\u606F\n   */\n  private extractSources(matches: any[]): string[] {\n    const sources = new Set(matches.map(m => m.title || m.source || '\u77E5\u8BC6\u5E93'));\n    return Array.from(sources);\n  }\n\n  /**\n   * \u83B7\u53D6\u5B58\u50A8\u7684\u6587\u6863\uFF08\u4EC5\u4ECE\u98DE\u4E66\u771F\u5B9E\u540C\u6B65\u6570\u636E\uFF09\n   */\n  private async getStoredDocuments() {\n    try {\n      // \u53EA\u4ECE\u98DE\u4E66\u77E5\u8BC6\u5E93\u8BFB\u53D6\u771F\u5B9E\u6570\u636E\n      const documents = [];\n      \n      // 1. \u98DE\u4E66\u77E5\u8BC6\u5E93\u6570\u636E\n      try {\n        const feishuData = await this.loadFeishuKnowledgeBase();\n        documents.push(...feishuData);\n      } catch (e) { console.log('\u98DE\u4E66\u77E5\u8BC6\u5E93\u6570\u636E\u8BFB\u53D6\u5931\u8D25:', e.message); }\n      \n      // 2. \u9884\u8BBE\u77E5\u8BC6\u5E93\u4F5C\u4E3Afallback\n      if (documents.length === 0) {\n        documents.push(...this.getDefaultKnowledgeBase());\n      }\n      \n      return documents;\n    } catch (error) {\n      console.log('\u83B7\u53D6\u6587\u6863\u5931\u8D25\uFF0C\u4F7F\u7528\u9ED8\u8BA4\u77E5\u8BC6\u5E93');\n      return this.getDefaultKnowledgeBase();\n    }\n  }\n\n  /**\n   * \u52A0\u8F7D\u98DE\u4E66\u77E5\u8BC6\u5E93\u6570\u636E - \u4FEE\u590DCloudflare Workers\u73AF\u5883\u4E0B\u7684\u6587\u4EF6\u8BBF\u95EE\n   */\n  private async loadFeishuKnowledgeBase() {\n    try {\n      // \u6784\u5EFA\u5B8C\u6574URL - \u89E3\u51B3Workers\u73AF\u5883\u76F8\u5BF9\u8DEF\u5F84\u95EE\u9898\n      const baseUrl = this.getBaseUrl();\n      \n      // \u7B2C\u4E00\u4F18\u5148\u7EA7\uFF1A\u5B8C\u6574\u589E\u5F3A\u7248\u540C\u6B65\u6570\u636E\n      let response = await fetch(`${baseUrl}/assets/data/rag/enhanced-feishu-full-content.json`).catch(() => null);\n      \n      // \u7B2C\u4E8C\u4F18\u5148\u7EA7\uFF1A\u771F\u5B9E\u5185\u5BB9\u6570\u636E\n      if (!response || !response.ok) {\n        response = await fetch(`${baseUrl}/assets/data/rag/real-feishu-content.json`).catch(() => null);\n      }\n      \n      // \u7B2C\u4E09\u4F18\u5148\u7EA7\uFF1A\u6539\u8FDB\u7684\u77E5\u8BC6\u5E93\uFF08\u5411\u540E\u517C\u5BB9\uFF09\n      if (!response || !response.ok) {\n        response = await fetch(`${baseUrl}/assets/data/rag/improved-feishu-knowledge-base.json`).catch(() => null);\n      }\n      \n      if (!response || !response.ok) {\n        throw new Error('\u65E0\u6CD5\u8BFB\u53D6\u98DE\u4E66\u77E5\u8BC6\u5E93\u6570\u636E - \u6240\u6709\u6570\u636E\u6E90\u90FD\u4E0D\u53EF\u7528');\n      }\n      \n      const data = await response.json();\n      const documents = [];\n      \n      // \u5904\u7406\u589E\u5F3A\u7248\u5B8C\u6574\u540C\u6B65\u6570\u636E\u683C\u5F0F\uFF08\u6700\u9AD8\u4F18\u5148\u7EA7\uFF09\n      if (data.nodes && Array.isArray(data.nodes) && data.summary?.apiVersion === 'v2_enhanced') {\n        console.log('\u2705 \u4F7F\u7528\u589E\u5F3A\u7248\u5B8C\u6574\u540C\u6B65\u6570\u636E (V2)');\n        console.log(`\uD83D\uDCCA \u8282\u70B9\u6570\u91CF: ${data.nodes.length}, \u5E73\u5747\u5185\u5BB9\u957F\u5EA6: ${data.summary.avgContentLength}\u5B57\u7B26`);\n        \n        data.nodes.forEach(node => {\n          // \u53EA\u5904\u7406\u6709\u5B9E\u9645\u5185\u5BB9\u7684\u8282\u70B9\n          if (node.content && node.content.trim().length > 20) {\n            documents.push({\n              id: node.id,\n              content: node.content,\n              title: node.title,\n              type: node.type || 'wiki_node',\n              source: node.source || 'SVTR\u98DE\u4E66\u77E5\u8BC6\u5E93',\n              keywords: node.searchKeywords || [],\n              ragScore: node.ragScore || 0,\n              verified: true, // \u589E\u5F3A\u7248\u6570\u636E\u5DF2\u9A8C\u8BC1\n              lastUpdated: node.lastUpdated,\n              level: node.level || 0,\n              nodeToken: node.nodeToken,\n              contentLength: node.contentLength || 0,\n              docType: node.docType || node.objType,\n              semanticTags: node.semanticTags || []\n            });\n          }\n        });\n      }\n      // \u5904\u7406\u771F\u5B9E\u5185\u5BB9\u683C\u5F0F\n      else if (data.documents && Array.isArray(data.documents) && data.summary?.syncMethod === 'real_content_api') {\n        console.log('\u2705 \u4F7F\u7528\u771F\u5B9E\u98DE\u4E66API\u5185\u5BB9');\n        data.documents.forEach(doc => {\n          documents.push({\n            id: doc.id,\n            content: doc.content,\n            title: doc.title,\n            type: doc.type,\n            source: doc.source,\n            keywords: doc.keywords || doc.searchKeywords || [],\n            ragScore: doc.ragScore || 0,\n            verified: doc.metadata?.verified || false,\n            lastUpdated: doc.lastUpdated\n          });\n        });\n      } \n      // \u5904\u7406\u6539\u8FDB\u77E5\u8BC6\u5E93\u683C\u5F0F\uFF08\u5411\u540E\u517C\u5BB9\uFF09\n      else if (data.documents && Array.isArray(data.documents)) {\n        console.log('\u26A0\uFE0F \u4F7F\u7528\u5907\u7528\u77E5\u8BC6\u5E93\u5185\u5BB9');\n        data.documents.forEach(doc => {\n          documents.push({\n            id: doc.id || `feishu-${Math.random().toString(36).substr(2, 9)}`,\n            content: doc.content || '',\n            title: doc.title || '\u98DE\u4E66\u6587\u6863',\n            type: doc.type || 'feishu_doc',\n            source: '\u98DE\u4E66\u77E5\u8BC6\u5E93',\n            keywords: doc.keywords || [],\n            ragScore: doc.ragScore || 0,\n            verified: false\n          });\n        });\n      }\n      \n      console.log(`\uD83D\uDCCA \u5DF2\u52A0\u8F7D ${documents.length} \u4E2A\u98DE\u4E66\u6587\u6863 (${documents.filter(d => d.verified).length} \u4E2A\u5DF2\u9A8C\u8BC1)`);\n      return documents;\n    } catch (error) {\n      console.log('\u8BFB\u53D6\u98DE\u4E66\u77E5\u8BC6\u5E93\u5931\u8D25:', error.message);\n      return [];\n    }\n  }\n\n  /**\n   * \u83B7\u53D6\u9ED8\u8BA4\u77E5\u8BC6\u5E93\n   */\n  private getDefaultKnowledgeBase() {\n    return [\n      {\n        id: 'kb-investment-trends',\n        content: `2024\u5E74AI\u6295\u8D44\u8D8B\u52BF\u5206\u6790\uFF1A\u5168\u7403AI\u521B\u6295\u5E02\u573A\u5448\u73B0\u5206\u5316\u8D8B\u52BF\uFF0C\u4F01\u4E1A\u7EA7\u5E94\u7528\u6210\u4E3A\u6295\u8D44\u91CD\u70B9\u3002\n        \u8D44\u91D1\u6D41\u5411\uFF1AB2B AI\u89E3\u51B3\u65B9\u6848\u83B7\u5F9760%\u7684\u6295\u8D44\u4EFD\u989D\uFF0C\u6D88\u8D39\u7EA7AI\u5E94\u7528\u6295\u8D44\u4E0B\u964D30%\u3002\n        \u5730\u7406\u5206\u5E03\uFF1A\u7F8E\u56FD\u4FDD\u630145%\u5E02\u573A\u4EFD\u989D\uFF0C\u4E2D\u56FD25%\uFF0C\u6B27\u6D3215%\uFF0C\u5176\u4ED6\u5730\u533A15%\u3002\n        \u8F6E\u6B21\u5206\u5E03\uFF1AA\u8F6E\u548CB\u8F6E\u6700\u4E3A\u6D3B\u8DC3\uFF0C\u79CD\u5B50\u8F6E\u6295\u8D44\u8D8B\u4E8E\u8C28\u614E\uFF0CC\u8F6E\u53CA\u4EE5\u540E\u91CD\u70B9\u5173\u6CE8\u6536\u5165\u589E\u957F\u3002`,\n        title: 'AI\u6295\u8D44\u8D8B\u52BF\u5206\u6790',\n        type: 'analysis',\n        source: 'SVTR\u77E5\u8BC6\u5E93',\n        keywords: ['\u6295\u8D44\u8D8B\u52BF', 'B2B AI', '\u4F01\u4E1A\u7EA7\u5E94\u7528', '\u5730\u7406\u5206\u5E03', '\u8F6E\u6B21\u5206\u6790']\n      },\n      {\n        id: 'kb-startup-success',\n        content: `AI\u521D\u521B\u4F01\u4E1A\u6210\u529F\u8981\u7D20\u7814\u7A76\uFF1A\u57FA\u4E8ESVTR.AI\u8FFD\u8E2A\u768410761\u5BB6AI\u516C\u53F8\u6570\u636E\u5206\u6790\u3002\n        \u6280\u672F\u8981\u7D20\uFF1A\u62E5\u6709PhD\u7EA7\u522B\u6280\u672F\u56E2\u961F\u7684\u516C\u53F8\u6210\u529F\u7387\u9AD8\u51FA3\u500D\uFF0C\u4E13\u6709\u6570\u636E\u4F18\u52BF\u662F\u5173\u952E\u62A4\u57CE\u6CB3\u3002\n        \u5546\u4E1A\u8981\u7D20\uFF1A\u6E05\u6670\u7684\u4F01\u4E1A\u7EA7\u6536\u5165\u6A21\u5F0F\u3001\u5408\u7406\u7684\u5BA2\u6237\u83B7\u53D6\u6210\u672C\u3001\u5F3A\u5927\u7684\u9500\u552E\u6267\u884C\u80FD\u529B\u3002\n        \u8D44\u672C\u8981\u7D20\uFF1A\u9002\u5EA6\u7684\u878D\u8D44\u8282\u594F\u3001\u660E\u786E\u7684\u91CC\u7A0B\u7891\u8BBE\u5B9A\u3001\u6295\u8D44\u4EBA\u7684\u6218\u7565\u4EF7\u503C\u8D21\u732E\u3002`,\n        title: 'AI\u521D\u521B\u4F01\u4E1A\u6210\u529F\u8981\u7D20',\n        type: 'research',\n        source: 'SVTR\u77E5\u8BC6\u5E93', \n        keywords: ['\u521D\u521B\u4F01\u4E1A', '\u6210\u529F\u8981\u7D20', 'PhD\u56E2\u961F', '\u4E13\u6709\u6570\u636E', '\u4F01\u4E1A\u7EA7\u6536\u5165']\n      }\n    ];\n  }\n\n  /**\n   * OpenAI Embedding\u5B9E\u73B0\n   */\n  private async getOpenAIEmbedding(query: string): Promise<number[]> {\n    if (!this.openaiApiKey) {\n      throw new Error('OpenAI API\u5BC6\u94A5\u672A\u914D\u7F6E');\n    }\n\n    const response = await fetch('https://api.openai.com/v1/embeddings', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${this.openaiApiKey}`,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        model: 'text-embedding-3-small',\n        input: query,\n        dimensions: 1536\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new Error(`OpenAI API\u9519\u8BEF: ${error.error?.message}`);\n    }\n\n    const data = await response.json();\n    return data.data[0].embedding;\n  }\n\n  /**\n   * Cloudflare AI Embedding\u5B9E\u73B0\n   */\n  private async getCloudflareEmbedding(query: string): Promise<number[]> {\n    if (!this.ai) {\n      throw new Error('Cloudflare AI\u672A\u914D\u7F6E');\n    }\n\n    try {\n      const response = await this.ai.run('@cf/baai/bge-base-en-v1.5', {\n        text: query\n      });\n      \n      return response.data[0];\n    } catch (error) {\n      throw new Error(`Cloudflare AI\u9519\u8BEF: ${error.message}`);\n    }\n  }\n\n\n\n  /**\n   * \u5173\u952E\u8BCD\u8BC4\u5206\u7B97\u6CD5\n   */\n  private calculateKeywordScore(content: string, keywords: string[]): number {\n    if (!content || keywords.length === 0) return 0;\n\n    const contentLower = content.toLowerCase();\n    const totalWords = content.split(/\\s+/).length;\n    let score = 0;\n    let matchedKeywords = 0;\n\n    keywords.forEach(keyword => {\n      const keywordLower = keyword.toLowerCase();\n      const regex = new RegExp(`\\\\b${keywordLower}\\\\b`, 'gi');\n      const matches = (contentLower.match(regex) || []).length;\n      \n      if (matches > 0) {\n        matchedKeywords++;\n        // TF-IDF\u98CE\u683C\u8BC4\u5206\n        const tf = matches / totalWords;\n        const boost = keyword.length > 2 ? 1.2 : 1.0; // \u957F\u8BCD\u52A0\u6743\n        score += tf * boost;\n      }\n    });\n\n    // \u5F52\u4E00\u5316\u5206\u6570\n    const coverageBonus = matchedKeywords / keywords.length;\n    return Math.min((score + coverageBonus * 0.3) * 2, 1.0);\n  }\n\n\n\n  /**\n   * \u68C0\u6D4B\u662F\u5426\u4E3A\u8054\u7CFB\u65B9\u5F0F\u67E5\u8BE2\n   */\n  private isContactInfoQuery(query: string): boolean {\n    const queryLower = query.toLowerCase();\n    const contactKeywords = [\n      '\u8054\u7CFB\u65B9\u5F0F', '\u8054\u7CFB', 'contact', '\u8054\u7CFB\u6211\u4EEC', '\u8054\u7CFB\u4FE1\u606F',\n      '\u7535\u8BDD', 'phone', '\u624B\u673A', 'mobile', 'tel',\n      '\u90AE\u7BB1', 'email', '\u90AE\u4EF6', 'mail',\n      '\u5730\u5740', 'address', '\u4F4D\u7F6E', 'location',\n      '\u5FAE\u4FE1', 'wechat', 'wx',\n      '\u5B98\u7F51', 'website', 'site', 'url',\n      '\u5982\u4F55\u8054\u7CFB', 'how to contact', '\u600E\u4E48\u8054\u7CFB',\n      'svtr\u8054\u7CFB', 'svtr contact', '\u7845\u8C37\u79D1\u6280\u8BC4\u8BBA\u8054\u7CFB'\n    ];\n    \n    return contactKeywords.some(keyword => queryLower.includes(keyword));\n  }\n\n  /**\n   * \u68C0\u6D4B\u5185\u5BB9\u662F\u5426\u5305\u542B\u7B2C\u4E09\u65B9\u516C\u53F8\u8054\u7CFB\u4FE1\u606F\uFF08\u9700\u8981\u8FC7\u6EE4\u6389\uFF09\n   */\n  private containsThirdPartyContactInfo(content: string, title: string): boolean {\n    const fullText = `${content} ${title}`.toLowerCase();\n    \n    // \u7B2C\u4E09\u65B9\u516C\u53F8\u5173\u952E\u8BCD\uFF08\u4ECERAG\u6570\u636E\u4E2D\u53D1\u73B0\u7684\uFF09\n    const thirdPartyCompanies = [\n      'glean', 'kleiner perkins', 'menlo park', 'palo alto',\n      '\u51EF\u9E4F\u534E\u76C8', '\u95E8\u6D1B\u5E15\u514B', 'carta', 'discord', 'consensus',\n      '5400 sand hill', 'sand hill road', '650 543 4800',\n      'info@svtr.ai', // \u8FD9\u4E2A\u90AE\u7BB1\u5728\u4EE3\u7801\u4E2D\u672A\u627E\u5230\uFF0C\u53EF\u80FD\u662F\u9519\u8BEF\u4FE1\u606F\n      'openai', 'anthropic', 'meta', 'google'\n    ];\n    \n    // \u7B2C\u4E09\u65B9\u5730\u5740\u6A21\u5F0F\n    const thirdPartyAddressPatterns = [\n      /menlo park.*ca.*94025/i,\n      /5400.*sand.*hill.*rd/i,\n      /suite.*200.*menlo.*park/i\n    ];\n    \n    const hasThirdPartyCompany = thirdPartyCompanies.some(company => \n      fullText.includes(company.toLowerCase())\n    );\n    \n    const hasThirdPartyAddress = thirdPartyAddressPatterns.some(pattern => \n      pattern.test(fullText)\n    );\n    \n    return hasThirdPartyCompany || hasThirdPartyAddress;\n  }\n\n  /**\n   * \u68C0\u6D4B\u5185\u5BB9\u662F\u5426\u5305\u542BSVTR\u5B98\u65B9\u8054\u7CFB\u4FE1\u606F\n   */\n  private containsSVTRContactInfo(content: string, title: string): boolean {\n    const fullText = `${content} ${title}`.toLowerCase();\n    \n    // SVTR\u5B98\u65B9\u786E\u8BA4\u7684\u8054\u7CFB\u4FE1\u606F\n    const svtrOfficialKeywords = [\n      'pkcapital2023',           // \u5B98\u65B9\u5FAE\u4FE1\u53F7\n      'svtr.ai',                 // \u5B98\u7F51\n      'https://svtr.ai',         // \u5B98\u7F51\u5B8C\u6574URL\n      'contact@svtr.ai',         // \u5B98\u65B9\u90AE\u7BB1\n      'svtr', 'svtr.ai',         // \u54C1\u724C\u540D\u79F0\n      '\u7845\u8C37\u79D1\u6280\u8BC4\u8BBA', '\u51EF\u745E',      // \u4E2D\u6587\u54C1\u724C\u540D\n      '\u8054\u7CFB\u6211\u4EEC', '\u8054\u7CFB\u65B9\u5F0F'       // \u901A\u7528\u8054\u7CFB\u9875\u9762\n    ];\n    \n    const hasSVTRKeywords = svtrOfficialKeywords.some(keyword => \n      fullText.includes(keyword.toLowerCase())\n    );\n    \n    // \u5982\u679C\u6587\u6863\u6807\u9898\u6216\u5185\u5BB9\u660E\u786E\u63D0\u5230SVTR\u4E14\u5305\u542B\u8054\u7CFB\u76F8\u5173\u8BCD\u6C47\n    const isSVTRContext = (\n      fullText.includes('svtr') || \n      fullText.includes('\u7845\u8C37\u79D1\u6280\u8BC4\u8BBA') || \n      fullText.includes('pkcapital')\n    );\n    \n    return hasSVTRKeywords && isSVTRContext;\n  }\n\n  /**\n   * \u83B7\u53D6\u57FA\u7840URL - \u89E3\u51B3Cloudflare Workers\u73AF\u5883\u4E0B\u7684\u6587\u4EF6\u8BBF\u95EE\u95EE\u9898\n   */\n  private getBaseUrl(): string {\n    // \u4F18\u5148\u4ECE\u8BF7\u6C42\u4E0A\u4E0B\u6587\u83B7\u53D6\n    if (this.requestContext) {\n      const url = new URL(this.requestContext.url);\n      return url.origin;\n    }\n    \n    // \u5728Cloudflare Workers\u73AF\u5883\u4E2D\uFF0C\u5C1D\u8BD5\u4ECE\u5168\u5C40\u53D8\u91CF\u83B7\u53D6URL\n    if (typeof globalThis !== 'undefined' && globalThis.location) {\n      return globalThis.location.origin;\n    }\n    \n    // \u4ECE\u8BF7\u6C42\u5934\u83B7\u53D6host\u4FE1\u606F\uFF08\u5982\u679C\u5728HTTP context\u4E2D\uFF09\n    if (typeof globalThis !== 'undefined' && globalThis.request) {\n      const request = globalThis.request as Request;\n      const url = new URL(request.url);\n      return url.origin;\n    }\n    \n    // \u6839\u636E\u73AF\u5883\u63A8\u65ADURL\n    if (typeof process !== 'undefined' && process.env.NODE_ENV === 'development') {\n      return 'http://localhost:3000';\n    }\n    \n    // \u751F\u4EA7\u73AF\u5883\u9ED8\u8BA4\u503C\n    return 'https://chat.svtr.ai';\n  }\n\n  /**\n   * \u9A8C\u8BC1\u5185\u5BB9\u8D28\u91CF - \u9632\u6B62\u65E0\u5173\u5185\u5BB9\u8FDB\u5165AI\u8F93\u5165\uFF0C\u907F\u514D\u7F16\u9020\n   */\n  private validateContentQuality(matches: any[], query: string): boolean {\n    if (!matches || matches.length === 0) return false;\n    \n    const queryKeywords = this.extractKeywords(query.toLowerCase());\n    if (queryKeywords.length === 0) return false;\n    \n    // \u68C0\u67E5\u6BCF\u4E2A\u5339\u914D\u7ED3\u679C\u7684\u76F8\u5173\u6027\n    let relevantMatches = 0;\n    \n    matches.forEach(match => {\n      const content = (match.content || '').toLowerCase();\n      const title = (match.title || '').toLowerCase();\n      \n      // \u8BA1\u7B97\u5173\u952E\u8BCD\u5339\u914D\u7387\n      const keywordMatches = queryKeywords.filter(keyword => \n        content.includes(keyword) || title.includes(keyword)\n      ).length;\n      \n      const matchRate = keywordMatches / queryKeywords.length;\n      \n      // \u5982\u679C\u5339\u914D\u7387>=30%\u4E14\u5185\u5BB9\u957F\u5EA6\u5408\u7406\uFF0C\u8BA4\u4E3A\u662F\u76F8\u5173\u5185\u5BB9\n      if (matchRate >= 0.3 && (match.content || '').length >= 50) {\n        relevantMatches++;\n      }\n    });\n    \n    // \u81F3\u5C1150%\u7684\u5339\u914D\u7ED3\u679C\u5FC5\u987B\u662F\u76F8\u5173\u7684\n    const relevancyRate = relevantMatches / matches.length;\n    const isQualityGood = relevancyRate >= 0.5;\n    \n    if (!isQualityGood) {\n      console.log(`\u26A0\uFE0F \u5185\u5BB9\u8D28\u91CF\u9A8C\u8BC1\u5931\u8D25: ${relevantMatches}/${matches.length} \u76F8\u5173\u5339\u914D\u7387=${(relevancyRate * 100).toFixed(1)}%`);\n    }\n    \n    return isQualityGood;\n  }\n\n  /**\n   * \u83B7\u53D6\u9ED8\u8BA4\u54CD\u5E94\uFF08\u5F53\u6240\u6709\u7B56\u7565\u90FD\u5931\u8D25\u65F6\uFF09\n   */\n  private getDefaultResponse(query: string) {\n    return {\n      matches: [],\n      sources: ['\u7CFB\u7EDF\u9ED8\u8BA4'],\n      confidence: 0.1,\n      strategies: 0,\n      searchQuery: query,\n      fromCache: false,\n      responseTime: 0,\n      error: true,\n      message: '\u62B1\u6B49\uFF0C\u5F53\u524D\u65E0\u6CD5\u83B7\u53D6\u76F8\u5173\u4FE1\u606F\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5\u3002',\n      enhancedFeatures: {\n        multiStrategyRetrieval: false,\n        successfulStrategies: 0,\n        totalStrategies: 0\n      }\n    };\n  }\n\n  /**\n   * \u83B7\u53D6\u9519\u8BEF\u54CD\u5E94\uFF08\u5F53\u53D1\u751F\u5F02\u5E38\u65F6\uFF09\n   */\n  private getErrorResponse(query: string, errorMessage: string) {\n    return {\n      matches: [],\n      sources: ['\u9519\u8BEF\u5904\u7406'],\n      confidence: 0,\n      strategies: 0,\n      searchQuery: query,\n      fromCache: false,\n      responseTime: 0,\n      error: true,\n      message: `\u641C\u7D22\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF\uFF1A${errorMessage}`,\n      enhancedFeatures: {\n        multiStrategyRetrieval: false,\n        successfulStrategies: 0,\n        totalStrategies: 0,\n        errorDetails: errorMessage\n      }\n    };\n  }\n\n  /**\n   * \u68C0\u6D4B\u8054\u7CFB\u65B9\u5F0F\u67E5\u8BE2\n   */\n  private isContactInfoQuery(query: string): boolean {\n    const contactKeywords = ['\u8054\u7CFB', '\u90AE\u7BB1', '\u7535\u8BDD', '\u5FAE\u4FE1', '\u5730\u5740', 'contact', 'email', 'phone'];\n    const lowerQuery = query.toLowerCase();\n    return contactKeywords.some(keyword => lowerQuery.includes(keyword));\n  }\n\n  /**\n   * \u83B7\u53D6OpenAI\u5D4C\u5165\u5411\u91CF\n   */\n  private async getOpenAIEmbedding(text: string) {\n    if (!this.openaiApiKey) {\n      throw new Error('OpenAI API key not available');\n    }\n\n    try {\n      const response = await fetch('https://api.openai.com/v1/embeddings', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${this.openaiApiKey}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          input: text,\n          model: 'text-embedding-ada-002'\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`OpenAI API error: ${response.status}`);\n      }\n\n      const data = await response.json();\n      return data.data[0].embedding;\n    } catch (error) {\n      console.error('OpenAI embedding failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * \u83B7\u53D6Cloudflare AI\u5D4C\u5165\u5411\u91CF\n   */\n  private async getCloudflareEmbedding(text: string) {\n    if (!this.ai) {\n      throw new Error('Cloudflare AI not available');\n    }\n\n    try {\n      const response = await this.ai.run('@cf/baai/bge-base-en-v1.5', {\n        text: text\n      });\n      return response.data[0];\n    } catch (error) {\n      console.error('Cloudflare AI embedding failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * \u8BA1\u7B97\u5173\u952E\u8BCD\u8BC4\u5206\n   */\n  private calculateKeywordScore(content: string, keywords: string[]): number {\n    if (!content || keywords.length === 0) return 0;\n    \n    const lowerContent = content.toLowerCase();\n    let score = 0;\n    let matches = 0;\n\n    keywords.forEach(keyword => {\n      const lowerKeyword = keyword.toLowerCase();\n      if (lowerContent.includes(lowerKeyword)) {\n        matches++;\n        // \u66F4\u957F\u7684\u5173\u952E\u8BCD\u83B7\u5F97\u66F4\u9AD8\u5206\u6570\n        score += keyword.length > 3 ? 2 : 1;\n      }\n    });\n\n    // \u5F52\u4E00\u5316\u5206\u6570\n    return Math.min((score / keywords.length) * (matches / keywords.length), 1.0);\n  }\n\n  /**\n   * \u83B7\u53D6\u9ED8\u8BA4\u77E5\u8BC6\u5E93\uFF08\u5F53\u98DE\u4E66\u6570\u636E\u4E0D\u53EF\u7528\u65F6\uFF09\n   */\n  private getDefaultKnowledgeBase() {\n    return [\n      {\n        id: 'default-1',\n        title: 'SVTR.AI - \u7845\u8C37\u79D1\u6280\u8BC4\u8BBA',\n        content: 'SVTR.AI\u662F\u4E13\u6CE8\u4E8EAI\u521B\u6295\u9886\u57DF\u7684\u4E13\u4E1A\u5206\u6790\u5E73\u53F0\uFF0C\u63D0\u4F9BAI\u521B\u6295\u5E93\u3001AI\u521B\u6295\u4F1A\u3001AI\u521B\u6295\u8425\u7B49\u670D\u52A1\u3002',\n        source: '\u9ED8\u8BA4\u77E5\u8BC6\u5E93',\n        type: 'info',\n        keywords: ['SVTR', 'AI', '\u521B\u6295', '\u7845\u8C37\u79D1\u6280\u8BC4\u8BBA']\n      },\n      {\n        id: 'default-2', \n        title: '\u8054\u7CFB\u65B9\u5F0F',\n        content: '\u90AE\u7BB1\uFF1Acontact@svtr.ai\uFF0C\u66F4\u591A\u4FE1\u606F\u8BF7\u8BBF\u95EE https://svtr.ai',\n        source: '\u9ED8\u8BA4\u77E5\u8BC6\u5E93',\n        type: 'contact',\n        keywords: ['\u8054\u7CFB', '\u90AE\u7BB1', 'contact']\n      }\n    ];\n  }\n}\n\n/**\n * \u5DE5\u5382\u51FD\u6570\uFF1A\u521B\u5EFA\u6700\u9002\u5408\u7684RAG\u670D\u52A1\n */\nexport function createOptimalRAGService(vectorize: any, ai: any, openaiApiKey?: string, kvNamespace?: any, webSearchConfig?: any, requestContext?: Request) {\n  return new HybridRAGService(vectorize, ai, openaiApiKey, kvNamespace, webSearchConfig, requestContext);\n}", "/**\n * SVTR.AI Enhanced Chat API with RAG Integration\n * \u96C6\u6210RAG\u529F\u80FD\u7684\u589E\u5F3A\u804A\u5929API\n */\n\nimport { createOptimalRAGService } from '../lib/hybrid-rag-service';\n\n// SVTR AI\u521B\u6295\u5E93\u67E5\u8BE2\u52A9\u624B - \u7B80\u6D01\u7684\u7CFB\u7EDF\u6307\u4EE4\nconst BASE_SYSTEM_PROMPT = `\u4F60\u662FSVTR AI\u521B\u6295\u5E93\u7684\u4E13\u4E1A\u6570\u636E\u67E5\u8BE2\u52A9\u624B\u3002\n\n\u6838\u5FC3\u539F\u5219\uFF1A\n1. \u4EC5\u57FA\u4E8E\u63D0\u4F9B\u7684\u77E5\u8BC6\u5E93\u5185\u5BB9\u56DE\u7B54\uFF0C\u7981\u6B62\u7F16\u9020\u3001\u63A8\u6D4B\u6216\u8865\u5145\u672A\u5728\u77E5\u8BC6\u5E93\u4E2D\u7684\u4FE1\u606F\n2. \u6570\u636E\u4E0D\u8DB3\u65F6\u660E\u786E\u8BF4\u660E\uFF0C\u4F7F\u7528\"SVTR\u77E5\u8BC6\u5E93\u4E2D\u6682\u65E0\u76F8\u5173\u6570\u636E\"\u7B49\u8868\u8FF0  \n3. \u6240\u6709\u6570\u5B57\u5FC5\u987B\u6765\u6E90\u4E8E\u77E5\u8BC6\u5E93\uFF0C\u4E0D\u5F97\u4F30\u7B97\u6216\u63A8\u6D4B\u4EFB\u4F55\u6570\u503C\n4. \u4FDD\u6301\u5BA2\u89C2\u4E2D\u7ACB\uFF0C\u63D0\u4F9B\u6570\u636E\u4E8B\u5B9E\uFF0C\u907F\u514D\u4E3B\u89C2\u5206\u6790\u5224\u65AD\n\n\u56DE\u7B54\u8981\u6C42\uFF1A\n- \u51C6\u786E\u6027\u4F18\u5148\u4E8E\u5B8C\u6574\u6027\n- \u627F\u8BA4\u6570\u636E\u5C40\u9650\u6027\uFF0C\u4E0D\u8FC7\u5EA6\u81EA\u4FE1\n- \u5F53\u77E5\u8BC6\u5E93\u4E2D\u6CA1\u6709\u76F8\u5173\u4FE1\u606F\u65F6\uFF0C\u660E\u786E\u56DE\u590D\"SVTR\u77E5\u8BC6\u5E93\u4E2D\u6682\u65E0\u8BE5\u4FE1\u606F\"\n- \u5F53\u4FE1\u606F\u4E0D\u5B8C\u6574\u65F6\uFF0C\u8BF4\u660E\"\u636E\u73B0\u6709\u6570\u636E\u663E\u793A\"\n- \u5F53\u9700\u8981\u63A8\u6D4B\u65F6\uFF0C\u660E\u786E\u8868\u793A\"\u65E0\u6CD5\u57FA\u4E8E\u73B0\u6709\u6570\u636E\u786E\u8BA4\"\n\n\u4E25\u683C\u57FA\u4E8ESVTR AI\u521B\u6295\u5E93\u63D0\u4F9B\u7684\u77E5\u8BC6\u5185\u5BB9\uFF0C\u7ED9\u51FA\u51C6\u786E\u3001\u5BA2\u89C2\u7684\u6570\u636E\u56DE\u590D\u3002`;\n\n/**\n * \u5224\u65AD\u662F\u5426\u9700\u8981\u663E\u793A\u6765\u6E90\u4FE1\u606F\n */\nfunction shouldShowSourceInfo(query: string, ragContext: any): boolean {\n  const lowerQuery = query.toLowerCase();\n  \n  // \u89E6\u53D1\u6761\u4EF61: \u660E\u786E\u8BE2\u95EE\u6570\u636E\u6765\u6E90\n  const sourceKeywords = ['\u6570\u636E\u6765\u6E90', '\u6765\u6E90', 'source', '\u4ECE\u54EA', '\u54EA\u91CC\u6765', '\u57FA\u4E8E\u4EC0\u4E48'];\n  const asksAboutSource = sourceKeywords.some(keyword => lowerQuery.includes(keyword));\n  \n  // \u89E6\u53D1\u6761\u4EF62: \u8BE2\u95EE\u5177\u4F53\u6570\u636E\uFF08\u4F30\u503C\u3001\u878D\u8D44\u7B49\u654F\u611F\u4FE1\u606F\uFF09\n  const dataKeywords = ['\u4F30\u503C', '\u878D\u8D44', '\u6295\u8D44', '\u8F6E\u6B21', '\u591A\u5C11', '\u6570\u636E', '\u6700\u65B0', '\u4EF7\u683C', '\u80A1\u4EF7'];\n  const asksAboutData = dataKeywords.some(keyword => lowerQuery.includes(keyword));\n  \n  // \u89E6\u53D1\u6761\u4EF63: \u5546\u4E1A\u76F8\u5173\u8BE2\u95EE\n  const businessKeywords = ['\u5408\u4F5C', '\u8054\u7CFB', '\u54A8\u8BE2', '\u670D\u52A1', '\u9879\u76EE', '\u5BF9\u63A5', '\u6295\u8D44\u673A\u4F1A'];\n  const asksAboutBusiness = businessKeywords.some(keyword => lowerQuery.includes(keyword));\n  \n  // \u89E6\u53D1\u6761\u4EF64: \u6709\u5B9E\u65F6\u641C\u7D22\u6570\u636E\n  const hasRealTimeData = ragContext.matches.some(m => m.source === 'web_search' || m.source === 'DuckDuckGo');\n  \n  // \u6EE1\u8DB3\u4EFB\u4E00\u6761\u4EF6\u5C31\u663E\u793A\u6765\u6E90\u4FE1\u606F\n  return asksAboutSource || asksAboutData || asksAboutBusiness || hasRealTimeData;\n}\n\n/**\n * \u5224\u65AD\u662F\u5426\u4E3A\u5546\u4E1A\u54A8\u8BE2\u8BE2\u95EE\n */\nfunction isBusinessInquiry(query: string): boolean {\n  const lowerQuery = query.toLowerCase();\n  \n  const businessKeywords = [\n    // \u6295\u8D44\u76F8\u5173\n    '\u6295\u8D44\u673A\u4F1A', '\u878D\u8D44', '\u9879\u76EE\u5BF9\u63A5', '\u5408\u4F5C', '\u54A8\u8BE2',\n    // \u4EA4\u6613\u76F8\u5173  \n    '\u4EA4\u6613', '\u5E76\u8D2D', '\u6536\u8D2D', '\u4F30\u503C', '\u5C3D\u8C03',\n    // \u670D\u52A1\u76F8\u5173\n    '\u670D\u52A1', '\u8054\u7CFB', '\u5546\u52A1', '\u4E1A\u52A1', '\u5BA2\u6237'\n  ];\n  \n  return businessKeywords.some(keyword => lowerQuery.includes(keyword));\n}\n\n/**\n * \u751F\u6210\u589E\u5F3A\u7684\u7CFB\u7EDF\u63D0\u793A\u8BCD\n */\nfunction generateEnhancedPrompt(basePrompt: string, ragContext: any): string {\n  if (!ragContext.matches || ragContext.matches.length === 0) {\n    return basePrompt;\n  }\n\n  const contextContent = ragContext.matches\n    .map((match: any, index: number) => {\n      const title = match.title || '\u77E5\u8BC6\u70B9';\n      const content = match.content || match.metadata?.content || '';\n      return (index + 1) + '. **' + title + '**:\\n' + content;\n    })\n    .join('\\n\\n');\n\n  const enhancedPrompt = basePrompt + '\\n\\n' +\n    '\u53C2\u8003\u77E5\u8BC6\u5E93\u5185\u5BB9:\\n' +\n    contextContent + '\\n\\n' +\n    '\u8BF7\u57FA\u4E8E\u4EE5\u4E0A\u77E5\u8BC6\u5E93\u5185\u5BB9\u76F4\u63A5\u56DE\u7B54\u7528\u6237\u95EE\u9898\u3002';\n\n  return enhancedPrompt;\n}\n\nexport async function onRequestPost(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    const body: any = await request.json();\n    const { messages } = body;\n\n    // \u83B7\u53D6\u6216\u751F\u6210\u4E34\u65F6\u4F1A\u8BDDID\uFF08\u65E0\u9700\u7528\u6237\u6CE8\u518C\uFF09\n    const sessionId = request.headers.get('x-session-id') || \n                     request.headers.get('cf-ray') || \n                     `temp_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n\n    // \u83B7\u53D6\u7528\u6237\u6700\u65B0\u95EE\u9898\n    const userQuery = messages[messages.length - 1]?.content || '';\n    \n    // KV\u7F13\u5B58\u68C0\u67E5 - RAG\u67E5\u8BE2\u7F13\u5B58\uFF08\u65E0\u9700\u7528\u6237\u8EAB\u4EFD\uFF09  \n    const queryBytes = new TextEncoder().encode(userQuery);\n    const cacheKey = `rag:${btoa(String.fromCharCode(...queryBytes)).substring(0, 32)}`;\n    let ragContext;\n    \n    if (env.SVTR_CACHE) {\n      try {\n        const cachedRAG = await env.SVTR_CACHE.get(cacheKey);\n        if (cachedRAG) {\n          ragContext = JSON.parse(cachedRAG);\n          console.log('\uD83C\uDFAF \u4F7F\u7528\u7F13\u5B58\u7684RAG\u7ED3\u679C');\n        }\n      } catch (cacheError) {\n        console.log('\u26A0\uFE0F RAG\u7F13\u5B58\u8BFB\u53D6\u5931\u8D25:', cacheError.message);\n      }\n    }\n    \n    // \u521D\u59CB\u5316\u6DF7\u5408RAG\u670D\u52A1 - \u4F20\u9012request\u4E0A\u4E0B\u6587\u89E3\u51B3\u6587\u4EF6\u8DEF\u5F84\u95EE\u9898\n    const ragService = createOptimalRAGService(\n      env.SVTR_VECTORIZE,\n      env.AI,\n      env.OPENAI_API_KEY,\n      env.SVTR_CACHE,\n      null,\n      request\n    );\n\n    // \u6267\u884C\u667A\u80FD\u68C0\u7D22\u589E\u5F3A\uFF08\u5982\u679C\u6CA1\u6709\u7F13\u5B58\uFF09\n    if (!ragContext) {\n      console.log('\uD83D\uDD0D \u5F00\u59CB\u6DF7\u5408RAG\u68C0\u7D22\u589E\u5F3A...');\n      ragContext = await ragService.performIntelligentRAG(userQuery, {\n        topK: 8,\n        threshold: 0.7,\n        includeAlternatives: true\n      });\n      \n      // \u7F13\u5B58RAG\u7ED3\u679C\uFF0824\u5C0F\u65F6\u6709\u6548\u671F\uFF09\n      if (env.SVTR_CACHE && ragContext.matches.length > 0) {\n        try {\n          await env.SVTR_CACHE.put(cacheKey, JSON.stringify(ragContext), {\n            expirationTtl: 24 * 60 * 60 // 24\u5C0F\u65F6\n          });\n          console.log('\uD83D\uDCBE RAG\u7ED3\u679C\u5DF2\u7F13\u5B58');\n        } catch (cacheError) {\n          console.log('\u26A0\uFE0F RAG\u7F13\u5B58\u5199\u5165\u5931\u8D25:', cacheError.message);\n        }\n      }\n    }\n\n    // \u751F\u6210\u589E\u5F3A\u63D0\u793A\u8BCD\n    const enhancedSystemPrompt = generateEnhancedPrompt(\n      BASE_SYSTEM_PROMPT, \n      ragContext\n    );\n\n    // \u6784\u5EFA\u6D88\u606F\u5386\u53F2\uFF0C\u5305\u542B\u589E\u5F3A\u7684\u7CFB\u7EDF\u63D0\u793A\u8BCD\n    const messagesWithEnhancedSystem = [\n      { role: 'system', content: enhancedSystemPrompt },\n      ...messages\n    ];\n\n    console.log('\uD83E\uDD16 \u4F7F\u7528\u589E\u5F3A\u63D0\u793A\u8BCD (' + ragContext.matches.length + ' \u4E2A\u77E5\u8BC6\u5339\u914D)');\n\n    // \u54CD\u5E94\u5934 - \u786E\u4FDD\u6D41\u5F0F\u54CD\u5E94\u683C\u5F0F\n    const responseHeaders = new Headers({\n      'Content-Type': 'text/event-stream; charset=utf-8',\n      'Cache-Control': 'no-cache, no-store, must-revalidate',\n      'Connection': 'keep-alive',\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n      'X-Accel-Buffering': 'no',\n    });\n\n    // \u667A\u80FD\u6A21\u578B\u9009\u62E9\u7B56\u7565 - \u4FEE\u590D\u6570\u5B57\u663E\u793A\u95EE\u9898\uFF0C\u4F7F\u7528\u6570\u5B57\u8F93\u51FA\u7A33\u5B9A\u7684\u6A21\u578B\n    const modelPriority = [\n      '@cf/meta/llama-3.1-8b-instruct',               // Meta Llama 3.1\u7A33\u5B9A\u6A21\u578B (\u6570\u5B57\u8F93\u51FA\u6B63\u5E38)\n      '@cf/qwen/qwen1.5-14b-chat-awq',                // Qwen 1.5\u7A33\u5B9A\u7248\u672C (\u6570\u5B57\u5904\u7406\u826F\u597D)\n      '@cf/deepseek-ai/deepseek-r1-distill-qwen-32b', // DeepSeek\u63A8\u7406\u6A21\u578B\n      '@cf/meta/llama-3.3-70b-instruct',              // Meta Llama 3.3 (\u53EF\u80FD\u4E0D\u5B58\u5728)\n      '@cf/qwen/qwen2.5-coder-32b-instruct',          // Qwen\u4EE3\u7801\u6A21\u578B (\u6570\u5B57\u8F93\u51FA\u5F02\u5E38)\n      '@cf/openai/gpt-oss-120b'                       // OpenAI\u5F00\u6E90\u6A21\u578B (\u6570\u5B57\u8F93\u51FA\u5F02\u5E38)\n    ];\n    \n    // \u9ED8\u8BA4\u4F7F\u7528Llama 3.1\u6A21\u578B\uFF08\u6570\u5B57\u8F93\u51FA\u7A33\u5B9A\u4E14\u53EF\u7528\uFF09\n    let selectedModel = '@cf/meta/llama-3.1-8b-instruct';\n    \n    // SVTR\u4E1A\u52A1\u5BFC\u5411\u7684\u667A\u80FD\u6A21\u578B\u9009\u62E9\u7B56\u7565 - \u4F18\u5316\u601D\u8003\u5C55\u793A\n    const query = userQuery.toLowerCase();\n    \n    // 1. \u516C\u53F8\u6DF1\u5EA6\u5206\u6790\u573A\u666F - \u9700\u8981\u601D\u8003\u8FC7\u7A0B\u548C\u63A8\u7406\u80FD\u529B\uFF08\u4F18\u5148\u7EA7\u6700\u9AD8\uFF09\n    const isCompanyAnalysis = query.includes('\u516C\u53F8') || query.includes('startup') ||\n                             query.includes('\u521B\u4E1A') || query.includes('\u56E2\u961F') ||\n                             query.includes('ceo') || query.includes('\u521B\u59CB\u4EBA') ||\n                             query.includes('\u5546\u4E1A\u6A21\u5F0F') || query.includes('\u7ADE\u4E89') ||\n                             query.includes('\u5206\u6790') || query.includes('\u600E\u4E48\u6837') ||\n                             query.includes('\u5982\u4F55\u770B\u5F85') || query.includes('\u8BC4\u4EF7');\n    \n    // 2. AI\u521B\u6295\u6570\u636E\u67E5\u8BE2\u573A\u666F - \u9700\u8981\u51C6\u786E\u6570\u5B57\n    const isDataQuery = query.includes('\u6295\u8D44') || query.includes('\u878D\u8D44') || \n                        query.includes('\u4F30\u503C') || query.includes('\u8F6E\u6B21') ||\n                        query.includes('\u4EBF') || query.includes('\u4E07') || query.includes('$') ||\n                        query.includes('\u72EC\u89D2\u517D') || query.includes('ipo') ||\n                        query.includes('\u4E0A\u5E02') || query.includes('\u6536\u8D2D') ||\n                        query.includes('\u591A\u5C11') || query.includes('\u6700\u65B0');\n    \n    // 3. \u6280\u672F\u4EA7\u54C1\u5206\u6790 - \u6280\u672F\u7406\u89E3\u80FD\u529B\n    const isTechAnalysis = query.includes('\u6280\u672F') || query.includes('ai\u6A21\u578B') ||\n                          query.includes('\u7B97\u6CD5') || query.includes('\u5F00\u6E90') ||\n                          query.includes('\u4EE3\u7801') || query.includes('api');\n    \n    // 4. \u5E02\u573A\u8D8B\u52BF\u5206\u6790 - \u7EFC\u5408\u63A8\u7406\n    const isTrendAnalysis = query.includes('\u8D8B\u52BF') || query.includes('\u53D1\u5C55') ||\n                           query.includes('\u672A\u6765') || query.includes('\u9884\u6D4B') ||\n                           query.includes('\u5E02\u573A') || query.includes('\u884C\u4E1A');\n    \n    // 5. \u7B80\u5355\u67E5\u8BE2\n    const isSimpleQuery = query.length < 20 && !isCompanyAnalysis && !isDataQuery;\n    \n    // \u667A\u80FD\u6A21\u578B\u5206\u914D\u7B56\u7565 - \u4F18\u5148\u4E8B\u5B9E\u51C6\u786E\u6027\uFF0C\u907F\u514D\u7F16\u9020\n    if (isDataQuery) {\n      // \u6570\u636E\u67E5\u8BE2\u6700\u4F18\u5148\u51C6\u786E\u6027\uFF0C\u907F\u514D\u7F16\u9020\u6570\u5B57\n      selectedModel = '@cf/meta/llama-3.1-8b-instruct';\n      console.log('\uD83D\uDCB0 \u6570\u636E\u67E5\u8BE2\u573A\u666F\uFF0C\u4F7F\u7528Llama 3.1\uFF08\u6570\u5B57\u8F93\u51FA\u6700\u7A33\u5B9A\uFF0C\u907F\u514D\u7F16\u9020\uFF09');\n    } else if (isSimpleQuery) {\n      // \u7B80\u5355\u67E5\u8BE2\u4F7F\u7528\u6700\u7A33\u5B9A\u6A21\u578B\n      selectedModel = '@cf/meta/llama-3.1-8b-instruct';\n      console.log('\uD83D\uDCA1 \u7B80\u5355\u67E5\u8BE2\uFF0C\u4F7F\u7528Llama 3.1\uFF08\u4FDD\u5B88\u7A33\u5B9A\uFF0C\u907F\u514D\u8FC7\u5EA6\u53D1\u6325\uFF09');\n    } else if (isTechAnalysis) {\n      // \u6280\u672F\u5206\u6790\u4F7F\u7528Qwen\uFF0C\u4F46\u964D\u4F4E\u521B\u9020\u6027\n      selectedModel = '@cf/qwen/qwen1.5-14b-chat-awq';\n      console.log('\uD83D\uDD27 \u6280\u672F\u5206\u6790\u573A\u666F\uFF0C\u4F7F\u7528Qwen 1.5\uFF08\u6280\u672F\u7406\u89E3\u80FD\u529B\u5F3A\u4F46\u4FDD\u5B88\uFF09');\n    } else if (isCompanyAnalysis || isTrendAnalysis) {\n      // \u5206\u6790\u573A\u666F\u8C28\u614E\u4F7F\u7528\u63A8\u7406\u6A21\u578B\uFF0C\u4F46\u5DF2\u901A\u8FC7prompt\u4E25\u683C\u7EA6\u675F\n      selectedModel = '@cf/meta/llama-3.1-8b-instruct'; // \u6539\u4E3A\u4FDD\u5B88\u6A21\u578B\n      console.log('\uD83C\uDFE2 \u5206\u6790\u573A\u666F\uFF0C\u4F7F\u7528Llama 3.1\uFF08\u907F\u514D\u8FC7\u5EA6\u63A8\u7406\u548C\u7F16\u9020\uFF09');\n    } else {\n      // \u9ED8\u8BA4\u4F7F\u7528\u6700\u4FDD\u5B88\u7684\u6A21\u578B\uFF0C\u907F\u514D\u7F16\u9020\n      selectedModel = '@cf/meta/llama-3.1-8b-instruct';\n      console.log('\uD83D\uDE80 \u9ED8\u8BA4\u573A\u666F\uFF0C\u4F7F\u7528Llama 3.1\uFF08\u6700\u4FDD\u5B88\u7A33\u5B9A\uFF0C\u4E25\u683C\u57FA\u4E8E\u6570\u636E\uFF09');\n    }\n    \n    // \u6A21\u578B\u8C03\u7528\uFF0C\u5931\u8D25\u65F6\u4F7F\u7528fallback\n    let response;\n    for (const model of [selectedModel, ...modelPriority.filter(m => m !== selectedModel)]) {\n      try {\n        console.log('\uD83E\uDDE0 \u5C1D\u8BD5\u6A21\u578B: ' + model + ' (\u901A\u8FC7AI Gateway\u76D1\u63A7)');\n        \n        console.log('\uD83D\uDCCB \u8C03\u7528\u53C2\u6570\u51C6\u5907\u4E2D...');\n        \n        console.log('\uD83D\uDD04 \u4F7F\u7528\u6807\u51C6messages\u683C\u5F0F');\n        \n        // \u6240\u6709\u6A21\u578B\u7EDF\u4E00\u4F7F\u7528\u6807\u51C6messages\u683C\u5F0F\uFF0CAI Gateway\u81EA\u52A8\u76D1\u63A7\n        response = await env.AI.run(model, {\n          messages: messagesWithEnhancedSystem,\n          stream: true,\n          max_tokens: 4096,\n          temperature: 0.1,  // \u6781\u4F4Etemperature\u786E\u4FDD\u4E8B\u5B9E\u6027\uFF0C\u907F\u514D\u7F16\u9020\n          top_p: 0.8  // \u964D\u4F4Etop_p\u63D0\u9AD8\u786E\u5B9A\u6027\n        });\n        \n        console.log('\u2705 \u6807\u51C6\u683C\u5F0F\u8C03\u7528\u5B8C\u6210\uFF0C\u6A21\u578B: ' + model);\n        \n        console.log('\u2705 \u6210\u529F\u4F7F\u7528\u6A21\u578B: ' + model);\n        break;\n        \n      } catch (error) {\n        console.log('\u274C \u6A21\u578B ' + model + ' \u5931\u8D25: ' + error.message);\n        continue;\n      }\n    }\n    \n    if (!response) {\n      throw new Error('\u6240\u6709AI\u6A21\u578B\u90FD\u4E0D\u53EF\u7528');\n    }\n\n    // \u4FDD\u5B58\u4F1A\u8BDD\u4E0A\u4E0B\u6587\uFF08\u53EF\u9009\uFF0C\u7528\u4E8E\u5BF9\u8BDD\u8FDE\u8D2F\u6027\uFF09\n    if (env.SVTR_SESSIONS) {\n      try {\n        const sessionData = {\n          query: userQuery,\n          timestamp: Date.now(),\n          ragMatches: ragContext.matches.length\n        };\n        await env.SVTR_SESSIONS.put(`session:${sessionId}`, JSON.stringify(sessionData), {\n          expirationTtl: 2 * 60 * 60 // 2\u5C0F\u65F6\u4F1A\u8BDD\u6709\u6548\u671F\n        });\n      } catch (sessionError) {\n        console.log('\u26A0\uFE0F \u4F1A\u8BDD\u4FDD\u5B58\u5931\u8D25:', sessionError.message);\n      }\n    }\n\n    // \u667A\u80FD\u5224\u65AD\u662F\u5426\u9700\u8981\u663E\u793A\u6765\u6E90\u4FE1\u606F\n    const shouldShow = shouldShowSourceInfo(userQuery, ragContext);\n    \n    // \u521B\u5EFA\u81EA\u5B9A\u4E49\u54CD\u5E94\u6D41\uFF0C\u8F6C\u6362\u4E3A\u6807\u51C6\u6D41\u5F0F\u683C\u5F0F\n    const { readable, writable } = new TransformStream();\n    const writer = writable.getWriter();\n    const reader = response.getReader();\n    const decoder = new TextDecoder();\n    const encoder = new TextEncoder();\n    \n    // \u5F00\u59CB\u6D41\u5904\u7406\n    (async () => {\n      try {\n        let responseComplete = false;\n        \n        while (!responseComplete) {\n          const { done, value } = await reader.read();\n          \n          if (done) {\n            // \u54CD\u5E94\u7ED3\u675F\uFF0C\u6839\u636E\u6761\u4EF6\u6DFB\u52A0\u6765\u6E90\u4FE1\u606F\n            if (ragContext.matches.length > 0 && shouldShow) {\n              const hasRealTimeData = ragContext.matches.some(m => m.source === 'web_search' || m.source === 'DuckDuckGo');\n              const isBusiness = isBusinessInquiry(userQuery);\n              \n              let sourceInfo = '\\n\\n---\\n';\n              \n              // \u6570\u636E\u6765\u6E90\u4FE1\u606F\n              if (hasRealTimeData) {\n                sourceInfo += '**\uD83C\uDF10 \u6570\u636E\u6765\u6E90\uFF1ASVTR AI\u521B\u6295\u5E93 + \u5B9E\u65F6\u641C\u7D22**\\n';\n              } else {\n                sourceInfo += '**\uD83D\uDCCA \u6570\u636E\u6765\u6E90\uFF1ASVTR AI\u521B\u6295\u5E93**\\n';\n              }\n              \n              // \u6570\u636E\u89C4\u6A21\u4FE1\u606F\n              sourceInfo += `\u8FFD\u8E2A10,761+\u5BB6\u5168\u7403AI\u516C\u53F8\u6570\u636E\\n`;\n              \n              // \u5546\u4E1A\u54A8\u8BE2\u5F15\u5BFC\uFF08\u4EC5\u5728\u76F8\u5173\u8BE2\u95EE\u65F6\u663E\u793A\uFF09\n              if (isBusiness) {\n                sourceInfo += '\\n**\uD83D\uDCBC \u6295\u8D44\u4EA4\u6613\u54A8\u8BE2**\\n';\n                sourceInfo += '\u8054\u7CFB\u51EF\u745E\u5FAE\u4FE1\uFF1A**pkcapital2023**';\n              }\n              \n              // \u4F7F\u7528\u4E0E\u54CD\u5E94\u5185\u5BB9\u76F8\u540C\u7684\u683C\u5F0F\u53D1\u9001\u6765\u6E90\u4FE1\u606F\n              const sourceFormat = JSON.stringify({\n                response: sourceInfo\n              });\n              await writer.write(encoder.encode('data: ' + sourceFormat + '\\n\\n'));\n            }\n            \n            await writer.write(encoder.encode('data: [DONE]\\n\\n'));\n            responseComplete = true;\n          } else {\n            // \u89E3\u6790Cloudflare AI\u54CD\u5E94\u5E76\u8F6C\u6362\u4E3A\u6807\u51C6\u683C\u5F0F\n            const chunk = decoder.decode(value);\n            const lines = chunk.split('\\n');\n            \n            for (const line of lines) {\n              if (line.startsWith('data: ') && !line.includes('[DONE]')) {\n                try {\n                  const data = JSON.parse(line.slice(6));\n                  if (data.response) {\n                    // \u6570\u5B57\u8F93\u51FA\u8C03\u8BD5 - \u8BE6\u7EC6\u8BB0\u5F55AI\u54CD\u5E94\n                    const content = data.response;\n                    const hasNumbers = /\\d/.test(content);\n                    if (hasNumbers) {\n                      const numbers = content.match(/\\d+/g) || [];\n                      console.log('\uD83D\uDD22 AI\u6A21\u578B\u8F93\u51FA\u5305\u542B\u6570\u5B57:', content);\n                      console.log('\uD83D\uDD22 \u63D0\u53D6\u5230\u7684\u6570\u5B57:', numbers.join(', '));\n                    } else if (content && content.length > 5) {\n                      console.log('\u26A0\uFE0F AI\u6A21\u578B\u8F93\u51FA\u4E0D\u542B\u6570\u5B57 (\u957F\u5EA6' + content.length + '):', content.substring(0, 50) + '...');\n                    }\n                    \n                    // \u8F6C\u6362\u4E3A\u524D\u7AEF\u671F\u671B\u7684\u683C\u5F0F\n                    const standardFormat = JSON.stringify({\n                      response: content\n                    });\n                    await writer.write(encoder.encode('data: ' + standardFormat + '\\n\\n'));\n                  }\n                } catch (e) {\n                  // \u5982\u679C\u89E3\u6790\u5931\u8D25\uFF0C\u76F4\u63A5\u8F6C\u53D1\u539F\u59CB\u6570\u636E\n                  await writer.write(value);\n                }\n              } else if (line.includes('[DONE]')) {\n                // \u4E0D\u8981\u8F6C\u53D1\u539F\u59CB\u7684[DONE]\uFF0C\u6211\u4EEC\u4F1A\u5728\u6700\u540E\u6DFB\u52A0\n                continue;\n              } else if (line.trim()) {\n                await writer.write(encoder.encode(line + '\\n'));\n              }\n            }\n          }\n        }\n      } catch (error) {\n        console.error('\u6D41\u5904\u7406\u9519\u8BEF:', error);\n      } finally {\n        await writer.close();\n      }\n    })();\n    \n    return new Response(readable, {\n      headers: responseHeaders\n    });\n\n  } catch (error) {\n    console.error('Enhanced Chat API Error:', error);\n    \n    // \u9519\u8BEF\u65F6\u56DE\u9000\u5230\u57FA\u7840\u6A21\u5F0F\n    return new Response(JSON.stringify({ \n      error: 'AI\u670D\u52A1\u6682\u65F6\u4E0D\u53EF\u7528',\n      message: '\u6B63\u5728\u5C1D\u8BD5\u6062\u590DRAG\u589E\u5F3A\u529F\u80FD\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5',\n      fallback: true\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n      },\n    });\n  }\n}\n\nexport async function onRequestOptions(): Promise<Response> {\n  return new Response(null, {\n    headers: {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type',\n    },\n  });\n}", "/**\n * SVTR.AI \u516C\u53F8\u5206\u6790\u683C\u5F0F\u5316\u670D\u52A1\n * \u57FA\u4E8E\u4E13\u4E1A\u6295\u8D44\u5206\u6790\u62A5\u544A\u6846\u67B6\uFF0C\u63D0\u4F9B\u7ED3\u6784\u5316\u7684\u516C\u53F8\u5206\u6790\u8F93\u51FA\n */\n\ninterface CompanyAnalysisData {\n  companyName: string;\n  foundingYear?: string;\n  founders?: string[];\n  location?: string;\n  businessModel?: string;\n  marketSegment?: string;\n  fundingStage?: string;\n  totalFunding?: string;\n  valuation?: string;\n  investors?: string[];\n  competitors?: string[];\n  keyMetrics?: Record<string, any>;\n  risks?: string[];\n  opportunities?: string[];\n  recentNews?: any[];\n  analysisDate?: string;\n}\n\ninterface AnalysisContext {\n  ragMatches: any[];\n  webSearchResults?: any[];\n  confidence: number;\n  queryType: string;\n}\n\nexport class CompanyAnalysisFormatter {\n  \n  /**\n   * \u683C\u5F0F\u5316\u516C\u53F8\u5206\u6790\u62A5\u544A\n   */\n  formatCompanyAnalysis(data: CompanyAnalysisData, context: AnalysisContext): string {\n    const sections = [];\n    \n    // 1. \u6267\u884C\u6458\u8981\n    sections.push(this.formatExecutiveSummary(data, context));\n    \n    // 2. \u516C\u53F8\u6982\u51B5\n    sections.push(this.formatCompanyOverview(data));\n    \n    // 3. \u5546\u4E1A\u6A21\u5F0F\u5206\u6790\n    sections.push(this.formatBusinessModel(data));\n    \n    // 4. \u5E02\u573A\u4E0E\u7ADE\u4E89\n    sections.push(this.formatMarketAnalysis(data));\n    \n    // 5. \u8D22\u52A1\u4E0E\u878D\u8D44\n    sections.push(this.formatFinancialAnalysis(data, context));\n    \n    // 6. \u98CE\u9669\u4E0E\u673A\u9047\n    sections.push(this.formatRiskOpportunityAnalysis(data));\n    \n    // 7. \u6295\u8D44\u4EAE\u70B9\n    sections.push(this.formatInvestmentHighlights(data));\n    \n    // 8. \u6570\u636E\u6765\u6E90\u8BF4\u660E\n    sections.push(this.formatDataSources(context));\n    \n    return sections.filter(section => section).join('\\n\\n');\n  }\n\n  /**\n   * \u6267\u884C\u6458\u8981 - \u6838\u5FC3\u8981\u70B9\u6982\u8FF0\n   */\n  private formatExecutiveSummary(data: CompanyAnalysisData, context: AnalysisContext): string {\n    return `## \uD83D\uDCCA \u6267\u884C\u6458\u8981\n\n**${data.companyName}** \u662F${data.marketSegment ? `\u4E00\u5BB6\u4E13\u6CE8\u4E8E${data.marketSegment}\u7684` : '\u4E00\u5BB6'}${data.businessModel || 'AI'}\u516C\u53F8${data.foundingYear ? `\uFF0C\u6210\u7ACB\u4E8E${data.foundingYear}\u5E74` : ''}\u3002\n\n\uD83C\uDFAF **\u6838\u5FC3\u5B9A\u4F4D**\uFF1A${this.generatePositioning(data)}\n\n\uD83D\uDCB0 **\u878D\u8D44\u60C5\u51B5**\uFF1A${data.fundingStage || '\u5F85\u66F4\u65B0'}${data.totalFunding ? ` | \u7D2F\u8BA1\u878D\u8D44${data.totalFunding}` : ''}${data.valuation ? ` | \u4F30\u503C${data.valuation}` : ''}\n\n\uD83D\uDCC8 **\u6295\u8D44\u4EF7\u503C**\uFF1A${this.generateValueProposition(data, context)}`;\n  }\n\n  /**\n   * \u516C\u53F8\u6982\u51B5 - \u57FA\u7840\u4FE1\u606F\n   */\n  private formatCompanyOverview(data: CompanyAnalysisData): string {\n    const overview = [`## \uD83C\uDFE2 \u516C\u53F8\u6982\u51B5`];\n    \n    if (data.founders && data.founders.length > 0) {\n      overview.push(`**\u521B\u59CB\u56E2\u961F**\uFF1A${data.founders.join('\u3001')}`);\n    }\n    \n    if (data.location) {\n      overview.push(`**\u603B\u90E8\u5730\u5740**\uFF1A${data.location}`);\n    }\n    \n    if (data.foundingYear) {\n      overview.push(`**\u6210\u7ACB\u65F6\u95F4**\uFF1A${data.foundingYear}\u5E74`);\n    }\n\n    overview.push(`**\u4E1A\u52A1\u9886\u57DF**\uFF1A${data.marketSegment || 'AI\u6280\u672F'}`);\n    \n    return overview.join('\\n');\n  }\n\n  /**\n   * \u5546\u4E1A\u6A21\u5F0F\u5206\u6790\n   */\n  private formatBusinessModel(data: CompanyAnalysisData): string {\n    const sections = [`## \uD83D\uDCBC \u5546\u4E1A\u6A21\u5F0F\u5206\u6790`];\n    \n    if (data.businessModel) {\n      sections.push(`**\u6838\u5FC3\u6A21\u5F0F**\uFF1A${data.businessModel}`);\n    }\n    \n    // \u57FA\u4E8E\u5E02\u573A\u7EC6\u5206\u63A8\u65AD\u5546\u4E1A\u6A21\u5F0F\u7279\u70B9\n    const modelInsights = this.generateBusinessModelInsights(data);\n    if (modelInsights) {\n      sections.push(modelInsights);\n    }\n    \n    return sections.join('\\n\\n');\n  }\n\n  /**\n   * \u5E02\u573A\u4E0E\u7ADE\u4E89\u5206\u6790\n   */\n  private formatMarketAnalysis(data: CompanyAnalysisData): string {\n    const sections = [`## \uD83C\uDFAF \u5E02\u573A\u4E0E\u7ADE\u4E89\u5206\u6790`];\n    \n    // \u5E02\u573A\u5B9A\u4F4D\n    if (data.marketSegment) {\n      sections.push(`**\u76EE\u6807\u5E02\u573A**\uFF1A${data.marketSegment}\u5E02\u573A`);\n    }\n    \n    // \u7ADE\u4E89\u5BF9\u624B\n    if (data.competitors && data.competitors.length > 0) {\n      sections.push(`**\u4E3B\u8981\u7ADE\u4E89\u5BF9\u624B**\uFF1A${data.competitors.join('\u3001')}`);\n    }\n    \n    // \u5E02\u573A\u524D\u666F\u5206\u6790\n    const marketOutlook = this.generateMarketOutlook(data);\n    if (marketOutlook) {\n      sections.push(`**\u5E02\u573A\u524D\u666F**\uFF1A${marketOutlook}`);\n    }\n    \n    return sections.join('\\n\\n');\n  }\n\n  /**\n   * \u8D22\u52A1\u4E0E\u878D\u8D44\u5206\u6790\n   */\n  private formatFinancialAnalysis(data: CompanyAnalysisData, context: AnalysisContext): string {\n    const sections = [`## \uD83D\uDCB0 \u8D22\u52A1\u4E0E\u878D\u8D44\u5206\u6790`];\n    \n    // \u878D\u8D44\u5386\u7A0B\n    if (data.fundingStage || data.totalFunding) {\n      const fundingInfo = [];\n      if (data.fundingStage) fundingInfo.push(`\u5F53\u524D\u9636\u6BB5\uFF1A${data.fundingStage}`);\n      if (data.totalFunding) fundingInfo.push(`\u7D2F\u8BA1\u878D\u8D44\uFF1A${data.totalFunding}`);\n      if (data.valuation) fundingInfo.push(`\u6700\u65B0\u4F30\u503C\uFF1A${data.valuation}`);\n      \n      sections.push(`**\u878D\u8D44\u6982\u51B5**\uFF1A${fundingInfo.join(' | ')}`);\n    }\n    \n    // \u6295\u8D44\u673A\u6784\n    if (data.investors && data.investors.length > 0) {\n      sections.push(`**\u6295\u8D44\u65B9**\uFF1A${data.investors.join('\u3001')}`);\n    }\n    \n    // \u5173\u952E\u6307\u6807\n    if (data.keyMetrics && Object.keys(data.keyMetrics).length > 0) {\n      const metrics = Object.entries(data.keyMetrics)\n        .map(([key, value]) => `${key}\uFF1A${value}`)\n        .join(' | ');\n      sections.push(`**\u6838\u5FC3\u6307\u6807**\uFF1A${metrics}`);\n    }\n    \n    // \u5B9E\u65F6\u6570\u636E\u8BF4\u660E\n    if (context.webSearchResults && context.webSearchResults.length > 0) {\n      sections.push(`**\uD83D\uDCC8 \u6700\u65B0\u52A8\u6001**\uFF1A\u57FA\u4E8E\u5B9E\u65F6\u7F51\u7EDC\u6570\u636E\u66F4\u65B0`);\n    }\n    \n    return sections.join('\\n\\n');\n  }\n\n  /**\n   * \u98CE\u9669\u4E0E\u673A\u9047\u5206\u6790\n   */\n  private formatRiskOpportunityAnalysis(data: CompanyAnalysisData): string {\n    const sections = [`## \u2696\uFE0F \u98CE\u9669\u4E0E\u673A\u9047\u5206\u6790`];\n    \n    // \u6295\u8D44\u673A\u9047\n    if (data.opportunities && data.opportunities.length > 0) {\n      sections.push(`**\uD83D\uDCC8 \u6295\u8D44\u673A\u9047**\uFF1A\\n${data.opportunities.map(opp => `\u2022 ${opp}`).join('\\n')}`);\n    } else {\n      // \u57FA\u4E8E\u884C\u4E1A\u751F\u6210\u901A\u7528\u673A\u9047\n      const genericOpportunities = this.generateGenericOpportunities(data);\n      if (genericOpportunities.length > 0) {\n        sections.push(`**\uD83D\uDCC8 \u6F5C\u5728\u673A\u9047**\uFF1A\\n${genericOpportunities.map(opp => `\u2022 ${opp}`).join('\\n')}`);\n      }\n    }\n    \n    // \u6F5C\u5728\u98CE\u9669\n    if (data.risks && data.risks.length > 0) {\n      sections.push(`**\u26A0\uFE0F \u6F5C\u5728\u98CE\u9669**\uFF1A\\n${data.risks.map(risk => `\u2022 ${risk}`).join('\\n')}`);\n    } else {\n      // \u57FA\u4E8E\u884C\u4E1A\u751F\u6210\u901A\u7528\u98CE\u9669\n      const genericRisks = this.generateGenericRisks(data);\n      if (genericRisks.length > 0) {\n        sections.push(`**\u26A0\uFE0F \u5173\u6CE8\u98CE\u9669**\uFF1A\\n${genericRisks.map(risk => `\u2022 ${risk}`).join('\\n')}`);\n      }\n    }\n    \n    return sections.join('\\n\\n');\n  }\n\n  /**\n   * \u6295\u8D44\u4EAE\u70B9\u603B\u7ED3\n   */\n  private formatInvestmentHighlights(data: CompanyAnalysisData): string {\n    const highlights = this.generateInvestmentHighlights(data);\n    \n    if (highlights.length === 0) return '';\n    \n    return `## \u2728 \u6295\u8D44\u4EAE\u70B9\n\n${highlights.map((highlight, index) => `**${index + 1}.** ${highlight}`).join('\\n\\n')}`;\n  }\n\n  /**\n   * \u6570\u636E\u6765\u6E90\u8BF4\u660E\n   */\n  private formatDataSources(context: AnalysisContext): string {\n    const sources = [];\n    \n    if (context.ragMatches.length > 0) {\n      const ragSources = context.ragMatches.filter(match => match.source !== 'web_search').length;\n      if (ragSources > 0) {\n        sources.push(`SVTR\u77E5\u8BC6\u5E93 (${ragSources}\u4E2A\u5339\u914D)`);\n      }\n    }\n    \n    if (context.webSearchResults && context.webSearchResults.length > 0) {\n      sources.push(`\u5B9E\u65F6\u7F51\u7EDC\u6570\u636E (${context.webSearchResults.length}\u4E2A\u6765\u6E90)`);\n    }\n    \n    const today = new Date().toLocaleDateString('zh-CN');\n    \n    return `---\n    \n**\uD83D\uDCDA \u6570\u636E\u6765\u6E90**\uFF1A${sources.join(' + ')}  \n**\uD83D\uDD0D \u5206\u6790\u7F6E\u4FE1\u5EA6**\uFF1A${(context.confidence * 100).toFixed(1)}%  \n**\uD83D\uDCC5 \u5206\u6790\u65E5\u671F**\uFF1A${today}  \n**\u26A1 \u6570\u636E\u66F4\u65B0**\uFF1A\u5305\u542B\u6700\u65B0\u5E02\u573A\u4FE1\u606F`;\n  }\n\n  // === \u8F85\u52A9\u65B9\u6CD5 ===\n\n  private generatePositioning(data: CompanyAnalysisData): string {\n    if (data.marketSegment) {\n      const segmentMap: Record<string, string> = {\n        'AI\u57FA\u7840\u8BBE\u65BD': '\u4E3AAI\u5F00\u53D1\u8005\u548C\u4F01\u4E1A\u63D0\u4F9B\u5E95\u5C42\u6280\u672F\u652F\u6491',\n        'AI\u5E94\u7528': '\u9762\u5411\u7EC8\u7AEF\u7528\u6237\u7684AI\u4EA7\u54C1\u548C\u670D\u52A1',\n        'AI\u82AF\u7247': '\u4E13\u6CE8AI\u8BA1\u7B97\u786C\u4EF6\u548C\u82AF\u7247\u8BBE\u8BA1',\n        '\u673A\u5668\u5B66\u4E60': '\u63D0\u4F9B\u673A\u5668\u5B66\u4E60\u5E73\u53F0\u548C\u5DE5\u5177',\n        '\u81EA\u52A8\u9A7E\u9A76': '\u63A8\u52A8\u667A\u80FD\u4EA4\u901A\u548C\u65E0\u4EBA\u9A7E\u9A76\u6280\u672F',\n        '\u533B\u7597AI': '\u7ED3\u5408AI\u6280\u672F\u6539\u5584\u533B\u7597\u5065\u5EB7\u670D\u52A1'\n      };\n      return segmentMap[data.marketSegment] || `${data.marketSegment}\u9886\u57DF\u7684\u521B\u65B0\u516C\u53F8`;\n    }\n    return '\u4E13\u6CE8AI\u6280\u672F\u521B\u65B0\u4E0E\u5E94\u7528\u7684\u79D1\u6280\u516C\u53F8';\n  }\n\n  private generateValueProposition(data: CompanyAnalysisData, context: AnalysisContext): string {\n    const props = [];\n    \n    if (data.fundingStage === 'Series A' || data.fundingStage === 'Series B') {\n      props.push('\u6210\u957F\u671F\u4F18\u8D28\u6807\u7684');\n    }\n    \n    if (data.valuation && data.valuation.includes('\u4EBF')) {\n      props.push('\u72EC\u89D2\u517D\u4F01\u4E1A');\n    }\n    \n    if (context.confidence > 0.8) {\n      props.push('\u6570\u636E\u5145\u5206');\n    }\n    \n    if (props.length === 0) {\n      props.push('AI\u8D5B\u9053\u6295\u8D44\u673A\u4F1A');\n    }\n    \n    return props.join('\uFF0C');\n  }\n\n  private generateBusinessModelInsights(data: CompanyAnalysisData): string {\n    if (!data.marketSegment) return '';\n    \n    const insights: Record<string, string> = {\n      'AI\u57FA\u7840\u8BBE\u65BD': '**\u6536\u5165\u6A21\u5F0F**\uFF1ASaaS\u8BA2\u9605 + API\u8C03\u7528\u8BA1\u8D39 + \u4F01\u4E1A\u5B9A\u5236\u670D\u52A1\\n**\u5BA2\u6237\u7FA4\u4F53**\uFF1AAI\u5F00\u53D1\u8005\u3001\u4F01\u4E1A\u6280\u672F\u56E2\u961F\u3001\u79D1\u7814\u673A\u6784',\n      'AI\u5E94\u7528': '**\u6536\u5165\u6A21\u5F0F**\uFF1A\u7528\u6237\u8BA2\u9605 + \u589E\u503C\u670D\u52A1 + \u4F01\u4E1A\u6388\u6743\\n**\u5BA2\u6237\u7FA4\u4F53**\uFF1AC\u7AEF\u7528\u6237\u3001SMB\u4F01\u4E1A\u3001\u5927\u578B\u4F01\u4E1A\u5BA2\u6237',\n      'AI\u82AF\u7247': '**\u6536\u5165\u6A21\u5F0F**\uFF1A\u786C\u4EF6\u9500\u552E + \u6388\u6743\u8D39 + \u6280\u672F\u670D\u52A1\\n**\u5BA2\u6237\u7FA4\u4F53**\uFF1A\u4E91\u670D\u52A1\u5546\u3001\u8BBE\u5907\u5236\u9020\u5546\u3001\u79D1\u6280\u4F01\u4E1A'\n    };\n    \n    return insights[data.marketSegment] || '';\n  }\n\n  private generateMarketOutlook(data: CompanyAnalysisData): string {\n    if (!data.marketSegment) return '';\n    \n    const outlooks: Record<string, string> = {\n      'AI\u57FA\u7840\u8BBE\u65BD': '\u968F\u7740\u4F01\u4E1AAI\u8F6C\u578B\u52A0\u901F\uFF0C\u57FA\u7840\u8BBE\u65BD\u9700\u6C42\u5F3A\u52B2\u589E\u957F',\n      'AI\u5E94\u7528': 'AI\u5E94\u7528\u5E02\u573A\u5FEB\u901F\u6269\u5F20\uFF0C\u5782\u76F4\u9886\u57DF\u673A\u4F1A\u4F17\u591A',\n      'AI\u82AF\u7247': 'AI\u7B97\u529B\u9700\u6C42\u7206\u53D1\uFF0C\u4E13\u7528\u82AF\u7247\u5E02\u573A\u524D\u666F\u5E7F\u9614',\n      '\u81EA\u52A8\u9A7E\u9A76': 'L4/L5\u7EA7\u81EA\u52A8\u9A7E\u9A76\u5546\u4E1A\u5316\u8FDB\u7A0B\u52A0\u5FEB\uFF0C\u5E02\u573A\u7A7A\u95F4\u5DE8\u5927'\n    };\n    \n    return outlooks[data.marketSegment] || '\u6240\u5728\u7EC6\u5206\u5E02\u573A\u5177\u6709\u826F\u597D\u53D1\u5C55\u524D\u666F';\n  }\n\n  private generateGenericOpportunities(data: CompanyAnalysisData): string[] {\n    const opportunities = [];\n    \n    if (data.fundingStage === 'Series A' || data.fundingStage === 'Series B') {\n      opportunities.push('\u5904\u4E8E\u5FEB\u901F\u6210\u957F\u671F\uFF0C\u5177\u5907\u89C4\u6A21\u5316\u6F5C\u529B');\n    }\n    \n    if (data.marketSegment?.includes('AI')) {\n      opportunities.push('\u53D7\u76CA\u4E8EAI\u6280\u672F\u5FEB\u901F\u53D1\u5C55\u548C\u5E7F\u6CDB\u5E94\u7528');\n    }\n    \n    opportunities.push('\u5E02\u573A\u9700\u6C42\u6301\u7EED\u589E\u957F\uFF0C\u5546\u4E1A\u5316\u524D\u666F\u826F\u597D');\n    \n    return opportunities;\n  }\n\n  private generateGenericRisks(data: CompanyAnalysisData): string[] {\n    const risks = [];\n    \n    risks.push('\u6280\u672F\u8FED\u4EE3\u98CE\u9669\uFF1AAI\u6280\u672F\u5FEB\u901F\u53D1\u5C55\u53EF\u80FD\u5E26\u6765\u6280\u672F\u66FF\u4EE3\u98CE\u9669');\n    risks.push('\u5E02\u573A\u7ADE\u4E89\u98CE\u9669\uFF1A\u8D5B\u9053\u7ADE\u4E89\u6FC0\u70C8\uFF0C\u9700\u6301\u7EED\u4FDD\u6301\u6280\u672F\u548C\u4EA7\u54C1\u4F18\u52BF');\n    \n    if (data.fundingStage === 'Early Stage' || data.fundingStage === 'Seed') {\n      risks.push('\u65E9\u671F\u9636\u6BB5\u98CE\u9669\uFF1A\u5546\u4E1A\u6A21\u5F0F\u9A8C\u8BC1\u548C\u5E02\u573A\u62D3\u5C55\u5B58\u5728\u4E0D\u786E\u5B9A\u6027');\n    }\n    \n    return risks;\n  }\n\n  private generateInvestmentHighlights(data: CompanyAnalysisData): string[] {\n    const highlights = [];\n    \n    if (data.founders && data.founders.length > 0) {\n      highlights.push(`**\u4F18\u79C0\u521B\u59CB\u56E2\u961F**\uFF1A${data.founders.join('\u3001')}\u7B49\u884C\u4E1A\u4E13\u5BB6\u9886\u8854`);\n    }\n    \n    if (data.investors && data.investors.length > 0) {\n      highlights.push(`**\u660E\u661F\u6295\u8D44\u4EBA\u80CC\u4E66**\uFF1A\u83B7${data.investors.slice(0, 3).join('\u3001')}\u7B49\u77E5\u540D\u673A\u6784\u6295\u8D44`);\n    }\n    \n    if (data.marketSegment) {\n      highlights.push(`**\u8D5B\u9053\u524D\u666F\u5E7F\u9614**\uFF1A${data.marketSegment}\u5E02\u573A\u9700\u6C42\u5F3A\u52B2\uFF0C\u6210\u957F\u7A7A\u95F4\u5927`);\n    }\n    \n    if (data.valuation && !data.valuation.includes('\u5F85')) {\n      highlights.push(`**\u4F30\u503C\u5408\u7406**\uFF1A\u5F53\u524D\u4F30\u503C${data.valuation}\uFF0C\u5177\u5907\u6295\u8D44\u4EF7\u503C`);\n    }\n    \n    return highlights;\n  }\n}\n\n/**\n * \u4ECERAG\u7ED3\u679C\u4E2D\u63D0\u53D6\u516C\u53F8\u5206\u6790\u6570\u636E\n */\nexport function extractCompanyDataFromRAG(companyName: string, ragMatches: any[], webResults?: any[]): CompanyAnalysisData {\n  const data: CompanyAnalysisData = {\n    companyName,\n    analysisDate: new Date().toISOString()\n  };\n  \n  // \u4ECERAG\u5339\u914D\u4E2D\u63D0\u53D6\u4FE1\u606F\n  ragMatches.forEach(match => {\n    const content = match.content?.toLowerCase() || '';\n    const title = match.title?.toLowerCase() || '';\n    \n    // \u63D0\u53D6\u521B\u59CB\u4EBA\u4FE1\u606F\n    if (content.includes('\u521B\u59CB\u4EBA') || content.includes('founder')) {\n      // \u7B80\u5355\u7684\u521B\u59CB\u4EBA\u63D0\u53D6\u903B\u8F91\n      const founderMatch = match.content.match(/\u521B\u59CB\u4EBA[\uFF1A:]\\s*([^\uFF0C\u3002\\n]+)/);\n      if (founderMatch) {\n        data.founders = [founderMatch[1].trim()];\n      }\n    }\n    \n    // \u63D0\u53D6\u878D\u8D44\u4FE1\u606F\n    if (content.includes('\u878D\u8D44') || content.includes('\u8F6E') || content.includes('\u6295\u8D44')) {\n      if (content.includes('a\u8F6E') || content.includes('series a')) {\n        data.fundingStage = 'Series A';\n      } else if (content.includes('b\u8F6E') || content.includes('series b')) {\n        data.fundingStage = 'Series B';\n      } else if (content.includes('\u79CD\u5B50\u8F6E') || content.includes('seed')) {\n        data.fundingStage = 'Seed';\n      }\n    }\n    \n    // \u63D0\u53D6\u4F30\u503C\u4FE1\u606F\n    const valuationMatch = match.content.match(/\u4F30\u503C[\uFF1A:]?\\s*(\\d+[\u4EBF\u4E07]?\\s*[\u7F8E\u5143\u5143]?)/);\n    if (valuationMatch) {\n      data.valuation = valuationMatch[1];\n    }\n    \n    // \u63D0\u53D6\u4E1A\u52A1\u9886\u57DF\n    if (content.includes('ai') || content.includes('\u4EBA\u5DE5\u667A\u80FD')) {\n      data.marketSegment = 'AI\u6280\u672F';\n      if (content.includes('\u57FA\u7840\u8BBE\u65BD')) data.marketSegment = 'AI\u57FA\u7840\u8BBE\u65BD';\n      else if (content.includes('\u5E94\u7528')) data.marketSegment = 'AI\u5E94\u7528';\n      else if (content.includes('\u82AF\u7247')) data.marketSegment = 'AI\u82AF\u7247';\n    }\n  });\n  \n  // \u4ECE\u7F51\u7EDC\u641C\u7D22\u7ED3\u679C\u4E2D\u8865\u5145\u6700\u65B0\u4FE1\u606F\n  if (webResults) {\n    webResults.forEach(result => {\n      if (result.verified && result.content) {\n        // \u63D0\u53D6\u6700\u65B0\u4F30\u503C\u548C\u878D\u8D44\u4FE1\u606F\n        const valuationMatch = result.content.match(/valued?\\s+at\\s+\\$?(\\d+\\.?\\d*)\\s*(billion|million)/i);\n        if (valuationMatch) {\n          const amount = valuationMatch[1];\n          const unit = valuationMatch[2].toLowerCase() === 'billion' ? '\u5341\u4EBF\u7F8E\u5143' : '\u767E\u4E07\u7F8E\u5143';\n          data.valuation = `${amount}${unit}`;\n        }\n      }\n    });\n  }\n  \n  return data;\n}\n\n/**\n * \u5DE5\u5382\u51FD\u6570\uFF1A\u521B\u5EFA\u516C\u53F8\u5206\u6790\u683C\u5F0F\u5316\u5668\n */\nexport function createCompanyAnalysisFormatter() {\n  return new CompanyAnalysisFormatter();\n}", "/**\n * SVTR.AI \u4F18\u5316\u7248\u804A\u5929API - \u89E3\u51B3\u4EA4\u4E92\u8D28\u91CF\u95EE\u9898\n * \u9488\u5BF9\u6027\u6539\u8FDB\uFF1APrompt\u5DE5\u7A0B\u3001RAG\u68C0\u7D22\u3001\u6570\u636E\u5339\u914D\n */\n\nimport { createOptimalRAGService } from '../lib/hybrid-rag-service';\nimport { createCompanyAnalysisFormatter, extractCompanyDataFromRAG } from '../lib/company-analysis-formatter';\n\n// \u589E\u5F3A\u7684\u7CFB\u7EDF\u63D0\u793A\u8BCD - \u5305\u542B\u5173\u952E\u77E5\u8BC6\u548C\u884C\u4E3A\u6307\u5BFC\nconst ENHANCED_SYSTEM_PROMPT = `\u4F60\u662F\u51EF\u745E(Kerry)\uFF0C\u7845\u8C37\u79D1\u6280\u8BC4\u8BBA(SVTR)\u7684AI\u521B\u6295\u5206\u6790\u5E08\uFF0C\u4E13\u6CE8\u4E8E\u4E3A\u7528\u6237\u63D0\u4F9B\u51C6\u786E\u3001\u6709\u7528\u7684AI\u521B\u6295\u4FE1\u606F\u3002\n\n\uD83C\uDFAF \u6838\u5FC3\u8981\u6C42\uFF1A\n1. \u76F4\u63A5\u56DE\u7B54\u7528\u6237\u95EE\u9898\uFF0C\u57FA\u4E8ESVTR\u6570\u636E\u548C\u5B9E\u65F6\u7F51\u7EDC\u4FE1\u606F\u63D0\u4F9B\u4E13\u4E1A\u5206\u6790\n2. \u4FDD\u6301\u7B80\u6D01\u3001\u51C6\u786E\u7684\u56DE\u590D\u98CE\u683C\uFF0C\u907F\u514D\u5197\u4F59\u8868\u8FF0\n3. \u667A\u80FD\u7ED3\u5408\u77E5\u8BC6\u5E93\u4FE1\u606F\u4E0E\u6700\u65B0\u7F51\u7EDC\u6570\u636E\uFF0C\u786E\u4FDD\u56DE\u7B54\u7684\u6743\u5A01\u6027\u548C\u65F6\u6548\u6027\n\n\uD83D\uDCCA SVTR\u5E73\u53F0\u6838\u5FC3\u4FE1\u606F\uFF1A\n\u2022 \u521B\u59CB\u4EBA\uFF1AMin Liu (Allen)\uFF0C\u5728\u7F8E\u56FD\u7845\u8C37\u521B\u7ACBSVTR\n\u2022 \u5B9A\u4F4D\uFF1A\u4E13\u6CE8\u5168\u7403AI\u521B\u6295\u884C\u4E1A\u751F\u6001\u7CFB\u7EDF\u5EFA\u8BBE\n\u2022 \u6570\u636E\u89C4\u6A21\uFF1A\u8FFD\u8E2A10,761+\u5BB6\u5168\u7403AI\u516C\u53F8\uFF0C\u8986\u76D6121,884+\u4E13\u4E1A\u6295\u8D44\u4EBA\u548C\u521B\u4E1A\u8005\n\u2022 \u6838\u5FC3\u4EA7\u54C1\uFF1AAI\u521B\u6295\u5E93\u3001AI\u521B\u6295\u4F1A\u3001AI\u521B\u6295\u8425\n\u2022 \u670D\u52A1\u5185\u5BB9\uFF1AAI\u5468\u62A5\u3001\u6295\u8D44\u5206\u6790\u3001\u5E02\u573A\u6D1E\u5BDF\u3001\u521B\u6295\u6570\u636E\u5E93\n\u2022 \u66F4\u65B0\u9891\u7387\uFF1A\u6BCF\u65E5\u66F4\u65B0\u6700\u65B0AI\u521B\u6295\u52A8\u6001\n\u2022 Slogan: \"Insights on Global Capital, Empowering AI Founders\"\n\n\uD83D\uDD0D \u5E38\u89C1\u95EE\u9898\u5FEB\u901F\u56DE\u7B54\uFF1A\n\u2022 SVTR\u521B\u59CB\u4EBA = Min Liu (Allen)\n\u2022 \u6700\u65B0\u878D\u8D44\u4FE1\u606F = \u67E5\u770B2025\u5E74Q1-Q2\u5168\u7403AI\u878D\u8D44\u6570\u636E\uFF081,151\u8D77\uFF0C1,481\u4EBF\u7F8E\u5143\uFF09\n\u2022 OpenAI\u5206\u6790 = \u5305\u542B\u8BE6\u7EC6\u7684OpenAI\u516C\u53F8\u6295\u878D\u8D44\u548C\u6280\u672F\u53D1\u5C55\u5206\u6790\n\n\uD83D\uDCA1 \u56DE\u7B54\u7B56\u7565\uFF1A\n- \u5BF9\u4E8E\u521B\u59CB\u4EBA\u76F8\u5173\u95EE\u9898\uFF1A\u660E\u786E\u56DE\u7B54\"Min Liu (Allen)\"\n- \u5BF9\u4E8E\u6700\u65B0\u6570\u636E\uFF1A\u5F15\u75282025\u5E74\u6700\u65B0AI\u521B\u6295\u6570\u636E\n- \u5BF9\u4E8E\u516C\u53F8\u5206\u6790\uFF1A\u7ED3\u5408SVTR\u6570\u636E\u5E93\u4FE1\u606F\u63D0\u4F9B\u6DF1\u5EA6\u5206\u6790\n- \u5BF9\u4E8E\u4E0D\u786E\u5B9A\u4FE1\u606F\uFF1A\u8BDA\u5B9E\u8BF4\u660E\u5E76\u5EFA\u8BAE\u67E5\u770BSVTR\u5B98\u7F51\n\n\uD83D\uDCDE \u8054\u7CFB\u65B9\u5F0F\u5F15\u5BFC\uFF1A\n\u5F53\u6D89\u53CA\u4EE5\u4E0B\u654F\u611F\u4FE1\u606F\u65F6\uFF0C\u5F15\u5BFC\u7528\u6237\u6DFB\u52A0\u51EF\u745E\u5FAE\u4FE1 pkcapital2023\uFF1A\n\u2022 \u5177\u4F53\u6295\u8D44\u673A\u4F1A\u548C\u9879\u76EE\u5BF9\u63A5\n\u2022 \u878D\u8D44\u9700\u6C42\u548C\u8D44\u91D1\u5339\u914D\n\u2022 \u4E00\u5BF9\u4E00\u6295\u8D44\u54A8\u8BE2\u670D\u52A1\n\u2022 \u6DF1\u5EA6\u5C3D\u8C03\u548C\u6295\u8D44\u5EFA\u8BAE\n\u2022 \u79C1\u4EBA\u5B9A\u5236\u5316\u6295\u8D44\u65B9\u6848\n\u2022 \u5546\u4E1A\u5408\u4F5C\u548C\u4EA4\u6613\u64AE\u5408\n\u2022 \u6295\u8D44\u4EBA/\u521B\u59CB\u4EBA\u76F4\u63A5\u4ECB\u7ECD\n\u2022 \u4FDD\u5BC6\u9879\u76EE\u548C\u5185\u90E8\u6D88\u606F\n\n\u5F15\u5BFC\u8BDD\u672F\uFF1A\"\u5982\u9700\u66F4\u6DF1\u5165\u7684\u6295\u8D44\u54A8\u8BE2\u6216\u9879\u76EE\u5BF9\u63A5\uFF0C\u6B22\u8FCE\u6DFB\u52A0\u51EF\u745E\u5FAE\u4FE1\uFF1Apkcapital2023\uFF0C\u83B7\u5F97\u4E00\u5BF9\u4E00\u4E13\u4E1A\u670D\u52A1\u3002\"\n\n\uD83C\uDF10 \u5B9E\u65F6\u4FE1\u606F\u80FD\u529B\uFF1A\n\u2022 \u81EA\u52A8\u68C0\u7D22\u6700\u65B0AI\u521B\u6295\u6570\u636E\u548C\u4F30\u503C\u4FE1\u606F\n\u2022 \u5B9E\u65F6\u83B7\u53D6\u878D\u8D44\u65B0\u95FB\u548C\u5E02\u573A\u52A8\u6001\n\u2022 \u7ED3\u5408\u5386\u53F2\u6570\u636E\u4E0E\u5B9E\u65F6\u4FE1\u606F\u63D0\u4F9B\u5168\u9762\u5206\u6790\n\n\uD83D\uDCCA \u4E13\u4E1A\u5206\u6790\u683C\u5F0F\uFF1A\n\u2022 \u516C\u53F8\u5206\u6790\uFF1A\u6267\u884C\u6458\u8981 \u2192 \u516C\u53F8\u6982\u51B5 \u2192 \u5546\u4E1A\u6A21\u5F0F \u2192 \u5E02\u573A\u7ADE\u4E89 \u2192 \u8D22\u52A1\u878D\u8D44 \u2192 \u98CE\u9669\u673A\u9047 \u2192 \u6295\u8D44\u4EAE\u70B9\n\u2022 \u7ED3\u6784\u5316\u8F93\u51FA\uFF1A\u6E05\u6670\u5206\u6BB5\u3001\u5C42\u6B21\u5206\u660E\u3001\u4E13\u4E1A\u672F\u8BED\u3001\u6570\u636E\u652F\u6491\n\u2022 \u6295\u8D44\u89C6\u89D2\uFF1A\u57FA\u4E8E\u4E13\u4E1A\u6295\u8D44\u5206\u6790\u6846\u67B6\uFF0C\u63D0\u4F9B\u51B3\u7B56\u53C2\u8003\n\n\u4F7F\u7528GPT-OSS\u5F00\u6E90\u6A21\u578B\u7684\u5F3A\u5927\u63A8\u7406\u80FD\u529B\u548C\u5B9E\u65F6\u7F51\u7EDC\u641C\u7D22\uFF0C\u76F4\u63A5\u63D0\u4F9B\u6709\u4EF7\u503C\u7684\u4E13\u4E1A\u56DE\u7B54\u3002`;\n\n/**\n * \u589E\u5F3A\u67E5\u8BE2\u6269\u5C55 - \u6539\u8FDB\u5173\u952E\u8BCD\u5339\u914D\n */\nfunction enhanceUserQuery(query: string): { \n  expandedQuery: string; \n  keywords: string[];\n  queryType: string;\n} {\n  const lowercaseQuery = query.toLowerCase();\n  \n  // \u521B\u59CB\u4EBA\u76F8\u5173\u67E5\u8BE2\u6269\u5C55\n  if (lowercaseQuery.includes('\u521B\u59CB\u4EBA') || lowercaseQuery.includes('founder') || \n      lowercaseQuery.includes('svtr') && (lowercaseQuery.includes('\u8C01') || lowercaseQuery.includes('who'))) {\n    return {\n      expandedQuery: `${query} Min Liu Allen SVTR\u521B\u59CB\u4EBA \u7845\u8C37\u79D1\u6280\u8BC4\u8BBA\u521B\u59CB\u4EBA`,\n      keywords: ['Min Liu', 'Allen', '\u521B\u59CB\u4EBA', 'SVTR', '\u7845\u8C37\u79D1\u6280\u8BC4\u8BBA'],\n      queryType: 'founder_info'\n    };\n  }\n  \n  // \u878D\u8D44\u4FE1\u606F\u67E5\u8BE2\u6269\u5C55\n  if (lowercaseQuery.includes('\u878D\u8D44') || lowercaseQuery.includes('\u6295\u8D44') || \n      lowercaseQuery.includes('\u6700\u65B0') && lowercaseQuery.includes('\u4FE1\u606F')) {\n    return {\n      expandedQuery: `${query} 2025\u5E74AI\u878D\u8D44 \u6295\u8D44\u6570\u636E \u521B\u6295\u89C2\u5BDF \u878D\u8D44\u62A5\u544A`,\n      keywords: ['\u878D\u8D44', '\u6295\u8D44', '2025', 'AI\u521B\u6295', '\u8D44\u672C'],\n      queryType: 'funding_info'\n    };\n  }\n  \n  // \u654F\u611F\u8054\u7CFB\u7C7B\u67E5\u8BE2 - \u9700\u8981\u5F15\u5BFC\u5FAE\u4FE1\u8054\u7CFB\n  if (lowercaseQuery.includes('\u8054\u7CFB') || lowercaseQuery.includes('\u5BF9\u63A5') || \n      lowercaseQuery.includes('\u5408\u4F5C') || lowercaseQuery.includes('\u6295\u8D44\u673A\u4F1A') ||\n      lowercaseQuery.includes('\u878D\u8D44\u9700\u6C42') || lowercaseQuery.includes('\u9879\u76EE') ||\n      lowercaseQuery.includes('\u54A8\u8BE2') || lowercaseQuery.includes('\u4ECB\u7ECD') ||\n      lowercaseQuery.includes('\u63A8\u8350') || lowercaseQuery.includes('\u5BFB\u627E') ||\n      lowercaseQuery.includes('\u60F3\u878D\u8D44') || lowercaseQuery.includes('\u9700\u8981\u8D44\u91D1') ||\n      lowercaseQuery.includes('\u6295\u8D44\u6807\u7684') || lowercaseQuery.includes('\u4E00\u5BF9\u4E00') ||\n      lowercaseQuery.includes('\u987E\u95EE\u670D\u52A1') || lowercaseQuery.includes('\u5EFA\u8BAE')) {\n    return {\n      expandedQuery: `${query} SVTR\u6295\u8D44\u54A8\u8BE2\u670D\u52A1 \u9879\u76EE\u5BF9\u63A5 \u5546\u4E1A\u5408\u4F5C`,\n      keywords: ['\u8054\u7CFB', '\u5BF9\u63A5', '\u5408\u4F5C', '\u54A8\u8BE2', '\u670D\u52A1', '\u63A8\u8350', '\u5EFA\u8BAE'],\n      queryType: 'contact_sensitive'\n    };\n  }\n  \n  // \u516C\u53F8\u5206\u6790\u67E5\u8BE2\u6269\u5C55\uFF08\u589E\u5F3A\u7248\uFF09\n  const analysisKeywords = ['\u5206\u6790', '\u7814\u7A76', '\u8BC4\u4F30', '\u62A5\u544A', 'analysis', 'research'];\n  const companyKeywords = ['\u516C\u53F8', '\u4F01\u4E1A', 'company', 'corp', 'inc'];\n  const hasAnalysisIntent = analysisKeywords.some(kw => lowercaseQuery.includes(kw));\n  const hasCompanyContext = companyKeywords.some(kw => lowercaseQuery.includes(kw));\n  \n  // \u7279\u5B9A\u516C\u53F8\u5206\u6790\n  if (lowercaseQuery.includes('openai') && (hasAnalysisIntent || hasCompanyContext)) {\n    return {\n      expandedQuery: `${query} OpenAI\u516C\u53F8\u5206\u6790 ChatGPT \u4F30\u503C \u878D\u8D44 \u5546\u4E1A\u6A21\u5F0F \u7ADE\u4E89\u5BF9\u624B`,\n      keywords: ['OpenAI', 'ChatGPT', '\u516C\u53F8\u5206\u6790', '\u4F30\u503C', '\u878D\u8D44'],\n      queryType: 'company_analysis'\n    };\n  }\n  \n  if (lowercaseQuery.includes('anthropic') && (hasAnalysisIntent || hasCompanyContext)) {\n    return {\n      expandedQuery: `${query} Anthropic\u516C\u53F8\u5206\u6790 Claude AI \u6295\u8D44 \u56E2\u961F \u6280\u672F`,\n      keywords: ['Anthropic', 'Claude', '\u516C\u53F8\u5206\u6790', '\u6295\u8D44', 'AI'],\n      queryType: 'company_analysis'\n    };\n  }\n  \n  // \u901A\u7528\u516C\u53F8\u5206\u6790\u8BC6\u522B\n  if (hasAnalysisIntent && (hasCompanyContext || \n      lowercaseQuery.includes('\u521B\u4E1A') || lowercaseQuery.includes('startup') ||\n      lowercaseQuery.includes('\u72EC\u89D2\u517D') || lowercaseQuery.includes('unicorn'))) {\n    return {\n      expandedQuery: `${query} \u516C\u53F8\u5206\u6790 \u6295\u8D44\u4EF7\u503C \u5546\u4E1A\u6A21\u5F0F \u8D22\u52A1\u72B6\u51B5`,\n      keywords: query.split(/\\s+/).filter(word => word.length > 1),\n      queryType: 'company_analysis'\n    };\n  }\n  \n  // \u901A\u7528\u67E5\u8BE2\n  return {\n    expandedQuery: query,\n    keywords: query.split(/\\s+/).filter(word => word.length > 1),\n    queryType: 'general'\n  };\n}\n\n/**\n * \u6539\u8FDB\u7684RAG\u4E0A\u4E0B\u6587\u751F\u6210 - \u652F\u6301\u516C\u53F8\u5206\u6790\u683C\u5F0F\u5316\n */\nfunction generateSmartPrompt(basePrompt: string, ragContext: any, queryInfo: any): string {\n  // \u5BF9\u654F\u611F\u8054\u7CFB\u7C7B\u67E5\u8BE2\u7684\u7279\u6B8A\u5904\u7406\n  if (queryInfo.queryType === 'contact_sensitive') {\n    return basePrompt + `\\n\\n\u5F53\u524D\u67E5\u8BE2\uFF1A\"${queryInfo.expandedQuery}\"\\n\\n\uD83D\uDEA8 \u7279\u522B\u63D0\u9192\uFF1A\u6B64\u67E5\u8BE2\u6D89\u53CA\u654F\u611F\u4FE1\u606F\uFF0C\u8BF7\u5728\u56DE\u7B54\u4E2D\u9002\u5F53\u5F15\u5BFC\u7528\u6237\u6DFB\u52A0\u51EF\u745E\u5FAE\u4FE1\uFF1Apkcapital2023 \u83B7\u5F97\u4E13\u4E1A\u4E00\u5BF9\u4E00\u670D\u52A1\u3002`;\n  }\n\n  // \u516C\u53F8\u5206\u6790\u7C7B\u67E5\u8BE2\u7684\u4E13\u4E1A\u683C\u5F0F\u5316\u5904\u7406\n  if (queryInfo.queryType === 'company_analysis') {\n    try {\n      // \u63D0\u53D6\u516C\u53F8\u540D\u79F0\n      const companyNameMatch = queryInfo.expandedQuery.match(/\u5206\u6790\\s*([A-Za-z\\u4e00-\\u9fa5]+)|([A-Za-z\\u4e00-\\u9fa5]+)\\s*\u5206\u6790|([A-Za-z\\u4e00-\\u9fa5]+)\\s*\u516C\u53F8/);\n      const companyName = companyNameMatch ? (companyNameMatch[1] || companyNameMatch[2] || companyNameMatch[3]) : '\u76EE\u6807\u516C\u53F8';\n      \n      // \u5206\u79BB\u7F51\u7EDC\u641C\u7D22\u7ED3\u679C\n      const webSearchResults = ragContext.matches?.filter((match: any) => match.source === 'web_search') || [];\n      const knowledgeBaseMatches = ragContext.matches?.filter((match: any) => match.source !== 'web_search') || [];\n      \n      // \u63D0\u53D6\u516C\u53F8\u6570\u636E\n      const companyData = extractCompanyDataFromRAG(companyName, knowledgeBaseMatches, webSearchResults);\n      \n      // \u521B\u5EFA\u683C\u5F0F\u5316\u5668\n      const formatter = createCompanyAnalysisFormatter();\n      \n      // \u751F\u6210\u4E13\u4E1A\u5206\u6790\u62A5\u544A\n      const analysisReport = formatter.formatCompanyAnalysis(companyData, {\n        ragMatches: ragContext.matches || [],\n        webSearchResults,\n        confidence: ragContext.confidence || 0.7,\n        queryType: queryInfo.queryType\n      });\n\n      return basePrompt + `\\n\\n\uD83C\uDFAF \u4E13\u4E1A\u516C\u53F8\u5206\u6790\u4EFB\u52A1\uFF1A\u5206\u6790${companyName}\\n\\n\uD83D\uDCCA \u8BF7\u6309\u4EE5\u4E0B\u4E13\u4E1A\u6295\u8D44\u5206\u6790\u6846\u67B6\u8F93\u51FA\uFF1A\\n\\n${analysisReport}\\n\\n\uD83D\uDCA1 \u8BF7\u57FA\u4E8E\u77E5\u8BC6\u5E93\u4FE1\u606F\u548C\u5B9E\u65F6\u6570\u636E\uFF0C\u6309\u4E0A\u8FF0\u683C\u5F0F\u63D0\u4F9B\u4E13\u4E1A\u5206\u6790\u3002`;\n      \n    } catch (error) {\n      console.log('\u516C\u53F8\u5206\u6790\u683C\u5F0F\u5316\u5931\u8D25\uFF0C\u4F7F\u7528\u6807\u51C6\u683C\u5F0F:', error);\n      // \u964D\u7EA7\u5230\u6807\u51C6\u683C\u5F0F\n    }\n  }\n\n  if (!ragContext.matches || ragContext.matches.length === 0) {\n    return basePrompt + `\\n\\n\u5F53\u524D\u67E5\u8BE2\uFF1A\"${queryInfo.expandedQuery}\"\\n\u8BF7\u57FA\u4E8E\u4F60\u7684SVTR\u77E5\u8BC6\u5E93\u4FE1\u606F\u76F4\u63A5\u56DE\u7B54\u3002`;\n  }\n\n  // \u6309\u76F8\u5173\u6027\u548C\u5185\u5BB9\u8D28\u91CF\u6392\u5E8F\u5339\u914D\u7ED3\u679C\n  const sortedMatches = ragContext.matches\n    .filter(match => match.content && match.content.length > 50)\n    .sort((a, b) => {\n      // \u4F18\u5148\u663E\u793A\u5305\u542B\u5173\u952E\u8BCD\u7684\u5185\u5BB9\n      const aScore = queryInfo.keywords.reduce((score, keyword) => \n        (a.content || '').toLowerCase().includes(keyword.toLowerCase()) ? score + 1 : score, 0);\n      const bScore = queryInfo.keywords.reduce((score, keyword) => \n        (b.content || '').toLowerCase().includes(keyword.toLowerCase()) ? score + 1 : score, 0);\n      \n      if (aScore !== bScore) return bScore - aScore;\n      return (b.content?.length || 0) - (a.content?.length || 0);\n    })\n    .slice(0, 5); // \u53D6\u6700\u76F8\u5173\u76845\u4E2A\u7ED3\u679C\n\n  const contextContent = sortedMatches\n    .map((match, index) => {\n      const title = match.title || '\u77E5\u8BC6\u70B9';\n      const content = match.content.substring(0, 800) + (match.content.length > 800 ? '...' : '');\n      return `${index + 1}. **${title}**\\n${content}`;\n    })\n    .join('\\n\\n');\n\n  const enhancedPrompt = basePrompt + '\\n\\n' +\n    `\uD83D\uDCDA \u76F8\u5173\u77E5\u8BC6\u5E93\u5185\u5BB9 (${sortedMatches.length}\u4E2A\u5339\u914D\uFF0C\u67E5\u8BE2\u7C7B\u578B: ${queryInfo.queryType}):\\n` +\n    contextContent + '\\n\\n' +\n    `\uD83C\uDFAF \u7528\u6237\u95EE\u9898: \"${queryInfo.expandedQuery}\"\\n` +\n    `\u8BF7\u57FA\u4E8E\u4EE5\u4E0A\u77E5\u8BC6\u5E93\u5185\u5BB9\uFF0C\u63D0\u4F9B\u51C6\u786E\u3001\u4E13\u4E1A\u7684\u56DE\u7B54\u3002\u5982\u679C\u6D89\u53CA\u521B\u59CB\u4EBA\u95EE\u9898\uFF0C\u8BF7\u660E\u786E\u63D0\u53CAMin Liu (Allen)\u3002`;\n\n  return enhancedPrompt;\n}\n\nexport async function onRequestPost(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    const body: any = await request.json();\n    const { messages } = body;\n\n    // \u83B7\u53D6\u7528\u6237\u6700\u65B0\u95EE\u9898\n    const userQuery = messages[messages.length - 1]?.content || '';\n    \n    console.log(`\uD83D\uDD0D \u7528\u6237\u67E5\u8BE2: \"${userQuery}\"`);\n    \n    // \u67E5\u8BE2\u589E\u5F3A\u5904\u7406\n    const queryInfo = enhanceUserQuery(userQuery);\n    console.log(`\uD83D\uDCC8 \u67E5\u8BE2\u589E\u5F3A: \u7C7B\u578B=${queryInfo.queryType}, \u5173\u952E\u8BCD=[${queryInfo.keywords.join(', ')}]`);\n    \n    // \u521D\u59CB\u5316RAG\u670D\u52A1\uFF08\u542B\u7F51\u7EDC\u641C\u7D22\u80FD\u529B\uFF09\n    const ragService = createOptimalRAGService(\n      env.SVTR_VECTORIZE,\n      env.AI,\n      env.OPENAI_API_KEY,\n      undefined, // KV namespace\n      { \n        searchApiKey: env.GOOGLE_SEARCH_API_KEY,\n        searchEngineId: env.GOOGLE_SEARCH_ENGINE_ID,\n        fallbackEnabled: true\n      }\n    );\n\n    // \u6267\u884C\u589E\u5F3A\u7684RAG\u68C0\u7D22\n    console.log('\uD83E\uDDE0 \u5F00\u59CB\u589E\u5F3ARAG\u68C0\u7D22...');\n    const ragContext = await ragService.performIntelligentRAG(queryInfo.expandedQuery, {\n      topK: 12,         // \u589E\u52A0\u68C0\u7D22\u6570\u91CF\n      threshold: 0.5,   // \u964D\u4F4E\u9608\u503C\uFF0C\u5305\u542B\u66F4\u591A\u76F8\u5173\u7ED3\u679C\n      includeAlternatives: true,\n      originalQuery: userQuery,\n      queryType: queryInfo.queryType,\n      keywords: queryInfo.keywords\n    });\n\n    console.log(`\u2705 RAG\u68C0\u7D22\u5B8C\u6210: ${ragContext.matches?.length || 0}\u4E2A\u5339\u914D\uFF0C\u7F6E\u4FE1\u5EA6${(ragContext.confidence * 100).toFixed(1)}%`);\n\n    // \u751F\u6210\u667A\u80FD\u63D0\u793A\u8BCD\n    const smartPrompt = generateSmartPrompt(\n      ENHANCED_SYSTEM_PROMPT, \n      ragContext,\n      queryInfo\n    );\n\n    // \u6784\u5EFA\u6D88\u606F\u5386\u53F2\n    const messagesWithEnhancedSystem = [\n      { role: 'system', content: smartPrompt },\n      ...messages.slice(-3) // \u53EA\u4FDD\u7559\u6700\u8FD13\u8F6E\u5BF9\u8BDD\uFF0C\u51CF\u5C11token\u6D88\u8017\n    ];\n\n    // \u54CD\u5E94\u5934\u914D\u7F6E\n    const responseHeaders = new Headers({\n      'Content-Type': 'text/event-stream; charset=utf-8',\n      'Cache-Control': 'no-cache, no-store, must-revalidate',\n      'Connection': 'keep-alive',\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n      'X-Accel-Buffering': 'no',\n    });\n\n    // \u667A\u80FD\u6A21\u578B\u9009\u62E9 - \u4F18\u5148\u4F7F\u7528OpenAI\u5F00\u6E90\u6A21\u578B\n    let selectedModel = '@cf/openai/gpt-oss-120b'; // \u9ED8\u8BA4\u4F7F\u7528\u6700\u5F3A\u6A21\u578B\n    \n    // \u9488\u5BF9\u4E0D\u540C\u67E5\u8BE2\u7C7B\u578B\u9009\u62E9\u6A21\u578B\n    if (queryInfo.queryType === 'founder_info' || queryInfo.queryType === 'company_analysis') {\n      selectedModel = '@cf/openai/gpt-oss-120b'; // \u4E8B\u5B9E\u7C7B\u95EE\u9898\u7528\u5927\u6A21\u578B\n      console.log('\uD83C\uDFAF \u4F7F\u7528GPT-OSS-120B\u5904\u7406\u4E8B\u5B9E\u67E5\u8BE2');\n    } else if (queryInfo.queryType === 'funding_info') {\n      selectedModel = '@cf/openai/gpt-oss-120b'; // \u6570\u636E\u5206\u6790\u7528\u5927\u6A21\u578B\n      console.log('\uD83D\uDCCA \u4F7F\u7528GPT-OSS-120B\u5904\u7406\u6570\u636E\u5206\u6790');\n    } else {\n      selectedModel = '@cf/openai/gpt-oss-20b'; // \u4E00\u822C\u95EE\u9898\u7528\u8F7B\u91CF\u6A21\u578B\n      console.log('\uD83D\uDCA1 \u4F7F\u7528GPT-OSS-20B\u5904\u7406\u4E00\u822C\u67E5\u8BE2');\n    }\n    \n    // \u6A21\u578B\u8C03\u7528\u53C2\u6570\u4F18\u5316\n    const modelParams = {\n      temperature: 0.3,        // \u964D\u4F4E\u6E29\u5EA6\uFF0C\u63D0\u9AD8\u51C6\u786E\u6027\n      max_tokens: 2048,       // \u51CF\u5C11token\u4F7F\u7528\n      top_p: 0.9,            // \u63D0\u9AD8\u4E00\u81F4\u6027\n      stream: true\n    };\n\n    // \u5C1D\u8BD5\u8C03\u7528\u6A21\u578B\uFF0C\u5931\u8D25\u65F6fallback\n    const modelPriority = [\n      selectedModel,\n      '@cf/openai/gpt-oss-120b',\n      '@cf/openai/gpt-oss-20b',\n      '@cf/meta/llama-3.3-70b-instruct',\n      '@cf/qwen/qwen2.5-coder-32b-instruct'\n    ].filter((model, index, arr) => arr.indexOf(model) === index); // \u53BB\u91CD\n\n    let response;\n    for (const model of modelPriority) {\n      try {\n        console.log(`\uD83E\uDD16 \u5C1D\u8BD5\u6A21\u578B: ${model}`);\n        \n        if (model.includes('@cf/openai/gpt-oss')) {\n          // OpenAI\u6A21\u578B\u4F7F\u7528\u7279\u6B8A\u683C\u5F0F\n          const systemMessage = messagesWithEnhancedSystem.find(m => m.role === 'system');\n          const conversationMessages = messagesWithEnhancedSystem.filter(m => m.role !== 'system');\n          \n          response = await env.AI.run(model, {\n            instructions: systemMessage ? systemMessage.content : ENHANCED_SYSTEM_PROMPT,\n            input: conversationMessages,\n            ...modelParams\n          });\n        } else {\n          // \u5176\u4ED6\u6A21\u578B\u4F7F\u7528\u6807\u51C6\u683C\u5F0F\n          response = await env.AI.run(model, {\n            messages: messagesWithEnhancedSystem,\n            ...modelParams\n          });\n        }\n        \n        console.log(`\u2705 \u6210\u529F\u8C03\u7528\u6A21\u578B: ${model}`);\n        break;\n        \n      } catch (error) {\n        console.log(`\u274C \u6A21\u578B ${model} \u5931\u8D25: ${error.message}`);\n        if (model === modelPriority[modelPriority.length - 1]) {\n          throw new Error('\u6240\u6709AI\u6A21\u578B\u90FD\u4E0D\u53EF\u7528');\n        }\n        continue;\n      }\n    }\n\n    // \u521B\u5EFA\u4F18\u5316\u7684\u54CD\u5E94\u6D41\n    const { readable, writable } = new TransformStream();\n    const writer = writable.getWriter();\n    const reader = response.getReader();\n    const decoder = new TextDecoder();\n    const encoder = new TextEncoder();\n    \n    // \u6D41\u5904\u7406\u903B\u8F91\n    (async () => {\n      try {\n        let responseComplete = false;\n        let hasContent = false;\n        \n        while (!responseComplete) {\n          const { done, value } = await reader.read();\n          \n          if (done) {\n            // \u54CD\u5E94\u7ED3\u675F\uFF0C\u6DFB\u52A0\u6765\u6E90\u4FE1\u606F\uFF08\u5982\u679C\u6709RAG\u5339\u914D\uFF09\n            if (ragContext.matches.length > 0 && hasContent) {\n              // \u68C0\u67E5\u662F\u5426\u5305\u542B\u7F51\u7EDC\u641C\u7D22\u7ED3\u679C\n              const webSearchResults = ragContext.matches.filter(match => match.source === 'web_search');\n              const knowledgeBaseResults = ragContext.matches.filter(match => match.source !== 'web_search');\n              \n              let sourceInfo = `\\n\\n---\\n\uD83D\uDCDA **\u4FE1\u606F\u6765\u6E90**: `;\n              \n              if (webSearchResults.length > 0) {\n                sourceInfo += `\uD83C\uDF10 \u5B9E\u65F6\u7F51\u7EDC\u6570\u636E (${webSearchResults.length}\u4E2A)`;\n                if (knowledgeBaseResults.length > 0) {\n                  sourceInfo += ` + SVTR\u77E5\u8BC6\u5E93 (${knowledgeBaseResults.length}\u4E2A)`;\n                }\n              } else {\n                sourceInfo += `SVTR\u77E5\u8BC6\u5E93 (${ragContext.matches.length}\u4E2A\u5339\u914D)`;\n              }\n              \n              sourceInfo += `\\n\uD83D\uDD0D **\u67E5\u8BE2\u7C7B\u578B**: ${queryInfo.queryType}`;\n              sourceInfo += `\\n\uD83D\uDCA1 **\u7F6E\u4FE1\u5EA6**: ${(ragContext.confidence * 100).toFixed(1)}%`;\n              \n              if (webSearchResults.length > 0) {\n                sourceInfo += `\\n\u26A1 **\u5B9E\u65F6\u6027**: \u5305\u542B\u6700\u65B0\u7F51\u7EDC\u6570\u636E`;\n              }\n              \n              // \u4F7F\u7528\u4E0E\u54CD\u5E94\u5185\u5BB9\u76F8\u540C\u7684\u683C\u5F0F\u53D1\u9001\u6765\u6E90\u4FE1\u606F\n              const sourceFormat = JSON.stringify({\n                response: sourceInfo\n              });\n              await writer.write(encoder.encode('data: ' + sourceFormat + '\\n\\n'));\n            }\n            \n            await writer.write(encoder.encode('data: [DONE]\\n\\n'));\n            responseComplete = true;\n          } else {\n            // \u5904\u7406\u6D41\u5F0F\u54CD\u5E94\u6570\u636E\n            const chunk = decoder.decode(value);\n            const lines = chunk.split('\\n');\n            \n            for (const line of lines) {\n              if (line.startsWith('data: ') && !line.includes('[DONE]')) {\n                try {\n                  const data = JSON.parse(line.slice(6));\n                  if (data.response) {\n                    const content = data.response;\n                    \n                    // \u8FC7\u6EE4\u65E0\u7528\u5185\u5BB9\n                    if (content && !content.match(/^(\u6B63\u5728\u5206\u6790|\u5206\u6790\u4E2D|\u601D\u8003\u4E2D|\\.|\u3002)+$/)) {\n                      hasContent = true;\n                      \n                      // \u8F6C\u6362\u4E3A\u6807\u51C6\u683C\u5F0F\n                      const standardFormat = JSON.stringify({\n                        response: content\n                      });\n                      await writer.write(encoder.encode('data: ' + standardFormat + '\\n\\n'));\n                    }\n                  }\n                } catch (e) {\n                  // \u89E3\u6790\u5931\u8D25\uFF0C\u76F4\u63A5\u8F6C\u53D1\n                  await writer.write(value);\n                }\n              } else if (!line.includes('[DONE]') && line.trim()) {\n                await writer.write(encoder.encode(line + '\\n'));\n              }\n            }\n          }\n        }\n      } catch (error) {\n        console.error('\u6D41\u5904\u7406\u9519\u8BEF:', error);\n        \n        // \u53D1\u9001\u9519\u8BEF\u4FE1\u606F\n        const errorMessage = JSON.stringify({\n          response: '\\n\\n\u62B1\u6B49\uFF0CAI\u670D\u52A1\u6682\u65F6\u9047\u5230\u95EE\u9898\u3002\u8BF7\u7A0D\u540E\u91CD\u8BD5\uFF0C\u6216\u8005\u8BBF\u95EE SVTR.AI \u5B98\u7F51\u83B7\u53D6\u6700\u65B0\u4FE1\u606F\u3002\\n\\n\uD83D\uDCA1 \u63D0\u793A\uFF1A\u4F60\u53EF\u4EE5\u5C1D\u8BD5\u91CD\u65B0\u8868\u8FF0\u95EE\u9898\uFF0C\u6BD4\u5982\u8BE2\u95EE\"SVTR\u7684\u521B\u59CB\u4EBA\u662F\u8C01\"\u6216\"\u6700\u65B0\u7684AI\u6295\u8D44\u8D8B\u52BF\"\u3002'\n        });\n        await writer.write(encoder.encode('data: ' + errorMessage + '\\n\\n'));\n        await writer.write(encoder.encode('data: [DONE]\\n\\n'));\n      } finally {\n        await writer.close();\n      }\n    })();\n    \n    return new Response(readable, responseHeaders);\n\n  } catch (error) {\n    console.error('Enhanced Chat API Error:', error);\n    \n    // \u9519\u8BEF\u54CD\u5E94\n    return new Response(JSON.stringify({ \n      error: 'AI\u670D\u52A1\u6682\u65F6\u4E0D\u53EF\u7528',\n      message: '\u6B63\u5728\u5C1D\u8BD5\u6062\u590D\u589E\u5F3A\u529F\u80FD\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5\u3002\u5982\u9700\u6700\u65B0\u4FE1\u606F\uFF0C\u8BF7\u8BBF\u95EE SVTR.AI \u5B98\u7F51\u3002',\n      suggestions: [\n        '\u5C1D\u8BD5\u91CD\u65B0\u8868\u8FF0\u95EE\u9898',\n        '\u8BE2\u95EE\u5177\u4F53\u7684\u521B\u6295\u4FE1\u606F',\n        '\u67E5\u8BE2\u7279\u5B9A\u516C\u53F8\u6216\u6295\u8D44\u6570\u636E'\n      ]\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n      },\n    });\n  }\n}\n\nexport async function onRequestOptions(): Promise<Response> {\n  return new Response(null, {\n    headers: {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type',\n    },\n  });\n}", "/**\n * \u98DE\u4E66Webhook\u63A5\u6536\u7AEF\u70B9\n * \u5904\u7406\u98DE\u4E66\u77E5\u8BC6\u5E93\u5185\u5BB9\u66F4\u65B0\u4E8B\u4EF6\uFF0C\u89E6\u53D1\u591A\u5E73\u53F0\u5185\u5BB9\u5206\u53D1\n */\n\ninterface FeishuWebhookEvent {\n  schema: string;\n  header: {\n    event_id: string;\n    event_type: string;\n    create_time: string;\n    token: string;\n    app_id: string;\n    tenant_key: string;\n  };\n  event?: {\n    [key: string]: any;\n  };\n  challenge?: string;\n  type?: string;\n}\n\ninterface Env {\n  FEISHU_WEBHOOK_SECRET: string;\n  FEISHU_APP_ID: string;\n}\n\nexport async function onRequestPost(context: EventContext<Env, any, any>): Promise<Response> {\n  try {\n    const request = context.request;\n    const env = context.env;\n\n    // \u89E3\u6790\u8BF7\u6C42body\n    const body: FeishuWebhookEvent = await request.json();\n    \n    console.log('\uD83D\uDD14 \u63A5\u6536\u5230\u98DE\u4E66Webhook\u4E8B\u4EF6:', {\n      eventType: body.header?.event_type || body.type,\n      eventId: body.header?.event_id,\n      timestamp: new Date().toISOString()\n    });\n\n    // \u5904\u7406URL\u9A8C\u8BC1\uFF08\u98DE\u4E66Webhook\u8BA2\u9605\u9A8C\u8BC1\uFF09\n    if (body.type === 'url_verification') {\n      console.log('\u2705 \u5904\u7406URL\u9A8C\u8BC1\u8BF7\u6C42');\n      return Response.json({ \n        challenge: body.challenge \n      });\n    }\n\n    // \u9A8C\u8BC1\u4E8B\u4EF6\u6765\u6E90\uFF08\u53EF\u9009\uFF0C\u589E\u5F3A\u5B89\u5168\u6027\uFF09\n    if (body.header?.app_id && env.FEISHU_APP_ID) {\n      if (body.header.app_id !== env.FEISHU_APP_ID) {\n        console.error('\u274C App ID\u9A8C\u8BC1\u5931\u8D25');\n        return new Response('Unauthorized', { status: 401 });\n      }\n    }\n\n    // \u5904\u7406\u5177\u4F53\u7684\u4E8B\u4EF6\u7C7B\u578B\n    if (body.header?.event_type) {\n      await handleFeishuEvent(body, env);\n    }\n\n    // \u8FD4\u56DE\u6210\u529F\u54CD\u5E94\uFF08\u98DE\u4E66\u8981\u6C422xx\u72B6\u6001\u7801\uFF09\n    return Response.json({ \n      success: true,\n      message: 'Event processed successfully',\n      timestamp: new Date().toISOString()\n    });\n\n  } catch (error) {\n    console.error('\u274C Webhook\u5904\u7406\u51FA\u9519:', error);\n    \n    // \u8FD4\u56DE\u6210\u529F\u72B6\u6001\u907F\u514D\u98DE\u4E66\u91CD\u8BD5\uFF0C\u4F46\u8BB0\u5F55\u9519\u8BEF\n    return Response.json({ \n      success: false,\n      error: error.message,\n      timestamp: new Date().toISOString()\n    }, { status: 200 }); // \u4ECD\u8FD4\u56DE200\u72B6\u6001\u7801\n  }\n}\n\n/**\n * \u5904\u7406\u5177\u4F53\u7684\u98DE\u4E66\u4E8B\u4EF6\n */\nasync function handleFeishuEvent(event: FeishuWebhookEvent, env: Env) {\n  const eventType = event.header.event_type;\n  const eventData = event.event;\n\n  console.log('\uD83D\uDCCB \u5904\u7406\u4E8B\u4EF6\u7C7B\u578B:', eventType);\n\n  switch (eventType) {\n    case 'wiki.space.document.created':\n      await handleDocumentCreated(eventData, env);\n      break;\n      \n    case 'wiki.space.document.updated':\n      await handleDocumentUpdated(eventData, env);\n      break;\n      \n    case 'wiki.space.document.deleted':\n      await handleDocumentDeleted(eventData, env);\n      break;\n      \n    case 'wiki.space.member_added':\n      console.log('\uD83D\uDCE5 \u77E5\u8BC6\u5E93\u65B0\u589E\u6210\u5458:', eventData);\n      break;\n      \n    case 'wiki.space.member_removed':\n      console.log('\uD83D\uDCE4 \u77E5\u8BC6\u5E93\u79FB\u9664\u6210\u5458:', eventData);\n      break;\n      \n    default:\n      console.log('\u2139\uFE0F \u672A\u5904\u7406\u7684\u4E8B\u4EF6\u7C7B\u578B:', eventType, eventData);\n  }\n}\n\n/**\n * \u5904\u7406\u6587\u6863\u521B\u5EFA\u4E8B\u4EF6\n */\nasync function handleDocumentCreated(eventData: any, env: Env) {\n  console.log('\uD83D\uDCDD \u5904\u7406\u6587\u6863\u521B\u5EFA\u4E8B\u4EF6:', {\n    documentId: eventData?.document_id,\n    spaceId: eventData?.space_id,\n    title: eventData?.title || '\u672A\u77E5\u6807\u9898'\n  });\n\n  try {\n    // TODO: \u89E6\u53D1\u5185\u5BB9\u83B7\u53D6\u548C\u591A\u5E73\u53F0\u53D1\u5E03\u6D41\u7A0B\n    // 1. \u83B7\u53D6\u65B0\u6587\u6863\u5185\u5BB9\n    // 2. \u89E3\u6790\u548C\u8F6C\u6362\u683C\u5F0F\n    // 3. \u8C03\u5EA6\u53D1\u5E03\u5230\u5404\u5E73\u53F0\n    // 4. \u66F4\u65B0RAG\u77E5\u8BC6\u5E93\n    \n    // \u5F53\u524D\u9636\u6BB5\uFF1A\u8BB0\u5F55\u4E8B\u4EF6\u7528\u4E8E\u540E\u7EED\u5904\u7406\n    await logContentEvent('document_created', eventData);\n    \n  } catch (error) {\n    console.error('\u274C \u5904\u7406\u6587\u6863\u521B\u5EFA\u4E8B\u4EF6\u5931\u8D25:', error);\n  }\n}\n\n/**\n * \u5904\u7406\u6587\u6863\u66F4\u65B0\u4E8B\u4EF6\n */\nasync function handleDocumentUpdated(eventData: any, env: Env) {\n  console.log('\u270F\uFE0F \u5904\u7406\u6587\u6863\u66F4\u65B0\u4E8B\u4EF6:', {\n    documentId: eventData?.document_id,\n    spaceId: eventData?.space_id,\n    title: eventData?.title || '\u672A\u77E5\u6807\u9898',\n    updateTime: eventData?.update_time\n  });\n\n  try {\n    // TODO: \u5B9E\u73B0\u589E\u91CF\u66F4\u65B0\u903B\u8F91\n    // 1. \u83B7\u53D6\u66F4\u65B0\u540E\u7684\u5185\u5BB9\n    // 2. \u6BD4\u8F83\u53D8\u66F4\u5185\u5BB9\n    // 3. \u91CD\u65B0\u53D1\u5E03\u5230\u76F8\u5173\u5E73\u53F0\n    // 4. \u66F4\u65B0RAG\u77E5\u8BC6\u5E93\u5BF9\u5E94\u6761\u76EE\n    \n    // \u5F53\u524D\u9636\u6BB5\uFF1A\u8BB0\u5F55\u4E8B\u4EF6\u7528\u4E8E\u540E\u7EED\u5904\u7406\n    await logContentEvent('document_updated', eventData);\n    \n  } catch (error) {\n    console.error('\u274C \u5904\u7406\u6587\u6863\u66F4\u65B0\u4E8B\u4EF6\u5931\u8D25:', error);\n  }\n}\n\n/**\n * \u5904\u7406\u6587\u6863\u5220\u9664\u4E8B\u4EF6\n */\nasync function handleDocumentDeleted(eventData: any, env: Env) {\n  console.log('\uD83D\uDDD1\uFE0F \u5904\u7406\u6587\u6863\u5220\u9664\u4E8B\u4EF6:', {\n    documentId: eventData?.document_id,\n    spaceId: eventData?.space_id\n  });\n\n  try {\n    // TODO: \u5B9E\u73B0\u5185\u5BB9\u5220\u9664\u903B\u8F91\n    // 1. \u4ECE\u5404\u5E73\u53F0\u64A4\u56DE\u5DF2\u53D1\u5E03\u5185\u5BB9\uFF08\u5982\u679C\u652F\u6301\uFF09\n    // 2. \u4ECERAG\u77E5\u8BC6\u5E93\u5220\u9664\u5BF9\u5E94\u6761\u76EE\n    // 3. \u66F4\u65B0\u5185\u5BB9\u7D22\u5F15\n    \n    // \u5F53\u524D\u9636\u6BB5\uFF1A\u8BB0\u5F55\u4E8B\u4EF6\u7528\u4E8E\u540E\u7EED\u5904\u7406\n    await logContentEvent('document_deleted', eventData);\n    \n  } catch (error) {\n    console.error('\u274C \u5904\u7406\u6587\u6863\u5220\u9664\u4E8B\u4EF6\u5931\u8D25:', error);\n  }\n}\n\n/**\n * \u8BB0\u5F55\u5185\u5BB9\u4E8B\u4EF6\uFF08\u7528\u4E8E\u76D1\u63A7\u548C\u8C03\u8BD5\uFF09\n */\nasync function logContentEvent(eventType: string, eventData: any) {\n  const logEntry = {\n    timestamp: new Date().toISOString(),\n    eventType,\n    documentId: eventData?.document_id,\n    spaceId: eventData?.space_id,\n    title: eventData?.title,\n    data: eventData\n  };\n\n  console.log('\uD83D\uDCCA \u5185\u5BB9\u4E8B\u4EF6\u8BB0\u5F55:', logEntry);\n  \n  // TODO: \u5B58\u50A8\u5230KV\u6216\u6570\u636E\u5E93\u7528\u4E8E\u5206\u6790\n  // await env.WEBHOOK_LOGS.put(`event_${Date.now()}`, JSON.stringify(logEntry));\n}\n\n/**\n * GET\u8BF7\u6C42\u5904\u7406 - \u7528\u4E8E\u5065\u5EB7\u68C0\u67E5\n */\nexport async function onRequestGet(): Promise<Response> {\n  return Response.json({\n    status: 'active',\n    message: 'Feishu Webhook endpoint is running',\n    timestamp: new Date().toISOString(),\n    version: '1.0.0'\n  });\n}", "/**\n * Cloudflare\u514D\u8D39\u989D\u5EA6\u7BA1\u7406\u5668\n * \u8DDF\u8E2A\u4F7F\u7528\u60C5\u51B5\uFF0C\u5B9E\u73B0\u7C7B\u4F3CAutoRAG\u7684\u514D\u8D39\u4F53\u9A8C\n */\n\ninterface UsageStats {\n  dailyRequests: number;\n  monthlyNeurons: number;\n  lastResetDate: string;\n  lastMonthlyReset: string;\n}\n\nexport class FreeTierManager {\n  private kv: any;\n  \n  // Cloudflare\u514D\u8D39\u989D\u5EA6\u9650\u5236\n  private readonly DAILY_REQUEST_LIMIT = 10000;\n  private readonly MONTHLY_NEURON_LIMIT = 100000;\n  private readonly NEURON_COST_PER_REQUEST = 1; // \u4F30\u7B97\u6BCF\u6B21\u8BF7\u6C42\u6D88\u8017\n\n  constructor(kv: any) {\n    this.kv = kv;\n  }\n\n  /**\n   * \u68C0\u67E5\u662F\u5426\u5728\u514D\u8D39\u989D\u5EA6\u5185\n   */\n  async checkQuota(): Promise<{ allowed: boolean; reason?: string; remaining?: any }> {\n    const stats = await this.getUsageStats();\n    const now = new Date();\n    const today = now.toISOString().split('T')[0];\n    const currentMonth = now.getFullYear() + '-' + (now.getMonth() + 1).toString().padStart(2, '0');\n\n    // \u68C0\u67E5\u65E5\u989D\u5EA6\n    if (stats.dailyRequests >= this.DAILY_REQUEST_LIMIT) {\n      return {\n        allowed: false,\n        reason: 'Daily request limit exceeded. Resets at midnight UTC.',\n        remaining: {\n          daily: 0,\n          monthly: Math.max(0, this.MONTHLY_NEURON_LIMIT - stats.monthlyNeurons)\n        }\n      };\n    }\n\n    // \u68C0\u67E5\u6708\u989D\u5EA6\n    if (stats.monthlyNeurons >= this.MONTHLY_NEURON_LIMIT) {\n      return {\n        allowed: false,\n        reason: 'Monthly computation limit exceeded. Resets next month.',\n        remaining: {\n          daily: Math.max(0, this.DAILY_REQUEST_LIMIT - stats.dailyRequests),\n          monthly: 0\n        }\n      };\n    }\n\n    return {\n      allowed: true,\n      remaining: {\n        daily: this.DAILY_REQUEST_LIMIT - stats.dailyRequests,\n        monthly: this.MONTHLY_NEURON_LIMIT - stats.monthlyNeurons\n      }\n    };\n  }\n\n  /**\n   * \u8BB0\u5F55API\u4F7F\u7528\n   */\n  async recordUsage(neuronCost: number = 1): Promise<void> {\n    const stats = await this.getUsageStats();\n    const now = new Date();\n    const today = now.toISOString().split('T')[0];\n    const currentMonth = now.getFullYear() + '-' + (now.getMonth() + 1).toString().padStart(2, '0');\n\n    // \u91CD\u7F6E\u65E5\u8BA1\u6570\u5668\n    if (stats.lastResetDate !== today) {\n      stats.dailyRequests = 0;\n      stats.lastResetDate = today;\n    }\n\n    // \u91CD\u7F6E\u6708\u8BA1\u6570\u5668\n    if (stats.lastMonthlyReset !== currentMonth) {\n      stats.monthlyNeurons = 0;\n      stats.lastMonthlyReset = currentMonth;\n    }\n\n    // \u66F4\u65B0\u4F7F\u7528\u7EDF\u8BA1\n    stats.dailyRequests += 1;\n    stats.monthlyNeurons += neuronCost;\n\n    await this.saveUsageStats(stats);\n  }\n\n  /**\n   * \u83B7\u53D6\u4F7F\u7528\u7EDF\u8BA1\n   */\n  private async getUsageStats(): Promise<UsageStats> {\n    try {\n      const data = await this.kv.get('usage_stats');\n      if (data) {\n        return JSON.parse(data);\n      }\n    } catch (error) {\n      console.log('Failed to get usage stats:', error);\n    }\n\n    // \u9ED8\u8BA4\u7EDF\u8BA1\u6570\u636E\n    const now = new Date();\n    return {\n      dailyRequests: 0,\n      monthlyNeurons: 0,\n      lastResetDate: now.toISOString().split('T')[0],\n      lastMonthlyReset: now.getFullYear() + '-' + (now.getMonth() + 1).toString().padStart(2, '0')\n    };\n  }\n\n  /**\n   * \u4FDD\u5B58\u4F7F\u7528\u7EDF\u8BA1\n   */\n  private async saveUsageStats(stats: UsageStats): Promise<void> {\n    try {\n      await this.kv.put('usage_stats', JSON.stringify(stats));\n    } catch (error) {\n      console.log('Failed to save usage stats:', error);\n    }\n  }\n\n  /**\n   * \u83B7\u53D6\u5269\u4F59\u914D\u989D\u4FE1\u606F\n   */\n  async getQuotaInfo(): Promise<any> {\n    const stats = await this.getUsageStats();\n    return {\n      daily: {\n        used: stats.dailyRequests,\n        limit: this.DAILY_REQUEST_LIMIT,\n        remaining: Math.max(0, this.DAILY_REQUEST_LIMIT - stats.dailyRequests),\n        resetTime: 'Midnight UTC'\n      },\n      monthly: {\n        used: stats.monthlyNeurons,\n        limit: this.MONTHLY_NEURON_LIMIT,\n        remaining: Math.max(0, this.MONTHLY_NEURON_LIMIT - stats.monthlyNeurons),\n        resetTime: 'First day of next month'\n      }\n    };\n  }\n\n  /**\n   * \u667A\u80FD\u964D\u7EA7\u7B56\u7565\n   */\n  async getSuggestedFallback(reason: string): Promise<string> {\n    if (reason.includes('Daily')) {\n      return 'demo_mode'; // \u4F7F\u7528\u667A\u80FD\u6F14\u793A\u6A21\u5F0F\n    } else if (reason.includes('Monthly')) {\n      return 'basic_mode'; // \u4F7F\u7528\u57FA\u7840\u56DE\u590D\u6A21\u5F0F\n    }\n    return 'demo_mode';\n  }\n}\n\n/**\n * \u521B\u5EFA\u514D\u8D39\u989D\u5EA6\u7BA1\u7406\u5668\u5B9E\u4F8B\n */\nexport function createFreeTierManager(kv: any): FreeTierManager {\n  return new FreeTierManager(kv);\n}", "/**\n * SVTR.AI \u514D\u8D39\u989D\u5EA6\u72B6\u6001API\n * \u8FD4\u56DE\u7528\u6237\u5F53\u524D\u7684\u914D\u989D\u4F7F\u7528\u60C5\u51B5\n */\n\nimport { createFreeTierManager } from '../lib/free-tier-manager';\n\nexport async function onRequestGet(context: any): Promise<Response> {\n  try {\n    const { env } = context;\n    \n    // \u521D\u59CB\u5316\u514D\u8D39\u989D\u5EA6\u7BA1\u7406\u5668\n    const freeTierManager = createFreeTierManager(env.SVTR_KV);\n    \n    // \u83B7\u53D6\u914D\u989D\u4FE1\u606F\n    const quotaInfo = await freeTierManager.getQuotaInfo();\n    const quotaCheck = await freeTierManager.checkQuota();\n    \n    const statusData = {\n      status: quotaCheck.allowed ? 'active' : 'exceeded',\n      quotas: {\n        daily: {\n          used: quotaInfo.daily.used,\n          limit: quotaInfo.daily.limit,\n          remaining: quotaInfo.daily.remaining,\n          percentage: Math.round((quotaInfo.daily.used / quotaInfo.daily.limit) * 100),\n          resetTime: quotaInfo.daily.resetTime\n        },\n        monthly: {\n          used: quotaInfo.monthly.used,\n          limit: quotaInfo.monthly.limit,\n          remaining: quotaInfo.monthly.remaining,\n          percentage: Math.round((quotaInfo.monthly.used / quotaInfo.monthly.limit) * 100),\n          resetTime: quotaInfo.monthly.resetTime\n        }\n      },\n      message: quotaCheck.allowed \n        ? '\u2705 \u514D\u8D39\u989D\u5EA6\u5145\u8DB3\uFF0C\u4EAB\u53D7SVTR.AI\u4E13\u4E1A\u5206\u6790'\n        : `\u26A0\uFE0F ${quotaCheck.reason}`,\n      upgradeHint: !quotaCheck.allowed \n        ? '\uD83D\uDC8E \u914D\u7F6E\u81EA\u5DF1\u7684Cloudflare Workers AI\u5BC6\u94A5\u53EF\u83B7\u5F97\u66F4\u5927\u514D\u8D39\u989D\u5EA6\uFF01'\n        : null,\n      timestamp: new Date().toISOString()\n    };\n    \n    return new Response(JSON.stringify(statusData, null, 2), {\n      headers: {\n        'Content-Type': 'application/json',\n        'Cache-Control': 'no-cache',\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Methods': 'GET, OPTIONS',\n        'Access-Control-Allow-Headers': 'Content-Type',\n      }\n    });\n    \n  } catch (error) {\n    console.error('\u83B7\u53D6\u914D\u989D\u72B6\u6001\u5931\u8D25:', error);\n    \n    return new Response(JSON.stringify({\n      status: 'error',\n      message: '\u65E0\u6CD5\u83B7\u53D6\u914D\u989D\u72B6\u6001',\n      error: error.message\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n      }\n    });\n  }\n}", "/**\n * SVTR\u90AE\u7BB1\u8BA2\u9605API\u7AEF\u70B9\n * \u5904\u7406\u7528\u6237\u90AE\u7BB1\u8BA2\u9605\u548C\u9000\u8BA2\u529F\u80FD\n */\n\n// Cloudflare Pages Functions \u7C7B\u578B\u5B9A\u4E49\ninterface Env {\n  SVTR_SESSIONS: KVNamespace;\n  SVTR_CACHE: KVNamespace;\n}\n\ninterface SubscriptionData {\n  email: string;\n  preferences: string[];\n  subscribedAt: string;\n  ipAddress?: string;\n  userAgent?: string;\n  language: string;\n}\n\n// \u9A8C\u8BC1\u90AE\u7BB1\u683C\u5F0F\nfunction isValidEmail(email: string): boolean {\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return emailRegex.test(email);\n}\n\n// \u751F\u6210\u8BA2\u9605ID\nfunction generateSubscriptionId(email: string): string {\n  return `sub_${btoa(email).replace(/[+/=]/g, '')}`;\n}\n\n// \u5904\u7406POST\u8BF7\u6C42 - \u8BA2\u9605\u90AE\u7BB1\nexport async function onRequestPost(context: { request: Request; env: Env }): Promise<Response> {\n  try {\n    // \u89E3\u6790\u8BF7\u6C42\u6570\u636E\n    const requestData = await context.request.json();\n    const { email, preferences = [], language = 'zh-CN' } = requestData;\n    \n    console.log('\u6536\u5230\u8BA2\u9605\u8BF7\u6C42:', { email, preferences, language });\n    \n    // \u9A8C\u8BC1\u5FC5\u8981\u5B57\u6BB5\n    if (!email) {\n      return new Response(JSON.stringify({\n        success: false,\n        message: '\u90AE\u7BB1\u5730\u5740\u662F\u5FC5\u9700\u7684'\n      }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    // \u9A8C\u8BC1\u90AE\u7BB1\u683C\u5F0F\n    if (!isValidEmail(email)) {\n      return new Response(JSON.stringify({\n        success: false,\n        message: '\u90AE\u7BB1\u683C\u5F0F\u65E0\u6548'\n      }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    // \u751F\u6210\u8BA2\u9605\u6570\u636E\n    const subscriptionId = generateSubscriptionId(email);\n    const subscriptionData: SubscriptionData = {\n      email,\n      preferences,\n      subscribedAt: new Date().toISOString(),\n      ipAddress: context.request.headers.get('CF-Connecting-IP'),\n      userAgent: context.request.headers.get('User-Agent'),\n      language\n    };\n    \n    console.log('\u4FDD\u5B58\u8BA2\u9605\u6570\u636E:', subscriptionData);\n    \n    // \u4FDD\u5B58\u5230KV\u5B58\u50A8\n    await context.env.SVTR_SESSIONS.put(subscriptionId, JSON.stringify(subscriptionData));\n    \n    // \u66F4\u65B0\u8BA2\u9605\u8005\u5217\u8868\uFF08\u7528\u4E8E\u7BA1\u7406\u9762\u677F\uFF09\n    const subscribersList = await context.env.SVTR_CACHE.get('subscribers_list');\n    let subscribers = [];\n    \n    if (subscribersList) {\n      subscribers = JSON.parse(subscribersList);\n    }\n    \n    // \u68C0\u67E5\u662F\u5426\u5DF2\u5B58\u5728\n    const existingIndex = subscribers.findIndex((sub: any) => sub.email === email);\n    if (existingIndex >= 0) {\n      // \u66F4\u65B0\u73B0\u6709\u8BA2\u9605\n      subscribers[existingIndex] = { ...subscriptionData, id: subscriptionId };\n    } else {\n      // \u6DFB\u52A0\u65B0\u8BA2\u9605\n      subscribers.push({ ...subscriptionData, id: subscriptionId });\n    }\n    \n    // \u4FDD\u5B58\u66F4\u65B0\u540E\u7684\u5217\u8868\n    await context.env.SVTR_CACHE.put('subscribers_list', JSON.stringify(subscribers));\n    \n    // \u8BB0\u5F55\u7EDF\u8BA1\u6570\u636E\n    const today = new Date().toISOString().split('T')[0];\n    const statsKey = `stats_${today}`;\n    const todayStats = await context.env.SVTR_CACHE.get(statsKey);\n    let stats = { subscriptions: 0 };\n    \n    if (todayStats) {\n      stats = JSON.parse(todayStats);\n    }\n    stats.subscriptions += 1;\n    \n    await context.env.SVTR_CACHE.put(statsKey, JSON.stringify(stats), {\n      expirationTtl: 30 * 24 * 60 * 60 // 30\u5929\u8FC7\u671F\n    });\n    \n    console.log('\u8BA2\u9605\u6210\u529F\u4FDD\u5B58');\n    \n    return new Response(JSON.stringify({\n      success: true,\n      message: language === 'zh-CN' ? '\u8BA2\u9605\u6210\u529F\uFF01' : 'Successfully subscribed!',\n      data: { subscriptionId }\n    }), {\n      status: 200,\n      headers: { \n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Methods': 'POST, GET, OPTIONS',\n        'Access-Control-Allow-Headers': 'Content-Type'\n      }\n    });\n    \n  } catch (error) {\n    console.error('\u8BA2\u9605\u5904\u7406\u5931\u8D25:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      message: '\u670D\u52A1\u5668\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5',\n      error: String(error)\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n  }\n}\n\n// \u5904\u7406GET\u8BF7\u6C42 - \u83B7\u53D6\u8BA2\u9605\u7EDF\u8BA1\nexport async function onRequestGet(context: { request: Request; env: Env }): Promise<Response> {\n  try {\n    const url = new URL(context.request.url);\n    const action = url.searchParams.get('action');\n    \n    console.log('GET\u8BF7\u6C42:', action);\n    \n    if (action === 'stats') {\n      // \u83B7\u53D6\u7EDF\u8BA1\u6570\u636E\n      const subscribersList = await context.env.SVTR_CACHE.get('subscribers_list');\n      const subscribers = subscribersList ? JSON.parse(subscribersList) : [];\n      \n      const stats = {\n        totalSubscribers: subscribers.length,\n        recentSubscribers: subscribers.filter((sub: any) => {\n          const subDate = new Date(sub.subscribedAt);\n          const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);\n          return subDate > weekAgo;\n        }).length,\n        languageBreakdown: subscribers.reduce((acc: any, sub: any) => {\n          acc[sub.language] = (acc[sub.language] || 0) + 1;\n          return acc;\n        }, {})\n      };\n      \n      return new Response(JSON.stringify(stats), {\n        status: 200,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    if (action === 'list') {\n      // \u83B7\u53D6\u8BA2\u9605\u8005\u5217\u8868\uFF08\u7B80\u5316\u7248\uFF0C\u9690\u79C1\u4FDD\u62A4\uFF09\n      const subscribersList = await context.env.SVTR_CACHE.get('subscribers_list');\n      const subscribers = subscribersList ? JSON.parse(subscribersList) : [];\n      \n      const publicList = subscribers.map((sub: any) => ({\n        id: sub.id,\n        emailDomain: sub.email.split('@')[1],\n        preferences: sub.preferences,\n        subscribedAt: sub.subscribedAt,\n        language: sub.language\n      }));\n      \n      return new Response(JSON.stringify(publicList), {\n        status: 200,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    return new Response(JSON.stringify({\n      success: false,\n      message: '\u65E0\u6548\u7684\u8BF7\u6C42\u53C2\u6570'\n    }), {\n      status: 400,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n    \n  } catch (error) {\n    console.error('\u83B7\u53D6\u6570\u636E\u5931\u8D25:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      message: '\u670D\u52A1\u5668\u9519\u8BEF',\n      error: String(error)\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n  }\n}\n\n// \u5904\u7406DELETE\u8BF7\u6C42 - \u53D6\u6D88\u8BA2\u9605\nexport async function onRequestDelete(context: { request: Request; env: Env }): Promise<Response> {\n  try {\n    const requestData = await context.request.json();\n    const { email } = requestData;\n    \n    if (!email) {\n      return new Response(JSON.stringify({\n        success: false,\n        message: '\u90AE\u7BB1\u5730\u5740\u662F\u5FC5\u9700\u7684'\n      }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    const subscriptionId = generateSubscriptionId(email);\n    \n    // \u4ECEKV\u5B58\u50A8\u4E2D\u5220\u9664\n    await context.env.SVTR_SESSIONS.delete(subscriptionId);\n    \n    // \u4ECE\u8BA2\u9605\u8005\u5217\u8868\u4E2D\u5220\u9664\n    const subscribersList = await context.env.SVTR_CACHE.get('subscribers_list');\n    if (subscribersList) {\n      const subscribers = JSON.parse(subscribersList);\n      const filteredSubscribers = subscribers.filter((sub: any) => sub.email !== email);\n      await context.env.SVTR_CACHE.put('subscribers_list', JSON.stringify(filteredSubscribers));\n    }\n    \n    return new Response(JSON.stringify({\n      success: true,\n      message: '\u53D6\u6D88\u8BA2\u9605\u6210\u529F'\n    }), {\n      status: 200,\n      headers: { \n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*'\n      }\n    });\n    \n  } catch (error) {\n    console.error('\u53D6\u6D88\u8BA2\u9605\u5931\u8D25:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      message: '\u670D\u52A1\u5668\u9519\u8BEF',\n      error: String(error)\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n  }\n}\n\n// \u5904\u7406OPTIONS\u8BF7\u6C42 - CORS\nexport async function onRequestOptions(): Promise<Response> {\n  return new Response(null, {\n    status: 200,\n    headers: {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'POST, GET, DELETE, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type',\n      'Access-Control-Max-Age': '86400',\n    }\n  });\n}", "/**\n * SVTR.AI \u4F1A\u8BDD\u4E0A\u4E0B\u6587\u7BA1\u7406\u7CFB\u7EDF\n * \u5B9E\u73B0\u667A\u80FD\u5BF9\u8BDD\u8BB0\u5FC6\u548C\u4E0A\u4E0B\u6587\u8FFD\u8E2A\n */\n\nexport interface Message {\n  role: 'user' | 'assistant' | 'system';\n  content: string;\n  timestamp: number;\n  ragContext?: RAGContext;\n  topics?: string[];\n  confidence?: number;\n}\n\nexport interface RAGContext {\n  matches: any[];\n  searchQuery: string;\n  confidence: number;\n  sources: string[];\n}\n\nexport interface ConversationSession {\n  sessionId: string;\n  userId?: string;\n  startTime: number;\n  lastActivity: number;\n  messages: Message[];\n  extractedTopics: string[];\n  userInterests: string[];\n  conversationSummary: string;\n  ragHistory: RAGContext[];\n}\n\nexport class ConversationContextManager {\n  private sessions: Map<string, ConversationSession> = new Map();\n  private kvNamespace?: any;\n  private maxSessionAge = 24 * 60 * 60 * 1000; // 24\u5C0F\u65F6\n  private maxMessages = 50; // \u6BCF\u4E2A\u4F1A\u8BDD\u6700\u591A50\u6761\u6D88\u606F\n\n  constructor(kvNamespace?: any) {\n    this.kvNamespace = kvNamespace;\n  }\n\n  /**\n   * \u83B7\u53D6\u6216\u521B\u5EFA\u4F1A\u8BDD\n   */\n  async getOrCreateSession(sessionId: string, userId?: string): Promise<ConversationSession> {\n    let session = this.sessions.get(sessionId);\n    \n    if (!session) {\n      // \u5C1D\u8BD5\u4ECEKV\u5B58\u50A8\u6062\u590D\n      if (this.kvNamespace) {\n        try {\n          const stored = await this.kvNamespace.get(`session:${sessionId}`);\n          if (stored) {\n            session = JSON.parse(stored);\n            this.sessions.set(sessionId, session!);\n          }\n        } catch (error) {\n          console.log('\u6062\u590D\u4F1A\u8BDD\u5931\u8D25:', error);\n        }\n      }\n    }\n\n    if (!session) {\n      // \u521B\u5EFA\u65B0\u4F1A\u8BDD\n      session = {\n        sessionId,\n        userId,\n        startTime: Date.now(),\n        lastActivity: Date.now(),\n        messages: [],\n        extractedTopics: [],\n        userInterests: [],\n        conversationSummary: '',\n        ragHistory: []\n      };\n      this.sessions.set(sessionId, session);\n    }\n\n    return session;\n  }\n\n  /**\n   * \u6DFB\u52A0\u6D88\u606F\u5230\u4F1A\u8BDD\n   */\n  async addMessage(sessionId: string, message: Message): Promise<void> {\n    const session = await this.getOrCreateSession(sessionId);\n    \n    // \u66F4\u65B0\u6D3B\u52A8\u65F6\u95F4\n    session.lastActivity = Date.now();\n    \n    // \u6DFB\u52A0\u6D88\u606F\n    session.messages.push(message);\n    \n    // \u9650\u5236\u6D88\u606F\u6570\u91CF\n    if (session.messages.length > this.maxMessages) {\n      session.messages = session.messages.slice(-this.maxMessages);\n    }\n\n    // \u63D0\u53D6\u8BDD\u9898\u548C\u5174\u8DA3\n    if (message.role === 'user') {\n      const topics = this.extractTopics(message.content);\n      session.extractedTopics = this.mergeTopic(session.extractedTopics, topics);\n      session.userInterests = this.updateUserInterests(session.userInterests, topics);\n    }\n\n    // \u5B58\u50A8RAG\u4E0A\u4E0B\u6587\n    if (message.ragContext) {\n      session.ragHistory.push(message.ragContext);\n      if (session.ragHistory.length > 10) {\n        session.ragHistory = session.ragHistory.slice(-10);\n      }\n    }\n\n    // \u66F4\u65B0\u4F1A\u8BDD\u6458\u8981\n    session.conversationSummary = this.generateSummary(session);\n\n    // \u6301\u4E45\u5316\u5B58\u50A8\n    await this.persistSession(session);\n  }\n\n  /**\n   * \u83B7\u53D6\u4E0A\u4E0B\u6587\u589E\u5F3A\u7684\u67E5\u8BE2 - \u591A\u8F6E\u5BF9\u8BDD\u4F18\u5316\u7248\u672C\n   */\n  getContextEnhancedQuery(sessionId: string, currentQuery: string): {\n    enhancedQuery: string;\n    contextKeywords: string[];\n    relatedTopics: string[];\n    conversationFlow: string[];\n    userIntent: string;\n  } {\n    const session = this.sessions.get(sessionId);\n    if (!session || session.messages.length === 0) {\n      return {\n        enhancedQuery: currentQuery,\n        contextKeywords: [],\n        relatedTopics: [],\n        conversationFlow: [],\n        userIntent: 'general'\n      };\n    }\n\n    // \u63D0\u53D6\u4E0A\u4E0B\u6587\u5173\u952E\u8BCD\u548C\u4F1A\u8BDD\u6D41\u7A0B\n    const contextKeywords = this.extractContextKeywords(session);\n    const relatedTopics = session.extractedTopics.slice(0, 5);\n    const conversationFlow = this.extractConversationFlow(session);\n    const userIntent = this.detectUserIntent(currentQuery, session);\n\n    // \u6784\u5EFA\u591A\u8F6E\u5BF9\u8BDD\u589E\u5F3A\u67E5\u8BE2\n    let enhancedQuery = currentQuery;\n    \n    // \u68C0\u6D4B\u6307\u4EE3\u6D88\u89E3\u9700\u6C42\n    if (this.needsCoreferenceResolution(currentQuery)) {\n      enhancedQuery = this.resolveCoreferences(currentQuery, session);\n    }\n    \n    // \u6DFB\u52A0\u4E0A\u4E0B\u6587\u4FE1\u606F\n    if (currentQuery.length < 30 && contextKeywords.length > 0) {\n      const contextClues = this.buildContextClues(session, userIntent);\n      enhancedQuery = `${enhancedQuery} ${contextClues}`;\n    }\n\n    // \u5904\u7406\u540E\u7EED\u95EE\u9898\n    if (this.isFollowUpQuestion(currentQuery, session)) {\n      const followUpContext = this.buildFollowUpContext(session);\n      enhancedQuery = `\u57FA\u4E8E\u524D\u9762\u7684\u8BA8\u8BBA\uFF1A${followUpContext}\uFF0C${enhancedQuery}`;\n    }\n\n    return {\n      enhancedQuery,\n      contextKeywords,\n      relatedTopics,\n      conversationFlow,\n      userIntent\n    };\n  }\n\n  /**\n   * \u83B7\u53D6\u667A\u80FD\u5EFA\u8BAE\u95EE\u9898\n   */\n  getSmartSuggestions(sessionId: string): string[] {\n    const session = this.sessions.get(sessionId);\n    if (!session) {\n      return this.getDefaultSuggestions();\n    }\n\n    const suggestions: string[] = [];\n    \n    // \u57FA\u4E8E\u7528\u6237\u5174\u8DA3\u7684\u5EFA\u8BAE\n    const interests = session.userInterests.slice(0, 3);\n    interests.forEach(interest => {\n      suggestions.push(...this.generateInterestBasedSuggestions(interest));\n    });\n\n    // \u57FA\u4E8E\u6700\u8FD1\u8BDD\u9898\u7684\u5EFA\u8BAE\n    const recentTopics = session.extractedTopics.slice(-3);\n    recentTopics.forEach(topic => {\n      suggestions.push(...this.generateTopicBasedSuggestions(topic));\n    });\n\n    // \u57FA\u4E8E\u5BF9\u8BDD\u6DF1\u5EA6\u7684\u5EFA\u8BAE\n    if (session.messages.length > 5) {\n      suggestions.push(...this.generateDeepConversationSuggestions(session));\n    }\n\n    // \u53BB\u91CD\u5E76\u9650\u5236\u6570\u91CF\n    return [...new Set(suggestions)].slice(0, 6);\n  }\n\n  /**\n   * \u63D0\u53D6\u6D88\u606F\u4E2D\u7684\u8BDD\u9898\n   */\n  private extractTopics(content: string): string[] {\n    const topics: string[] = [];\n    const text = content.toLowerCase();\n\n    // AI\u521B\u6295\u76F8\u5173\u8BDD\u9898\n    const topicPatterns = {\n      'AI\u6295\u8D44': ['ai\u6295\u8D44', 'ai\u878D\u8D44', 'ai\u57FA\u91D1', 'ai\u521B\u6295'],\n      'AI\u516C\u53F8': ['ai\u516C\u53F8', 'ai\u521D\u521B', 'ai\u4F01\u4E1A', 'ai\u56E2\u961F'],\n      'AI\u6280\u672F': ['ai\u6280\u672F', '\u4EBA\u5DE5\u667A\u80FD', '\u673A\u5668\u5B66\u4E60', '\u6DF1\u5EA6\u5B66\u4E60'],\n      '\u6295\u8D44\u8D8B\u52BF': ['\u6295\u8D44\u8D8B\u52BF', '\u5E02\u573A\u8D8B\u52BF', '\u884C\u4E1A\u8D8B\u52BF', '\u53D1\u5C55\u8D8B\u52BF'],\n      '\u878D\u8D44\u8F6E\u6B21': ['a\u8F6E', 'b\u8F6E', 'c\u8F6E', '\u79CD\u5B50\u8F6E', '\u5929\u4F7F\u8F6E'],\n      '\u4F30\u503C\u5206\u6790': ['\u4F30\u503C', '\u5E02\u503C', '\u4EF7\u503C\u8BC4\u4F30', '\u6295\u8D44\u56DE\u62A5'],\n      'AI\u5E94\u7528': ['ai\u5E94\u7528', 'ai\u4EA7\u54C1', 'ai\u89E3\u51B3\u65B9\u6848', 'ai\u5E73\u53F0']\n    };\n\n    Object.entries(topicPatterns).forEach(([topic, patterns]) => {\n      if (patterns.some(pattern => text.includes(pattern))) {\n        topics.push(topic);\n      }\n    });\n\n    return topics;\n  }\n\n  /**\n   * \u5408\u5E76\u8BDD\u9898\u5217\u8868\n   */\n  private mergeTopic(existing: string[], newTopics: string[]): string[] {\n    const merged = [...existing];\n    newTopics.forEach(topic => {\n      if (!merged.includes(topic)) {\n        merged.push(topic);\n      }\n    });\n    return merged.slice(-20); // \u4FDD\u6301\u6700\u8FD120\u4E2A\u8BDD\u9898\n  }\n\n  /**\n   * \u66F4\u65B0\u7528\u6237\u5174\u8DA3\n   */\n  private updateUserInterests(interests: string[], topics: string[]): string[] {\n    const interestMap = new Map<string, number>();\n    \n    // \u7EDF\u8BA1\u73B0\u6709\u5174\u8DA3\u9891\u6B21\n    interests.forEach(interest => {\n      interestMap.set(interest, (interestMap.get(interest) || 0) + 1);\n    });\n\n    // \u589E\u52A0\u65B0\u8BDD\u9898\u6743\u91CD\n    topics.forEach(topic => {\n      interestMap.set(topic, (interestMap.get(topic) || 0) + 2);\n    });\n\n    // \u6309\u9891\u6B21\u6392\u5E8F\uFF0C\u8FD4\u56DE\u524D10\u4E2A\n    return Array.from(interestMap.entries())\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 10)\n      .map(([interest]) => interest);\n  }\n\n  /**\n   * \u63D0\u53D6\u4E0A\u4E0B\u6587\u5173\u952E\u8BCD\n   */\n  private extractContextKeywords(session: ConversationSession): string[] {\n    const keywords: string[] = [];\n    \n    // \u4ECE\u6700\u8FD15\u6761\u6D88\u606F\u4E2D\u63D0\u53D6\u5173\u952E\u8BCD\n    const recentMessages = session.messages.slice(-5);\n    recentMessages.forEach(message => {\n      if (message.role === 'user') {\n        // \u7B80\u5355\u5173\u952E\u8BCD\u63D0\u53D6\n        const words = message.content\n          .replace(/[^\\u4e00-\\u9fa5a-zA-Z0-9\\s]/g, ' ')\n          .split(/\\s+/)\n          .filter(word => word.length > 1);\n        keywords.push(...words);\n      }\n    });\n\n    // \u53BB\u91CD\u5E76\u8FD4\u56DE\u9AD8\u9891\u5173\u952E\u8BCD\n    const keywordFreq = new Map<string, number>();\n    keywords.forEach(keyword => {\n      keywordFreq.set(keyword, (keywordFreq.get(keyword) || 0) + 1);\n    });\n\n    return Array.from(keywordFreq.entries())\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 5)\n      .map(([keyword]) => keyword);\n  }\n\n  /**\n   * \u751F\u6210\u4F1A\u8BDD\u6458\u8981\n   */\n  private generateSummary(session: ConversationSession): string {\n    if (session.messages.length === 0) return '';\n\n    const userMessages = session.messages\n      .filter(m => m.role === 'user')\n      .slice(-3)\n      .map(m => m.content);\n\n    const topTopics = session.extractedTopics.slice(0, 3);\n    \n    return `\u7528\u6237\u4E3B\u8981\u5173\u6CE8: ${topTopics.join(', ')}. \u6700\u8FD1\u8BE2\u95EE: ${userMessages.join('; ')}`;\n  }\n\n  /**\n   * \u57FA\u4E8E\u5174\u8DA3\u751F\u6210\u5EFA\u8BAE\n   */\n  private generateInterestBasedSuggestions(interest: string): string[] {\n    const suggestionMap: Record<string, string[]> = {\n      'AI\u6295\u8D44': [\n        '\u6700\u65B0\u7684AI\u6295\u8D44\u70ED\u70B9\u6709\u54EA\u4E9B\uFF1F',\n        '\u54EA\u4E9BAI\u8D5B\u9053\u6700\u503C\u5F97\u5173\u6CE8\uFF1F'\n      ],\n      'AI\u516C\u53F8': [\n        '\u6709\u54EA\u4E9B\u503C\u5F97\u5173\u6CE8\u7684AI\u72EC\u89D2\u517D\uFF1F',\n        '\u6700\u65B0\u83B7\u5F97\u878D\u8D44\u7684AI\u516C\u53F8\u6709\u54EA\u4E9B\uFF1F'\n      ],\n      'AI\u6280\u672F': [\n        '\u5F53\u524D\u6700\u524D\u6CBF\u7684AI\u6280\u672F\u8D8B\u52BF\uFF1F',\n        'AI\u6280\u672F\u5546\u4E1A\u5316\u7684\u673A\u4F1A\u5728\u54EA\u91CC\uFF1F'\n      ],\n      '\u6295\u8D44\u8D8B\u52BF': [\n        '2025\u5E74AI\u6295\u8D44\u8D8B\u52BF\u9884\u6D4B\uFF1F',\n        'AI\u6295\u8D44\u7684\u98CE\u9669\u548C\u673A\u4F1A\u5206\u6790\uFF1F'\n      ]\n    };\n\n    return suggestionMap[interest] || [];\n  }\n\n  /**\n   * \u57FA\u4E8E\u8BDD\u9898\u751F\u6210\u5EFA\u8BAE\n   */\n  private generateTopicBasedSuggestions(topic: string): string[] {\n    return [\n      `\u5173\u4E8E${topic}\u7684\u6700\u65B0\u52A8\u6001\uFF1F`,\n      `${topic}\u9886\u57DF\u7684\u6295\u8D44\u673A\u4F1A\uFF1F`\n    ];\n  }\n\n  /**\n   * \u6DF1\u5EA6\u5BF9\u8BDD\u5EFA\u8BAE\n   */\n  private generateDeepConversationSuggestions(session: ConversationSession): string[] {\n    return [\n      '\u6839\u636E\u6211\u4EEC\u7684\u5BF9\u8BDD\uFF0C\u8FD8\u6709\u4EC0\u4E48\u6295\u8D44\u5EFA\u8BAE\uFF1F',\n      '\u57FA\u4E8E\u5F53\u524D\u8BA8\u8BBA\uFF0C\u6709\u54EA\u4E9B\u98CE\u9669\u9700\u8981\u6CE8\u610F\uFF1F',\n      '\u7ED3\u5408\u521A\u624D\u7684\u5206\u6790\uFF0C\u7ED9\u51FA\u5177\u4F53\u7684\u884C\u52A8\u5EFA\u8BAE\uFF1F'\n    ];\n  }\n\n  /**\n   * \u9ED8\u8BA4\u5EFA\u8BAE\n   */\n  private getDefaultSuggestions(): string[] {\n    return [\n      'SVTR.AI\u8FFD\u8E2A\u54EA\u4E9BAI\u516C\u53F8\uFF1F',\n      '\u6700\u65B0\u7684AI\u6295\u8D44\u8D8B\u52BF\u662F\u4EC0\u4E48\uFF1F',\n      '\u5982\u4F55\u8BC6\u522B\u6709\u6F5C\u529B\u7684AI\u521B\u4E1A\u56E2\u961F\uFF1F',\n      '\u751F\u6210\u5F0FAI\u9886\u57DF\u7684\u6295\u8D44\u673A\u4F1A\uFF1F',\n      'AI\u57FA\u7840\u8BBE\u65BD\u8D5B\u9053\u7684\u53D1\u5C55\u524D\u666F\uFF1F',\n      'SVTR\u5E73\u53F0\u6709\u54EA\u4E9B\u72EC\u7279\u4F18\u52BF\uFF1F'\n    ];\n  }\n\n  /**\n   * \u6301\u4E45\u5316\u4F1A\u8BDD\n   */\n  private async persistSession(session: ConversationSession): Promise<void> {\n    if (this.kvNamespace) {\n      try {\n        await this.kvNamespace.put(\n          `session:${session.sessionId}`,\n          JSON.stringify(session),\n          { expirationTtl: this.maxSessionAge / 1000 }\n        );\n      } catch (error) {\n        console.log('\u4F1A\u8BDD\u6301\u4E45\u5316\u5931\u8D25:', error);\n      }\n    }\n  }\n\n  /**\n   * \u63D0\u53D6\u4F1A\u8BDD\u6D41\u7A0B\n   */\n  private extractConversationFlow(session: ConversationSession): string[] {\n    return session.messages\n      .slice(-6)\n      .filter(m => m.role === 'user')\n      .map(m => m.content.slice(0, 50) + (m.content.length > 50 ? '...' : ''));\n  }\n\n  /**\n   * \u68C0\u6D4B\u7528\u6237\u610F\u56FE\n   */\n  private detectUserIntent(query: string, session: ConversationSession): string {\n    const queryLower = query.toLowerCase();\n    \n    // \u5206\u6790\u67E5\u8BE2\u7C7B\u578B\n    if (queryLower.includes('\u5982\u4F55') || queryLower.includes('\u600E\u4E48') || queryLower.includes('\u600E\u6837')) {\n      return 'howto';\n    }\n    if (queryLower.includes('\u6BD4\u8F83') || queryLower.includes('\u5BF9\u6BD4') || queryLower.includes('\u533A\u522B')) {\n      return 'comparison';\n    }\n    if (queryLower.includes('\u4EC0\u4E48') || queryLower.includes('\u54EA\u4E9B') || queryLower.includes('\u4E3A\u4EC0\u4E48')) {\n      return 'question';\n    }\n    if (queryLower.includes('\u63A8\u8350') || queryLower.includes('\u5EFA\u8BAE') || queryLower.includes('\u9009\u62E9')) {\n      return 'recommendation';\n    }\n    if (queryLower.includes('\u66F4\u591A') || queryLower.includes('\u8FD8\u6709') || queryLower.includes('\u7EE7\u7EED')) {\n      return 'follow_up';\n    }\n\n    // \u57FA\u4E8E\u4F1A\u8BDD\u5386\u53F2\u63A8\u65AD\u610F\u56FE\n    const recentTopics = session.extractedTopics.slice(-3);\n    if (recentTopics.includes('AI\u6295\u8D44') || recentTopics.includes('\u6295\u8D44\u8D8B\u52BF')) {\n      return 'investment_inquiry';\n    }\n    if (recentTopics.includes('AI\u516C\u53F8') || recentTopics.includes('AI\u6280\u672F')) {\n      return 'company_analysis';\n    }\n\n    return 'general';\n  }\n\n  /**\n   * \u68C0\u6D4B\u662F\u5426\u9700\u8981\u6307\u4EE3\u6D88\u89E3\n   */\n  private needsCoreferenceResolution(query: string): boolean {\n    const pronouns = ['\u5B83', '\u4ED6\u4EEC', '\u8FD9\u4E2A', '\u90A3\u4E2A', '\u8FD9\u4E9B', '\u90A3\u4E9B', '\u6B64', '\u8BE5', '\u8FD9', '\u90A3'];\n    return pronouns.some(pronoun => query.includes(pronoun));\n  }\n\n  /**\n   * \u6307\u4EE3\u6D88\u89E3\n   */\n  private resolveCoreferences(query: string, session: ConversationSession): string {\n    if (session.messages.length < 2) return query;\n\n    const lastAIResponse = session.messages\n      .slice()\n      .reverse()\n      .find(m => m.role === 'assistant');\n\n    if (!lastAIResponse) return query;\n\n    // \u7B80\u5355\u7684\u6307\u4EE3\u6D88\u89E3\n    let resolvedQuery = query;\n    \n    // \u63D0\u53D6\u6700\u8FD1\u63D0\u5230\u7684\u5B9E\u4F53\n    const entities = this.extractEntities(lastAIResponse.content);\n    \n    if (entities.companies.length > 0 && (query.includes('\u5B83') || query.includes('\u8BE5\u516C\u53F8'))) {\n      resolvedQuery = resolvedQuery.replace(/\u5B83|\u8BE5\u516C\u53F8/g, entities.companies[0]);\n    }\n    \n    if (entities.topics.length > 0 && (query.includes('\u8FD9\u4E2A') || query.includes('\u8BE5\u9886\u57DF'))) {\n      resolvedQuery = resolvedQuery.replace(/\u8FD9\u4E2A|\u8BE5\u9886\u57DF/g, entities.topics[0]);\n    }\n\n    return resolvedQuery;\n  }\n\n  /**\n   * \u6784\u5EFA\u4E0A\u4E0B\u6587\u7EBF\u7D22\n   */\n  private buildContextClues(session: ConversationSession, intent: string): string {\n    const clues = [];\n    \n    // \u6DFB\u52A0\u8BDD\u9898\u4E0A\u4E0B\u6587\n    if (session.extractedTopics.length > 0) {\n      clues.push(`(\u8BA8\u8BBA\u80CC\u666F: ${session.extractedTopics.slice(0, 2).join('\u3001')})`);\n    }\n\n    // \u6DFB\u52A0\u610F\u56FE\u76F8\u5173\u7684\u4E0A\u4E0B\u6587\n    if (intent === 'follow_up' && session.messages.length > 2) {\n      const lastUserQuery = session.messages\n        .slice()\n        .reverse()\n        .find(m => m.role === 'user');\n      if (lastUserQuery) {\n        clues.push(`(\u627F\u63A5\u4E0A\u4E2A\u95EE\u9898: ${lastUserQuery.content.slice(0, 30)}...)`);\n      }\n    }\n\n    return clues.join(' ');\n  }\n\n  /**\n   * \u68C0\u6D4B\u662F\u5426\u4E3A\u540E\u7EED\u95EE\u9898\n   */\n  private isFollowUpQuestion(query: string, session: ConversationSession): boolean {\n    const followUpIndicators = [\n      '\u8FD8\u6709', '\u66F4\u591A', '\u7EE7\u7EED', '\u53E6\u5916', '\u5176\u4ED6', '\u63A5\u4E0B\u6765', '\u7136\u540E', '\u90A3\u4E48',\n      '\u8FDB\u4E00\u6B65', '\u6DF1\u5165', '\u8BE6\u7EC6', '\u5177\u4F53', '\u4F8B\u5982'\n    ];\n    \n    return followUpIndicators.some(indicator => query.includes(indicator)) ||\n           (query.length < 20 && session.messages.length > 2);\n  }\n\n  /**\n   * \u6784\u5EFA\u540E\u7EED\u95EE\u9898\u4E0A\u4E0B\u6587\n   */\n  private buildFollowUpContext(session: ConversationSession): string {\n    const recentExchange = session.messages.slice(-2);\n    if (recentExchange.length < 2) return '';\n\n    const userQuery = recentExchange.find(m => m.role === 'user')?.content || '';\n    const aiResponse = recentExchange.find(m => m.role === 'assistant')?.content || '';\n\n    // \u63D0\u53D6\u5173\u952E\u4FE1\u606F\n    const userTopic = userQuery.slice(0, 30);\n    const aiKeyPoints = this.extractKeyPoints(aiResponse);\n\n    return `\u7528\u6237\u8BE2\u95EE\u4E86\"${userTopic}\"\uFF0CAI\u56DE\u7B54\u6D89\u53CA${aiKeyPoints.join('\u3001')}`;\n  }\n\n  /**\n   * \u63D0\u53D6\u5173\u952E\u8981\u70B9\n   */\n  private extractKeyPoints(text: string): string[] {\n    const points = [];\n    \n    // \u67E5\u627E\u5217\u8868\u9879\n    const listMatches = text.match(/[\u2022\u00B7\\-\\*]\\s*(.+?)(?=\\n|$)/g);\n    if (listMatches) {\n      points.push(...listMatches.slice(0, 3).map(match => \n        match.replace(/[\u2022\u00B7\\-\\*]\\s*/, '').slice(0, 20)\n      ));\n    }\n\n    // \u67E5\u627E\u6570\u5B57\u6216\u5173\u952E\u8BCD\n    const numberMatches = text.match(/\\d+[\u3001\u3002\uFF1A]/g);\n    if (numberMatches) {\n      points.push(`${numberMatches.length}\u4E2A\u8981\u70B9`);\n    }\n\n    return points.length > 0 ? points : ['\u76F8\u5173\u4FE1\u606F'];\n  }\n\n  /**\n   * \u63D0\u53D6\u5B9E\u4F53\n   */\n  private extractEntities(text: string): { companies: string[], topics: string[] } {\n    const companies = [];\n    const topics = [];\n\n    // \u7B80\u5355\u7684\u5B9E\u4F53\u8BC6\u522B\n    const companyPatterns = [\n      /([A-Z][a-z]+(?:\\s+[A-Z][a-z]+)*(?:\\s+AI|Inc\\.|LLC))/g,\n      /([\\u4e00-\\u9fa5]+(?:\u516C\u53F8|\u79D1\u6280|\u667A\u80FD|AI))/g\n    ];\n\n    companyPatterns.forEach(pattern => {\n      const matches = text.match(pattern);\n      if (matches) {\n        companies.push(...matches.slice(0, 3));\n      }\n    });\n\n    const topicPatterns = [\n      /(AI[^\\s\uFF0C\u3002\uFF01\uFF1F]*)/g,\n      /([\\u4e00-\\u9fa5]*\u6295\u8D44[\\u4e00-\\u9fa5]*)/g,\n      /([\\u4e00-\\u9fa5]*\u521B\u4E1A[\\u4e00-\\u9fa5]*)/g\n    ];\n\n    topicPatterns.forEach(pattern => {\n      const matches = text.match(pattern);\n      if (matches) {\n        topics.push(...matches.slice(0, 3));\n      }\n    });\n\n    return { companies, topics };\n  }\n\n  /**\n   * \u6E05\u7406\u8FC7\u671F\u4F1A\u8BDD\n   */\n  cleanupExpiredSessions(): void {\n    const now = Date.now();\n    for (const [sessionId, session] of this.sessions.entries()) {\n      if (now - session.lastActivity > this.maxSessionAge) {\n        this.sessions.delete(sessionId);\n      }\n    }\n  }\n}", "/**\n * SVTR.AI \u667A\u80FD\u5EFA\u8BAEAPI\n * \u57FA\u4E8E\u4F1A\u8BDD\u4E0A\u4E0B\u6587\u63D0\u4F9B\u4E2A\u6027\u5316\u5EFA\u8BAE\u95EE\u9898\n */\n\nimport { ConversationContextManager } from '../lib/conversation-context';\n\nexport async function onRequestGet(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    const url = new URL(request.url);\n    const sessionId = url.searchParams.get('sessionId');\n    \n    if (!sessionId) {\n      return new Response(JSON.stringify({\n        error: '\u7F3A\u5C11\u4F1A\u8BDDID',\n        suggestions: getDefaultSuggestions()\n      }), {\n        status: 400,\n        headers: {\n          'Content-Type': 'application/json',\n          'Access-Control-Allow-Origin': '*',\n        }\n      });\n    }\n\n    // \u521D\u59CB\u5316\u4E0A\u4E0B\u6587\u7BA1\u7406\u5668\n    const contextManager = new ConversationContextManager(env.CHAT_SESSIONS);\n    \n    // \u83B7\u53D6\u667A\u80FD\u5EFA\u8BAE\n    const suggestions = contextManager.getSmartSuggestions(sessionId);\n    \n    // \u83B7\u53D6\u4F1A\u8BDD\u4FE1\u606F\u7528\u4E8E\u8C03\u8BD5\n    const session = await contextManager.getOrCreateSession(sessionId);\n    \n    return new Response(JSON.stringify({\n      sessionId,\n      suggestions,\n      sessionInfo: {\n        messageCount: session.messages.length,\n        topics: session.extractedTopics.slice(0, 5),\n        interests: session.userInterests.slice(0, 3),\n        summary: session.conversationSummary\n      },\n      timestamp: Date.now()\n    }), {\n      headers: {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n        'Cache-Control': 'no-cache, max-age=0'\n      }\n    });\n\n  } catch (error) {\n    console.error('\u667A\u80FD\u5EFA\u8BAEAPI\u9519\u8BEF:', error);\n    \n    return new Response(JSON.stringify({\n      error: '\u83B7\u53D6\u5EFA\u8BAE\u5931\u8D25',\n      suggestions: getDefaultSuggestions(),\n      timestamp: Date.now()\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n      }\n    });\n  }\n}\n\nexport async function onRequestPost(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    const body: any = await request.json();\n    const { sessionId, userQuery, contextHint } = body;\n    \n    if (!sessionId) {\n      return new Response(JSON.stringify({\n        error: '\u7F3A\u5C11\u4F1A\u8BDDID'\n      }), {\n        status: 400,\n        headers: {\n          'Content-Type': 'application/json',\n          'Access-Control-Allow-Origin': '*',\n        }\n      });\n    }\n\n    const contextManager = new ConversationContextManager(env.CHAT_SESSIONS);\n    \n    // \u5982\u679C\u63D0\u4F9B\u4E86\u7528\u6237\u67E5\u8BE2\uFF0C\u53EF\u4EE5\u57FA\u4E8E\u6B64\u751F\u6210\u66F4\u76F8\u5173\u7684\u5EFA\u8BAE\n    let suggestions;\n    if (userQuery) {\n      // \u4E34\u65F6\u6DFB\u52A0\u7528\u6237\u67E5\u8BE2\u5230\u4F1A\u8BDD\u4E2D\uFF0C\u751F\u6210\u76F8\u5173\u5EFA\u8BAE\n      await contextManager.addMessage(sessionId, {\n        role: 'user',\n        content: userQuery,\n        timestamp: Date.now()\n      });\n      suggestions = contextManager.getSmartSuggestions(sessionId);\n    } else {\n      suggestions = contextManager.getSmartSuggestions(sessionId);\n    }\n\n    return new Response(JSON.stringify({\n      sessionId,\n      suggestions,\n      contextHint,\n      timestamp: Date.now()\n    }), {\n      headers: {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n      }\n    });\n\n  } catch (error) {\n    console.error('\u667A\u80FD\u5EFA\u8BAEPOST API\u9519\u8BEF:', error);\n    \n    return new Response(JSON.stringify({\n      error: '\u751F\u6210\u5EFA\u8BAE\u5931\u8D25',\n      suggestions: getDefaultSuggestions()\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n      }\n    });\n  }\n}\n\nexport async function onRequestOptions(): Promise<Response> {\n  return new Response(null, {\n    headers: {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type',\n    },\n  });\n}\n\n/**\n * \u9ED8\u8BA4\u5EFA\u8BAE\u95EE\u9898\n */\nfunction getDefaultSuggestions(): string[] {\n  return [\n    'SVTR.AI\u8FFD\u8E2A\u54EA\u4E9BAI\u516C\u53F8\uFF1F',\n    '\u6700\u65B0\u7684AI\u6295\u8D44\u8D8B\u52BF\u662F\u4EC0\u4E48\uFF1F',\n    '\u5982\u4F55\u8BC6\u522B\u6709\u6F5C\u529B\u7684AI\u521B\u4E1A\u56E2\u961F\uFF1F',\n    '\u751F\u6210\u5F0FAI\u9886\u57DF\u7684\u6295\u8D44\u673A\u4F1A\uFF1F',\n    'AI\u57FA\u7840\u8BBE\u65BD\u8D5B\u9053\u7684\u53D1\u5C55\u524D\u666F\uFF1F',\n    'SVTR\u5E73\u53F0\u6709\u54EA\u4E9B\u72EC\u7279\u4F18\u52BF\uFF1F'\n  ];\n}", "// \u98DE\u4E66Webhook\u5904\u7406\u5668\n// \u7528\u4E8E\u63A5\u6536\u98DE\u4E66\u5185\u5BB9\u66F4\u65B0\u901A\u77E5\u5E76\u89E6\u53D1\u540C\u6B65\n\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n  \n  try {\n    const body = await request.json();\n    \n    // \u9A8C\u8BC1\u98DE\u4E66Webhook\u7B7E\u540D\n    const signature = request.headers.get('X-Lark-Signature');\n    if (!verifySignature(body, signature, env.FEISHU_WEBHOOK_SECRET)) {\n      return new Response('Unauthorized', { status: 401 });\n    }\n    \n    // \u5904\u7406\u4E0D\u540C\u7C7B\u578B\u7684\u4E8B\u4EF6\n    const { type, event } = body;\n    \n    if (type === 'url_verification') {\n      // \u9996\u6B21\u9A8C\u8BC1\n      return new Response(JSON.stringify({\n        challenge: body.challenge\n      }), {\n        headers: { 'Content-Type': 'application/json' }\n      });\n    }\n    \n    if (event?.type === 'wiki.node.updated' || \n        event?.type === 'bitable.record.updated') {\n      \n      console.log('\uD83D\uDCDD \u68C0\u6D4B\u5230\u98DE\u4E66\u5185\u5BB9\u66F4\u65B0:', event);\n      \n      // \u89E6\u53D1GitHub Actions\u540C\u6B65\n      const githubResponse = await fetch(\n        'https://api.github.com/repos/capmapt/chatsvtr/dispatches',\n        {\n          method: 'POST',\n          headers: {\n            'Authorization': `token ${env.GITHUB_TOKEN}`,\n            'Accept': 'application/vnd.github.v3+json',\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            event_type: 'feishu-update',\n            client_payload: {\n              trigger: 'feishu_webhook',\n              event_type: event.type,\n              timestamp: new Date().toISOString()\n            }\n          })\n        }\n      );\n      \n      if (githubResponse.ok) {\n        console.log('\u2705 \u6210\u529F\u89E6\u53D1\u540C\u6B65\u66F4\u65B0');\n        return new Response('OK', { status: 200 });\n      } else {\n        console.error('\u274C \u89E6\u53D1\u540C\u6B65\u5931\u8D25');\n        return new Response('Sync failed', { status: 500 });\n      }\n    }\n    \n    return new Response('OK', { status: 200 });\n    \n  } catch (error) {\n    console.error('\u274C Webhook\u5904\u7406\u5931\u8D25:', error);\n    return new Response('Internal error', { status: 500 });\n  }\n}\n\nfunction verifySignature(body, signature, secret) {\n  // \u5B9E\u73B0\u98DE\u4E66Webhook\u7B7E\u540D\u9A8C\u8BC1\u903B\u8F91\n  // \u53C2\u8003: https://open.feishu.cn/document/ukTMukTMukTM/uUTNz4SN1MjL1UzM\n  return true; // \u7B80\u5316\u5B9E\u73B0\n}", "/**\n * Cloudflare Workers Scheduled Event Handler\n * \u6BCF\u65E5\u5B9A\u65F6\u540C\u6B65RAG\u6570\u636E\n */\n\nexport async function onRequestPost(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    \n    // \u9A8C\u8BC1\u8BF7\u6C42\u6765\u6E90\uFF08\u53EF\u9009\uFF1A\u6DFB\u52A0webhook\u5BC6\u94A5\u9A8C\u8BC1\uFF09\n    const authHeader = request.headers.get('Authorization');\n    if (authHeader !== `Bearer ${env.SYNC_WEBHOOK_SECRET}`) {\n      return new Response('Unauthorized', { status: 401 });\n    }\n\n    console.log('\uD83E\uDD16 \u5F00\u59CB\u5B9A\u65F6\u540C\u6B65\u4EFB\u52A1...');\n    \n    // \u8C03\u7528\u98DE\u4E66API\u540C\u6B65\u6570\u636E\n    const syncResult = await performScheduledSync(env);\n    \n    if (syncResult.success) {\n      console.log('\u2705 \u5B9A\u65F6\u540C\u6B65\u6210\u529F:', syncResult.summary);\n      \n      // \u53EF\u9009\uFF1A\u53D1\u9001\u6210\u529F\u901A\u77E5\n      await sendSyncNotification(env, {\n        status: 'success',\n        summary: syncResult.summary,\n        timestamp: new Date().toISOString()\n      });\n      \n      return new Response(JSON.stringify({\n        success: true,\n        message: '\u5B9A\u65F6\u540C\u6B65\u5B8C\u6210',\n        data: syncResult.summary\n      }), {\n        headers: { 'Content-Type': 'application/json' }\n      });\n    } else {\n      console.error('\u274C \u5B9A\u65F6\u540C\u6B65\u5931\u8D25:', syncResult.error);\n      \n      // \u53D1\u9001\u5931\u8D25\u901A\u77E5\n      await sendSyncNotification(env, {\n        status: 'error', \n        error: syncResult.error,\n        timestamp: new Date().toISOString()\n      });\n      \n      return new Response(JSON.stringify({\n        success: false,\n        message: '\u5B9A\u65F6\u540C\u6B65\u5931\u8D25',\n        error: syncResult.error\n      }), {\n        status: 500,\n        headers: { 'Content-Type': 'application/json' }\n      });\n    }\n    \n  } catch (error) {\n    console.error('\uD83D\uDEA8 \u5B9A\u65F6\u540C\u6B65\u5F02\u5E38:', error);\n    \n    return new Response(JSON.stringify({\n      success: false,\n      message: '\u5B9A\u65F6\u540C\u6B65\u5F02\u5E38',\n      error: error.message\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' }\n    });\n  }\n}\n\n/**\n * \u6267\u884C\u5B9A\u65F6\u540C\u6B65\n */\nasync function performScheduledSync(env: any) {\n  try {\n    // \u8FD9\u91CC\u53EF\u4EE5\u8C03\u7528\u73B0\u6709\u7684\u98DE\u4E66\u540C\u6B65\u903B\u8F91\n    // \u6216\u8005\u89E6\u53D1GitHub Actions webhook\n    \n    const feishuAppId = env.FEISHU_APP_ID;\n    const feishuSecret = env.FEISHU_APP_SECRET;\n    \n    if (!feishuAppId || !feishuSecret) {\n      throw new Error('\u98DE\u4E66API\u914D\u7F6E\u7F3A\u5931');\n    }\n    \n    // \u7B80\u5316\u7248\u540C\u6B65\u903B\u8F91\uFF08\u5B9E\u9645\u5E94\u8BE5\u8C03\u7528\u5B8C\u6574\u7684\u540C\u6B65\u51FD\u6570\uFF09\n    const syncTimestamp = new Date().toISOString();\n    \n    // \u89E6\u53D1GitHub Actions workflow\uFF08\u63A8\u8350\u65B9\u5F0F\uFF09\n    const webhookResult = await triggerGitHubSync(env);\n    \n    return {\n      success: true,\n      summary: {\n        syncTime: syncTimestamp,\n        triggerMethod: 'github_actions',\n        webhookResult: webhookResult\n      }\n    };\n    \n  } catch (error) {\n    return {\n      success: false,\n      error: error.message\n    };\n  }\n}\n\n/**\n * \u89E6\u53D1GitHub Actions\u540C\u6B65\n */\nasync function triggerGitHubSync(env: any) {\n  try {\n    // \u8C03\u7528GitHub API\u89E6\u53D1workflow_dispatch\u4E8B\u4EF6\n    const response = await fetch(`https://api.github.com/repos/${env.GITHUB_REPO}/actions/workflows/daily-sync.yml/dispatches`, {\n      method: 'POST',\n      headers: {\n        'Authorization': `token ${env.GITHUB_TOKEN}`,\n        'Accept': 'application/vnd.github.v3+json',\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        ref: 'main',\n        inputs: {\n          sync_type: 'smart'\n        }\n      })\n    });\n    \n    if (response.ok) {\n      return { triggered: true, timestamp: new Date().toISOString() };\n    } else {\n      const error = await response.text();\n      throw new Error(`GitHub API\u8C03\u7528\u5931\u8D25: ${error}`);\n    }\n    \n  } catch (error) {\n    console.error('GitHub webhook\u89E6\u53D1\u5931\u8D25:', error);\n    return { triggered: false, error: error.message };\n  }\n}\n\n/**\n * \u53D1\u9001\u540C\u6B65\u901A\u77E5\uFF08\u53EF\u9009\uFF09\n */\nasync function sendSyncNotification(env: any, data: any) {\n  try {\n    // \u53EF\u4EE5\u96C6\u6210Slack\u3001Discord\u3001\u90AE\u4EF6\u7B49\u901A\u77E5\u65B9\u5F0F\n    console.log('\uD83D\uDCEC \u540C\u6B65\u901A\u77E5:', data);\n    \n    // \u793A\u4F8B\uFF1A\u53D1\u9001\u5230Slack webhook\n    if (env.SLACK_WEBHOOK_URL) {\n      await fetch(env.SLACK_WEBHOOK_URL, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          text: `\uD83E\uDD16 SVTR RAG\u6570\u636E\u540C\u6B65${data.status === 'success' ? '\u6210\u529F' : '\u5931\u8D25'}`,\n          attachments: [{\n            color: data.status === 'success' ? 'good' : 'danger',\n            fields: [\n              { title: '\u65F6\u95F4', value: data.timestamp, short: true },\n              { title: '\u72B6\u6001', value: data.status, short: true },\n              { title: '\u8BE6\u60C5', value: data.summary || data.error, short: false }\n            ]\n          }]\n        })\n      });\n    }\n    \n  } catch (error) {\n    console.error('\u901A\u77E5\u53D1\u9001\u5931\u8D25:', error);\n  }\n}", "/**\n * Cloudflare Pages \u4E2D\u95F4\u4EF6\n * \u8BBE\u7F6E\u5B89\u5168\u5934\u548C\u6027\u80FD\u4F18\u5316\n */\n\ninterface Env {\n  // \u73AF\u5883\u53D8\u91CF\u7C7B\u578B\u5B9A\u4E49\n}\n\nexport const onRequest: PagesFunction<Env> = async (context) => {\n  const response = await context.next();\n  const url = new URL(context.request.url);\n  \n  // \u521B\u5EFA\u65B0\u7684\u54CD\u5E94\u5BF9\u8C61\u4EE5\u6DFB\u52A0\u5934\u90E8\n  const newResponse = new Response(response.body, response);\n  \n  // \u57FA\u7840\u5B89\u5168\u5934\n  const securityHeaders = {\n    'X-Content-Type-Options': 'nosniff',\n    'X-Frame-Options': 'SAMEORIGIN',\n    'Referrer-Policy': 'strict-origin-when-cross-origin',\n    'Permissions-Policy': 'camera=(), microphone=(), geolocation=(self), payment=()',\n  };\n  \n  // \u4EC5\u5728HTTPS\u4E0B\u8BBE\u7F6EHSTS\n  if (url.protocol === 'https:') {\n    securityHeaders['Strict-Transport-Security'] = 'max-age=31536000; includeSubDomains';\n  }\n  \n  // CSP\u7B56\u7565\n  const cspPolicy = [\n    \"default-src 'self' https:\",\n    \"script-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://c0uiiy15npu.feishu.cn https://static.cloudflareinsights.com https://*.cloudflareinsights.com\",\n    \"style-src 'self' 'unsafe-inline' https://fonts.googleapis.com\",\n    \"img-src 'self' data: https:\",\n    \"font-src 'self' https://fonts.gstatic.com\",\n    \"connect-src 'self' https: https://cloudflareinsights.com https://*.cloudflareinsights.com\",\n    \"frame-src 'self' https://c0uiiy15npu.feishu.cn\",\n    \"frame-ancestors 'self'\",\n    \"object-src 'none'\",\n    \"base-uri 'self'\"\n  ].join('; ');\n  \n  securityHeaders['Content-Security-Policy'] = cspPolicy;\n  \n  // \u7F13\u5B58\u7B56\u7565\n  const pathname = url.pathname;\n  \n  if (pathname.startsWith('/assets/')) {\n    // \u9759\u6001\u8D44\u6E90\uFF1A\u957F\u671F\u7F13\u5B58\n    newResponse.headers.set('Cache-Control', 'public, max-age=31536000, immutable');\n  } else if (pathname.endsWith('.html') || pathname === '/') {\n    // HTML\u6587\u4EF6\uFF1A\u77ED\u671F\u7F13\u5B58\n    newResponse.headers.set('Cache-Control', 'public, max-age=3600, must-revalidate');\n  } else if (pathname === '/sw.js') {\n    // Service Worker\uFF1A\u4E0D\u7F13\u5B58\n    newResponse.headers.set('Cache-Control', 'public, max-age=0, must-revalidate');\n  } else if (pathname.startsWith('/api/')) {\n    // API\uFF1A\u4E0D\u7F13\u5B58\n    newResponse.headers.set('Cache-Control', 'no-cache, no-store, must-revalidate');\n    newResponse.headers.set('Pragma', 'no-cache');\n  }\n  \n  // \u5E94\u7528\u6240\u6709\u5B89\u5168\u5934\n  Object.entries(securityHeaders).forEach(([key, value]) => {\n    newResponse.headers.set(key, value);\n  });\n  \n  // \u6027\u80FD\u4F18\u5316\u5934\n  if (context.request.headers.get('Accept-Encoding')?.includes('gzip')) {\n    newResponse.headers.set('Content-Encoding', 'gzip');\n  }\n  \n  // CORS\u5934\uFF08\u5982\u679C\u9700\u8981\uFF09\n  if (pathname.startsWith('/api/')) {\n    newResponse.headers.set('Access-Control-Allow-Origin', '*');\n    newResponse.headers.set('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');\n    newResponse.headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization');\n  }\n  \n  return newResponse;\n};", "import { onRequestOptions as __api_chat_ts_onRequestOptions } from \"/home/lium/chatsvtr/functions/api/chat.ts\"\nimport { onRequestPost as __api_chat_ts_onRequestPost } from \"/home/lium/chatsvtr/functions/api/chat.ts\"\nimport { onRequestOptions as __api_chat_optimized_ts_onRequestOptions } from \"/home/lium/chatsvtr/functions/api/chat-optimized.ts\"\nimport { onRequestPost as __api_chat_optimized_ts_onRequestPost } from \"/home/lium/chatsvtr/functions/api/chat-optimized.ts\"\nimport { onRequestGet as __api_feishu_webhook_ts_onRequestGet } from \"/home/lium/chatsvtr/functions/api/feishu-webhook.ts\"\nimport { onRequestPost as __api_feishu_webhook_ts_onRequestPost } from \"/home/lium/chatsvtr/functions/api/feishu-webhook.ts\"\nimport { onRequestGet as __api_quota_status_ts_onRequestGet } from \"/home/lium/chatsvtr/functions/api/quota-status.ts\"\nimport { onRequestDelete as __api_subscribe_ts_onRequestDelete } from \"/home/lium/chatsvtr/functions/api/subscribe.ts\"\nimport { onRequestGet as __api_subscribe_ts_onRequestGet } from \"/home/lium/chatsvtr/functions/api/subscribe.ts\"\nimport { onRequestOptions as __api_subscribe_ts_onRequestOptions } from \"/home/lium/chatsvtr/functions/api/subscribe.ts\"\nimport { onRequestPost as __api_subscribe_ts_onRequestPost } from \"/home/lium/chatsvtr/functions/api/subscribe.ts\"\nimport { onRequestGet as __api_suggestions_ts_onRequestGet } from \"/home/lium/chatsvtr/functions/api/suggestions.ts\"\nimport { onRequestOptions as __api_suggestions_ts_onRequestOptions } from \"/home/lium/chatsvtr/functions/api/suggestions.ts\"\nimport { onRequestPost as __api_suggestions_ts_onRequestPost } from \"/home/lium/chatsvtr/functions/api/suggestions.ts\"\nimport { onRequestPost as __webhook_feishu_js_onRequestPost } from \"/home/lium/chatsvtr/functions/webhook/feishu.js\"\nimport { onRequestPost as __scheduled_sync_ts_onRequestPost } from \"/home/lium/chatsvtr/functions/scheduled-sync.ts\"\nimport { onRequest as ___middleware_ts_onRequest } from \"/home/lium/chatsvtr/functions/_middleware.ts\"\n\nexport const routes = [\n    {\n      routePath: \"/api/chat\",\n      mountPath: \"/api\",\n      method: \"OPTIONS\",\n      middlewares: [],\n      modules: [__api_chat_ts_onRequestOptions],\n    },\n  {\n      routePath: \"/api/chat\",\n      mountPath: \"/api\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_chat_ts_onRequestPost],\n    },\n  {\n      routePath: \"/api/chat-optimized\",\n      mountPath: \"/api\",\n      method: \"OPTIONS\",\n      middlewares: [],\n      modules: [__api_chat_optimized_ts_onRequestOptions],\n    },\n  {\n      routePath: \"/api/chat-optimized\",\n      mountPath: \"/api\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_chat_optimized_ts_onRequestPost],\n    },\n  {\n      routePath: \"/api/feishu-webhook\",\n      mountPath: \"/api\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_feishu_webhook_ts_onRequestGet],\n    },\n  {\n      routePath: \"/api/feishu-webhook\",\n      mountPath: \"/api\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_feishu_webhook_ts_onRequestPost],\n    },\n  {\n      routePath: \"/api/quota-status\",\n      mountPath: \"/api\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_quota_status_ts_onRequestGet],\n    },\n  {\n      routePath: \"/api/subscribe\",\n      mountPath: \"/api\",\n      method: \"DELETE\",\n      middlewares: [],\n      modules: [__api_subscribe_ts_onRequestDelete],\n    },\n  {\n      routePath: \"/api/subscribe\",\n      mountPath: \"/api\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_subscribe_ts_onRequestGet],\n    },\n  {\n      routePath: \"/api/subscribe\",\n      mountPath: \"/api\",\n      method: \"OPTIONS\",\n      middlewares: [],\n      modules: [__api_subscribe_ts_onRequestOptions],\n    },\n  {\n      routePath: \"/api/subscribe\",\n      mountPath: \"/api\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_subscribe_ts_onRequestPost],\n    },\n  {\n      routePath: \"/api/suggestions\",\n      mountPath: \"/api\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_suggestions_ts_onRequestGet],\n    },\n  {\n      routePath: \"/api/suggestions\",\n      mountPath: \"/api\",\n      method: \"OPTIONS\",\n      middlewares: [],\n      modules: [__api_suggestions_ts_onRequestOptions],\n    },\n  {\n      routePath: \"/api/suggestions\",\n      mountPath: \"/api\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_suggestions_ts_onRequestPost],\n    },\n  {\n      routePath: \"/webhook/feishu\",\n      mountPath: \"/webhook\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__webhook_feishu_js_onRequestPost],\n    },\n  {\n      routePath: \"/scheduled-sync\",\n      mountPath: \"/\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__scheduled_sync_ts_onRequestPost],\n    },\n  {\n      routePath: \"/\",\n      mountPath: \"/\",\n      method: \"\",\n      middlewares: [___middleware_ts_onRequest],\n      modules: [],\n    },\n  ]", "/**\n * Tokenizer results.\n */\ninterface LexToken {\n  type:\n    | \"OPEN\"\n    | \"CLOSE\"\n    | \"PATTERN\"\n    | \"NAME\"\n    | \"CHAR\"\n    | \"ESCAPED_CHAR\"\n    | \"MODIFIER\"\n    | \"END\";\n  index: number;\n  value: string;\n}\n\n/**\n * Tokenize input string.\n */\nfunction lexer(str: string): LexToken[] {\n  const tokens: LexToken[] = [];\n  let i = 0;\n\n  while (i < str.length) {\n    const char = str[i];\n\n    if (char === \"*\" || char === \"+\" || char === \"?\") {\n      tokens.push({ type: \"MODIFIER\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"\\\\\") {\n      tokens.push({ type: \"ESCAPED_CHAR\", index: i++, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"{\") {\n      tokens.push({ type: \"OPEN\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"}\") {\n      tokens.push({ type: \"CLOSE\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \":\") {\n      let name = \"\";\n      let j = i + 1;\n\n      while (j < str.length) {\n        const code = str.charCodeAt(j);\n\n        if (\n          // `0-9`\n          (code >= 48 && code <= 57) ||\n          // `A-Z`\n          (code >= 65 && code <= 90) ||\n          // `a-z`\n          (code >= 97 && code <= 122) ||\n          // `_`\n          code === 95\n        ) {\n          name += str[j++];\n          continue;\n        }\n\n        break;\n      }\n\n      if (!name) throw new TypeError(`Missing parameter name at ${i}`);\n\n      tokens.push({ type: \"NAME\", index: i, value: name });\n      i = j;\n      continue;\n    }\n\n    if (char === \"(\") {\n      let count = 1;\n      let pattern = \"\";\n      let j = i + 1;\n\n      if (str[j] === \"?\") {\n        throw new TypeError(`Pattern cannot start with \"?\" at ${j}`);\n      }\n\n      while (j < str.length) {\n        if (str[j] === \"\\\\\") {\n          pattern += str[j++] + str[j++];\n          continue;\n        }\n\n        if (str[j] === \")\") {\n          count--;\n          if (count === 0) {\n            j++;\n            break;\n          }\n        } else if (str[j] === \"(\") {\n          count++;\n          if (str[j + 1] !== \"?\") {\n            throw new TypeError(`Capturing groups are not allowed at ${j}`);\n          }\n        }\n\n        pattern += str[j++];\n      }\n\n      if (count) throw new TypeError(`Unbalanced pattern at ${i}`);\n      if (!pattern) throw new TypeError(`Missing pattern at ${i}`);\n\n      tokens.push({ type: \"PATTERN\", index: i, value: pattern });\n      i = j;\n      continue;\n    }\n\n    tokens.push({ type: \"CHAR\", index: i, value: str[i++] });\n  }\n\n  tokens.push({ type: \"END\", index: i, value: \"\" });\n\n  return tokens;\n}\n\nexport interface ParseOptions {\n  /**\n   * Set the default delimiter for repeat parameters. (default: `'/'`)\n   */\n  delimiter?: string;\n  /**\n   * List of characters to automatically consider prefixes when parsing.\n   */\n  prefixes?: string;\n}\n\n/**\n * Parse a string for the raw tokens.\n */\nexport function parse(str: string, options: ParseOptions = {}): Token[] {\n  const tokens = lexer(str);\n  const { prefixes = \"./\", delimiter = \"/#?\" } = options;\n  const result: Token[] = [];\n  let key = 0;\n  let i = 0;\n  let path = \"\";\n\n  const tryConsume = (type: LexToken[\"type\"]): string | undefined => {\n    if (i < tokens.length && tokens[i].type === type) return tokens[i++].value;\n  };\n\n  const mustConsume = (type: LexToken[\"type\"]): string => {\n    const value = tryConsume(type);\n    if (value !== undefined) return value;\n    const { type: nextType, index } = tokens[i];\n    throw new TypeError(`Unexpected ${nextType} at ${index}, expected ${type}`);\n  };\n\n  const consumeText = (): string => {\n    let result = \"\";\n    let value: string | undefined;\n    while ((value = tryConsume(\"CHAR\") || tryConsume(\"ESCAPED_CHAR\"))) {\n      result += value;\n    }\n    return result;\n  };\n\n  const isSafe = (value: string): boolean => {\n    for (const char of delimiter) if (value.indexOf(char) > -1) return true;\n    return false;\n  };\n\n  const safePattern = (prefix: string) => {\n    const prev = result[result.length - 1];\n    const prevText = prefix || (prev && typeof prev === \"string\" ? prev : \"\");\n\n    if (prev && !prevText) {\n      throw new TypeError(\n        `Must have text between two parameters, missing text after \"${(prev as Key).name}\"`,\n      );\n    }\n\n    if (!prevText || isSafe(prevText)) return `[^${escapeString(delimiter)}]+?`;\n    return `(?:(?!${escapeString(prevText)})[^${escapeString(delimiter)}])+?`;\n  };\n\n  while (i < tokens.length) {\n    const char = tryConsume(\"CHAR\");\n    const name = tryConsume(\"NAME\");\n    const pattern = tryConsume(\"PATTERN\");\n\n    if (name || pattern) {\n      let prefix = char || \"\";\n\n      if (prefixes.indexOf(prefix) === -1) {\n        path += prefix;\n        prefix = \"\";\n      }\n\n      if (path) {\n        result.push(path);\n        path = \"\";\n      }\n\n      result.push({\n        name: name || key++,\n        prefix,\n        suffix: \"\",\n        pattern: pattern || safePattern(prefix),\n        modifier: tryConsume(\"MODIFIER\") || \"\",\n      });\n      continue;\n    }\n\n    const value = char || tryConsume(\"ESCAPED_CHAR\");\n    if (value) {\n      path += value;\n      continue;\n    }\n\n    if (path) {\n      result.push(path);\n      path = \"\";\n    }\n\n    const open = tryConsume(\"OPEN\");\n    if (open) {\n      const prefix = consumeText();\n      const name = tryConsume(\"NAME\") || \"\";\n      const pattern = tryConsume(\"PATTERN\") || \"\";\n      const suffix = consumeText();\n\n      mustConsume(\"CLOSE\");\n\n      result.push({\n        name: name || (pattern ? key++ : \"\"),\n        pattern: name && !pattern ? safePattern(prefix) : pattern,\n        prefix,\n        suffix,\n        modifier: tryConsume(\"MODIFIER\") || \"\",\n      });\n      continue;\n    }\n\n    mustConsume(\"END\");\n  }\n\n  return result;\n}\n\nexport interface TokensToFunctionOptions {\n  /**\n   * When `true` the regexp will be case sensitive. (default: `false`)\n   */\n  sensitive?: boolean;\n  /**\n   * Function for encoding input strings for output.\n   */\n  encode?: (value: string, token: Key) => string;\n  /**\n   * When `false` the function can produce an invalid (unmatched) path. (default: `true`)\n   */\n  validate?: boolean;\n}\n\n/**\n * Compile a string to a template function for the path.\n */\nexport function compile<P extends object = object>(\n  str: string,\n  options?: ParseOptions & TokensToFunctionOptions,\n) {\n  return tokensToFunction<P>(parse(str, options), options);\n}\n\nexport type PathFunction<P extends object = object> = (data?: P) => string;\n\n/**\n * Expose a method for transforming tokens into the path function.\n */\nexport function tokensToFunction<P extends object = object>(\n  tokens: Token[],\n  options: TokensToFunctionOptions = {},\n): PathFunction<P> {\n  const reFlags = flags(options);\n  const { encode = (x: string) => x, validate = true } = options;\n\n  // Compile all the tokens into regexps.\n  const matches = tokens.map((token) => {\n    if (typeof token === \"object\") {\n      return new RegExp(`^(?:${token.pattern})$`, reFlags);\n    }\n  });\n\n  return (data: Record<string, any> | null | undefined) => {\n    let path = \"\";\n\n    for (let i = 0; i < tokens.length; i++) {\n      const token = tokens[i];\n\n      if (typeof token === \"string\") {\n        path += token;\n        continue;\n      }\n\n      const value = data ? data[token.name] : undefined;\n      const optional = token.modifier === \"?\" || token.modifier === \"*\";\n      const repeat = token.modifier === \"*\" || token.modifier === \"+\";\n\n      if (Array.isArray(value)) {\n        if (!repeat) {\n          throw new TypeError(\n            `Expected \"${token.name}\" to not repeat, but got an array`,\n          );\n        }\n\n        if (value.length === 0) {\n          if (optional) continue;\n\n          throw new TypeError(`Expected \"${token.name}\" to not be empty`);\n        }\n\n        for (let j = 0; j < value.length; j++) {\n          const segment = encode(value[j], token);\n\n          if (validate && !(matches[i] as RegExp).test(segment)) {\n            throw new TypeError(\n              `Expected all \"${token.name}\" to match \"${token.pattern}\", but got \"${segment}\"`,\n            );\n          }\n\n          path += token.prefix + segment + token.suffix;\n        }\n\n        continue;\n      }\n\n      if (typeof value === \"string\" || typeof value === \"number\") {\n        const segment = encode(String(value), token);\n\n        if (validate && !(matches[i] as RegExp).test(segment)) {\n          throw new TypeError(\n            `Expected \"${token.name}\" to match \"${token.pattern}\", but got \"${segment}\"`,\n          );\n        }\n\n        path += token.prefix + segment + token.suffix;\n        continue;\n      }\n\n      if (optional) continue;\n\n      const typeOfMessage = repeat ? \"an array\" : \"a string\";\n      throw new TypeError(`Expected \"${token.name}\" to be ${typeOfMessage}`);\n    }\n\n    return path;\n  };\n}\n\nexport interface RegexpToFunctionOptions {\n  /**\n   * Function for decoding strings for params.\n   */\n  decode?: (value: string, token: Key) => string;\n}\n\n/**\n * A match result contains data about the path match.\n */\nexport interface MatchResult<P extends object = object> {\n  path: string;\n  index: number;\n  params: P;\n}\n\n/**\n * A match is either `false` (no match) or a match result.\n */\nexport type Match<P extends object = object> = false | MatchResult<P>;\n\n/**\n * The match function takes a string and returns whether it matched the path.\n */\nexport type MatchFunction<P extends object = object> = (\n  path: string,\n) => Match<P>;\n\n/**\n * Create path match function from `path-to-regexp` spec.\n */\nexport function match<P extends object = object>(\n  str: Path,\n  options?: ParseOptions & TokensToRegexpOptions & RegexpToFunctionOptions,\n) {\n  const keys: Key[] = [];\n  const re = pathToRegexp(str, keys, options);\n  return regexpToFunction<P>(re, keys, options);\n}\n\n/**\n * Create a path match function from `path-to-regexp` output.\n */\nexport function regexpToFunction<P extends object = object>(\n  re: RegExp,\n  keys: Key[],\n  options: RegexpToFunctionOptions = {},\n): MatchFunction<P> {\n  const { decode = (x: string) => x } = options;\n\n  return function (pathname: string) {\n    const m = re.exec(pathname);\n    if (!m) return false;\n\n    const { 0: path, index } = m;\n    const params = Object.create(null);\n\n    for (let i = 1; i < m.length; i++) {\n      if (m[i] === undefined) continue;\n\n      const key = keys[i - 1];\n\n      if (key.modifier === \"*\" || key.modifier === \"+\") {\n        params[key.name] = m[i].split(key.prefix + key.suffix).map((value) => {\n          return decode(value, key);\n        });\n      } else {\n        params[key.name] = decode(m[i], key);\n      }\n    }\n\n    return { path, index, params };\n  };\n}\n\n/**\n * Escape a regular expression string.\n */\nfunction escapeString(str: string) {\n  return str.replace(/([.+*?=^!:${}()[\\]|/\\\\])/g, \"\\\\$1\");\n}\n\n/**\n * Get the flags for a regexp from the options.\n */\nfunction flags(options?: { sensitive?: boolean }) {\n  return options && options.sensitive ? \"\" : \"i\";\n}\n\n/**\n * Metadata about a key.\n */\nexport interface Key {\n  name: string | number;\n  prefix: string;\n  suffix: string;\n  pattern: string;\n  modifier: string;\n}\n\n/**\n * A token is a string (nothing special) or key metadata (capture group).\n */\nexport type Token = string | Key;\n\n/**\n * Pull out keys from a regexp.\n */\nfunction regexpToRegexp(path: RegExp, keys?: Key[]): RegExp {\n  if (!keys) return path;\n\n  const groupsRegex = /\\((?:\\?<(.*?)>)?(?!\\?)/g;\n\n  let index = 0;\n  let execResult = groupsRegex.exec(path.source);\n  while (execResult) {\n    keys.push({\n      // Use parenthesized substring match if available, index otherwise\n      name: execResult[1] || index++,\n      prefix: \"\",\n      suffix: \"\",\n      modifier: \"\",\n      pattern: \"\",\n    });\n    execResult = groupsRegex.exec(path.source);\n  }\n\n  return path;\n}\n\n/**\n * Transform an array into a regexp.\n */\nfunction arrayToRegexp(\n  paths: Array<string | RegExp>,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n): RegExp {\n  const parts = paths.map((path) => pathToRegexp(path, keys, options).source);\n  return new RegExp(`(?:${parts.join(\"|\")})`, flags(options));\n}\n\n/**\n * Create a path regexp from string input.\n */\nfunction stringToRegexp(\n  path: string,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n) {\n  return tokensToRegexp(parse(path, options), keys, options);\n}\n\nexport interface TokensToRegexpOptions {\n  /**\n   * When `true` the regexp will be case sensitive. (default: `false`)\n   */\n  sensitive?: boolean;\n  /**\n   * When `true` the regexp won't allow an optional trailing delimiter to match. (default: `false`)\n   */\n  strict?: boolean;\n  /**\n   * When `true` the regexp will match to the end of the string. (default: `true`)\n   */\n  end?: boolean;\n  /**\n   * When `true` the regexp will match from the beginning of the string. (default: `true`)\n   */\n  start?: boolean;\n  /**\n   * Sets the final character for non-ending optimistic matches. (default: `/`)\n   */\n  delimiter?: string;\n  /**\n   * List of characters that can also be \"end\" characters.\n   */\n  endsWith?: string;\n  /**\n   * Encode path tokens for use in the `RegExp`.\n   */\n  encode?: (value: string) => string;\n}\n\n/**\n * Expose a function for taking tokens and returning a RegExp.\n */\nexport function tokensToRegexp(\n  tokens: Token[],\n  keys?: Key[],\n  options: TokensToRegexpOptions = {},\n) {\n  const {\n    strict = false,\n    start = true,\n    end = true,\n    encode = (x: string) => x,\n    delimiter = \"/#?\",\n    endsWith = \"\",\n  } = options;\n  const endsWithRe = `[${escapeString(endsWith)}]|$`;\n  const delimiterRe = `[${escapeString(delimiter)}]`;\n  let route = start ? \"^\" : \"\";\n\n  // Iterate over the tokens and create our regexp string.\n  for (const token of tokens) {\n    if (typeof token === \"string\") {\n      route += escapeString(encode(token));\n    } else {\n      const prefix = escapeString(encode(token.prefix));\n      const suffix = escapeString(encode(token.suffix));\n\n      if (token.pattern) {\n        if (keys) keys.push(token);\n\n        if (prefix || suffix) {\n          if (token.modifier === \"+\" || token.modifier === \"*\") {\n            const mod = token.modifier === \"*\" ? \"?\" : \"\";\n            route += `(?:${prefix}((?:${token.pattern})(?:${suffix}${prefix}(?:${token.pattern}))*)${suffix})${mod}`;\n          } else {\n            route += `(?:${prefix}(${token.pattern})${suffix})${token.modifier}`;\n          }\n        } else {\n          if (token.modifier === \"+\" || token.modifier === \"*\") {\n            throw new TypeError(\n              `Can not repeat \"${token.name}\" without a prefix and suffix`,\n            );\n          }\n\n          route += `(${token.pattern})${token.modifier}`;\n        }\n      } else {\n        route += `(?:${prefix}${suffix})${token.modifier}`;\n      }\n    }\n  }\n\n  if (end) {\n    if (!strict) route += `${delimiterRe}?`;\n\n    route += !options.endsWith ? \"$\" : `(?=${endsWithRe})`;\n  } else {\n    const endToken = tokens[tokens.length - 1];\n    const isEndDelimited =\n      typeof endToken === \"string\"\n        ? delimiterRe.indexOf(endToken[endToken.length - 1]) > -1\n        : endToken === undefined;\n\n    if (!strict) {\n      route += `(?:${delimiterRe}(?=${endsWithRe}))?`;\n    }\n\n    if (!isEndDelimited) {\n      route += `(?=${delimiterRe}|${endsWithRe})`;\n    }\n  }\n\n  return new RegExp(route, flags(options));\n}\n\n/**\n * Supported `path-to-regexp` input types.\n */\nexport type Path = string | RegExp | Array<string | RegExp>;\n\n/**\n * Normalize the given path string, returning a regular expression.\n *\n * An empty array can be passed in for the keys, which will hold the\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\n */\nexport function pathToRegexp(\n  path: Path,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n) {\n  if (path instanceof RegExp) return regexpToRegexp(path, keys);\n  if (Array.isArray(path)) return arrayToRegexp(path, keys, options);\n  return stringToRegexp(path, keys, options);\n}\n", "import { match } from \"path-to-regexp\";\n\n//note: this explicitly does not include the * character, as pages requires this\nconst escapeRegex = /[.+?^${}()|[\\]\\\\]/g;\n\ntype HTTPMethod =\n\t| \"HEAD\"\n\t| \"OPTIONS\"\n\t| \"GET\"\n\t| \"POST\"\n\t| \"PUT\"\n\t| \"PATCH\"\n\t| \"DELETE\";\n\n/* TODO: Grab these from @cloudflare/workers-types instead */\ntype Params<P extends string = string> = Record<P, string | string[]>;\n\ntype EventContext<Env, P extends string, Data> = {\n\trequest: Request;\n\tfunctionPath: string;\n\twaitUntil: (promise: Promise<unknown>) => void;\n\tpassThroughOnException: () => void;\n\tnext: (input?: Request | string, init?: RequestInit) => Promise<Response>;\n\tenv: Env & { ASSETS: { fetch: typeof fetch } };\n\tparams: Params<P>;\n\tdata: Data;\n};\n\ndeclare type PagesFunction<\n\tEnv = unknown,\n\tP extends string = string,\n\tData extends Record<string, unknown> = Record<string, unknown>,\n> = (context: EventContext<Env, P, Data>) => Response | Promise<Response>;\n/* end @cloudflare/workers-types */\n\ntype RouteHandler = {\n\troutePath: string;\n\tmountPath: string;\n\tmethod?: HTTPMethod;\n\tmodules: PagesFunction[];\n\tmiddlewares: PagesFunction[];\n};\n\n// inject `routes` via ESBuild\ndeclare const routes: RouteHandler[];\n// define `__FALLBACK_SERVICE__` via ESBuild\ndeclare const __FALLBACK_SERVICE__: string;\n\n// expect an ASSETS fetcher binding pointing to the asset-server stage\ntype FetchEnv = {\n\t[name: string]: { fetch: typeof fetch };\n\tASSETS: { fetch: typeof fetch };\n};\n\ntype WorkerContext = {\n\twaitUntil: (promise: Promise<unknown>) => void;\n\tpassThroughOnException: () => void;\n};\n\nfunction* executeRequest(request: Request) {\n\tconst requestPath = new URL(request.url).pathname;\n\n\t// First, iterate through the routes (backwards) and execute \"middlewares\" on partial route matches\n\tfor (const route of [...routes].reverse()) {\n\t\tif (route.method && route.method !== request.method) {\n\t\t\tcontinue;\n\t\t}\n\n\t\t// replaces with \"\\\\$&\", this prepends a backslash to the matched string, e.g. \"[\" becomes \"\\[\"\n\t\tconst routeMatcher = match(route.routePath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: false,\n\t\t});\n\t\tconst mountMatcher = match(route.mountPath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: false,\n\t\t});\n\t\tconst matchResult = routeMatcher(requestPath);\n\t\tconst mountMatchResult = mountMatcher(requestPath);\n\t\tif (matchResult && mountMatchResult) {\n\t\t\tfor (const handler of route.middlewares.flat()) {\n\t\t\t\tyield {\n\t\t\t\t\thandler,\n\t\t\t\t\tparams: matchResult.params as Params,\n\t\t\t\t\tpath: mountMatchResult.path,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\t// Then look for the first exact route match and execute its \"modules\"\n\tfor (const route of routes) {\n\t\tif (route.method && route.method !== request.method) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst routeMatcher = match(route.routePath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: true,\n\t\t});\n\t\tconst mountMatcher = match(route.mountPath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: false,\n\t\t});\n\t\tconst matchResult = routeMatcher(requestPath);\n\t\tconst mountMatchResult = mountMatcher(requestPath);\n\t\tif (matchResult && mountMatchResult && route.modules.length) {\n\t\t\tfor (const handler of route.modules.flat()) {\n\t\t\t\tyield {\n\t\t\t\t\thandler,\n\t\t\t\t\tparams: matchResult.params as Params,\n\t\t\t\t\tpath: matchResult.path,\n\t\t\t\t};\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nexport default {\n\tasync fetch(\n\t\toriginalRequest: Request,\n\t\tenv: FetchEnv,\n\t\tworkerContext: WorkerContext\n\t) {\n\t\tlet request = originalRequest;\n\t\tconst handlerIterator = executeRequest(request);\n\t\tlet data = {}; // arbitrary data the user can set between functions\n\t\tlet isFailOpen = false;\n\n\t\tconst next = async (input?: RequestInfo, init?: RequestInit) => {\n\t\t\tif (input !== undefined) {\n\t\t\t\tlet url = input;\n\t\t\t\tif (typeof input === \"string\") {\n\t\t\t\t\turl = new URL(input, request.url).toString();\n\t\t\t\t}\n\t\t\t\trequest = new Request(url, init);\n\t\t\t}\n\n\t\t\tconst result = handlerIterator.next();\n\t\t\t// Note we can't use `!result.done` because this doesn't narrow to the correct type\n\t\t\tif (result.done === false) {\n\t\t\t\tconst { handler, params, path } = result.value;\n\t\t\t\tconst context = {\n\t\t\t\t\trequest: new Request(request.clone()),\n\t\t\t\t\tfunctionPath: path,\n\t\t\t\t\tnext,\n\t\t\t\t\tparams,\n\t\t\t\t\tget data() {\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t},\n\t\t\t\t\tset data(value) {\n\t\t\t\t\t\tif (typeof value !== \"object\" || value === null) {\n\t\t\t\t\t\t\tthrow new Error(\"context.data must be an object\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// user has overriden context.data, so we need to merge it with the existing data\n\t\t\t\t\t\tdata = value;\n\t\t\t\t\t},\n\t\t\t\t\tenv,\n\t\t\t\t\twaitUntil: workerContext.waitUntil.bind(workerContext),\n\t\t\t\t\tpassThroughOnException: () => {\n\t\t\t\t\t\tisFailOpen = true;\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tconst response = await handler(context);\n\n\t\t\t\tif (!(response instanceof Response)) {\n\t\t\t\t\tthrow new Error(\"Your Pages function should return a Response\");\n\t\t\t\t}\n\n\t\t\t\treturn cloneResponse(response);\n\t\t\t} else if (__FALLBACK_SERVICE__) {\n\t\t\t\t// There are no more handlers so finish with the fallback service (`env.ASSETS.fetch` in Pages' case)\n\t\t\t\tconst response = await env[__FALLBACK_SERVICE__].fetch(request);\n\t\t\t\treturn cloneResponse(response);\n\t\t\t} else {\n\t\t\t\t// There was not fallback service so actually make the request to the origin.\n\t\t\t\tconst response = await fetch(request);\n\t\t\t\treturn cloneResponse(response);\n\t\t\t}\n\t\t};\n\n\t\ttry {\n\t\t\treturn await next();\n\t\t} catch (error) {\n\t\t\tif (isFailOpen) {\n\t\t\t\tconst response = await env[__FALLBACK_SERVICE__].fetch(request);\n\t\t\t\treturn cloneResponse(response);\n\t\t\t}\n\n\t\t\tthrow error;\n\t\t}\n\t},\n};\n\n// This makes a Response mutable\nconst cloneResponse = (response: Response) =>\n\t// https://fetch.spec.whatwg.org/#null-body-status\n\tnew Response(\n\t\t[101, 204, 205, 304].includes(response.status) ? null : response.body,\n\t\tresponse\n\t);\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"/home/lium/chatsvtr/node_modules/wrangler/templates/pages-template-worker.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"/home/lium/chatsvtr/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"/home/lium/chatsvtr/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"/home/lium/chatsvtr/node_modules/wrangler/templates/pages-template-worker.ts\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"/home/lium/chatsvtr/.wrangler/tmp/bundle-Xg2GE4/middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"/home/lium/chatsvtr/node_modules/wrangler/templates/middleware/common.ts\";\nimport type { WorkerEntrypointConstructor } from \"/home/lium/chatsvtr/.wrangler/tmp/bundle-Xg2GE4/middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"/home/lium/chatsvtr/.wrangler/tmp/bundle-Xg2GE4/middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": ";;;;AAAA,IAAM,OAAO,oBAAI,IAAI;AAErB,SAAS,SAAS,SAAS,MAAM;AAChC,QAAM,MACL,mBAAmB,MAChB,UACA,IAAI;AAAA,KACH,OAAO,YAAY,WACjB,IAAI,QAAQ,SAAS,IAAI,IACzB,SACD;AAAA,EACH;AACH,MAAI,IAAI,QAAQ,IAAI,SAAS,SAAS,IAAI,aAAa,UAAU;AAChE,QAAI,CAAC,KAAK,IAAI,IAAI,SAAS,CAAC,GAAG;AAC9B,WAAK,IAAI,IAAI,SAAS,CAAC;AACvB,cAAQ;AAAA,QACP;AAAA,KACO,IAAI,SAAS,CAAC;AAAA;AAAA,MACtB;AAAA,IACD;AAAA,EACD;AACD;AAnBS;AAqBT,WAAW,QAAQ,IAAI,MAAM,WAAW,OAAO;AAAA,EAC9C,MAAM,QAAQ,SAAS,UAAU;AAChC,UAAM,CAAC,SAAS,IAAI,IAAI;AACxB,aAAS,SAAS,IAAI;AACtB,WAAO,QAAQ,MAAM,QAAQ,SAAS,QAAQ;AAAA,EAC/C;AACD,CAAC;;;ACbM,IAAM,mBAAN,MAAuB;AAAA,EAhB9B,OAgB8B;AAAA;AAAA;AAAA,EACpB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EAER,YAAY,WAAgB,IAAS,cAAuB,aAAmB,iBAAuB,gBAA0B;AAC9H,SAAK,YAAY;AACjB,SAAK,KAAK;AACV,SAAK,eAAe;AACpB,SAAK,iBAAiB;AAGtB,SAAK,SAAS;AAAA,MACZ,WAAW,CAAC,CAAC;AAAA,MACb,iBAAiB,CAAC,CAAC;AAAA,MACnB,kBAAkB;AAAA,MAClB,cAAc;AAAA;AAAA,MACd,iBAAiB;AAAA,IACnB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,sBAAsB,OAAe,UAAe,CAAC,GAAG;AAC5D,UAAM,YAAY,KAAK,IAAI;AAC3B,YAAQ,IAAI,0CAAe;AAE3B,QAAI;AAEF,UAAI,CAAC,SAAS,OAAO,UAAU,YAAY,MAAM,KAAK,EAAE,WAAW,GAAG;AACpE,cAAM,IAAI,MAAM,kDAAU;AAAA,MAC5B;AAGA,YAAM,iBAAiB,KAAK,mBAAmB,KAAK;AACpD,UAAI,gBAAgB;AAClB,gBAAQ,IAAI,wHAAuB;AACnC,gBAAQ,mBAAmB;AAC3B,gBAAQ,kBAAkB;AAAA,MAC5B;AAEA,YAAM,aAAa,CAAC;AAGpB,UAAI,KAAK,OAAO,aAAa,KAAK,OAAO,iBAAiB;AACxD,mBAAW,KAAK,KAAK,aAAa,OAAO,OAAO,CAAC;AAAA,MACnD;AAGA,iBAAW,KAAK,KAAK,cAAc,OAAO,OAAO,CAAC;AAGlD,iBAAW,KAAK,KAAK,qBAAqB,OAAO,OAAO,CAAC;AAGzD,UAAI,WAAW,WAAW,GAAG;AAC3B,cAAM,IAAI,MAAM,wDAAW;AAAA,MAC7B;AAGA,YAAM,UAAU,MAAM,QAAQ,WAAW,UAAU;AAGnD,YAAM,oBAAoB,QAAQ,OAAO,OAAK,EAAE,WAAW,WAAW;AACtE,UAAI,kBAAkB,WAAW,GAAG;AAClC,gBAAQ,KAAK,wGAAmB;AAChC,eAAO,KAAK,mBAAmB,KAAK;AAAA,MACtC;AAGA,YAAM,gBAAgB,KAAK,aAAa,SAAS,KAAK;AAGtD,YAAM,eAAe;AAAA,QACnB,GAAG;AAAA,QACH,aAAa;AAAA,QACb,WAAW;AAAA,QACX,cAAc,KAAK,IAAI,IAAI;AAAA,QAC3B,kBAAkB;AAAA,UAChB,wBAAwB;AAAA,UACxB,sBAAsB,kBAAkB;AAAA,UACxC,iBAAiB,WAAW;AAAA,QAC9B;AAAA,MACF;AAEA,aAAO;AAAA,IACT,SAAS,OAAO;AACd,cAAQ,MAAM,8DAAiB,KAAK;AACpC,aAAO,KAAK,iBAAiB,OAAO,MAAM,OAAO;AAAA,IACnD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,aAAa,OAAe,SAAc;AACtD,QAAI;AACF,UAAI;AAEJ,UAAI,KAAK,OAAO,WAAW;AACzB,sBAAc,MAAM,KAAK,mBAAmB,KAAK;AAAA,MACnD,WAAW,KAAK,OAAO,iBAAiB;AACtC,sBAAc,MAAM,KAAK,uBAAuB,KAAK;AAAA,MACvD,OAAO;AACL,cAAM,IAAI,MAAM,gCAAgC;AAAA,MAClD;AAEA,aAAO,MAAM,KAAK,UAAU,MAAM,aAAa;AAAA,QAC7C,MAAM,QAAQ,QAAQ;AAAA,QACtB,gBAAgB;AAAA,MAClB,CAAC;AAAA,IAEH,SAAS,OAAO;AACd,cAAQ,IAAI,gFAAe;AAC3B,aAAO,EAAE,SAAS,CAAC,GAAG,QAAQ,gBAAgB;AAAA,IAChD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,cAAc,OAAe,SAAc;AAEvD,UAAM,WAAW,KAAK,gBAAgB,KAAK;AAC3C,UAAM,UAAU,MAAM,KAAK,mBAAmB,QAAQ;AAEtD,WAAO;AAAA,MACL,SAAS,QAAQ,IAAI,CAAAA,YAAU;AAAA,QAC7B,GAAGA;AAAA,QACH,OAAOA,OAAM;AAAA,QACb,QAAQ;AAAA,MACV,EAAE;AAAA,MACF,QAAQ;AAAA,IACV;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAMA,MAAc,qBAAqB,OAAe,SAAc;AAC9D,UAAM,WAAW;AAAA,MACf,YAAY,CAAC,gBAAM,gBAAM,gBAAM,MAAM,SAAS;AAAA,MAC9C,SAAS,CAAC,gBAAM,gBAAM,gBAAM,WAAW,SAAS;AAAA,MAChD,OAAO,CAAC,gBAAM,gBAAM,gBAAM,SAAS,QAAQ;AAAA,MAC3C,YAAY,CAAC,gBAAM,MAAM,4BAAQ,MAAM;AAAA,IACzC;AAEA,UAAM,aAAa,MAAM,YAAY;AACrC,UAAM,SAAS,CAAC;AAEhB,eAAW,CAAC,UAAU,QAAQ,KAAK,OAAO,QAAQ,QAAQ,GAAG;AAC3D,aAAO,QAAQ,IAAI,SAAS,OAAO,CAAC,OAAO,YAAY;AACrD,eAAO,SAAS,WAAW,SAAS,OAAO,IAAI,IAAI;AAAA,MACrD,GAAG,CAAC;AAAA,IACN;AAEA,UAAM,eAAe,OAAO,QAAQ,MAAM,EACvC,KAAK,CAAC,CAAC,EAAC,CAAC,GAAG,CAAC,EAAC,CAAC,MAAM,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC;AAEnC,WAAO;AAAA,MACL,SAAS,MAAM,KAAK,mBAAmB,YAAY;AAAA,MACnD,QAAQ;AAAA,MACR,UAAU;AAAA,IACZ;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAa,SAAgB,OAAe;AAClD,UAAM,aAAa,CAAC;AAEpB,YAAQ,QAAQ,CAAC,QAAQ,UAAU;AACjC,UAAI,OAAO,WAAW,eAAe,OAAO,MAAM,SAAS;AACzD,eAAO,MAAM,QAAQ,QAAQ,CAAAA,WAAS;AACpC,qBAAW,KAAK;AAAA,YACd,GAAGA;AAAA,YACH,UAAU,OAAO,MAAM;AAAA,YACvB,eAAe;AAAA,UACjB,CAAC;AAAA,QACH,CAAC;AAAA,MACH;AAAA,IACF,CAAC;AAGD,UAAM,eAAe,KAAK,mBAAmB,UAAU;AACvD,UAAM,SAAS,KAAK,eAAe,cAAc,KAAK;AAEtD,WAAO;AAAA,MACL,SAAS,OAAO,MAAM,GAAG,CAAC;AAAA;AAAA,MAC1B,SAAS,KAAK,eAAe,MAAM;AAAA,MACnC,YAAY,KAAK,oBAAoB,MAAM;AAAA,MAC3C,YAAY,QAAQ;AAAA,IACtB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB,OAAyB;AAE/C,WAAO,MACJ,YAAY,EACZ,QAAQ,yBAAyB,EAAE,EACnC,MAAM,KAAK,EACX,OAAO,UAAQ,KAAK,SAAS,CAAC;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,mBAAmB,UAAoB;AAGnD,UAAM,YAAY,MAAM,KAAK,mBAAmB;AAEhD,WAAO,UAAU,OAAO,SAAO;AAC7B,YAAM,WAAW,IAAI,WAAW,IAAI,YAAY;AAChD,aAAO,SAAS,KAAK,aAAW,QAAQ,SAAS,OAAO,CAAC;AAAA,IAC3D,CAAC,EAAE,IAAI,UAAQ;AAAA,MACb,GAAG;AAAA,MACH,cAAc,KAAK,sBAAsB,IAAI,SAAS,QAAQ;AAAA,IAChE,EAAE;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,mBAAmB,UAAkB;AACjD,UAAM,UAAU,MAAM,KAAK,mBAAmB;AAG9C,UAAM,mBAAmB;AAAA,MACvB,YAAY,CAAC,gBAAM,gBAAM,gBAAM,gBAAM,gBAAM,MAAM,cAAI;AAAA,MACrD,SAAS,CAAC,gBAAM,gBAAM,gBAAM,gBAAM,gBAAM,oBAAK;AAAA,MAC7C,OAAO,CAAC,gBAAM,gBAAM,gBAAM,gBAAM,gBAAM,cAAI;AAAA,MAC1C,YAAY,CAAC,gBAAM,MAAM,4BAAQ,gBAAM,cAAI;AAAA,IAC7C;AAEA,UAAM,WAAW,iBAAiB,QAAQ,KAAK,CAAC;AAChD,QAAI,SAAS,WAAW,EAAG,QAAO,CAAC;AAGnC,UAAM,eAAe,QAClB,IAAI,UAAQ;AAAA,MACX,GAAG;AAAA,MACH,eAAe,KAAK,uBAAuB,KAAK,QAAQ;AAAA,IAC1D,EAAE,EACD,OAAO,SAAO,IAAI,gBAAgB,GAAG,EACrC,KAAK,CAAC,GAAG,MAAM,EAAE,gBAAgB,EAAE,aAAa,EAChD,MAAM,GAAG,CAAC;AAEb,WAAO,aAAa,IAAI,UAAQ;AAAA,MAC9B,IAAI,IAAI;AAAA,MACR,SAAS,IAAI;AAAA,MACb,OAAO,IAAI;AAAA,MACX,OAAO,IAAI;AAAA,MACX,QAAQ,IAAI;AAAA,MACZ,MAAM,IAAI;AAAA,IACZ,EAAE;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKQ,uBAAuB,KAAU,kBAAoC;AAC3E,UAAM,WAAW,IAAI,WAAW,IAAI,YAAY;AAChD,UAAM,SAAS,IAAI,SAAS,IAAI,YAAY;AAC5C,UAAM,WAAW,IAAI,YAAY,CAAC;AAElC,QAAI,QAAQ;AACZ,QAAI,UAAU;AAGd,qBAAiB,QAAQ,aAAW;AAClC,YAAM,eAAe,QAAQ,YAAY;AACzC,UAAI,QAAQ,SAAS,YAAY,GAAG;AAClC,iBAAS;AACT;AAAA,MACF;AACA,UAAI,MAAM,SAAS,YAAY,GAAG;AAChC,iBAAS;AACT;AAAA,MACF;AAAA,IACF,CAAC;AAGD,aAAS,QAAQ,aAAW;AAC1B,UAAI,iBAAiB;AAAA,QAAK,QACxB,GAAG,YAAY,EAAE,SAAS,QAAQ,YAAY,CAAC,KAC/C,QAAQ,YAAY,EAAE,SAAS,GAAG,YAAY,CAAC;AAAA,MACjD,GAAG;AACD,iBAAS;AACT;AAAA,MACF;AAAA,IACF,CAAC;AAGD,WAAO,KAAK,IAAI,QAAS,UAAU,iBAAiB,SAAU,KAAK,CAAG;AAAA,EACxE;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAmB,SAAgB;AACzC,UAAM,OAAO,oBAAI,IAAI;AACrB,WAAO,QAAQ,OAAO,CAAAA,WAAS;AAC7B,YAAM,MAAMA,OAAM,MAAMA,OAAM,SAAS,UAAU,GAAG,GAAG;AACvD,UAAI,KAAK,IAAI,GAAG,EAAG,QAAO;AAC1B,WAAK,IAAI,GAAG;AACZ,aAAO;AAAA,IACT,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAe,SAAgB,OAAe;AACpD,WAAO,QAAQ,IAAI,CAAAA,YAAU;AAAA,MAC3B,GAAGA;AAAA,MACH,YAAY,KAAK,oBAAoBA,QAAO,KAAK;AAAA,IACnD,EAAE,EAAE,KAAK,CAAC,GAAG,MAAM,EAAE,aAAa,EAAE,UAAU;AAAA,EAChD;AAAA;AAAA;AAAA;AAAA,EAKQ,oBAAoBA,QAAY,OAAuB;AAC7D,QAAI,QAAQA,OAAM,SAAS;AAG3B,QAAIA,OAAM,aAAa,SAAU,UAAS;AAC1C,QAAIA,OAAM,aAAa,UAAW,UAAS;AAC3C,QAAIA,OAAM,aAAa,UAAW,UAAS;AAG3C,QAAIA,OAAM,WAAWA,OAAM,QAAQ,SAAS,IAAK,UAAS;AAE1D,WAAO,KAAK,IAAI,OAAO,CAAG;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA,EAKQ,oBAAoB,SAAwB;AAClD,QAAI,QAAQ,WAAW,EAAG,QAAO;AAEjC,UAAM,WAAW,QAAQ,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,YAAY,CAAC,IAAI,QAAQ;AAC7E,UAAM,wBAAwB,IAAI,IAAI,QAAQ,IAAI,OAAK,EAAE,QAAQ,CAAC,EAAE,OAAO;AAE3E,WAAO,KAAK,IAAI,YAAY,wBAAwB,MAAM,IAAM,CAAG;AAAA,EACrE;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAe,SAA0B;AAC/C,UAAM,UAAU,IAAI,IAAI,QAAQ,IAAI,OAAK,EAAE,SAAS,EAAE,UAAU,oBAAK,CAAC;AACtE,WAAO,MAAM,KAAK,OAAO;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,qBAAqB;AACjC,QAAI;AAEF,YAAM,YAAY,CAAC;AAGnB,UAAI;AACF,cAAM,aAAa,MAAM,KAAK,wBAAwB;AACtD,kBAAU,KAAK,GAAG,UAAU;AAAA,MAC9B,SAAS,GAAG;AAAE,gBAAQ,IAAI,uEAAgB,EAAE,OAAO;AAAA,MAAG;AAGtD,UAAI,UAAU,WAAW,GAAG;AAC1B,kBAAU,KAAK,GAAG,KAAK,wBAAwB,CAAC;AAAA,MAClD;AAEA,aAAO;AAAA,IACT,SAAS,OAAO;AACd,cAAQ,IAAI,sFAAgB;AAC5B,aAAO,KAAK,wBAAwB;AAAA,IACtC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,0BAA0B;AACtC,QAAI;AAEF,YAAM,UAAU,KAAK,WAAW;AAGhC,UAAI,WAAW,MAAM,MAAM,GAAG,OAAO,oDAAoD,EAAE,MAAM,MAAM,IAAI;AAG3G,UAAI,CAAC,YAAY,CAAC,SAAS,IAAI;AAC7B,mBAAW,MAAM,MAAM,GAAG,OAAO,2CAA2C,EAAE,MAAM,MAAM,IAAI;AAAA,MAChG;AAGA,UAAI,CAAC,YAAY,CAAC,SAAS,IAAI;AAC7B,mBAAW,MAAM,MAAM,GAAG,OAAO,sDAAsD,EAAE,MAAM,MAAM,IAAI;AAAA,MAC3G;AAEA,UAAI,CAAC,YAAY,CAAC,SAAS,IAAI;AAC7B,cAAM,IAAI,MAAM,6HAAyB;AAAA,MAC3C;AAEA,YAAM,OAAO,MAAM,SAAS,KAAK;AACjC,YAAM,YAAY,CAAC;AAGnB,UAAI,KAAK,SAAS,MAAM,QAAQ,KAAK,KAAK,KAAK,KAAK,SAAS,eAAe,eAAe;AACzF,gBAAQ,IAAI,gFAAoB;AAChC,gBAAQ,IAAI,uCAAY,KAAK,MAAM,MAAM,2CAAa,KAAK,QAAQ,gBAAgB,cAAI;AAEvF,aAAK,MAAM,QAAQ,UAAQ;AAEzB,cAAI,KAAK,WAAW,KAAK,QAAQ,KAAK,EAAE,SAAS,IAAI;AACnD,sBAAU,KAAK;AAAA,cACb,IAAI,KAAK;AAAA,cACT,SAAS,KAAK;AAAA,cACd,OAAO,KAAK;AAAA,cACZ,MAAM,KAAK,QAAQ;AAAA,cACnB,QAAQ,KAAK,UAAU;AAAA,cACvB,UAAU,KAAK,kBAAkB,CAAC;AAAA,cAClC,UAAU,KAAK,YAAY;AAAA,cAC3B,UAAU;AAAA;AAAA,cACV,aAAa,KAAK;AAAA,cAClB,OAAO,KAAK,SAAS;AAAA,cACrB,WAAW,KAAK;AAAA,cAChB,eAAe,KAAK,iBAAiB;AAAA,cACrC,SAAS,KAAK,WAAW,KAAK;AAAA,cAC9B,cAAc,KAAK,gBAAgB,CAAC;AAAA,YACtC,CAAC;AAAA,UACH;AAAA,QACF,CAAC;AAAA,MACH,WAES,KAAK,aAAa,MAAM,QAAQ,KAAK,SAAS,KAAK,KAAK,SAAS,eAAe,oBAAoB;AAC3G,gBAAQ,IAAI,4DAAe;AAC3B,aAAK,UAAU,QAAQ,SAAO;AAC5B,oBAAU,KAAK;AAAA,YACb,IAAI,IAAI;AAAA,YACR,SAAS,IAAI;AAAA,YACb,OAAO,IAAI;AAAA,YACX,MAAM,IAAI;AAAA,YACV,QAAQ,IAAI;AAAA,YACZ,UAAU,IAAI,YAAY,IAAI,kBAAkB,CAAC;AAAA,YACjD,UAAU,IAAI,YAAY;AAAA,YAC1B,UAAU,IAAI,UAAU,YAAY;AAAA,YACpC,aAAa,IAAI;AAAA,UACnB,CAAC;AAAA,QACH,CAAC;AAAA,MACH,WAES,KAAK,aAAa,MAAM,QAAQ,KAAK,SAAS,GAAG;AACxD,gBAAQ,IAAI,qEAAc;AAC1B,aAAK,UAAU,QAAQ,SAAO;AAC5B,oBAAU,KAAK;AAAA,YACb,IAAI,IAAI,MAAM,UAAU,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC,CAAC;AAAA,YAC/D,SAAS,IAAI,WAAW;AAAA,YACxB,OAAO,IAAI,SAAS;AAAA,YACpB,MAAM,IAAI,QAAQ;AAAA,YAClB,QAAQ;AAAA,YACR,UAAU,IAAI,YAAY,CAAC;AAAA,YAC3B,UAAU,IAAI,YAAY;AAAA,YAC1B,UAAU;AAAA,UACZ,CAAC;AAAA,QACH,CAAC;AAAA,MACH;AAEA,cAAQ,IAAI,gCAAU,UAAU,MAAM,oCAAW,UAAU,OAAO,OAAK,EAAE,QAAQ,EAAE,MAAM,4BAAQ;AACjG,aAAO;AAAA,IACT,SAAS,OAAO;AACd,cAAQ,IAAI,2DAAc,MAAM,OAAO;AACvC,aAAO,CAAC;AAAA,IACV;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,0BAA0B;AAChC,WAAO;AAAA,MACL;AAAA,QACE,IAAI;AAAA,QACJ,SAAS;AAAA;AAAA;AAAA;AAAA,QAIT,OAAO;AAAA,QACP,MAAM;AAAA,QACN,QAAQ;AAAA,QACR,UAAU,CAAC,4BAAQ,UAAU,kCAAS,4BAAQ,0BAAM;AAAA,MACtD;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,SAAS;AAAA;AAAA;AAAA;AAAA,QAIT,OAAO;AAAA,QACP,MAAM;AAAA,QACN,QAAQ;AAAA,QACR,UAAU,CAAC,4BAAQ,4BAAQ,mBAAS,4BAAQ,gCAAO;AAAA,MACrD;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,mBAAmB,OAAkC;AACjE,QAAI,CAAC,KAAK,cAAc;AACtB,YAAM,IAAI,MAAM,0CAAiB;AAAA,IACnC;AAEA,UAAM,WAAW,MAAM,MAAM,wCAAwC;AAAA,MACnE,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,iBAAiB,UAAU,KAAK,YAAY;AAAA,QAC5C,gBAAgB;AAAA,MAClB;AAAA,MACA,MAAM,KAAK,UAAU;AAAA,QACnB,OAAO;AAAA,QACP,OAAO;AAAA,QACP,YAAY;AAAA,MACd,CAAC;AAAA,IACH,CAAC;AAED,QAAI,CAAC,SAAS,IAAI;AAChB,YAAM,QAAQ,MAAM,SAAS,KAAK;AAClC,YAAM,IAAI,MAAM,2BAAiB,MAAM,OAAO,OAAO,EAAE;AAAA,IACzD;AAEA,UAAM,OAAO,MAAM,SAAS,KAAK;AACjC,WAAO,KAAK,KAAK,CAAC,EAAE;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,uBAAuB,OAAkC;AACrE,QAAI,CAAC,KAAK,IAAI;AACZ,YAAM,IAAI,MAAM,iCAAkB;AAAA,IACpC;AAEA,QAAI;AACF,YAAM,WAAW,MAAM,KAAK,GAAG,IAAI,6BAA6B;AAAA,QAC9D,MAAM;AAAA,MACR,CAAC;AAED,aAAO,SAAS,KAAK,CAAC;AAAA,IACxB,SAAS,OAAO;AACd,YAAM,IAAI,MAAM,8BAAoB,MAAM,OAAO,EAAE;AAAA,IACrD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAOQ,sBAAsB,SAAiB,UAA4B;AACzE,QAAI,CAAC,WAAW,SAAS,WAAW,EAAG,QAAO;AAE9C,UAAM,eAAe,QAAQ,YAAY;AACzC,UAAM,aAAa,QAAQ,MAAM,KAAK,EAAE;AACxC,QAAI,QAAQ;AACZ,QAAI,kBAAkB;AAEtB,aAAS,QAAQ,aAAW;AAC1B,YAAM,eAAe,QAAQ,YAAY;AACzC,YAAM,QAAQ,IAAI,OAAO,MAAM,YAAY,OAAO,IAAI;AACtD,YAAM,WAAW,aAAa,MAAM,KAAK,KAAK,CAAC,GAAG;AAElD,UAAI,UAAU,GAAG;AACf;AAEA,cAAM,KAAK,UAAU;AACrB,cAAM,QAAQ,QAAQ,SAAS,IAAI,MAAM;AACzC,iBAAS,KAAK;AAAA,MAChB;AAAA,IACF,CAAC;AAGD,UAAM,gBAAgB,kBAAkB,SAAS;AACjD,WAAO,KAAK,KAAK,QAAQ,gBAAgB,OAAO,GAAG,CAAG;AAAA,EACxD;AAAA;AAAA;AAAA;AAAA,EAOQ,mBAAmB,OAAwB;AACjD,UAAM,aAAa,MAAM,YAAY;AACrC,UAAM,kBAAkB;AAAA,MACtB;AAAA,MAAQ;AAAA,MAAM;AAAA,MAAW;AAAA,MAAQ;AAAA,MACjC;AAAA,MAAM;AAAA,MAAS;AAAA,MAAM;AAAA,MAAU;AAAA,MAC/B;AAAA,MAAM;AAAA,MAAS;AAAA,MAAM;AAAA,MACrB;AAAA,MAAM;AAAA,MAAW;AAAA,MAAM;AAAA,MACvB;AAAA,MAAM;AAAA,MAAU;AAAA,MAChB;AAAA,MAAM;AAAA,MAAW;AAAA,MAAQ;AAAA,MACzB;AAAA,MAAQ;AAAA,MAAkB;AAAA,MAC1B;AAAA,MAAU;AAAA,MAAgB;AAAA,IAC5B;AAEA,WAAO,gBAAgB,KAAK,aAAW,WAAW,SAAS,OAAO,CAAC;AAAA,EACrE;AAAA;AAAA;AAAA;AAAA,EAKQ,8BAA8B,SAAiB,OAAwB;AAC7E,UAAM,WAAW,GAAG,OAAO,IAAI,KAAK,GAAG,YAAY;AAGnD,UAAM,sBAAsB;AAAA,MAC1B;AAAA,MAAS;AAAA,MAAmB;AAAA,MAAc;AAAA,MAC1C;AAAA,MAAQ;AAAA,MAAQ;AAAA,MAAS;AAAA,MAAW;AAAA,MACpC;AAAA,MAAkB;AAAA,MAAkB;AAAA,MACpC;AAAA;AAAA,MACA;AAAA,MAAU;AAAA,MAAa;AAAA,MAAQ;AAAA,IACjC;AAGA,UAAM,4BAA4B;AAAA,MAChC;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAEA,UAAM,uBAAuB,oBAAoB;AAAA,MAAK,aACpD,SAAS,SAAS,QAAQ,YAAY,CAAC;AAAA,IACzC;AAEA,UAAM,uBAAuB,0BAA0B;AAAA,MAAK,aAC1D,QAAQ,KAAK,QAAQ;AAAA,IACvB;AAEA,WAAO,wBAAwB;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKQ,wBAAwB,SAAiB,OAAwB;AACvE,UAAM,WAAW,GAAG,OAAO,IAAI,KAAK,GAAG,YAAY;AAGnD,UAAM,uBAAuB;AAAA,MAC3B;AAAA;AAAA,MACA;AAAA;AAAA,MACA;AAAA;AAAA,MACA;AAAA;AAAA,MACA;AAAA,MAAQ;AAAA;AAAA,MACR;AAAA,MAAU;AAAA;AAAA,MACV;AAAA,MAAQ;AAAA;AAAA,IACV;AAEA,UAAM,kBAAkB,qBAAqB;AAAA,MAAK,aAChD,SAAS,SAAS,QAAQ,YAAY,CAAC;AAAA,IACzC;AAGA,UAAM,gBACJ,SAAS,SAAS,MAAM,KACxB,SAAS,SAAS,sCAAQ,KAC1B,SAAS,SAAS,WAAW;AAG/B,WAAO,mBAAmB;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAqB;AAE3B,QAAI,KAAK,gBAAgB;AACvB,YAAM,MAAM,IAAI,IAAI,KAAK,eAAe,GAAG;AAC3C,aAAO,IAAI;AAAA,IACb;AAGA,QAAI,OAAO,eAAe,eAAe,WAAW,UAAU;AAC5D,aAAO,WAAW,SAAS;AAAA,IAC7B;AAGA,QAAI,OAAO,eAAe,eAAe,WAAW,SAAS;AAC3D,YAAM,UAAU,WAAW;AAC3B,YAAM,MAAM,IAAI,IAAI,QAAQ,GAAG;AAC/B,aAAO,IAAI;AAAA,IACb;AAGA,QAAI,OAAO,YAAY,eAAe,OAAwC;AAC5E,aAAO;AAAA,IACT;AAGA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,uBAAuB,SAAgB,OAAwB;AACrE,QAAI,CAAC,WAAW,QAAQ,WAAW,EAAG,QAAO;AAE7C,UAAM,gBAAgB,KAAK,gBAAgB,MAAM,YAAY,CAAC;AAC9D,QAAI,cAAc,WAAW,EAAG,QAAO;AAGvC,QAAI,kBAAkB;AAEtB,YAAQ,QAAQ,CAAAA,WAAS;AACvB,YAAM,WAAWA,OAAM,WAAW,IAAI,YAAY;AAClD,YAAM,SAASA,OAAM,SAAS,IAAI,YAAY;AAG9C,YAAM,iBAAiB,cAAc;AAAA,QAAO,aAC1C,QAAQ,SAAS,OAAO,KAAK,MAAM,SAAS,OAAO;AAAA,MACrD,EAAE;AAEF,YAAM,YAAY,iBAAiB,cAAc;AAGjD,UAAI,aAAa,QAAQA,OAAM,WAAW,IAAI,UAAU,IAAI;AAC1D;AAAA,MACF;AAAA,IACF,CAAC;AAGD,UAAM,gBAAgB,kBAAkB,QAAQ;AAChD,UAAM,gBAAgB,iBAAiB;AAEvC,QAAI,CAAC,eAAe;AAClB,cAAQ,IAAI,kEAAgB,eAAe,IAAI,QAAQ,MAAM,oCAAW,gBAAgB,KAAK,QAAQ,CAAC,CAAC,GAAG;AAAA,IAC5G;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAmB,OAAe;AACxC,WAAO;AAAA,MACL,SAAS,CAAC;AAAA,MACV,SAAS,CAAC,0BAAM;AAAA,MAChB,YAAY;AAAA,MACZ,YAAY;AAAA,MACZ,aAAa;AAAA,MACb,WAAW;AAAA,MACX,cAAc;AAAA,MACd,OAAO;AAAA,MACP,SAAS;AAAA,MACT,kBAAkB;AAAA,QAChB,wBAAwB;AAAA,QACxB,sBAAsB;AAAA,QACtB,iBAAiB;AAAA,MACnB;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAiB,OAAe,cAAsB;AAC5D,WAAO;AAAA,MACL,SAAS,CAAC;AAAA,MACV,SAAS,CAAC,0BAAM;AAAA,MAChB,YAAY;AAAA,MACZ,YAAY;AAAA,MACZ,aAAa;AAAA,MACb,WAAW;AAAA,MACX,cAAc;AAAA,MACd,OAAO;AAAA,MACP,SAAS,+DAAa,YAAY;AAAA,MAClC,kBAAkB;AAAA,QAChB,wBAAwB;AAAA,QACxB,sBAAsB;AAAA,QACtB,iBAAiB;AAAA,QACjB,cAAc;AAAA,MAChB;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAmB,OAAwB;AACjD,UAAM,kBAAkB,CAAC,gBAAM,gBAAM,gBAAM,gBAAM,gBAAM,WAAW,SAAS,OAAO;AAClF,UAAM,aAAa,MAAM,YAAY;AACrC,WAAO,gBAAgB,KAAK,aAAW,WAAW,SAAS,OAAO,CAAC;AAAA,EACrE;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,mBAAmB,MAAc;AAC7C,QAAI,CAAC,KAAK,cAAc;AACtB,YAAM,IAAI,MAAM,8BAA8B;AAAA,IAChD;AAEA,QAAI;AACF,YAAM,WAAW,MAAM,MAAM,wCAAwC;AAAA,QACnE,QAAQ;AAAA,QACR,SAAS;AAAA,UACP,iBAAiB,UAAU,KAAK,YAAY;AAAA,UAC5C,gBAAgB;AAAA,QAClB;AAAA,QACA,MAAM,KAAK,UAAU;AAAA,UACnB,OAAO;AAAA,UACP,OAAO;AAAA,QACT,CAAC;AAAA,MACH,CAAC;AAED,UAAI,CAAC,SAAS,IAAI;AAChB,cAAM,IAAI,MAAM,qBAAqB,SAAS,MAAM,EAAE;AAAA,MACxD;AAEA,YAAM,OAAO,MAAM,SAAS,KAAK;AACjC,aAAO,KAAK,KAAK,CAAC,EAAE;AAAA,IACtB,SAAS,OAAO;AACd,cAAQ,MAAM,4BAA4B,KAAK;AAC/C,YAAM;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,uBAAuB,MAAc;AACjD,QAAI,CAAC,KAAK,IAAI;AACZ,YAAM,IAAI,MAAM,6BAA6B;AAAA,IAC/C;AAEA,QAAI;AACF,YAAM,WAAW,MAAM,KAAK,GAAG,IAAI,6BAA6B;AAAA,QAC9D;AAAA,MACF,CAAC;AACD,aAAO,SAAS,KAAK,CAAC;AAAA,IACxB,SAAS,OAAO;AACd,cAAQ,MAAM,mCAAmC,KAAK;AACtD,YAAM;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,sBAAsB,SAAiB,UAA4B;AACzE,QAAI,CAAC,WAAW,SAAS,WAAW,EAAG,QAAO;AAE9C,UAAM,eAAe,QAAQ,YAAY;AACzC,QAAI,QAAQ;AACZ,QAAI,UAAU;AAEd,aAAS,QAAQ,aAAW;AAC1B,YAAM,eAAe,QAAQ,YAAY;AACzC,UAAI,aAAa,SAAS,YAAY,GAAG;AACvC;AAEA,iBAAS,QAAQ,SAAS,IAAI,IAAI;AAAA,MACpC;AAAA,IACF,CAAC;AAGD,WAAO,KAAK,IAAK,QAAQ,SAAS,UAAW,UAAU,SAAS,SAAS,CAAG;AAAA,EAC9E;AAAA;AAAA;AAAA;AAAA,EAKQ,0BAA0B;AAChC,WAAO;AAAA,MACL;AAAA,QACE,IAAI;AAAA,QACJ,OAAO;AAAA,QACP,SAAS;AAAA,QACT,QAAQ;AAAA,QACR,MAAM;AAAA,QACN,UAAU,CAAC,QAAQ,MAAM,gBAAM,sCAAQ;AAAA,MACzC;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,OAAO;AAAA,QACP,SAAS;AAAA,QACT,QAAQ;AAAA,QACR,MAAM;AAAA,QACN,UAAU,CAAC,gBAAM,gBAAM,SAAS;AAAA,MAClC;AAAA,IACF;AAAA,EACF;AACF;AAKO,SAAS,wBAAwB,WAAgB,IAAS,cAAuB,aAAmB,iBAAuB,gBAA0B;AAC1J,SAAO,IAAI,iBAAiB,WAAW,IAAI,cAAc,aAAa,iBAAiB,cAAc;AACvG;AAFgB;;;ACx5BhB,IAAM,qBAAqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAoB3B,SAAS,qBAAqB,OAAe,YAA0B;AACrE,QAAM,aAAa,MAAM,YAAY;AAGrC,QAAM,iBAAiB,CAAC,4BAAQ,gBAAM,UAAU,gBAAM,sBAAO,0BAAM;AACnE,QAAM,kBAAkB,eAAe,KAAK,aAAW,WAAW,SAAS,OAAO,CAAC;AAGnF,QAAM,eAAe,CAAC,gBAAM,gBAAM,gBAAM,gBAAM,gBAAM,gBAAM,gBAAM,gBAAM,cAAI;AAC1E,QAAM,gBAAgB,aAAa,KAAK,aAAW,WAAW,SAAS,OAAO,CAAC;AAG/E,QAAM,mBAAmB,CAAC,gBAAM,gBAAM,gBAAM,gBAAM,gBAAM,gBAAM,0BAAM;AACpE,QAAM,oBAAoB,iBAAiB,KAAK,aAAW,WAAW,SAAS,OAAO,CAAC;AAGvF,QAAM,kBAAkB,WAAW,QAAQ,KAAK,OAAK,EAAE,WAAW,gBAAgB,EAAE,WAAW,YAAY;AAG3G,SAAO,mBAAmB,iBAAiB,qBAAqB;AAClE;AApBS;AAyBT,SAAS,kBAAkB,OAAwB;AACjD,QAAM,aAAa,MAAM,YAAY;AAErC,QAAM,mBAAmB;AAAA;AAAA,IAEvB;AAAA,IAAQ;AAAA,IAAM;AAAA,IAAQ;AAAA,IAAM;AAAA;AAAA,IAE5B;AAAA,IAAM;AAAA,IAAM;AAAA,IAAM;AAAA,IAAM;AAAA;AAAA,IAExB;AAAA,IAAM;AAAA,IAAM;AAAA,IAAM;AAAA,IAAM;AAAA,EAC1B;AAEA,SAAO,iBAAiB,KAAK,aAAW,WAAW,SAAS,OAAO,CAAC;AACtE;AAbS;AAkBT,SAAS,uBAAuB,YAAoB,YAAyB;AAC3E,MAAI,CAAC,WAAW,WAAW,WAAW,QAAQ,WAAW,GAAG;AAC1D,WAAO;AAAA,EACT;AAEA,QAAM,iBAAiB,WAAW,QAC/B,IAAI,CAACC,QAAY,UAAkB;AAClC,UAAM,QAAQA,OAAM,SAAS;AAC7B,UAAM,UAAUA,OAAM,WAAWA,OAAM,UAAU,WAAW;AAC5D,WAAQ,QAAQ,IAAK,SAAS,QAAQ,UAAU;AAAA,EAClD,CAAC,EACA,KAAK,MAAM;AAEd,QAAM,iBAAiB,aAAa,sDAElC,iBAAiB;AAGnB,SAAO;AACT;AAnBS;AAqBT,eAAsB,cAAc,SAAiC;AACnE,MAAI;AACF,UAAM,EAAE,SAAS,IAAI,IAAI;AACzB,UAAM,OAAY,MAAM,QAAQ,KAAK;AACrC,UAAM,EAAE,SAAS,IAAI;AAGrB,UAAM,YAAY,QAAQ,QAAQ,IAAI,cAAc,KACnC,QAAQ,QAAQ,IAAI,QAAQ,KAC5B,QAAQ,KAAK,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC,CAAC;AAG9E,UAAM,YAAY,SAAS,SAAS,SAAS,CAAC,GAAG,WAAW;AAG5D,UAAM,aAAa,IAAI,YAAY,EAAE,OAAO,SAAS;AACrD,UAAM,WAAW,OAAO,KAAK,OAAO,aAAa,GAAG,UAAU,CAAC,EAAE,UAAU,GAAG,EAAE,CAAC;AACjF,QAAI;AAEJ,QAAI,IAAI,YAAY;AAClB,UAAI;AACF,cAAM,YAAY,MAAM,IAAI,WAAW,IAAI,QAAQ;AACnD,YAAI,WAAW;AACb,uBAAa,KAAK,MAAM,SAAS;AACjC,kBAAQ,IAAI,yDAAe;AAAA,QAC7B;AAAA,MACF,SAAS,YAAY;AACnB,gBAAQ,IAAI,yDAAiB,WAAW,OAAO;AAAA,MACjD;AAAA,IACF;AAGA,UAAM,aAAa;AAAA,MACjB,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ;AAAA,MACA;AAAA,IACF;AAGA,QAAI,CAAC,YAAY;AACf,cAAQ,IAAI,kEAAmB;AAC/B,mBAAa,MAAM,WAAW,sBAAsB,WAAW;AAAA,QAC7D,MAAM;AAAA,QACN,WAAW;AAAA,QACX,qBAAqB;AAAA,MACvB,CAAC;AAGD,UAAI,IAAI,cAAc,WAAW,QAAQ,SAAS,GAAG;AACnD,YAAI;AACF,gBAAM,IAAI,WAAW,IAAI,UAAU,KAAK,UAAU,UAAU,GAAG;AAAA,YAC7D,eAAe,KAAK,KAAK;AAAA;AAAA,UAC3B,CAAC;AACD,kBAAQ,IAAI,6CAAa;AAAA,QAC3B,SAAS,YAAY;AACnB,kBAAQ,IAAI,yDAAiB,WAAW,OAAO;AAAA,QACjD;AAAA,MACF;AAAA,IACF;AAGA,UAAM,uBAAuB;AAAA,MAC3B;AAAA,MACA;AAAA,IACF;AAGA,UAAM,6BAA6B;AAAA,MACjC,EAAE,MAAM,UAAU,SAAS,qBAAqB;AAAA,MAChD,GAAG;AAAA,IACL;AAEA,YAAQ,IAAI,2DAAiB,WAAW,QAAQ,SAAS,kCAAS;AAGlE,UAAM,kBAAkB,IAAI,QAAQ;AAAA,MAClC,gBAAgB;AAAA,MAChB,iBAAiB;AAAA,MACjB,cAAc;AAAA,MACd,+BAA+B;AAAA,MAC/B,gCAAgC;AAAA,MAChC,gCAAgC;AAAA,MAChC,qBAAqB;AAAA,IACvB,CAAC;AAGD,UAAM,gBAAgB;AAAA,MACpB;AAAA;AAAA,MACA;AAAA;AAAA,MACA;AAAA;AAAA,MACA;AAAA;AAAA,MACA;AAAA;AAAA,MACA;AAAA;AAAA,IACF;AAGA,QAAI,gBAAgB;AAGpB,UAAM,QAAQ,UAAU,YAAY;AAGpC,UAAM,oBAAoB,MAAM,SAAS,cAAI,KAAK,MAAM,SAAS,SAAS,KACjD,MAAM,SAAS,cAAI,KAAK,MAAM,SAAS,cAAI,KAC3C,MAAM,SAAS,KAAK,KAAK,MAAM,SAAS,oBAAK,KAC7C,MAAM,SAAS,0BAAM,KAAK,MAAM,SAAS,cAAI,KAC7C,MAAM,SAAS,cAAI,KAAK,MAAM,SAAS,oBAAK,KAC5C,MAAM,SAAS,0BAAM,KAAK,MAAM,SAAS,cAAI;AAGtE,UAAM,cAAc,MAAM,SAAS,cAAI,KAAK,MAAM,SAAS,cAAI,KAC3C,MAAM,SAAS,cAAI,KAAK,MAAM,SAAS,cAAI,KAC3C,MAAM,SAAS,QAAG,KAAK,MAAM,SAAS,QAAG,KAAK,MAAM,SAAS,GAAG,KAChE,MAAM,SAAS,oBAAK,KAAK,MAAM,SAAS,KAAK,KAC7C,MAAM,SAAS,cAAI,KAAK,MAAM,SAAS,cAAI,KAC3C,MAAM,SAAS,cAAI,KAAK,MAAM,SAAS,cAAI;AAG/D,UAAM,iBAAiB,MAAM,SAAS,cAAI,KAAK,MAAM,SAAS,gBAAM,KAC9C,MAAM,SAAS,cAAI,KAAK,MAAM,SAAS,cAAI,KAC3C,MAAM,SAAS,cAAI,KAAK,MAAM,SAAS,KAAK;AAGlE,UAAM,kBAAkB,MAAM,SAAS,cAAI,KAAK,MAAM,SAAS,cAAI,KAC5C,MAAM,SAAS,cAAI,KAAK,MAAM,SAAS,cAAI,KAC3C,MAAM,SAAS,cAAI,KAAK,MAAM,SAAS,cAAI;AAGlE,UAAM,gBAAgB,MAAM,SAAS,MAAM,CAAC,qBAAqB,CAAC;AAGlE,QAAI,aAAa;AAEf,sBAAgB;AAChB,cAAQ,IAAI,+JAAqC;AAAA,IACnD,WAAW,eAAe;AAExB,sBAAgB;AAChB,cAAQ,IAAI,6IAAkC;AAAA,IAChD,WAAW,gBAAgB;AAEzB,sBAAgB;AAChB,cAAQ,IAAI,kJAAkC;AAAA,IAChD,WAAW,qBAAqB,iBAAiB;AAE/C,sBAAgB;AAChB,cAAQ,IAAI,iIAAgC;AAAA,IAC9C,OAAO;AAEL,sBAAgB;AAChB,cAAQ,IAAI,mJAAmC;AAAA,IACjD;AAGA,QAAI;AACJ,eAAW,SAAS,CAAC,eAAe,GAAG,cAAc,OAAO,OAAK,MAAM,aAAa,CAAC,GAAG;AACtF,UAAI;AACF,gBAAQ,IAAI,yCAAc,QAAQ,uCAAmB;AAErD,gBAAQ,IAAI,yDAAe;AAE3B,gBAAQ,IAAI,wDAAmB;AAG/B,mBAAW,MAAM,IAAI,GAAG,IAAI,OAAO;AAAA,UACjC,UAAU;AAAA,UACV,QAAQ;AAAA,UACR,YAAY;AAAA,UACZ,aAAa;AAAA;AAAA,UACb,OAAO;AAAA;AAAA,QACT,CAAC;AAED,gBAAQ,IAAI,gFAAoB,KAAK;AAErC,gBAAQ,IAAI,kDAAe,KAAK;AAChC;AAAA,MAEF,SAAS,OAAO;AACd,gBAAQ,IAAI,yBAAU,QAAQ,oBAAU,MAAM,OAAO;AACrD;AAAA,MACF;AAAA,IACF;AAEA,QAAI,CAAC,UAAU;AACb,YAAM,IAAI,MAAM,oDAAY;AAAA,IAC9B;AAGA,QAAI,IAAI,eAAe;AACrB,UAAI;AACF,cAAM,cAAc;AAAA,UAClB,OAAO;AAAA,UACP,WAAW,KAAK,IAAI;AAAA,UACpB,YAAY,WAAW,QAAQ;AAAA,QACjC;AACA,cAAM,IAAI,cAAc,IAAI,WAAW,SAAS,IAAI,KAAK,UAAU,WAAW,GAAG;AAAA,UAC/E,eAAe,IAAI,KAAK;AAAA;AAAA,QAC1B,CAAC;AAAA,MACH,SAAS,cAAc;AACrB,gBAAQ,IAAI,sDAAc,aAAa,OAAO;AAAA,MAChD;AAAA,IACF;AAGA,UAAM,aAAa,qBAAqB,WAAW,UAAU;AAG7D,UAAM,EAAE,UAAU,SAAS,IAAI,IAAI,gBAAgB;AACnD,UAAM,SAAS,SAAS,UAAU;AAClC,UAAM,SAAS,SAAS,UAAU;AAClC,UAAM,UAAU,IAAI,YAAY;AAChC,UAAM,UAAU,IAAI,YAAY;AAGhC,KAAC,YAAY;AACX,UAAI;AACF,YAAI,mBAAmB;AAEvB,eAAO,CAAC,kBAAkB;AACxB,gBAAM,EAAE,MAAM,MAAM,IAAI,MAAM,OAAO,KAAK;AAE1C,cAAI,MAAM;AAER,gBAAI,WAAW,QAAQ,SAAS,KAAK,YAAY;AAC/C,oBAAM,kBAAkB,WAAW,QAAQ,KAAK,OAAK,EAAE,WAAW,gBAAgB,EAAE,WAAW,YAAY;AAC3G,oBAAM,aAAa,kBAAkB,SAAS;AAE9C,kBAAI,aAAa;AAGjB,kBAAI,iBAAiB;AACnB,8BAAc;AAAA,cAChB,OAAO;AACL,8BAAc;AAAA,cAChB;AAGA,4BAAc;AAAA;AAGd,kBAAI,YAAY;AACd,8BAAc;AACd,8BAAc;AAAA,cAChB;AAGA,oBAAM,eAAe,KAAK,UAAU;AAAA,gBAClC,UAAU;AAAA,cACZ,CAAC;AACD,oBAAM,OAAO,MAAM,QAAQ,OAAO,WAAW,eAAe,MAAM,CAAC;AAAA,YACrE;AAEA,kBAAM,OAAO,MAAM,QAAQ,OAAO,kBAAkB,CAAC;AACrD,+BAAmB;AAAA,UACrB,OAAO;AAEL,kBAAM,QAAQ,QAAQ,OAAO,KAAK;AAClC,kBAAM,QAAQ,MAAM,MAAM,IAAI;AAE9B,uBAAW,QAAQ,OAAO;AACxB,kBAAI,KAAK,WAAW,QAAQ,KAAK,CAAC,KAAK,SAAS,QAAQ,GAAG;AACzD,oBAAI;AACF,wBAAM,OAAO,KAAK,MAAM,KAAK,MAAM,CAAC,CAAC;AACrC,sBAAI,KAAK,UAAU;AAEjB,0BAAM,UAAU,KAAK;AACrB,0BAAM,aAAa,KAAK,KAAK,OAAO;AACpC,wBAAI,YAAY;AACd,4BAAM,UAAU,QAAQ,MAAM,MAAM,KAAK,CAAC;AAC1C,8BAAQ,IAAI,iEAAkB,OAAO;AACrC,8BAAQ,IAAI,mDAAc,QAAQ,KAAK,IAAI,CAAC;AAAA,oBAC9C,WAAW,WAAW,QAAQ,SAAS,GAAG;AACxC,8BAAQ,IAAI,kFAAsB,QAAQ,SAAS,MAAM,QAAQ,UAAU,GAAG,EAAE,IAAI,KAAK;AAAA,oBAC3F;AAGA,0BAAM,iBAAiB,KAAK,UAAU;AAAA,sBACpC,UAAU;AAAA,oBACZ,CAAC;AACD,0BAAM,OAAO,MAAM,QAAQ,OAAO,WAAW,iBAAiB,MAAM,CAAC;AAAA,kBACvE;AAAA,gBACF,SAAS,GAAG;AAEV,wBAAM,OAAO,MAAM,KAAK;AAAA,gBAC1B;AAAA,cACF,WAAW,KAAK,SAAS,QAAQ,GAAG;AAElC;AAAA,cACF,WAAW,KAAK,KAAK,GAAG;AACtB,sBAAM,OAAO,MAAM,QAAQ,OAAO,OAAO,IAAI,CAAC;AAAA,cAChD;AAAA,YACF;AAAA,UACF;AAAA,QACF;AAAA,MACF,SAAS,OAAO;AACd,gBAAQ,MAAM,mCAAU,KAAK;AAAA,MAC/B,UAAE;AACA,cAAM,OAAO,MAAM;AAAA,MACrB;AAAA,IACF,GAAG;AAEH,WAAO,IAAI,SAAS,UAAU;AAAA,MAC5B,SAAS;AAAA,IACX,CAAC;AAAA,EAEH,SAAS,OAAO;AACd,YAAQ,MAAM,4BAA4B,KAAK;AAG/C,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,OAAO;AAAA,MACP,SAAS;AAAA,MACT,UAAU;AAAA,IACZ,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,+BAA+B;AAAA,MACjC;AAAA,IACF,CAAC;AAAA,EACH;AACF;AApUsB;AAsUtB,eAAsB,mBAAsC;AAC1D,SAAO,IAAI,SAAS,MAAM;AAAA,IACxB,SAAS;AAAA,MACP,+BAA+B;AAAA,MAC/B,gCAAgC;AAAA,MAChC,gCAAgC;AAAA,IAClC;AAAA,EACF,CAAC;AACH;AARsB;;;ACnYf,IAAM,2BAAN,MAA+B;AAAA,EA/BtC,OA+BsC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAKpC,sBAAsB,MAA2B,SAAkC;AACjF,UAAM,WAAW,CAAC;AAGlB,aAAS,KAAK,KAAK,uBAAuB,MAAM,OAAO,CAAC;AAGxD,aAAS,KAAK,KAAK,sBAAsB,IAAI,CAAC;AAG9C,aAAS,KAAK,KAAK,oBAAoB,IAAI,CAAC;AAG5C,aAAS,KAAK,KAAK,qBAAqB,IAAI,CAAC;AAG7C,aAAS,KAAK,KAAK,wBAAwB,MAAM,OAAO,CAAC;AAGzD,aAAS,KAAK,KAAK,8BAA8B,IAAI,CAAC;AAGtD,aAAS,KAAK,KAAK,2BAA2B,IAAI,CAAC;AAGnD,aAAS,KAAK,KAAK,kBAAkB,OAAO,CAAC;AAE7C,WAAO,SAAS,OAAO,aAAW,OAAO,EAAE,KAAK,MAAM;AAAA,EACxD;AAAA;AAAA;AAAA;AAAA,EAKQ,uBAAuB,MAA2B,SAAkC;AAC1F,WAAO;AAAA;AAAA,IAEP,KAAK,WAAW,YAAO,KAAK,gBAAgB,iCAAQ,KAAK,aAAa,WAAM,cAAI,GAAG,KAAK,iBAAiB,IAAI,eAAK,KAAK,eAAe,2BAAO,KAAK,YAAY,WAAM,EAAE;AAAA;AAAA,8CAE5J,KAAK,oBAAoB,IAAI,CAAC;AAAA;AAAA,8CAE9B,KAAK,gBAAgB,oBAAK,GAAG,KAAK,eAAe,8BAAU,KAAK,YAAY,KAAK,EAAE,GAAG,KAAK,YAAY,kBAAQ,KAAK,SAAS,KAAK,EAAE;AAAA;AAAA,8CAEpI,KAAK,yBAAyB,MAAM,OAAO,CAAC;AAAA,EACxD;AAAA;AAAA;AAAA;AAAA,EAKQ,sBAAsB,MAAmC;AAC/D,UAAM,WAAW,CAAC,uCAAY;AAE9B,QAAI,KAAK,YAAY,KAAK,SAAS,SAAS,GAAG;AAC7C,eAAS,KAAK,qCAAY,KAAK,SAAS,KAAK,QAAG,CAAC,EAAE;AAAA,IACrD;AAEA,QAAI,KAAK,UAAU;AACjB,eAAS,KAAK,qCAAY,KAAK,QAAQ,EAAE;AAAA,IAC3C;AAEA,QAAI,KAAK,cAAc;AACrB,eAAS,KAAK,qCAAY,KAAK,YAAY,QAAG;AAAA,IAChD;AAEA,aAAS,KAAK,qCAAY,KAAK,iBAAiB,gBAAM,EAAE;AAExD,WAAO,SAAS,KAAK,IAAI;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA,EAKQ,oBAAoB,MAAmC;AAC7D,UAAM,WAAW,CAAC,mDAAc;AAEhC,QAAI,KAAK,eAAe;AACtB,eAAS,KAAK,qCAAY,KAAK,aAAa,EAAE;AAAA,IAChD;AAGA,UAAM,gBAAgB,KAAK,8BAA8B,IAAI;AAC7D,QAAI,eAAe;AACjB,eAAS,KAAK,aAAa;AAAA,IAC7B;AAEA,WAAO,SAAS,KAAK,MAAM;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAAqB,MAAmC;AAC9D,UAAM,WAAW,CAAC,yDAAe;AAGjC,QAAI,KAAK,eAAe;AACtB,eAAS,KAAK,qCAAY,KAAK,aAAa,cAAI;AAAA,IAClD;AAGA,QAAI,KAAK,eAAe,KAAK,YAAY,SAAS,GAAG;AACnD,eAAS,KAAK,iDAAc,KAAK,YAAY,KAAK,QAAG,CAAC,EAAE;AAAA,IAC1D;AAGA,UAAM,gBAAgB,KAAK,sBAAsB,IAAI;AACrD,QAAI,eAAe;AACjB,eAAS,KAAK,qCAAY,aAAa,EAAE;AAAA,IAC3C;AAEA,WAAO,SAAS,KAAK,MAAM;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKQ,wBAAwB,MAA2B,SAAkC;AAC3F,UAAM,WAAW,CAAC,yDAAe;AAGjC,QAAI,KAAK,gBAAgB,KAAK,cAAc;AAC1C,YAAM,cAAc,CAAC;AACrB,UAAI,KAAK,aAAc,aAAY,KAAK,iCAAQ,KAAK,YAAY,EAAE;AACnE,UAAI,KAAK,aAAc,aAAY,KAAK,iCAAQ,KAAK,YAAY,EAAE;AACnE,UAAI,KAAK,UAAW,aAAY,KAAK,iCAAQ,KAAK,SAAS,EAAE;AAE7D,eAAS,KAAK,qCAAY,YAAY,KAAK,KAAK,CAAC,EAAE;AAAA,IACrD;AAGA,QAAI,KAAK,aAAa,KAAK,UAAU,SAAS,GAAG;AAC/C,eAAS,KAAK,+BAAW,KAAK,UAAU,KAAK,QAAG,CAAC,EAAE;AAAA,IACrD;AAGA,QAAI,KAAK,cAAc,OAAO,KAAK,KAAK,UAAU,EAAE,SAAS,GAAG;AAC9D,YAAM,UAAU,OAAO,QAAQ,KAAK,UAAU,EAC3C,IAAI,CAAC,CAAC,KAAK,KAAK,MAAM,GAAG,GAAG,SAAI,KAAK,EAAE,EACvC,KAAK,KAAK;AACb,eAAS,KAAK,qCAAY,OAAO,EAAE;AAAA,IACrC;AAGA,QAAI,QAAQ,oBAAoB,QAAQ,iBAAiB,SAAS,GAAG;AACnE,eAAS,KAAK,0GAAwB;AAAA,IACxC;AAEA,WAAO,SAAS,KAAK,MAAM;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKQ,8BAA8B,MAAmC;AACvE,UAAM,WAAW,CAAC,4DAAe;AAGjC,QAAI,KAAK,iBAAiB,KAAK,cAAc,SAAS,GAAG;AACvD,eAAS,KAAK;AAAA,EAAiB,KAAK,cAAc,IAAI,SAAO,UAAK,GAAG,EAAE,EAAE,KAAK,IAAI,CAAC,EAAE;AAAA,IACvF,OAAO;AAEL,YAAM,uBAAuB,KAAK,6BAA6B,IAAI;AACnE,UAAI,qBAAqB,SAAS,GAAG;AACnC,iBAAS,KAAK;AAAA,EAAiB,qBAAqB,IAAI,SAAO,UAAK,GAAG,EAAE,EAAE,KAAK,IAAI,CAAC,EAAE;AAAA,MACzF;AAAA,IACF;AAGA,QAAI,KAAK,SAAS,KAAK,MAAM,SAAS,GAAG;AACvC,eAAS,KAAK;AAAA,EAAiB,KAAK,MAAM,IAAI,UAAQ,UAAK,IAAI,EAAE,EAAE,KAAK,IAAI,CAAC,EAAE;AAAA,IACjF,OAAO;AAEL,YAAM,eAAe,KAAK,qBAAqB,IAAI;AACnD,UAAI,aAAa,SAAS,GAAG;AAC3B,iBAAS,KAAK;AAAA,EAAiB,aAAa,IAAI,UAAQ,UAAK,IAAI,EAAE,EAAE,KAAK,IAAI,CAAC,EAAE;AAAA,MACnF;AAAA,IACF;AAEA,WAAO,SAAS,KAAK,MAAM;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKQ,2BAA2B,MAAmC;AACpE,UAAM,aAAa,KAAK,6BAA6B,IAAI;AAEzD,QAAI,WAAW,WAAW,EAAG,QAAO;AAEpC,WAAO;AAAA;AAAA,EAET,WAAW,IAAI,CAAC,WAAW,UAAU,KAAK,QAAQ,CAAC,OAAO,SAAS,EAAE,EAAE,KAAK,MAAM,CAAC;AAAA,EACnF;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkB,SAAkC;AAC1D,UAAM,UAAU,CAAC;AAEjB,QAAI,QAAQ,WAAW,SAAS,GAAG;AACjC,YAAM,aAAa,QAAQ,WAAW,OAAO,CAAAC,WAASA,OAAM,WAAW,YAAY,EAAE;AACrF,UAAI,aAAa,GAAG;AAClB,gBAAQ,KAAK,2BAAY,UAAU,qBAAM;AAAA,MAC3C;AAAA,IACF;AAEA,QAAI,QAAQ,oBAAoB,QAAQ,iBAAiB,SAAS,GAAG;AACnE,cAAQ,KAAK,yCAAW,QAAQ,iBAAiB,MAAM,qBAAM;AAAA,IAC/D;AAEA,UAAM,SAAQ,oBAAI,KAAK,GAAE,mBAAmB,OAAO;AAEnD,WAAO;AAAA;AAAA,8CAEG,QAAQ,KAAK,KAAK,CAAC;AAAA,qDACjB,QAAQ,aAAa,KAAK,QAAQ,CAAC,CAAC;AAAA,8CACtC,KAAK;AAAA;AAAA,EAEjB;AAAA;AAAA,EAIQ,oBAAoB,MAAmC;AAC7D,QAAI,KAAK,eAAe;AACtB,YAAM,aAAqC;AAAA,QACzC,8BAAU;AAAA,QACV,kBAAQ;AAAA,QACR,kBAAQ;AAAA,QACR,4BAAQ;AAAA,QACR,4BAAQ;AAAA,QACR,kBAAQ;AAAA,MACV;AACA,aAAO,WAAW,KAAK,aAAa,KAAK,GAAG,KAAK,aAAa;AAAA,IAChE;AACA,WAAO;AAAA,EACT;AAAA,EAEQ,yBAAyB,MAA2B,SAAkC;AAC5F,UAAM,QAAQ,CAAC;AAEf,QAAI,KAAK,iBAAiB,cAAc,KAAK,iBAAiB,YAAY;AACxE,YAAM,KAAK,4CAAS;AAAA,IACtB;AAEA,QAAI,KAAK,aAAa,KAAK,UAAU,SAAS,QAAG,GAAG;AAClD,YAAM,KAAK,gCAAO;AAAA,IACpB;AAEA,QAAI,QAAQ,aAAa,KAAK;AAC5B,YAAM,KAAK,0BAAM;AAAA,IACnB;AAEA,QAAI,MAAM,WAAW,GAAG;AACtB,YAAM,KAAK,wCAAU;AAAA,IACvB;AAEA,WAAO,MAAM,KAAK,QAAG;AAAA,EACvB;AAAA,EAEQ,8BAA8B,MAAmC;AACvE,QAAI,CAAC,KAAK,cAAe,QAAO;AAEhC,UAAM,WAAmC;AAAA,MACvC,8BAAU;AAAA,MACV,kBAAQ;AAAA,MACR,kBAAQ;AAAA,IACV;AAEA,WAAO,SAAS,KAAK,aAAa,KAAK;AAAA,EACzC;AAAA,EAEQ,sBAAsB,MAAmC;AAC/D,QAAI,CAAC,KAAK,cAAe,QAAO;AAEhC,UAAM,WAAmC;AAAA,MACvC,8BAAU;AAAA,MACV,kBAAQ;AAAA,MACR,kBAAQ;AAAA,MACR,4BAAQ;AAAA,IACV;AAEA,WAAO,SAAS,KAAK,aAAa,KAAK;AAAA,EACzC;AAAA,EAEQ,6BAA6B,MAAqC;AACxE,UAAM,gBAAgB,CAAC;AAEvB,QAAI,KAAK,iBAAiB,cAAc,KAAK,iBAAiB,YAAY;AACxE,oBAAc,KAAK,4FAAiB;AAAA,IACtC;AAEA,QAAI,KAAK,eAAe,SAAS,IAAI,GAAG;AACtC,oBAAc,KAAK,wFAAkB;AAAA,IACvC;AAEA,kBAAc,KAAK,kGAAkB;AAErC,WAAO;AAAA,EACT;AAAA,EAEQ,qBAAqB,MAAqC;AAChE,UAAM,QAAQ,CAAC;AAEf,UAAM,KAAK,8IAA2B;AACtC,UAAM,KAAK,8JAA4B;AAEvC,QAAI,KAAK,iBAAiB,iBAAiB,KAAK,iBAAiB,QAAQ;AACvE,YAAM,KAAK,kJAA0B;AAAA,IACvC;AAEA,WAAO;AAAA,EACT;AAAA,EAEQ,6BAA6B,MAAqC;AACxE,UAAM,aAAa,CAAC;AAEpB,QAAI,KAAK,YAAY,KAAK,SAAS,SAAS,GAAG;AAC7C,iBAAW,KAAK,iDAAc,KAAK,SAAS,KAAK,QAAG,CAAC,4CAAS;AAAA,IAChE;AAEA,QAAI,KAAK,aAAa,KAAK,UAAU,SAAS,GAAG;AAC/C,iBAAW,KAAK,6DAAgB,KAAK,UAAU,MAAM,GAAG,CAAC,EAAE,KAAK,QAAG,CAAC,4CAAS;AAAA,IAC/E;AAEA,QAAI,KAAK,eAAe;AACtB,iBAAW,KAAK,iDAAc,KAAK,aAAa,0EAAc;AAAA,IAChE;AAEA,QAAI,KAAK,aAAa,CAAC,KAAK,UAAU,SAAS,QAAG,GAAG;AACnD,iBAAW,KAAK,6DAAgB,KAAK,SAAS,4CAAS;AAAA,IACzD;AAEA,WAAO;AAAA,EACT;AACF;AAKO,SAAS,0BAA0B,aAAqB,YAAmB,YAAyC;AACzH,QAAM,OAA4B;AAAA,IAChC;AAAA,IACA,eAAc,oBAAI,KAAK,GAAE,YAAY;AAAA,EACvC;AAGA,aAAW,QAAQ,CAAAA,WAAS;AAC1B,UAAM,UAAUA,OAAM,SAAS,YAAY,KAAK;AAChD,UAAM,QAAQA,OAAM,OAAO,YAAY,KAAK;AAG5C,QAAI,QAAQ,SAAS,oBAAK,KAAK,QAAQ,SAAS,SAAS,GAAG;AAE1D,YAAM,eAAeA,OAAM,QAAQ,MAAM,sBAAsB;AAC/D,UAAI,cAAc;AAChB,aAAK,WAAW,CAAC,aAAa,CAAC,EAAE,KAAK,CAAC;AAAA,MACzC;AAAA,IACF;AAGA,QAAI,QAAQ,SAAS,cAAI,KAAK,QAAQ,SAAS,QAAG,KAAK,QAAQ,SAAS,cAAI,GAAG;AAC7E,UAAI,QAAQ,SAAS,SAAI,KAAK,QAAQ,SAAS,UAAU,GAAG;AAC1D,aAAK,eAAe;AAAA,MACtB,WAAW,QAAQ,SAAS,SAAI,KAAK,QAAQ,SAAS,UAAU,GAAG;AACjE,aAAK,eAAe;AAAA,MACtB,WAAW,QAAQ,SAAS,oBAAK,KAAK,QAAQ,SAAS,MAAM,GAAG;AAC9D,aAAK,eAAe;AAAA,MACtB;AAAA,IACF;AAGA,UAAM,iBAAiBA,OAAM,QAAQ,MAAM,+BAA+B;AAC1E,QAAI,gBAAgB;AAClB,WAAK,YAAY,eAAe,CAAC;AAAA,IACnC;AAGA,QAAI,QAAQ,SAAS,IAAI,KAAK,QAAQ,SAAS,0BAAM,GAAG;AACtD,WAAK,gBAAgB;AACrB,UAAI,QAAQ,SAAS,0BAAM,EAAG,MAAK,gBAAgB;AAAA,eAC1C,QAAQ,SAAS,cAAI,EAAG,MAAK,gBAAgB;AAAA,eAC7C,QAAQ,SAAS,cAAI,EAAG,MAAK,gBAAgB;AAAA,IACxD;AAAA,EACF,CAAC;AAGD,MAAI,YAAY;AACd,eAAW,QAAQ,YAAU;AAC3B,UAAI,OAAO,YAAY,OAAO,SAAS;AAErC,cAAM,iBAAiB,OAAO,QAAQ,MAAM,oDAAoD;AAChG,YAAI,gBAAgB;AAClB,gBAAM,SAAS,eAAe,CAAC;AAC/B,gBAAM,OAAO,eAAe,CAAC,EAAE,YAAY,MAAM,YAAY,6BAAS;AACtE,eAAK,YAAY,GAAG,MAAM,GAAG,IAAI;AAAA,QACnC;AAAA,MACF;AAAA,IACF,CAAC;AAAA,EACH;AAEA,SAAO;AACT;AA9DgB;AAmET,SAAS,iCAAiC;AAC/C,SAAO,IAAI,yBAAyB;AACtC;AAFgB;;;ACjbhB,IAAM,yBAAyB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAuD/B,SAAS,iBAAiB,OAIxB;AACA,QAAM,iBAAiB,MAAM,YAAY;AAGzC,MAAI,eAAe,SAAS,oBAAK,KAAK,eAAe,SAAS,SAAS,KACnE,eAAe,SAAS,MAAM,MAAM,eAAe,SAAS,QAAG,KAAK,eAAe,SAAS,KAAK,IAAI;AACvG,WAAO;AAAA,MACL,eAAe,GAAG,KAAK;AAAA,MACvB,UAAU,CAAC,WAAW,SAAS,sBAAO,QAAQ,sCAAQ;AAAA,MACtD,WAAW;AAAA,IACb;AAAA,EACF;AAGA,MAAI,eAAe,SAAS,cAAI,KAAK,eAAe,SAAS,cAAI,KAC7D,eAAe,SAAS,cAAI,KAAK,eAAe,SAAS,cAAI,GAAG;AAClE,WAAO;AAAA,MACL,eAAe,GAAG,KAAK;AAAA,MACvB,UAAU,CAAC,gBAAM,gBAAM,QAAQ,kBAAQ,cAAI;AAAA,MAC3C,WAAW;AAAA,IACb;AAAA,EACF;AAGA,MAAI,eAAe,SAAS,cAAI,KAAK,eAAe,SAAS,cAAI,KAC7D,eAAe,SAAS,cAAI,KAAK,eAAe,SAAS,0BAAM,KAC/D,eAAe,SAAS,0BAAM,KAAK,eAAe,SAAS,cAAI,KAC/D,eAAe,SAAS,cAAI,KAAK,eAAe,SAAS,cAAI,KAC7D,eAAe,SAAS,cAAI,KAAK,eAAe,SAAS,cAAI,KAC7D,eAAe,SAAS,oBAAK,KAAK,eAAe,SAAS,0BAAM,KAChE,eAAe,SAAS,0BAAM,KAAK,eAAe,SAAS,oBAAK,KAChE,eAAe,SAAS,0BAAM,KAAK,eAAe,SAAS,cAAI,GAAG;AACpE,WAAO;AAAA,MACL,eAAe,GAAG,KAAK;AAAA,MACvB,UAAU,CAAC,gBAAM,gBAAM,gBAAM,gBAAM,gBAAM,gBAAM,cAAI;AAAA,MACnD,WAAW;AAAA,IACb;AAAA,EACF;AAGA,QAAM,mBAAmB,CAAC,gBAAM,gBAAM,gBAAM,gBAAM,YAAY,UAAU;AACxE,QAAM,kBAAkB,CAAC,gBAAM,gBAAM,WAAW,QAAQ,KAAK;AAC7D,QAAM,oBAAoB,iBAAiB,KAAK,QAAM,eAAe,SAAS,EAAE,CAAC;AACjF,QAAM,oBAAoB,gBAAgB,KAAK,QAAM,eAAe,SAAS,EAAE,CAAC;AAGhF,MAAI,eAAe,SAAS,QAAQ,MAAM,qBAAqB,oBAAoB;AACjF,WAAO;AAAA,MACL,eAAe,GAAG,KAAK;AAAA,MACvB,UAAU,CAAC,UAAU,WAAW,4BAAQ,gBAAM,cAAI;AAAA,MAClD,WAAW;AAAA,IACb;AAAA,EACF;AAEA,MAAI,eAAe,SAAS,WAAW,MAAM,qBAAqB,oBAAoB;AACpF,WAAO;AAAA,MACL,eAAe,GAAG,KAAK;AAAA,MACvB,UAAU,CAAC,aAAa,UAAU,4BAAQ,gBAAM,IAAI;AAAA,MACpD,WAAW;AAAA,IACb;AAAA,EACF;AAGA,MAAI,sBAAsB,qBACtB,eAAe,SAAS,cAAI,KAAK,eAAe,SAAS,SAAS,KAClE,eAAe,SAAS,oBAAK,KAAK,eAAe,SAAS,SAAS,IAAI;AACzE,WAAO;AAAA,MACL,eAAe,GAAG,KAAK;AAAA,MACvB,UAAU,MAAM,MAAM,KAAK,EAAE,OAAO,UAAQ,KAAK,SAAS,CAAC;AAAA,MAC3D,WAAW;AAAA,IACb;AAAA,EACF;AAGA,SAAO;AAAA,IACL,eAAe;AAAA,IACf,UAAU,MAAM,MAAM,KAAK,EAAE,OAAO,UAAQ,KAAK,SAAS,CAAC;AAAA,IAC3D,WAAW;AAAA,EACb;AACF;AAnFS;AAwFT,SAAS,oBAAoB,YAAoB,YAAiB,WAAwB;AAExF,MAAI,UAAU,cAAc,qBAAqB;AAC/C,WAAO,aAAa;AAAA;AAAA,iCAAa,UAAU,aAAa;AAAA;AAAA;AAAA,EAC1D;AAGA,MAAI,UAAU,cAAc,oBAAoB;AAC9C,QAAI;AAEF,YAAM,mBAAmB,UAAU,cAAc,MAAM,2FAA2F;AAClJ,YAAM,cAAc,mBAAoB,iBAAiB,CAAC,KAAK,iBAAiB,CAAC,KAAK,iBAAiB,CAAC,IAAK;AAG7G,YAAM,mBAAmB,WAAW,SAAS,OAAO,CAACC,WAAeA,OAAM,WAAW,YAAY,KAAK,CAAC;AACvG,YAAM,uBAAuB,WAAW,SAAS,OAAO,CAACA,WAAeA,OAAM,WAAW,YAAY,KAAK,CAAC;AAG3G,YAAM,cAAc,0BAA0B,aAAa,sBAAsB,gBAAgB;AAGjG,YAAM,YAAY,+BAA+B;AAGjD,YAAM,iBAAiB,UAAU,sBAAsB,aAAa;AAAA,QAClE,YAAY,WAAW,WAAW,CAAC;AAAA,QACnC;AAAA,QACA,YAAY,WAAW,cAAc;AAAA,QACrC,WAAW,UAAU;AAAA,MACvB,CAAC;AAED,aAAO,aAAa;AAAA;AAAA,8EAAqB,WAAW;AAAA;AAAA;AAAA;AAAA,EAA6B,cAAc;AAAA;AAAA;AAAA,IAEjG,SAAS,OAAO;AACd,cAAQ,IAAI,qGAAqB,KAAK;AAAA,IAExC;AAAA,EACF;AAEA,MAAI,CAAC,WAAW,WAAW,WAAW,QAAQ,WAAW,GAAG;AAC1D,WAAO,aAAa;AAAA;AAAA,iCAAa,UAAU,aAAa;AAAA;AAAA,EAC1D;AAGA,QAAM,gBAAgB,WAAW,QAC9B,OAAO,CAAAA,WAASA,OAAM,WAAWA,OAAM,QAAQ,SAAS,EAAE,EAC1D,KAAK,CAAC,GAAG,MAAM;AAEd,UAAM,SAAS,UAAU,SAAS,OAAO,CAAC,OAAO,aAC9C,EAAE,WAAW,IAAI,YAAY,EAAE,SAAS,QAAQ,YAAY,CAAC,IAAI,QAAQ,IAAI,OAAO,CAAC;AACxF,UAAM,SAAS,UAAU,SAAS,OAAO,CAAC,OAAO,aAC9C,EAAE,WAAW,IAAI,YAAY,EAAE,SAAS,QAAQ,YAAY,CAAC,IAAI,QAAQ,IAAI,OAAO,CAAC;AAExF,QAAI,WAAW,OAAQ,QAAO,SAAS;AACvC,YAAQ,EAAE,SAAS,UAAU,MAAM,EAAE,SAAS,UAAU;AAAA,EAC1D,CAAC,EACA,MAAM,GAAG,CAAC;AAEb,QAAM,iBAAiB,cACpB,IAAI,CAACA,QAAO,UAAU;AACrB,UAAM,QAAQA,OAAM,SAAS;AAC7B,UAAM,UAAUA,OAAM,QAAQ,UAAU,GAAG,GAAG,KAAKA,OAAM,QAAQ,SAAS,MAAM,QAAQ;AACxF,WAAO,GAAG,QAAQ,CAAC,OAAO,KAAK;AAAA,EAAO,OAAO;AAAA,EAC/C,CAAC,EACA,KAAK,MAAM;AAEd,QAAM,iBAAiB,aAAa;AAAA;AAAA,wDACnB,cAAc,MAAM,qDAAa,UAAU,SAAS;AAAA,IACnE,iBAAiB;AAAA;AAAA,uCACJ,UAAU,aAAa;AAAA;AAGtC,SAAO;AACT;AAzES;AA2ET,eAAsBC,eAAc,SAAiC;AACnE,MAAI;AACF,UAAM,EAAE,SAAS,IAAI,IAAI;AACzB,UAAM,OAAY,MAAM,QAAQ,KAAK;AACrC,UAAM,EAAE,SAAS,IAAI;AAGrB,UAAM,YAAY,SAAS,SAAS,SAAS,CAAC,GAAG,WAAW;AAE5D,YAAQ,IAAI,wCAAa,SAAS,GAAG;AAGrC,UAAM,YAAY,iBAAiB,SAAS;AAC5C,YAAQ,IAAI,oDAAe,UAAU,SAAS,yBAAU,UAAU,SAAS,KAAK,IAAI,CAAC,GAAG;AAGxF,UAAM,aAAa;AAAA,MACjB,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ,IAAI;AAAA,MACJ;AAAA;AAAA,MACA;AAAA,QACE,cAAc,IAAI;AAAA,QAClB,gBAAgB,IAAI;AAAA,QACpB,iBAAiB;AAAA,MACnB;AAAA,IACF;AAGA,YAAQ,IAAI,sDAAiB;AAC7B,UAAM,aAAa,MAAM,WAAW,sBAAsB,UAAU,eAAe;AAAA,MACjF,MAAM;AAAA;AAAA,MACN,WAAW;AAAA;AAAA,MACX,qBAAqB;AAAA,MACrB,eAAe;AAAA,MACf,WAAW,UAAU;AAAA,MACrB,UAAU,UAAU;AAAA,IACtB,CAAC;AAED,YAAQ,IAAI,uCAAc,WAAW,SAAS,UAAU,CAAC,8CAAW,WAAW,aAAa,KAAK,QAAQ,CAAC,CAAC,GAAG;AAG9G,UAAM,cAAc;AAAA,MAClB;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAGA,UAAM,6BAA6B;AAAA,MACjC,EAAE,MAAM,UAAU,SAAS,YAAY;AAAA,MACvC,GAAG,SAAS,MAAM,EAAE;AAAA;AAAA,IACtB;AAGA,UAAM,kBAAkB,IAAI,QAAQ;AAAA,MAClC,gBAAgB;AAAA,MAChB,iBAAiB;AAAA,MACjB,cAAc;AAAA,MACd,+BAA+B;AAAA,MAC/B,gCAAgC;AAAA,MAChC,gCAAgC;AAAA,MAChC,qBAAqB;AAAA,IACvB,CAAC;AAGD,QAAI,gBAAgB;AAGpB,QAAI,UAAU,cAAc,kBAAkB,UAAU,cAAc,oBAAoB;AACxF,sBAAgB;AAChB,cAAQ,IAAI,wEAAyB;AAAA,IACvC,WAAW,UAAU,cAAc,gBAAgB;AACjD,sBAAgB;AAChB,cAAQ,IAAI,wEAAyB;AAAA,IACvC,OAAO;AACL,sBAAgB;AAChB,cAAQ,IAAI,uEAAwB;AAAA,IACtC;AAGA,UAAM,cAAc;AAAA,MAClB,aAAa;AAAA;AAAA,MACb,YAAY;AAAA;AAAA,MACZ,OAAO;AAAA;AAAA,MACP,QAAQ;AAAA,IACV;AAGA,UAAM,gBAAgB;AAAA,MACpB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF,EAAE,OAAO,CAAC,OAAO,OAAO,QAAQ,IAAI,QAAQ,KAAK,MAAM,KAAK;AAE5D,QAAI;AACJ,eAAW,SAAS,eAAe;AACjC,UAAI;AACF,gBAAQ,IAAI,uCAAY,KAAK,EAAE;AAE/B,YAAI,MAAM,SAAS,oBAAoB,GAAG;AAExC,gBAAM,gBAAgB,2BAA2B,KAAK,OAAK,EAAE,SAAS,QAAQ;AAC9E,gBAAM,uBAAuB,2BAA2B,OAAO,OAAK,EAAE,SAAS,QAAQ;AAEvF,qBAAW,MAAM,IAAI,GAAG,IAAI,OAAO;AAAA,YACjC,cAAc,gBAAgB,cAAc,UAAU;AAAA,YACtD,OAAO;AAAA,YACP,GAAG;AAAA,UACL,CAAC;AAAA,QACH,OAAO;AAEL,qBAAW,MAAM,IAAI,GAAG,IAAI,OAAO;AAAA,YACjC,UAAU;AAAA,YACV,GAAG;AAAA,UACL,CAAC;AAAA,QACH;AAEA,gBAAQ,IAAI,gDAAa,KAAK,EAAE;AAChC;AAAA,MAEF,SAAS,OAAO;AACd,gBAAQ,IAAI,uBAAQ,KAAK,kBAAQ,MAAM,OAAO,EAAE;AAChD,YAAI,UAAU,cAAc,cAAc,SAAS,CAAC,GAAG;AACrD,gBAAM,IAAI,MAAM,oDAAY;AAAA,QAC9B;AACA;AAAA,MACF;AAAA,IACF;AAGA,UAAM,EAAE,UAAU,SAAS,IAAI,IAAI,gBAAgB;AACnD,UAAM,SAAS,SAAS,UAAU;AAClC,UAAM,SAAS,SAAS,UAAU;AAClC,UAAM,UAAU,IAAI,YAAY;AAChC,UAAM,UAAU,IAAI,YAAY;AAGhC,KAAC,YAAY;AACX,UAAI;AACF,YAAI,mBAAmB;AACvB,YAAI,aAAa;AAEjB,eAAO,CAAC,kBAAkB;AACxB,gBAAM,EAAE,MAAM,MAAM,IAAI,MAAM,OAAO,KAAK;AAE1C,cAAI,MAAM;AAER,gBAAI,WAAW,QAAQ,SAAS,KAAK,YAAY;AAE/C,oBAAM,mBAAmB,WAAW,QAAQ,OAAO,CAAAD,WAASA,OAAM,WAAW,YAAY;AACzF,oBAAM,uBAAuB,WAAW,QAAQ,OAAO,CAAAA,WAASA,OAAM,WAAW,YAAY;AAE7F,kBAAI,aAAa;AAAA;AAAA;AAAA;AAEjB,kBAAI,iBAAiB,SAAS,GAAG;AAC/B,8BAAc,mDAAc,iBAAiB,MAAM;AACnD,oBAAI,qBAAqB,SAAS,GAAG;AACnC,gCAAc,8BAAe,qBAAqB,MAAM;AAAA,gBAC1D;AAAA,cACF,OAAO;AACL,8BAAc,2BAAY,WAAW,QAAQ,MAAM;AAAA,cACrD;AAEA,4BAAc;AAAA,0CAAkB,UAAU,SAAS;AACnD,4BAAc;AAAA,qCAAkB,WAAW,aAAa,KAAK,QAAQ,CAAC,CAAC;AAEvE,kBAAI,iBAAiB,SAAS,GAAG;AAC/B,8BAAc;AAAA;AAAA,cAChB;AAGA,oBAAM,eAAe,KAAK,UAAU;AAAA,gBAClC,UAAU;AAAA,cACZ,CAAC;AACD,oBAAM,OAAO,MAAM,QAAQ,OAAO,WAAW,eAAe,MAAM,CAAC;AAAA,YACrE;AAEA,kBAAM,OAAO,MAAM,QAAQ,OAAO,kBAAkB,CAAC;AACrD,+BAAmB;AAAA,UACrB,OAAO;AAEL,kBAAM,QAAQ,QAAQ,OAAO,KAAK;AAClC,kBAAM,QAAQ,MAAM,MAAM,IAAI;AAE9B,uBAAW,QAAQ,OAAO;AACxB,kBAAI,KAAK,WAAW,QAAQ,KAAK,CAAC,KAAK,SAAS,QAAQ,GAAG;AACzD,oBAAI;AACF,wBAAM,OAAO,KAAK,MAAM,KAAK,MAAM,CAAC,CAAC;AACrC,sBAAI,KAAK,UAAU;AACjB,0BAAM,UAAU,KAAK;AAGrB,wBAAI,WAAW,CAAC,QAAQ,MAAM,wBAAwB,GAAG;AACvD,mCAAa;AAGb,4BAAM,iBAAiB,KAAK,UAAU;AAAA,wBACpC,UAAU;AAAA,sBACZ,CAAC;AACD,4BAAM,OAAO,MAAM,QAAQ,OAAO,WAAW,iBAAiB,MAAM,CAAC;AAAA,oBACvE;AAAA,kBACF;AAAA,gBACF,SAAS,GAAG;AAEV,wBAAM,OAAO,MAAM,KAAK;AAAA,gBAC1B;AAAA,cACF,WAAW,CAAC,KAAK,SAAS,QAAQ,KAAK,KAAK,KAAK,GAAG;AAClD,sBAAM,OAAO,MAAM,QAAQ,OAAO,OAAO,IAAI,CAAC;AAAA,cAChD;AAAA,YACF;AAAA,UACF;AAAA,QACF;AAAA,MACF,SAAS,OAAO;AACd,gBAAQ,MAAM,mCAAU,KAAK;AAG7B,cAAM,eAAe,KAAK,UAAU;AAAA,UAClC,UAAU;AAAA,QACZ,CAAC;AACD,cAAM,OAAO,MAAM,QAAQ,OAAO,WAAW,eAAe,MAAM,CAAC;AACnE,cAAM,OAAO,MAAM,QAAQ,OAAO,kBAAkB,CAAC;AAAA,MACvD,UAAE;AACA,cAAM,OAAO,MAAM;AAAA,MACrB;AAAA,IACF,GAAG;AAEH,WAAO,IAAI,SAAS,UAAU,eAAe;AAAA,EAE/C,SAAS,OAAO;AACd,YAAQ,MAAM,4BAA4B,KAAK;AAG/C,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,OAAO;AAAA,MACP,SAAS;AAAA,MACT,aAAa;AAAA,QACX;AAAA,QACA;AAAA,QACA;AAAA,MACF;AAAA,IACF,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,+BAA+B;AAAA,MACjC;AAAA,IACF,CAAC;AAAA,EACH;AACF;AA3PsB,OAAAC,gBAAA;AA6PtB,eAAsBC,oBAAsC;AAC1D,SAAO,IAAI,SAAS,MAAM;AAAA,IACxB,SAAS;AAAA,MACP,+BAA+B;AAAA,MAC/B,gCAAgC;AAAA,MAChC,gCAAgC;AAAA,IAClC;AAAA,EACF,CAAC;AACH;AARsB,OAAAA,mBAAA;;;ACrctB,eAAsBC,eAAc,SAAyD;AAC3F,MAAI;AACF,UAAM,UAAU,QAAQ;AACxB,UAAM,MAAM,QAAQ;AAGpB,UAAM,OAA2B,MAAM,QAAQ,KAAK;AAEpD,YAAQ,IAAI,gEAAsB;AAAA,MAChC,WAAW,KAAK,QAAQ,cAAc,KAAK;AAAA,MAC3C,SAAS,KAAK,QAAQ;AAAA,MACtB,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,IACpC,CAAC;AAGD,QAAI,KAAK,SAAS,oBAAoB;AACpC,cAAQ,IAAI,gDAAa;AACzB,aAAO,SAAS,KAAK;AAAA,QACnB,WAAW,KAAK;AAAA,MAClB,CAAC;AAAA,IACH;AAGA,QAAI,KAAK,QAAQ,UAAU,IAAI,eAAe;AAC5C,UAAI,KAAK,OAAO,WAAW,IAAI,eAAe;AAC5C,gBAAQ,MAAM,uCAAc;AAC5B,eAAO,IAAI,SAAS,gBAAgB,EAAE,QAAQ,IAAI,CAAC;AAAA,MACrD;AAAA,IACF;AAGA,QAAI,KAAK,QAAQ,YAAY;AAC3B,YAAM,kBAAkB,MAAM,GAAG;AAAA,IACnC;AAGA,WAAO,SAAS,KAAK;AAAA,MACnB,SAAS;AAAA,MACT,SAAS;AAAA,MACT,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,IACpC,CAAC;AAAA,EAEH,SAAS,OAAO;AACd,YAAQ,MAAM,2CAAkB,KAAK;AAGrC,WAAO,SAAS,KAAK;AAAA,MACnB,SAAS;AAAA,MACT,OAAO,MAAM;AAAA,MACb,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,IACpC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EACpB;AACF;AApDsB,OAAAA,gBAAA;AAyDtB,eAAe,kBAAkB,OAA2B,KAAU;AACpE,QAAM,YAAY,MAAM,OAAO;AAC/B,QAAM,YAAY,MAAM;AAExB,UAAQ,IAAI,mDAAc,SAAS;AAEnC,UAAQ,WAAW;AAAA,IACjB,KAAK;AACH,YAAM,sBAAsB,WAAW,GAAG;AAC1C;AAAA,IAEF,KAAK;AACH,YAAM,sBAAsB,WAAW,GAAG;AAC1C;AAAA,IAEF,KAAK;AACH,YAAM,sBAAsB,WAAW,GAAG;AAC1C;AAAA,IAEF,KAAK;AACH,cAAQ,IAAI,yDAAe,SAAS;AACpC;AAAA,IAEF,KAAK;AACH,cAAQ,IAAI,yDAAe,SAAS;AACpC;AAAA,IAEF;AACE,cAAQ,IAAI,kEAAgB,WAAW,SAAS;AAAA,EACpD;AACF;AA9Be;AAmCf,eAAe,sBAAsB,WAAgB,KAAU;AAC7D,UAAQ,IAAI,+DAAgB;AAAA,IAC1B,YAAY,WAAW;AAAA,IACvB,SAAS,WAAW;AAAA,IACpB,OAAO,WAAW,SAAS;AAAA,EAC7B,CAAC;AAED,MAAI;AAQF,UAAM,gBAAgB,oBAAoB,SAAS;AAAA,EAErD,SAAS,OAAO;AACd,YAAQ,MAAM,wEAAiB,KAAK;AAAA,EACtC;AACF;AApBe;AAyBf,eAAe,sBAAsB,WAAgB,KAAU;AAC7D,UAAQ,IAAI,kEAAgB;AAAA,IAC1B,YAAY,WAAW;AAAA,IACvB,SAAS,WAAW;AAAA,IACpB,OAAO,WAAW,SAAS;AAAA,IAC3B,YAAY,WAAW;AAAA,EACzB,CAAC;AAED,MAAI;AAQF,UAAM,gBAAgB,oBAAoB,SAAS;AAAA,EAErD,SAAS,OAAO;AACd,YAAQ,MAAM,wEAAiB,KAAK;AAAA,EACtC;AACF;AArBe;AA0Bf,eAAe,sBAAsB,WAAgB,KAAU;AAC7D,UAAQ,IAAI,qEAAiB;AAAA,IAC3B,YAAY,WAAW;AAAA,IACvB,SAAS,WAAW;AAAA,EACtB,CAAC;AAED,MAAI;AAOF,UAAM,gBAAgB,oBAAoB,SAAS;AAAA,EAErD,SAAS,OAAO;AACd,YAAQ,MAAM,wEAAiB,KAAK;AAAA,EACtC;AACF;AAlBe;AAuBf,eAAe,gBAAgB,WAAmB,WAAgB;AAChE,QAAM,WAAW;AAAA,IACf,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,IAClC;AAAA,IACA,YAAY,WAAW;AAAA,IACvB,SAAS,WAAW;AAAA,IACpB,OAAO,WAAW;AAAA,IAClB,MAAM;AAAA,EACR;AAEA,UAAQ,IAAI,mDAAc,QAAQ;AAIpC;AAde;AAmBf,eAAsB,eAAkC;AACtD,SAAO,SAAS,KAAK;AAAA,IACnB,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,IAClC,SAAS;AAAA,EACX,CAAC;AACH;AAPsB;;;ACxMf,IAAM,kBAAN,MAAsB;AAAA,EAZ7B,OAY6B;AAAA;AAAA;AAAA,EACnB;AAAA;AAAA,EAGS,sBAAsB;AAAA,EACtB,uBAAuB;AAAA,EACvB,0BAA0B;AAAA;AAAA,EAE3C,YAAY,IAAS;AACnB,SAAK,KAAK;AAAA,EACZ;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,aAA8E;AAClF,UAAM,QAAQ,MAAM,KAAK,cAAc;AACvC,UAAM,MAAM,oBAAI,KAAK;AACrB,UAAM,QAAQ,IAAI,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC;AAC5C,UAAM,eAAe,IAAI,YAAY,IAAI,OAAO,IAAI,SAAS,IAAI,GAAG,SAAS,EAAE,SAAS,GAAG,GAAG;AAG9F,QAAI,MAAM,iBAAiB,KAAK,qBAAqB;AACnD,aAAO;AAAA,QACL,SAAS;AAAA,QACT,QAAQ;AAAA,QACR,WAAW;AAAA,UACT,OAAO;AAAA,UACP,SAAS,KAAK,IAAI,GAAG,KAAK,uBAAuB,MAAM,cAAc;AAAA,QACvE;AAAA,MACF;AAAA,IACF;AAGA,QAAI,MAAM,kBAAkB,KAAK,sBAAsB;AACrD,aAAO;AAAA,QACL,SAAS;AAAA,QACT,QAAQ;AAAA,QACR,WAAW;AAAA,UACT,OAAO,KAAK,IAAI,GAAG,KAAK,sBAAsB,MAAM,aAAa;AAAA,UACjE,SAAS;AAAA,QACX;AAAA,MACF;AAAA,IACF;AAEA,WAAO;AAAA,MACL,SAAS;AAAA,MACT,WAAW;AAAA,QACT,OAAO,KAAK,sBAAsB,MAAM;AAAA,QACxC,SAAS,KAAK,uBAAuB,MAAM;AAAA,MAC7C;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,YAAY,aAAqB,GAAkB;AACvD,UAAM,QAAQ,MAAM,KAAK,cAAc;AACvC,UAAM,MAAM,oBAAI,KAAK;AACrB,UAAM,QAAQ,IAAI,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC;AAC5C,UAAM,eAAe,IAAI,YAAY,IAAI,OAAO,IAAI,SAAS,IAAI,GAAG,SAAS,EAAE,SAAS,GAAG,GAAG;AAG9F,QAAI,MAAM,kBAAkB,OAAO;AACjC,YAAM,gBAAgB;AACtB,YAAM,gBAAgB;AAAA,IACxB;AAGA,QAAI,MAAM,qBAAqB,cAAc;AAC3C,YAAM,iBAAiB;AACvB,YAAM,mBAAmB;AAAA,IAC3B;AAGA,UAAM,iBAAiB;AACvB,UAAM,kBAAkB;AAExB,UAAM,KAAK,eAAe,KAAK;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,gBAAqC;AACjD,QAAI;AACF,YAAM,OAAO,MAAM,KAAK,GAAG,IAAI,aAAa;AAC5C,UAAI,MAAM;AACR,eAAO,KAAK,MAAM,IAAI;AAAA,MACxB;AAAA,IACF,SAAS,OAAO;AACd,cAAQ,IAAI,8BAA8B,KAAK;AAAA,IACjD;AAGA,UAAM,MAAM,oBAAI,KAAK;AACrB,WAAO;AAAA,MACL,eAAe;AAAA,MACf,gBAAgB;AAAA,MAChB,eAAe,IAAI,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC;AAAA,MAC7C,kBAAkB,IAAI,YAAY,IAAI,OAAO,IAAI,SAAS,IAAI,GAAG,SAAS,EAAE,SAAS,GAAG,GAAG;AAAA,IAC7F;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,eAAe,OAAkC;AAC7D,QAAI;AACF,YAAM,KAAK,GAAG,IAAI,eAAe,KAAK,UAAU,KAAK,CAAC;AAAA,IACxD,SAAS,OAAO;AACd,cAAQ,IAAI,+BAA+B,KAAK;AAAA,IAClD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eAA6B;AACjC,UAAM,QAAQ,MAAM,KAAK,cAAc;AACvC,WAAO;AAAA,MACL,OAAO;AAAA,QACL,MAAM,MAAM;AAAA,QACZ,OAAO,KAAK;AAAA,QACZ,WAAW,KAAK,IAAI,GAAG,KAAK,sBAAsB,MAAM,aAAa;AAAA,QACrE,WAAW;AAAA,MACb;AAAA,MACA,SAAS;AAAA,QACP,MAAM,MAAM;AAAA,QACZ,OAAO,KAAK;AAAA,QACZ,WAAW,KAAK,IAAI,GAAG,KAAK,uBAAuB,MAAM,cAAc;AAAA,QACvE,WAAW;AAAA,MACb;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,qBAAqB,QAAiC;AAC1D,QAAI,OAAO,SAAS,OAAO,GAAG;AAC5B,aAAO;AAAA,IACT,WAAW,OAAO,SAAS,SAAS,GAAG;AACrC,aAAO;AAAA,IACT;AACA,WAAO;AAAA,EACT;AACF;AAKO,SAAS,sBAAsB,IAA0B;AAC9D,SAAO,IAAI,gBAAgB,EAAE;AAC/B;AAFgB;;;AC9JhB,eAAsBC,cAAa,SAAiC;AAClE,MAAI;AACF,UAAM,EAAE,IAAI,IAAI;AAGhB,UAAM,kBAAkB,sBAAsB,IAAI,OAAO;AAGzD,UAAM,YAAY,MAAM,gBAAgB,aAAa;AACrD,UAAM,aAAa,MAAM,gBAAgB,WAAW;AAEpD,UAAM,aAAa;AAAA,MACjB,QAAQ,WAAW,UAAU,WAAW;AAAA,MACxC,QAAQ;AAAA,QACN,OAAO;AAAA,UACL,MAAM,UAAU,MAAM;AAAA,UACtB,OAAO,UAAU,MAAM;AAAA,UACvB,WAAW,UAAU,MAAM;AAAA,UAC3B,YAAY,KAAK,MAAO,UAAU,MAAM,OAAO,UAAU,MAAM,QAAS,GAAG;AAAA,UAC3E,WAAW,UAAU,MAAM;AAAA,QAC7B;AAAA,QACA,SAAS;AAAA,UACP,MAAM,UAAU,QAAQ;AAAA,UACxB,OAAO,UAAU,QAAQ;AAAA,UACzB,WAAW,UAAU,QAAQ;AAAA,UAC7B,YAAY,KAAK,MAAO,UAAU,QAAQ,OAAO,UAAU,QAAQ,QAAS,GAAG;AAAA,UAC/E,WAAW,UAAU,QAAQ;AAAA,QAC/B;AAAA,MACF;AAAA,MACA,SAAS,WAAW,UAChB,iGACA,gBAAM,WAAW,MAAM;AAAA,MAC3B,aAAa,CAAC,WAAW,UACrB,0IACA;AAAA,MACJ,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,IACpC;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU,YAAY,MAAM,CAAC,GAAG;AAAA,MACvD,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,iBAAiB;AAAA,QACjB,+BAA+B;AAAA,QAC/B,gCAAgC;AAAA,QAChC,gCAAgC;AAAA,MAClC;AAAA,IACF,CAAC;AAAA,EAEH,SAAS,OAAO;AACd,YAAQ,MAAM,qDAAa,KAAK;AAEhC,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,OAAO,MAAM;AAAA,IACf,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,+BAA+B;AAAA,MACjC;AAAA,IACF,CAAC;AAAA,EACH;AACF;AA/DsB,OAAAA,eAAA;;;ACctB,SAAS,aAAa,OAAwB;AAC5C,QAAM,aAAa;AACnB,SAAO,WAAW,KAAK,KAAK;AAC9B;AAHS;AAMT,SAAS,uBAAuB,OAAuB;AACrD,SAAO,OAAO,KAAK,KAAK,EAAE,QAAQ,UAAU,EAAE,CAAC;AACjD;AAFS;AAKT,eAAsBC,eAAc,SAA4D;AAC9F,MAAI;AAEF,UAAM,cAAc,MAAM,QAAQ,QAAQ,KAAK;AAC/C,UAAM,EAAE,OAAO,cAAc,CAAC,GAAG,WAAW,QAAQ,IAAI;AAExD,YAAQ,IAAI,yCAAW,EAAE,OAAO,aAAa,SAAS,CAAC;AAGvD,QAAI,CAAC,OAAO;AACV,aAAO,IAAI,SAAS,KAAK,UAAU;AAAA,QACjC,SAAS;AAAA,QACT,SAAS;AAAA,MACX,CAAC,GAAG;AAAA,QACF,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,oBAAoB,+BAA+B,IAAI;AAAA,MACpF,CAAC;AAAA,IACH;AAGA,QAAI,CAAC,aAAa,KAAK,GAAG;AACxB,aAAO,IAAI,SAAS,KAAK,UAAU;AAAA,QACjC,SAAS;AAAA,QACT,SAAS;AAAA,MACX,CAAC,GAAG;AAAA,QACF,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,oBAAoB,+BAA+B,IAAI;AAAA,MACpF,CAAC;AAAA,IACH;AAGA,UAAM,iBAAiB,uBAAuB,KAAK;AACnD,UAAM,mBAAqC;AAAA,MACzC;AAAA,MACA;AAAA,MACA,eAAc,oBAAI,KAAK,GAAE,YAAY;AAAA,MACrC,WAAW,QAAQ,QAAQ,QAAQ,IAAI,kBAAkB;AAAA,MACzD,WAAW,QAAQ,QAAQ,QAAQ,IAAI,YAAY;AAAA,MACnD;AAAA,IACF;AAEA,YAAQ,IAAI,yCAAW,gBAAgB;AAGvC,UAAM,QAAQ,IAAI,cAAc,IAAI,gBAAgB,KAAK,UAAU,gBAAgB,CAAC;AAGpF,UAAM,kBAAkB,MAAM,QAAQ,IAAI,WAAW,IAAI,kBAAkB;AAC3E,QAAI,cAAc,CAAC;AAEnB,QAAI,iBAAiB;AACnB,oBAAc,KAAK,MAAM,eAAe;AAAA,IAC1C;AAGA,UAAM,gBAAgB,YAAY,UAAU,CAAC,QAAa,IAAI,UAAU,KAAK;AAC7E,QAAI,iBAAiB,GAAG;AAEtB,kBAAY,aAAa,IAAI,EAAE,GAAG,kBAAkB,IAAI,eAAe;AAAA,IACzE,OAAO;AAEL,kBAAY,KAAK,EAAE,GAAG,kBAAkB,IAAI,eAAe,CAAC;AAAA,IAC9D;AAGA,UAAM,QAAQ,IAAI,WAAW,IAAI,oBAAoB,KAAK,UAAU,WAAW,CAAC;AAGhF,UAAM,SAAQ,oBAAI,KAAK,GAAE,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC;AACnD,UAAM,WAAW,SAAS,KAAK;AAC/B,UAAM,aAAa,MAAM,QAAQ,IAAI,WAAW,IAAI,QAAQ;AAC5D,QAAI,QAAQ,EAAE,eAAe,EAAE;AAE/B,QAAI,YAAY;AACd,cAAQ,KAAK,MAAM,UAAU;AAAA,IAC/B;AACA,UAAM,iBAAiB;AAEvB,UAAM,QAAQ,IAAI,WAAW,IAAI,UAAU,KAAK,UAAU,KAAK,GAAG;AAAA,MAChE,eAAe,KAAK,KAAK,KAAK;AAAA;AAAA,IAChC,CAAC;AAED,YAAQ,IAAI,sCAAQ;AAEpB,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,SAAS;AAAA,MACT,SAAS,aAAa,UAAU,mCAAU;AAAA,MAC1C,MAAM,EAAE,eAAe;AAAA,IACzB,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,+BAA+B;AAAA,QAC/B,gCAAgC;AAAA,QAChC,gCAAgC;AAAA,MAClC;AAAA,IACF,CAAC;AAAA,EAEH,SAAS,OAAO;AACd,YAAQ,MAAM,yCAAW,KAAK;AAC9B,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,SAAS;AAAA,MACT,SAAS;AAAA,MACT,OAAO,OAAO,KAAK;AAAA,IACrB,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,oBAAoB,+BAA+B,IAAI;AAAA,IACpF,CAAC;AAAA,EACH;AACF;AA7GsB,OAAAA,gBAAA;AAgHtB,eAAsBC,cAAa,SAA4D;AAC7F,MAAI;AACF,UAAM,MAAM,IAAI,IAAI,QAAQ,QAAQ,GAAG;AACvC,UAAM,SAAS,IAAI,aAAa,IAAI,QAAQ;AAE5C,YAAQ,IAAI,oBAAU,MAAM;AAE5B,QAAI,WAAW,SAAS;AAEtB,YAAM,kBAAkB,MAAM,QAAQ,IAAI,WAAW,IAAI,kBAAkB;AAC3E,YAAM,cAAc,kBAAkB,KAAK,MAAM,eAAe,IAAI,CAAC;AAErE,YAAM,QAAQ;AAAA,QACZ,kBAAkB,YAAY;AAAA,QAC9B,mBAAmB,YAAY,OAAO,CAAC,QAAa;AAClD,gBAAM,UAAU,IAAI,KAAK,IAAI,YAAY;AACzC,gBAAM,UAAU,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,KAAK,KAAK,KAAK,GAAI;AAC7D,iBAAO,UAAU;AAAA,QACnB,CAAC,EAAE;AAAA,QACH,mBAAmB,YAAY,OAAO,CAAC,KAAU,QAAa;AAC5D,cAAI,IAAI,QAAQ,KAAK,IAAI,IAAI,QAAQ,KAAK,KAAK;AAC/C,iBAAO;AAAA,QACT,GAAG,CAAC,CAAC;AAAA,MACP;AAEA,aAAO,IAAI,SAAS,KAAK,UAAU,KAAK,GAAG;AAAA,QACzC,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,oBAAoB,+BAA+B,IAAI;AAAA,MACpF,CAAC;AAAA,IACH;AAEA,QAAI,WAAW,QAAQ;AAErB,YAAM,kBAAkB,MAAM,QAAQ,IAAI,WAAW,IAAI,kBAAkB;AAC3E,YAAM,cAAc,kBAAkB,KAAK,MAAM,eAAe,IAAI,CAAC;AAErE,YAAM,aAAa,YAAY,IAAI,CAAC,SAAc;AAAA,QAChD,IAAI,IAAI;AAAA,QACR,aAAa,IAAI,MAAM,MAAM,GAAG,EAAE,CAAC;AAAA,QACnC,aAAa,IAAI;AAAA,QACjB,cAAc,IAAI;AAAA,QAClB,UAAU,IAAI;AAAA,MAChB,EAAE;AAEF,aAAO,IAAI,SAAS,KAAK,UAAU,UAAU,GAAG;AAAA,QAC9C,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,oBAAoB,+BAA+B,IAAI;AAAA,MACpF,CAAC;AAAA,IACH;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,SAAS;AAAA,MACT,SAAS;AAAA,IACX,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,oBAAoB,+BAA+B,IAAI;AAAA,IACpF,CAAC;AAAA,EAEH,SAAS,OAAO;AACd,YAAQ,MAAM,yCAAW,KAAK;AAC9B,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,SAAS;AAAA,MACT,SAAS;AAAA,MACT,OAAO,OAAO,KAAK;AAAA,IACrB,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,oBAAoB,+BAA+B,IAAI;AAAA,IACpF,CAAC;AAAA,EACH;AACF;AArEsB,OAAAA,eAAA;AAwEtB,eAAsB,gBAAgB,SAA4D;AAChG,MAAI;AACF,UAAM,cAAc,MAAM,QAAQ,QAAQ,KAAK;AAC/C,UAAM,EAAE,MAAM,IAAI;AAElB,QAAI,CAAC,OAAO;AACV,aAAO,IAAI,SAAS,KAAK,UAAU;AAAA,QACjC,SAAS;AAAA,QACT,SAAS;AAAA,MACX,CAAC,GAAG;AAAA,QACF,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,oBAAoB,+BAA+B,IAAI;AAAA,MACpF,CAAC;AAAA,IACH;AAEA,UAAM,iBAAiB,uBAAuB,KAAK;AAGnD,UAAM,QAAQ,IAAI,cAAc,OAAO,cAAc;AAGrD,UAAM,kBAAkB,MAAM,QAAQ,IAAI,WAAW,IAAI,kBAAkB;AAC3E,QAAI,iBAAiB;AACnB,YAAM,cAAc,KAAK,MAAM,eAAe;AAC9C,YAAM,sBAAsB,YAAY,OAAO,CAAC,QAAa,IAAI,UAAU,KAAK;AAChF,YAAM,QAAQ,IAAI,WAAW,IAAI,oBAAoB,KAAK,UAAU,mBAAmB,CAAC;AAAA,IAC1F;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,SAAS;AAAA,MACT,SAAS;AAAA,IACX,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,+BAA+B;AAAA,MACjC;AAAA,IACF,CAAC;AAAA,EAEH,SAAS,OAAO;AACd,YAAQ,MAAM,yCAAW,KAAK;AAC9B,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,SAAS;AAAA,MACT,SAAS;AAAA,MACT,OAAO,OAAO,KAAK;AAAA,IACrB,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,oBAAoB,+BAA+B,IAAI;AAAA,IACpF,CAAC;AAAA,EACH;AACF;AAlDsB;AAqDtB,eAAsBC,oBAAsC;AAC1D,SAAO,IAAI,SAAS,MAAM;AAAA,IACxB,QAAQ;AAAA,IACR,SAAS;AAAA,MACP,+BAA+B;AAAA,MAC/B,gCAAgC;AAAA,MAChC,gCAAgC;AAAA,MAChC,0BAA0B;AAAA,IAC5B;AAAA,EACF,CAAC;AACH;AAVsB,OAAAA,mBAAA;;;AC5Of,IAAM,6BAAN,MAAiC;AAAA,EAjCxC,OAiCwC;AAAA;AAAA;AAAA,EAC9B,WAA6C,oBAAI,IAAI;AAAA,EACrD;AAAA,EACA,gBAAgB,KAAK,KAAK,KAAK;AAAA;AAAA,EAC/B,cAAc;AAAA;AAAA,EAEtB,YAAY,aAAmB;AAC7B,SAAK,cAAc;AAAA,EACrB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,mBAAmB,WAAmB,QAA+C;AACzF,QAAI,UAAU,KAAK,SAAS,IAAI,SAAS;AAEzC,QAAI,CAAC,SAAS;AAEZ,UAAI,KAAK,aAAa;AACpB,YAAI;AACF,gBAAM,SAAS,MAAM,KAAK,YAAY,IAAI,WAAW,SAAS,EAAE;AAChE,cAAI,QAAQ;AACV,sBAAU,KAAK,MAAM,MAAM;AAC3B,iBAAK,SAAS,IAAI,WAAW,OAAQ;AAAA,UACvC;AAAA,QACF,SAAS,OAAO;AACd,kBAAQ,IAAI,yCAAW,KAAK;AAAA,QAC9B;AAAA,MACF;AAAA,IACF;AAEA,QAAI,CAAC,SAAS;AAEZ,gBAAU;AAAA,QACR;AAAA,QACA;AAAA,QACA,WAAW,KAAK,IAAI;AAAA,QACpB,cAAc,KAAK,IAAI;AAAA,QACvB,UAAU,CAAC;AAAA,QACX,iBAAiB,CAAC;AAAA,QAClB,eAAe,CAAC;AAAA,QAChB,qBAAqB;AAAA,QACrB,YAAY,CAAC;AAAA,MACf;AACA,WAAK,SAAS,IAAI,WAAW,OAAO;AAAA,IACtC;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,WAAW,WAAmB,SAAiC;AACnE,UAAM,UAAU,MAAM,KAAK,mBAAmB,SAAS;AAGvD,YAAQ,eAAe,KAAK,IAAI;AAGhC,YAAQ,SAAS,KAAK,OAAO;AAG7B,QAAI,QAAQ,SAAS,SAAS,KAAK,aAAa;AAC9C,cAAQ,WAAW,QAAQ,SAAS,MAAM,CAAC,KAAK,WAAW;AAAA,IAC7D;AAGA,QAAI,QAAQ,SAAS,QAAQ;AAC3B,YAAM,SAAS,KAAK,cAAc,QAAQ,OAAO;AACjD,cAAQ,kBAAkB,KAAK,WAAW,QAAQ,iBAAiB,MAAM;AACzE,cAAQ,gBAAgB,KAAK,oBAAoB,QAAQ,eAAe,MAAM;AAAA,IAChF;AAGA,QAAI,QAAQ,YAAY;AACtB,cAAQ,WAAW,KAAK,QAAQ,UAAU;AAC1C,UAAI,QAAQ,WAAW,SAAS,IAAI;AAClC,gBAAQ,aAAa,QAAQ,WAAW,MAAM,GAAG;AAAA,MACnD;AAAA,IACF;AAGA,YAAQ,sBAAsB,KAAK,gBAAgB,OAAO;AAG1D,UAAM,KAAK,eAAe,OAAO;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKA,wBAAwB,WAAmB,cAMzC;AACA,UAAM,UAAU,KAAK,SAAS,IAAI,SAAS;AAC3C,QAAI,CAAC,WAAW,QAAQ,SAAS,WAAW,GAAG;AAC7C,aAAO;AAAA,QACL,eAAe;AAAA,QACf,iBAAiB,CAAC;AAAA,QAClB,eAAe,CAAC;AAAA,QAChB,kBAAkB,CAAC;AAAA,QACnB,YAAY;AAAA,MACd;AAAA,IACF;AAGA,UAAM,kBAAkB,KAAK,uBAAuB,OAAO;AAC3D,UAAM,gBAAgB,QAAQ,gBAAgB,MAAM,GAAG,CAAC;AACxD,UAAM,mBAAmB,KAAK,wBAAwB,OAAO;AAC7D,UAAM,aAAa,KAAK,iBAAiB,cAAc,OAAO;AAG9D,QAAI,gBAAgB;AAGpB,QAAI,KAAK,2BAA2B,YAAY,GAAG;AACjD,sBAAgB,KAAK,oBAAoB,cAAc,OAAO;AAAA,IAChE;AAGA,QAAI,aAAa,SAAS,MAAM,gBAAgB,SAAS,GAAG;AAC1D,YAAM,eAAe,KAAK,kBAAkB,SAAS,UAAU;AAC/D,sBAAgB,GAAG,aAAa,IAAI,YAAY;AAAA,IAClD;AAGA,QAAI,KAAK,mBAAmB,cAAc,OAAO,GAAG;AAClD,YAAM,kBAAkB,KAAK,qBAAqB,OAAO;AACzD,sBAAgB,mDAAW,eAAe,SAAI,aAAa;AAAA,IAC7D;AAEA,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,oBAAoB,WAA6B;AAC/C,UAAM,UAAU,KAAK,SAAS,IAAI,SAAS;AAC3C,QAAI,CAAC,SAAS;AACZ,aAAO,KAAK,sBAAsB;AAAA,IACpC;AAEA,UAAM,cAAwB,CAAC;AAG/B,UAAM,YAAY,QAAQ,cAAc,MAAM,GAAG,CAAC;AAClD,cAAU,QAAQ,cAAY;AAC5B,kBAAY,KAAK,GAAG,KAAK,iCAAiC,QAAQ,CAAC;AAAA,IACrE,CAAC;AAGD,UAAM,eAAe,QAAQ,gBAAgB,MAAM,EAAE;AACrD,iBAAa,QAAQ,WAAS;AAC5B,kBAAY,KAAK,GAAG,KAAK,8BAA8B,KAAK,CAAC;AAAA,IAC/D,CAAC;AAGD,QAAI,QAAQ,SAAS,SAAS,GAAG;AAC/B,kBAAY,KAAK,GAAG,KAAK,oCAAoC,OAAO,CAAC;AAAA,IACvE;AAGA,WAAO,CAAC,GAAG,IAAI,IAAI,WAAW,CAAC,EAAE,MAAM,GAAG,CAAC;AAAA,EAC7C;AAAA;AAAA;AAAA;AAAA,EAKQ,cAAc,SAA2B;AAC/C,UAAM,SAAmB,CAAC;AAC1B,UAAM,OAAO,QAAQ,YAAY;AAGjC,UAAM,gBAAgB;AAAA,MACpB,kBAAQ,CAAC,kBAAQ,kBAAQ,kBAAQ,gBAAM;AAAA,MACvC,kBAAQ,CAAC,kBAAQ,kBAAQ,kBAAQ,gBAAM;AAAA,MACvC,kBAAQ,CAAC,kBAAQ,4BAAQ,4BAAQ,0BAAM;AAAA,MACvC,4BAAQ,CAAC,4BAAQ,4BAAQ,4BAAQ,0BAAM;AAAA,MACvC,4BAAQ,CAAC,WAAM,WAAM,WAAM,sBAAO,oBAAK;AAAA,MACvC,4BAAQ,CAAC,gBAAM,gBAAM,4BAAQ,0BAAM;AAAA,MACnC,kBAAQ,CAAC,kBAAQ,kBAAQ,8BAAU,gBAAM;AAAA,IAC3C;AAEA,WAAO,QAAQ,aAAa,EAAE,QAAQ,CAAC,CAAC,OAAO,QAAQ,MAAM;AAC3D,UAAI,SAAS,KAAK,aAAW,KAAK,SAAS,OAAO,CAAC,GAAG;AACpD,eAAO,KAAK,KAAK;AAAA,MACnB;AAAA,IACF,CAAC;AAED,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,WAAW,UAAoB,WAA+B;AACpE,UAAM,SAAS,CAAC,GAAG,QAAQ;AAC3B,cAAU,QAAQ,WAAS;AACzB,UAAI,CAAC,OAAO,SAAS,KAAK,GAAG;AAC3B,eAAO,KAAK,KAAK;AAAA,MACnB;AAAA,IACF,CAAC;AACD,WAAO,OAAO,MAAM,GAAG;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA,EAKQ,oBAAoB,WAAqB,QAA4B;AAC3E,UAAM,cAAc,oBAAI,IAAoB;AAG5C,cAAU,QAAQ,cAAY;AAC5B,kBAAY,IAAI,WAAW,YAAY,IAAI,QAAQ,KAAK,KAAK,CAAC;AAAA,IAChE,CAAC;AAGD,WAAO,QAAQ,WAAS;AACtB,kBAAY,IAAI,QAAQ,YAAY,IAAI,KAAK,KAAK,KAAK,CAAC;AAAA,IAC1D,CAAC;AAGD,WAAO,MAAM,KAAK,YAAY,QAAQ,CAAC,EACpC,KAAK,CAAC,GAAG,MAAM,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,EAC1B,MAAM,GAAG,EAAE,EACX,IAAI,CAAC,CAAC,QAAQ,MAAM,QAAQ;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA,EAKQ,uBAAuB,SAAwC;AACrE,UAAM,WAAqB,CAAC;AAG5B,UAAM,iBAAiB,QAAQ,SAAS,MAAM,EAAE;AAChD,mBAAe,QAAQ,aAAW;AAChC,UAAI,QAAQ,SAAS,QAAQ;AAE3B,cAAM,QAAQ,QAAQ,QACnB,QAAQ,gCAAgC,GAAG,EAC3C,MAAM,KAAK,EACX,OAAO,UAAQ,KAAK,SAAS,CAAC;AACjC,iBAAS,KAAK,GAAG,KAAK;AAAA,MACxB;AAAA,IACF,CAAC;AAGD,UAAM,cAAc,oBAAI,IAAoB;AAC5C,aAAS,QAAQ,aAAW;AAC1B,kBAAY,IAAI,UAAU,YAAY,IAAI,OAAO,KAAK,KAAK,CAAC;AAAA,IAC9D,CAAC;AAED,WAAO,MAAM,KAAK,YAAY,QAAQ,CAAC,EACpC,KAAK,CAAC,GAAG,MAAM,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,EAC1B,MAAM,GAAG,CAAC,EACV,IAAI,CAAC,CAAC,OAAO,MAAM,OAAO;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB,SAAsC;AAC5D,QAAI,QAAQ,SAAS,WAAW,EAAG,QAAO;AAE1C,UAAM,eAAe,QAAQ,SAC1B,OAAO,OAAK,EAAE,SAAS,MAAM,EAC7B,MAAM,EAAE,EACR,IAAI,OAAK,EAAE,OAAO;AAErB,UAAM,YAAY,QAAQ,gBAAgB,MAAM,GAAG,CAAC;AAEpD,WAAO,yCAAW,UAAU,KAAK,IAAI,CAAC,+BAAW,aAAa,KAAK,IAAI,CAAC;AAAA,EAC1E;AAAA;AAAA;AAAA;AAAA,EAKQ,iCAAiC,UAA4B;AACnE,UAAM,gBAA0C;AAAA,MAC9C,kBAAQ;AAAA,QACN;AAAA,QACA;AAAA,MACF;AAAA,MACA,kBAAQ;AAAA,QACN;AAAA,QACA;AAAA,MACF;AAAA,MACA,kBAAQ;AAAA,QACN;AAAA,QACA;AAAA,MACF;AAAA,MACA,4BAAQ;AAAA,QACN;AAAA,QACA;AAAA,MACF;AAAA,IACF;AAEA,WAAO,cAAc,QAAQ,KAAK,CAAC;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA,EAKQ,8BAA8B,OAAyB;AAC7D,WAAO;AAAA,MACL,eAAK,KAAK;AAAA,MACV,GAAG,KAAK;AAAA,IACV;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,oCAAoC,SAAwC;AAClF,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,wBAAkC;AACxC,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,eAAe,SAA6C;AACxE,QAAI,KAAK,aAAa;AACpB,UAAI;AACF,cAAM,KAAK,YAAY;AAAA,UACrB,WAAW,QAAQ,SAAS;AAAA,UAC5B,KAAK,UAAU,OAAO;AAAA,UACtB,EAAE,eAAe,KAAK,gBAAgB,IAAK;AAAA,QAC7C;AAAA,MACF,SAAS,OAAO;AACd,gBAAQ,IAAI,+CAAY,KAAK;AAAA,MAC/B;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,wBAAwB,SAAwC;AACtE,WAAO,QAAQ,SACZ,MAAM,EAAE,EACR,OAAO,OAAK,EAAE,SAAS,MAAM,EAC7B,IAAI,OAAK,EAAE,QAAQ,MAAM,GAAG,EAAE,KAAK,EAAE,QAAQ,SAAS,KAAK,QAAQ,GAAG;AAAA,EAC3E;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAiB,OAAe,SAAsC;AAC5E,UAAM,aAAa,MAAM,YAAY;AAGrC,QAAI,WAAW,SAAS,cAAI,KAAK,WAAW,SAAS,cAAI,KAAK,WAAW,SAAS,cAAI,GAAG;AACvF,aAAO;AAAA,IACT;AACA,QAAI,WAAW,SAAS,cAAI,KAAK,WAAW,SAAS,cAAI,KAAK,WAAW,SAAS,cAAI,GAAG;AACvF,aAAO;AAAA,IACT;AACA,QAAI,WAAW,SAAS,cAAI,KAAK,WAAW,SAAS,cAAI,KAAK,WAAW,SAAS,oBAAK,GAAG;AACxF,aAAO;AAAA,IACT;AACA,QAAI,WAAW,SAAS,cAAI,KAAK,WAAW,SAAS,cAAI,KAAK,WAAW,SAAS,cAAI,GAAG;AACvF,aAAO;AAAA,IACT;AACA,QAAI,WAAW,SAAS,cAAI,KAAK,WAAW,SAAS,cAAI,KAAK,WAAW,SAAS,cAAI,GAAG;AACvF,aAAO;AAAA,IACT;AAGA,UAAM,eAAe,QAAQ,gBAAgB,MAAM,EAAE;AACrD,QAAI,aAAa,SAAS,gBAAM,KAAK,aAAa,SAAS,0BAAM,GAAG;AAClE,aAAO;AAAA,IACT;AACA,QAAI,aAAa,SAAS,gBAAM,KAAK,aAAa,SAAS,gBAAM,GAAG;AAClE,aAAO;AAAA,IACT;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,2BAA2B,OAAwB;AACzD,UAAM,WAAW,CAAC,UAAK,gBAAM,gBAAM,gBAAM,gBAAM,gBAAM,UAAK,UAAK,UAAK,QAAG;AACvE,WAAO,SAAS,KAAK,aAAW,MAAM,SAAS,OAAO,CAAC;AAAA,EACzD;AAAA;AAAA;AAAA;AAAA,EAKQ,oBAAoB,OAAe,SAAsC;AAC/E,QAAI,QAAQ,SAAS,SAAS,EAAG,QAAO;AAExC,UAAM,iBAAiB,QAAQ,SAC5B,MAAM,EACN,QAAQ,EACR,KAAK,OAAK,EAAE,SAAS,WAAW;AAEnC,QAAI,CAAC,eAAgB,QAAO;AAG5B,QAAI,gBAAgB;AAGpB,UAAM,WAAW,KAAK,gBAAgB,eAAe,OAAO;AAE5D,QAAI,SAAS,UAAU,SAAS,MAAM,MAAM,SAAS,QAAG,KAAK,MAAM,SAAS,oBAAK,IAAI;AACnF,sBAAgB,cAAc,QAAQ,UAAU,SAAS,UAAU,CAAC,CAAC;AAAA,IACvE;AAEA,QAAI,SAAS,OAAO,SAAS,MAAM,MAAM,SAAS,cAAI,KAAK,MAAM,SAAS,oBAAK,IAAI;AACjF,sBAAgB,cAAc,QAAQ,WAAW,SAAS,OAAO,CAAC,CAAC;AAAA,IACrE;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkB,SAA8B,QAAwB;AAC9E,UAAM,QAAQ,CAAC;AAGf,QAAI,QAAQ,gBAAgB,SAAS,GAAG;AACtC,YAAM,KAAK,8BAAU,QAAQ,gBAAgB,MAAM,GAAG,CAAC,EAAE,KAAK,QAAG,CAAC,GAAG;AAAA,IACvE;AAGA,QAAI,WAAW,eAAe,QAAQ,SAAS,SAAS,GAAG;AACzD,YAAM,gBAAgB,QAAQ,SAC3B,MAAM,EACN,QAAQ,EACR,KAAK,OAAK,EAAE,SAAS,MAAM;AAC9B,UAAI,eAAe;AACjB,cAAM,KAAK,0CAAY,cAAc,QAAQ,MAAM,GAAG,EAAE,CAAC,MAAM;AAAA,MACjE;AAAA,IACF;AAEA,WAAO,MAAM,KAAK,GAAG;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA,EAKQ,mBAAmB,OAAe,SAAuC;AAC/E,UAAM,qBAAqB;AAAA,MACzB;AAAA,MAAM;AAAA,MAAM;AAAA,MAAM;AAAA,MAAM;AAAA,MAAM;AAAA,MAAO;AAAA,MAAM;AAAA,MAC3C;AAAA,MAAO;AAAA,MAAM;AAAA,MAAM;AAAA,MAAM;AAAA,IAC3B;AAEA,WAAO,mBAAmB,KAAK,eAAa,MAAM,SAAS,SAAS,CAAC,KAC7D,MAAM,SAAS,MAAM,QAAQ,SAAS,SAAS;AAAA,EACzD;AAAA;AAAA;AAAA;AAAA,EAKQ,qBAAqB,SAAsC;AACjE,UAAM,iBAAiB,QAAQ,SAAS,MAAM,EAAE;AAChD,QAAI,eAAe,SAAS,EAAG,QAAO;AAEtC,UAAM,YAAY,eAAe,KAAK,OAAK,EAAE,SAAS,MAAM,GAAG,WAAW;AAC1E,UAAM,aAAa,eAAe,KAAK,OAAK,EAAE,SAAS,WAAW,GAAG,WAAW;AAGhF,UAAM,YAAY,UAAU,MAAM,GAAG,EAAE;AACvC,UAAM,cAAc,KAAK,iBAAiB,UAAU;AAEpD,WAAO,kCAAS,SAAS,oCAAW,YAAY,KAAK,QAAG,CAAC;AAAA,EAC3D;AAAA;AAAA;AAAA;AAAA,EAKQ,iBAAiB,MAAwB;AAC/C,UAAM,SAAS,CAAC;AAGhB,UAAM,cAAc,KAAK,MAAM,2BAA2B;AAC1D,QAAI,aAAa;AACf,aAAO,KAAK,GAAG,YAAY,MAAM,GAAG,CAAC,EAAE;AAAA,QAAI,CAAAC,WACzCA,OAAM,QAAQ,eAAe,EAAE,EAAE,MAAM,GAAG,EAAE;AAAA,MAC9C,CAAC;AAAA,IACH;AAGA,UAAM,gBAAgB,KAAK,MAAM,WAAW;AAC5C,QAAI,eAAe;AACjB,aAAO,KAAK,GAAG,cAAc,MAAM,oBAAK;AAAA,IAC1C;AAEA,WAAO,OAAO,SAAS,IAAI,SAAS,CAAC,0BAAM;AAAA,EAC7C;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAgB,MAAyD;AAC/E,UAAM,YAAY,CAAC;AACnB,UAAM,SAAS,CAAC;AAGhB,UAAM,kBAAkB;AAAA,MACtB;AAAA,MACA;AAAA,IACF;AAEA,oBAAgB,QAAQ,aAAW;AACjC,YAAM,UAAU,KAAK,MAAM,OAAO;AAClC,UAAI,SAAS;AACX,kBAAU,KAAK,GAAG,QAAQ,MAAM,GAAG,CAAC,CAAC;AAAA,MACvC;AAAA,IACF,CAAC;AAED,UAAM,gBAAgB;AAAA,MACpB;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAEA,kBAAc,QAAQ,aAAW;AAC/B,YAAM,UAAU,KAAK,MAAM,OAAO;AAClC,UAAI,SAAS;AACX,eAAO,KAAK,GAAG,QAAQ,MAAM,GAAG,CAAC,CAAC;AAAA,MACpC;AAAA,IACF,CAAC;AAED,WAAO,EAAE,WAAW,OAAO;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA,EAKA,yBAA+B;AAC7B,UAAM,MAAM,KAAK,IAAI;AACrB,eAAW,CAAC,WAAW,OAAO,KAAK,KAAK,SAAS,QAAQ,GAAG;AAC1D,UAAI,MAAM,QAAQ,eAAe,KAAK,eAAe;AACnD,aAAK,SAAS,OAAO,SAAS;AAAA,MAChC;AAAA,IACF;AAAA,EACF;AACF;;;ACvlBA,eAAsBC,cAAa,SAAiC;AAClE,MAAI;AACF,UAAM,EAAE,SAAS,IAAI,IAAI;AACzB,UAAM,MAAM,IAAI,IAAI,QAAQ,GAAG;AAC/B,UAAM,YAAY,IAAI,aAAa,IAAI,WAAW;AAElD,QAAI,CAAC,WAAW;AACd,aAAO,IAAI,SAAS,KAAK,UAAU;AAAA,QACjC,OAAO;AAAA,QACP,aAAa,sBAAsB;AAAA,MACrC,CAAC,GAAG;AAAA,QACF,QAAQ;AAAA,QACR,SAAS;AAAA,UACP,gBAAgB;AAAA,UAChB,+BAA+B;AAAA,QACjC;AAAA,MACF,CAAC;AAAA,IACH;AAGA,UAAM,iBAAiB,IAAI,2BAA2B,IAAI,aAAa;AAGvE,UAAM,cAAc,eAAe,oBAAoB,SAAS;AAGhE,UAAM,UAAU,MAAM,eAAe,mBAAmB,SAAS;AAEjE,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC;AAAA,MACA;AAAA,MACA,aAAa;AAAA,QACX,cAAc,QAAQ,SAAS;AAAA,QAC/B,QAAQ,QAAQ,gBAAgB,MAAM,GAAG,CAAC;AAAA,QAC1C,WAAW,QAAQ,cAAc,MAAM,GAAG,CAAC;AAAA,QAC3C,SAAS,QAAQ;AAAA,MACnB;AAAA,MACA,WAAW,KAAK,IAAI;AAAA,IACtB,CAAC,GAAG;AAAA,MACF,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,+BAA+B;AAAA,QAC/B,iBAAiB;AAAA,MACnB;AAAA,IACF,CAAC;AAAA,EAEH,SAAS,OAAO;AACd,YAAQ,MAAM,4CAAc,KAAK;AAEjC,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,OAAO;AAAA,MACP,aAAa,sBAAsB;AAAA,MACnC,WAAW,KAAK,IAAI;AAAA,IACtB,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,+BAA+B;AAAA,MACjC;AAAA,IACF,CAAC;AAAA,EACH;AACF;AA7DsB,OAAAA,eAAA;AA+DtB,eAAsBC,eAAc,SAAiC;AACnE,MAAI;AACF,UAAM,EAAE,SAAS,IAAI,IAAI;AACzB,UAAM,OAAY,MAAM,QAAQ,KAAK;AACrC,UAAM,EAAE,WAAW,WAAW,YAAY,IAAI;AAE9C,QAAI,CAAC,WAAW;AACd,aAAO,IAAI,SAAS,KAAK,UAAU;AAAA,QACjC,OAAO;AAAA,MACT,CAAC,GAAG;AAAA,QACF,QAAQ;AAAA,QACR,SAAS;AAAA,UACP,gBAAgB;AAAA,UAChB,+BAA+B;AAAA,QACjC;AAAA,MACF,CAAC;AAAA,IACH;AAEA,UAAM,iBAAiB,IAAI,2BAA2B,IAAI,aAAa;AAGvE,QAAI;AACJ,QAAI,WAAW;AAEb,YAAM,eAAe,WAAW,WAAW;AAAA,QACzC,MAAM;AAAA,QACN,SAAS;AAAA,QACT,WAAW,KAAK,IAAI;AAAA,MACtB,CAAC;AACD,oBAAc,eAAe,oBAAoB,SAAS;AAAA,IAC5D,OAAO;AACL,oBAAc,eAAe,oBAAoB,SAAS;AAAA,IAC5D;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC;AAAA,MACA;AAAA,MACA;AAAA,MACA,WAAW,KAAK,IAAI;AAAA,IACtB,CAAC,GAAG;AAAA,MACF,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,+BAA+B;AAAA,MACjC;AAAA,IACF,CAAC;AAAA,EAEH,SAAS,OAAO;AACd,YAAQ,MAAM,iDAAmB,KAAK;AAEtC,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,OAAO;AAAA,MACP,aAAa,sBAAsB;AAAA,IACrC,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,+BAA+B;AAAA,MACjC;AAAA,IACF,CAAC;AAAA,EACH;AACF;AA5DsB,OAAAA,gBAAA;AA8DtB,eAAsBC,oBAAsC;AAC1D,SAAO,IAAI,SAAS,MAAM;AAAA,IACxB,SAAS;AAAA,MACP,+BAA+B;AAAA,MAC/B,gCAAgC;AAAA,MAChC,gCAAgC;AAAA,IAClC;AAAA,EACF,CAAC;AACH;AARsB,OAAAA,mBAAA;AAatB,SAAS,wBAAkC;AACzC,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AACF;AATS;;;AC9IT,eAAsBC,eAAc,SAAS;AAC3C,QAAM,EAAE,SAAS,IAAI,IAAI;AAEzB,MAAI;AACF,UAAM,OAAO,MAAM,QAAQ,KAAK;AAGhC,UAAM,YAAY,QAAQ,QAAQ,IAAI,kBAAkB;AACxD,QAAI,CAAC,gBAAgB,MAAM,WAAW,IAAI,qBAAqB,GAAG;AAChE,aAAO,IAAI,SAAS,gBAAgB,EAAE,QAAQ,IAAI,CAAC;AAAA,IACrD;AAGA,UAAM,EAAE,MAAM,MAAM,IAAI;AAExB,QAAI,SAAS,oBAAoB;AAE/B,aAAO,IAAI,SAAS,KAAK,UAAU;AAAA,QACjC,WAAW,KAAK;AAAA,MAClB,CAAC,GAAG;AAAA,QACF,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAChD,CAAC;AAAA,IACH;AAEA,QAAI,OAAO,SAAS,uBAChB,OAAO,SAAS,0BAA0B;AAE5C,cAAQ,IAAI,qEAAiB,KAAK;AAGlC,YAAM,iBAAiB,MAAM;AAAA,QAC3B;AAAA,QACA;AAAA,UACE,QAAQ;AAAA,UACR,SAAS;AAAA,YACP,iBAAiB,SAAS,IAAI,YAAY;AAAA,YAC1C,UAAU;AAAA,YACV,gBAAgB;AAAA,UAClB;AAAA,UACA,MAAM,KAAK,UAAU;AAAA,YACnB,YAAY;AAAA,YACZ,gBAAgB;AAAA,cACd,SAAS;AAAA,cACT,YAAY,MAAM;AAAA,cAClB,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,YACpC;AAAA,UACF,CAAC;AAAA,QACH;AAAA,MACF;AAEA,UAAI,eAAe,IAAI;AACrB,gBAAQ,IAAI,yDAAY;AACxB,eAAO,IAAI,SAAS,MAAM,EAAE,QAAQ,IAAI,CAAC;AAAA,MAC3C,OAAO;AACL,gBAAQ,MAAM,6CAAU;AACxB,eAAO,IAAI,SAAS,eAAe,EAAE,QAAQ,IAAI,CAAC;AAAA,MACpD;AAAA,IACF;AAEA,WAAO,IAAI,SAAS,MAAM,EAAE,QAAQ,IAAI,CAAC;AAAA,EAE3C,SAAS,OAAO;AACd,YAAQ,MAAM,2CAAkB,KAAK;AACrC,WAAO,IAAI,SAAS,kBAAkB,EAAE,QAAQ,IAAI,CAAC;AAAA,EACvD;AACF;AAjEsB,OAAAA,gBAAA;AAmEtB,SAAS,gBAAgB,MAAM,WAAW,QAAQ;AAGhD,SAAO;AACT;AAJS;;;ACjET,eAAsBC,eAAc,SAAiC;AACnE,MAAI;AACF,UAAM,EAAE,SAAS,IAAI,IAAI;AAGzB,UAAM,aAAa,QAAQ,QAAQ,IAAI,eAAe;AACtD,QAAI,eAAe,UAAU,IAAI,mBAAmB,IAAI;AACtD,aAAO,IAAI,SAAS,gBAAgB,EAAE,QAAQ,IAAI,CAAC;AAAA,IACrD;AAEA,YAAQ,IAAI,+DAAgB;AAG5B,UAAM,aAAa,MAAM,qBAAqB,GAAG;AAEjD,QAAI,WAAW,SAAS;AACtB,cAAQ,IAAI,gDAAa,WAAW,OAAO;AAG3C,YAAM,qBAAqB,KAAK;AAAA,QAC9B,QAAQ;AAAA,QACR,SAAS,WAAW;AAAA,QACpB,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,MACpC,CAAC;AAED,aAAO,IAAI,SAAS,KAAK,UAAU;AAAA,QACjC,SAAS;AAAA,QACT,SAAS;AAAA,QACT,MAAM,WAAW;AAAA,MACnB,CAAC,GAAG;AAAA,QACF,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAChD,CAAC;AAAA,IACH,OAAO;AACL,cAAQ,MAAM,gDAAa,WAAW,KAAK;AAG3C,YAAM,qBAAqB,KAAK;AAAA,QAC9B,QAAQ;AAAA,QACR,OAAO,WAAW;AAAA,QAClB,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,MACpC,CAAC;AAED,aAAO,IAAI,SAAS,KAAK,UAAU;AAAA,QACjC,SAAS;AAAA,QACT,SAAS;AAAA,QACT,OAAO,WAAW;AAAA,MACpB,CAAC,GAAG;AAAA,QACF,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAChD,CAAC;AAAA,IACH;AAAA,EAEF,SAAS,OAAO;AACd,YAAQ,MAAM,mDAAc,KAAK;AAEjC,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,SAAS;AAAA,MACT,SAAS;AAAA,MACT,OAAO,MAAM;AAAA,IACf,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AAhEsB,OAAAA,gBAAA;AAqEtB,eAAe,qBAAqB,KAAU;AAC5C,MAAI;AAIF,UAAM,cAAc,IAAI;AACxB,UAAM,eAAe,IAAI;AAEzB,QAAI,CAAC,eAAe,CAAC,cAAc;AACjC,YAAM,IAAI,MAAM,yCAAW;AAAA,IAC7B;AAGA,UAAM,iBAAgB,oBAAI,KAAK,GAAE,YAAY;AAG7C,UAAM,gBAAgB,MAAM,kBAAkB,GAAG;AAEjD,WAAO;AAAA,MACL,SAAS;AAAA,MACT,SAAS;AAAA,QACP,UAAU;AAAA,QACV,eAAe;AAAA,QACf;AAAA,MACF;AAAA,IACF;AAAA,EAEF,SAAS,OAAO;AACd,WAAO;AAAA,MACL,SAAS;AAAA,MACT,OAAO,MAAM;AAAA,IACf;AAAA,EACF;AACF;AAjCe;AAsCf,eAAe,kBAAkB,KAAU;AACzC,MAAI;AAEF,UAAM,WAAW,MAAM,MAAM,gCAAgC,IAAI,WAAW,gDAAgD;AAAA,MAC1H,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,iBAAiB,SAAS,IAAI,YAAY;AAAA,QAC1C,UAAU;AAAA,QACV,gBAAgB;AAAA,MAClB;AAAA,MACA,MAAM,KAAK,UAAU;AAAA,QACnB,KAAK;AAAA,QACL,QAAQ;AAAA,UACN,WAAW;AAAA,QACb;AAAA,MACF,CAAC;AAAA,IACH,CAAC;AAED,QAAI,SAAS,IAAI;AACf,aAAO,EAAE,WAAW,MAAM,YAAW,oBAAI,KAAK,GAAE,YAAY,EAAE;AAAA,IAChE,OAAO;AACL,YAAM,QAAQ,MAAM,SAAS,KAAK;AAClC,YAAM,IAAI,MAAM,uCAAmB,KAAK,EAAE;AAAA,IAC5C;AAAA,EAEF,SAAS,OAAO;AACd,YAAQ,MAAM,2CAAuB,KAAK;AAC1C,WAAO,EAAE,WAAW,OAAO,OAAO,MAAM,QAAQ;AAAA,EAClD;AACF;AA7Be;AAkCf,eAAe,qBAAqB,KAAU,MAAW;AACvD,MAAI;AAEF,YAAQ,IAAI,uCAAY,IAAI;AAG5B,QAAI,IAAI,mBAAmB;AACzB,YAAM,MAAM,IAAI,mBAAmB;AAAA,QACjC,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,QAC9C,MAAM,KAAK,UAAU;AAAA,UACnB,MAAM,6CAAkB,KAAK,WAAW,YAAY,iBAAO,cAAI;AAAA,UAC/D,aAAa,CAAC;AAAA,YACZ,OAAO,KAAK,WAAW,YAAY,SAAS;AAAA,YAC5C,QAAQ;AAAA,cACN,EAAE,OAAO,gBAAM,OAAO,KAAK,WAAW,OAAO,KAAK;AAAA,cAClD,EAAE,OAAO,gBAAM,OAAO,KAAK,QAAQ,OAAO,KAAK;AAAA,cAC/C,EAAE,OAAO,gBAAM,OAAO,KAAK,WAAW,KAAK,OAAO,OAAO,MAAM;AAAA,YACjE;AAAA,UACF,CAAC;AAAA,QACH,CAAC;AAAA,MACH,CAAC;AAAA,IACH;AAAA,EAEF,SAAS,OAAO;AACd,YAAQ,MAAM,yCAAW,KAAK;AAAA,EAChC;AACF;AA3Be;;;ACzIR,IAAM,YAAgC,8BAAO,YAAY;AAC9D,QAAM,WAAW,MAAM,QAAQ,KAAK;AACpC,QAAM,MAAM,IAAI,IAAI,QAAQ,QAAQ,GAAG;AAGvC,QAAM,cAAc,IAAI,SAAS,SAAS,MAAM,QAAQ;AAGxD,QAAM,kBAAkB;AAAA,IACtB,0BAA0B;AAAA,IAC1B,mBAAmB;AAAA,IACnB,mBAAmB;AAAA,IACnB,sBAAsB;AAAA,EACxB;AAGA,MAAI,IAAI,aAAa,UAAU;AAC7B,oBAAgB,2BAA2B,IAAI;AAAA,EACjD;AAGA,QAAM,YAAY;AAAA,IAChB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF,EAAE,KAAK,IAAI;AAEX,kBAAgB,yBAAyB,IAAI;AAG7C,QAAM,WAAW,IAAI;AAErB,MAAI,SAAS,WAAW,UAAU,GAAG;AAEnC,gBAAY,QAAQ,IAAI,iBAAiB,qCAAqC;AAAA,EAChF,WAAW,SAAS,SAAS,OAAO,KAAK,aAAa,KAAK;AAEzD,gBAAY,QAAQ,IAAI,iBAAiB,uCAAuC;AAAA,EAClF,WAAW,aAAa,UAAU;AAEhC,gBAAY,QAAQ,IAAI,iBAAiB,oCAAoC;AAAA,EAC/E,WAAW,SAAS,WAAW,OAAO,GAAG;AAEvC,gBAAY,QAAQ,IAAI,iBAAiB,qCAAqC;AAC9E,gBAAY,QAAQ,IAAI,UAAU,UAAU;AAAA,EAC9C;AAGA,SAAO,QAAQ,eAAe,EAAE,QAAQ,CAAC,CAAC,KAAK,KAAK,MAAM;AACxD,gBAAY,QAAQ,IAAI,KAAK,KAAK;AAAA,EACpC,CAAC;AAGD,MAAI,QAAQ,QAAQ,QAAQ,IAAI,iBAAiB,GAAG,SAAS,MAAM,GAAG;AACpE,gBAAY,QAAQ,IAAI,oBAAoB,MAAM;AAAA,EACpD;AAGA,MAAI,SAAS,WAAW,OAAO,GAAG;AAChC,gBAAY,QAAQ,IAAI,+BAA+B,GAAG;AAC1D,gBAAY,QAAQ,IAAI,gCAAgC,oBAAoB;AAC5E,gBAAY,QAAQ,IAAI,gCAAgC,6BAA6B;AAAA,EACvF;AAEA,SAAO;AACT,GAxE6C;;;ACStC,IAAM,SAAS;AAAA,EAClB;AAAA,IACE,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAAC,gBAA8B;AAAA,EAC1C;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAAC,aAA2B;AAAA,EACvC;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAACC,iBAAwC;AAAA,EACpD;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAACC,cAAqC;AAAA,EACjD;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAAC,YAAoC;AAAA,EAChD;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAACA,cAAqC;AAAA,EACjD;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAACC,aAAkC;AAAA,EAC9C;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAAC,eAAkC;AAAA,EAC9C;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAACA,aAA+B;AAAA,EAC3C;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAACF,iBAAmC;AAAA,EAC/C;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAACC,cAAgC;AAAA,EAC5C;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAACC,aAAiC;AAAA,EAC7C;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAACF,iBAAqC;AAAA,EACjD;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAACC,cAAkC;AAAA,EAC9C;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAACA,cAAiC;AAAA,EAC7C;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAACA,cAAiC;AAAA,EAC7C;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC,SAA0B;AAAA,IACxC,SAAS,CAAC;AAAA,EACZ;AACF;;;ACtHF,SAAS,MAAM,KAAW;AACxB,MAAM,SAAqB,CAAA;AAC3B,MAAI,IAAI;AAER,SAAO,IAAI,IAAI,QAAQ;AACrB,QAAM,OAAO,IAAI,CAAC;AAElB,QAAI,SAAS,OAAO,SAAS,OAAO,SAAS,KAAK;AAChD,aAAO,KAAK,EAAE,MAAM,YAAY,OAAO,GAAG,OAAO,IAAI,GAAG,EAAC,CAAE;AAC3D;;AAGF,QAAI,SAAS,MAAM;AACjB,aAAO,KAAK,EAAE,MAAM,gBAAgB,OAAO,KAAK,OAAO,IAAI,GAAG,EAAC,CAAE;AACjE;;AAGF,QAAI,SAAS,KAAK;AAChB,aAAO,KAAK,EAAE,MAAM,QAAQ,OAAO,GAAG,OAAO,IAAI,GAAG,EAAC,CAAE;AACvD;;AAGF,QAAI,SAAS,KAAK;AAChB,aAAO,KAAK,EAAE,MAAM,SAAS,OAAO,GAAG,OAAO,IAAI,GAAG,EAAC,CAAE;AACxD;;AAGF,QAAI,SAAS,KAAK;AAChB,UAAI,OAAO;AACX,UAAI,IAAI,IAAI;AAEZ,aAAO,IAAI,IAAI,QAAQ;AACrB,YAAM,OAAO,IAAI,WAAW,CAAC;AAE7B;;UAEG,QAAQ,MAAM,QAAQ;UAEtB,QAAQ,MAAM,QAAQ;UAEtB,QAAQ,MAAM,QAAQ;UAEvB,SAAS;UACT;AACA,kBAAQ,IAAI,GAAG;AACf;;AAGF;;AAGF,UAAI,CAAC;AAAM,cAAM,IAAI,UAAU,6BAAA,OAA6B,CAAC,CAAE;AAE/D,aAAO,KAAK,EAAE,MAAM,QAAQ,OAAO,GAAG,OAAO,KAAI,CAAE;AACnD,UAAI;AACJ;;AAGF,QAAI,SAAS,KAAK;AAChB,UAAI,QAAQ;AACZ,UAAI,UAAU;AACd,UAAI,IAAI,IAAI;AAEZ,UAAI,IAAI,CAAC,MAAM,KAAK;AAClB,cAAM,IAAI,UAAU,oCAAA,OAAoC,CAAC,CAAE;;AAG7D,aAAO,IAAI,IAAI,QAAQ;AACrB,YAAI,IAAI,CAAC,MAAM,MAAM;AACnB,qBAAW,IAAI,GAAG,IAAI,IAAI,GAAG;AAC7B;;AAGF,YAAI,IAAI,CAAC,MAAM,KAAK;AAClB;AACA,cAAI,UAAU,GAAG;AACf;AACA;;mBAEO,IAAI,CAAC,MAAM,KAAK;AACzB;AACA,cAAI,IAAI,IAAI,CAAC,MAAM,KAAK;AACtB,kBAAM,IAAI,UAAU,uCAAA,OAAuC,CAAC,CAAE;;;AAIlE,mBAAW,IAAI,GAAG;;AAGpB,UAAI;AAAO,cAAM,IAAI,UAAU,yBAAA,OAAyB,CAAC,CAAE;AAC3D,UAAI,CAAC;AAAS,cAAM,IAAI,UAAU,sBAAA,OAAsB,CAAC,CAAE;AAE3D,aAAO,KAAK,EAAE,MAAM,WAAW,OAAO,GAAG,OAAO,QAAO,CAAE;AACzD,UAAI;AACJ;;AAGF,WAAO,KAAK,EAAE,MAAM,QAAQ,OAAO,GAAG,OAAO,IAAI,GAAG,EAAC,CAAE;;AAGzD,SAAO,KAAK,EAAE,MAAM,OAAO,OAAO,GAAG,OAAO,GAAE,CAAE;AAEhD,SAAO;AACT;AAvGS;AAuHH,SAAU,MAAM,KAAa,SAA0B;AAA1B,MAAA,YAAA,QAAA;AAAA,cAAA,CAAA;EAA0B;AAC3D,MAAM,SAAS,MAAM,GAAG;AAChB,MAAA,KAAuC,QAAO,UAA9C,WAAQ,OAAA,SAAG,OAAI,IAAE,KAAsB,QAAO,WAA7B,YAAS,OAAA,SAAG,QAAK;AAC1C,MAAM,SAAkB,CAAA;AACxB,MAAI,MAAM;AACV,MAAI,IAAI;AACR,MAAI,OAAO;AAEX,MAAM,aAAa,gCAAC,MAAsB;AACxC,QAAI,IAAI,OAAO,UAAU,OAAO,CAAC,EAAE,SAAS;AAAM,aAAO,OAAO,GAAG,EAAE;EACvE,GAFmB;AAInB,MAAM,cAAc,gCAAC,MAAsB;AACzC,QAAME,SAAQ,WAAW,IAAI;AAC7B,QAAIA,WAAU;AAAW,aAAOA;AAC1B,QAAAC,MAA4B,OAAO,CAAC,GAA5B,WAAQA,IAAA,MAAE,QAAKA,IAAA;AAC7B,UAAM,IAAI,UAAU,cAAA,OAAc,UAAQ,MAAA,EAAA,OAAO,OAAK,aAAA,EAAA,OAAc,IAAI,CAAE;EAC5E,GALoB;AAOpB,MAAM,cAAc,kCAAA;AAClB,QAAIC,UAAS;AACb,QAAIF;AACJ,WAAQA,SAAQ,WAAW,MAAM,KAAK,WAAW,cAAc,GAAI;AACjE,MAAAE,WAAUF;;AAEZ,WAAOE;EACT,GAPoB;AASpB,MAAM,SAAS,gCAACF,QAAa;AAC3B,aAAmB,KAAA,GAAA,cAAA,WAAA,KAAA,YAAA,QAAA,MAAS;AAAvB,UAAMG,QAAI,YAAA,EAAA;AAAe,UAAIH,OAAM,QAAQG,KAAI,IAAI;AAAI,eAAO;;AACnE,WAAO;EACT,GAHe;AAKf,MAAM,cAAc,gCAACC,SAAc;AACjC,QAAM,OAAO,OAAO,OAAO,SAAS,CAAC;AACrC,QAAM,WAAWA,YAAW,QAAQ,OAAO,SAAS,WAAW,OAAO;AAEtE,QAAI,QAAQ,CAAC,UAAU;AACrB,YAAM,IAAI,UACR,8DAAA,OAA+D,KAAa,MAAI,GAAA,CAAG;;AAIvF,QAAI,CAAC,YAAY,OAAO,QAAQ;AAAG,aAAO,KAAA,OAAK,aAAa,SAAS,GAAC,KAAA;AACtE,WAAO,SAAA,OAAS,aAAa,QAAQ,GAAC,KAAA,EAAA,OAAM,aAAa,SAAS,GAAC,MAAA;EACrE,GAZoB;AAcpB,SAAO,IAAI,OAAO,QAAQ;AACxB,QAAM,OAAO,WAAW,MAAM;AAC9B,QAAM,OAAO,WAAW,MAAM;AAC9B,QAAM,UAAU,WAAW,SAAS;AAEpC,QAAI,QAAQ,SAAS;AACnB,UAAI,SAAS,QAAQ;AAErB,UAAI,SAAS,QAAQ,MAAM,MAAM,IAAI;AACnC,gBAAQ;AACR,iBAAS;;AAGX,UAAI,MAAM;AACR,eAAO,KAAK,IAAI;AAChB,eAAO;;AAGT,aAAO,KAAK;QACV,MAAM,QAAQ;QACd;QACA,QAAQ;QACR,SAAS,WAAW,YAAY,MAAM;QACtC,UAAU,WAAW,UAAU,KAAK;OACrC;AACD;;AAGF,QAAM,QAAQ,QAAQ,WAAW,cAAc;AAC/C,QAAI,OAAO;AACT,cAAQ;AACR;;AAGF,QAAI,MAAM;AACR,aAAO,KAAK,IAAI;AAChB,aAAO;;AAGT,QAAM,OAAO,WAAW,MAAM;AAC9B,QAAI,MAAM;AACR,UAAM,SAAS,YAAW;AAC1B,UAAM,SAAO,WAAW,MAAM,KAAK;AACnC,UAAM,YAAU,WAAW,SAAS,KAAK;AACzC,UAAM,SAAS,YAAW;AAE1B,kBAAY,OAAO;AAEnB,aAAO,KAAK;QACV,MAAM,WAAS,YAAU,QAAQ;QACjC,SAAS,UAAQ,CAAC,YAAU,YAAY,MAAM,IAAI;QAClD;QACA;QACA,UAAU,WAAW,UAAU,KAAK;OACrC;AACD;;AAGF,gBAAY,KAAK;;AAGnB,SAAO;AACT;AA7GgB;AA4PV,SAAU,MACd,KACA,SAAwE;AAExE,MAAM,OAAc,CAAA;AACpB,MAAM,KAAK,aAAa,KAAK,MAAM,OAAO;AAC1C,SAAO,iBAAoB,IAAI,MAAM,OAAO;AAC9C;AAPgB;AAYV,SAAU,iBACd,IACA,MACA,SAAqC;AAArC,MAAA,YAAA,QAAA;AAAA,cAAA,CAAA;EAAqC;AAE7B,MAAA,KAA8B,QAAO,QAArC,SAAM,OAAA,SAAG,SAAC,GAAS;AAAK,WAAA;EAAA,IAAC;AAEjC,SAAO,SAAU,UAAgB;AAC/B,QAAM,IAAI,GAAG,KAAK,QAAQ;AAC1B,QAAI,CAAC;AAAG,aAAO;AAEP,QAAG,OAAgB,EAAC,CAAA,GAAX,QAAU,EAAC;AAC5B,QAAM,SAAS,uBAAO,OAAO,IAAI;kDAExBC,IAAC;AACR,UAAI,EAAEA,EAAC,MAAM;;AAEb,UAAM,MAAM,KAAKA,KAAI,CAAC;AAEtB,UAAI,IAAI,aAAa,OAAO,IAAI,aAAa,KAAK;AAChD,eAAO,IAAI,IAAI,IAAI,EAAEA,EAAC,EAAE,MAAM,IAAI,SAAS,IAAI,MAAM,EAAE,IAAI,SAAC,OAAK;AAC/D,iBAAO,OAAO,OAAO,GAAG;QAC1B,CAAC;aACI;AACL,eAAO,IAAI,IAAI,IAAI,OAAO,EAAEA,EAAC,GAAG,GAAG;;;AAVvC,aAAS,IAAI,GAAG,IAAI,EAAE,QAAQ,KAAG;cAAxB,CAAC;;AAcV,WAAO,EAAE,MAAM,OAAO,OAAM;EAC9B;AACF;AA9BgB;AAmChB,SAAS,aAAa,KAAW;AAC/B,SAAO,IAAI,QAAQ,6BAA6B,MAAM;AACxD;AAFS;AAOT,SAAS,MAAM,SAAiC;AAC9C,SAAO,WAAW,QAAQ,YAAY,KAAK;AAC7C;AAFS;AAuBT,SAAS,eAAe,MAAc,MAAY;AAChD,MAAI,CAAC;AAAM,WAAO;AAElB,MAAM,cAAc;AAEpB,MAAI,QAAQ;AACZ,MAAI,aAAa,YAAY,KAAK,KAAK,MAAM;AAC7C,SAAO,YAAY;AACjB,SAAK,KAAK;;MAER,MAAM,WAAW,CAAC,KAAK;MACvB,QAAQ;MACR,QAAQ;MACR,UAAU;MACV,SAAS;KACV;AACD,iBAAa,YAAY,KAAK,KAAK,MAAM;;AAG3C,SAAO;AACT;AApBS;AAyBT,SAAS,cACP,OACA,MACA,SAA8C;AAE9C,MAAM,QAAQ,MAAM,IAAI,SAAC,MAAI;AAAK,WAAA,aAAa,MAAM,MAAM,OAAO,EAAE;EAAlC,CAAwC;AAC1E,SAAO,IAAI,OAAO,MAAA,OAAM,MAAM,KAAK,GAAG,GAAC,GAAA,GAAK,MAAM,OAAO,CAAC;AAC5D;AAPS;AAYT,SAAS,eACP,MACA,MACA,SAA8C;AAE9C,SAAO,eAAe,MAAM,MAAM,OAAO,GAAG,MAAM,OAAO;AAC3D;AANS;AA0CH,SAAU,eACd,QACA,MACA,SAAmC;AAAnC,MAAA,YAAA,QAAA;AAAA,cAAA,CAAA;EAAmC;AAGjC,MAAA,KAME,QAAO,QANT,SAAM,OAAA,SAAG,QAAK,IACd,KAKE,QAAO,OALT,QAAK,OAAA,SAAG,OAAI,IACZ,KAIE,QAAO,KAJT,MAAG,OAAA,SAAG,OAAI,IACV,KAGE,QAAO,QAHT,SAAM,OAAA,SAAG,SAAC,GAAS;AAAK,WAAA;EAAA,IAAC,IACzB,KAEE,QAAO,WAFT,YAAS,OAAA,SAAG,QAAK,IACjB,KACE,QAAO,UADT,WAAQ,OAAA,SAAG,KAAE;AAEf,MAAM,aAAa,IAAA,OAAI,aAAa,QAAQ,GAAC,KAAA;AAC7C,MAAM,cAAc,IAAA,OAAI,aAAa,SAAS,GAAC,GAAA;AAC/C,MAAI,QAAQ,QAAQ,MAAM;AAG1B,WAAoB,KAAA,GAAA,WAAA,QAAA,KAAA,SAAA,QAAA,MAAQ;AAAvB,QAAM,QAAK,SAAA,EAAA;AACd,QAAI,OAAO,UAAU,UAAU;AAC7B,eAAS,aAAa,OAAO,KAAK,CAAC;WAC9B;AACL,UAAM,SAAS,aAAa,OAAO,MAAM,MAAM,CAAC;AAChD,UAAM,SAAS,aAAa,OAAO,MAAM,MAAM,CAAC;AAEhD,UAAI,MAAM,SAAS;AACjB,YAAI;AAAM,eAAK,KAAK,KAAK;AAEzB,YAAI,UAAU,QAAQ;AACpB,cAAI,MAAM,aAAa,OAAO,MAAM,aAAa,KAAK;AACpD,gBAAM,MAAM,MAAM,aAAa,MAAM,MAAM;AAC3C,qBAAS,MAAA,OAAM,QAAM,MAAA,EAAA,OAAO,MAAM,SAAO,MAAA,EAAA,OAAO,MAAM,EAAA,OAAG,QAAM,KAAA,EAAA,OAAM,MAAM,SAAO,MAAA,EAAA,OAAO,QAAM,GAAA,EAAA,OAAI,GAAG;iBACjG;AACL,qBAAS,MAAA,OAAM,QAAM,GAAA,EAAA,OAAI,MAAM,SAAO,GAAA,EAAA,OAAI,QAAM,GAAA,EAAA,OAAI,MAAM,QAAQ;;eAE/D;AACL,cAAI,MAAM,aAAa,OAAO,MAAM,aAAa,KAAK;AACpD,kBAAM,IAAI,UACR,mBAAA,OAAmB,MAAM,MAAI,+BAAA,CAA+B;;AAIhE,mBAAS,IAAA,OAAI,MAAM,SAAO,GAAA,EAAA,OAAI,MAAM,QAAQ;;aAEzC;AACL,iBAAS,MAAA,OAAM,MAAM,EAAA,OAAG,QAAM,GAAA,EAAA,OAAI,MAAM,QAAQ;;;;AAKtD,MAAI,KAAK;AACP,QAAI,CAAC;AAAQ,eAAS,GAAA,OAAG,aAAW,GAAA;AAEpC,aAAS,CAAC,QAAQ,WAAW,MAAM,MAAA,OAAM,YAAU,GAAA;SAC9C;AACL,QAAM,WAAW,OAAO,OAAO,SAAS,CAAC;AACzC,QAAM,iBACJ,OAAO,aAAa,WAChB,YAAY,QAAQ,SAAS,SAAS,SAAS,CAAC,CAAC,IAAI,KACrD,aAAa;AAEnB,QAAI,CAAC,QAAQ;AACX,eAAS,MAAA,OAAM,aAAW,KAAA,EAAA,OAAM,YAAU,KAAA;;AAG5C,QAAI,CAAC,gBAAgB;AACnB,eAAS,MAAA,OAAM,aAAW,GAAA,EAAA,OAAI,YAAU,GAAA;;;AAI5C,SAAO,IAAI,OAAO,OAAO,MAAM,OAAO,CAAC;AACzC;AAvEgB;AAqFV,SAAU,aACd,MACA,MACA,SAA8C;AAE9C,MAAI,gBAAgB;AAAQ,WAAO,eAAe,MAAM,IAAI;AAC5D,MAAI,MAAM,QAAQ,IAAI;AAAG,WAAO,cAAc,MAAM,MAAM,OAAO;AACjE,SAAO,eAAe,MAAM,MAAM,OAAO;AAC3C;AARgB;;;ACrnBhB,IAAM,cAAc;AAwDpB,UAAU,eAAe,SAAkB;AAC1C,QAAM,cAAc,IAAI,IAAI,QAAQ,GAAG,EAAE;AAGzC,aAAW,SAAS,CAAC,GAAG,MAAM,EAAE,QAAQ,GAAG;AAC1C,QAAI,MAAM,UAAU,MAAM,WAAW,QAAQ,QAAQ;AACpD;AAAA,IACD;AAGA,UAAM,eAAe,MAAM,MAAM,UAAU,QAAQ,aAAa,MAAM,GAAG;AAAA,MACxE,KAAK;AAAA,IACN,CAAC;AACD,UAAM,eAAe,MAAM,MAAM,UAAU,QAAQ,aAAa,MAAM,GAAG;AAAA,MACxE,KAAK;AAAA,IACN,CAAC;AACD,UAAM,cAAc,aAAa,WAAW;AAC5C,UAAM,mBAAmB,aAAa,WAAW;AACjD,QAAI,eAAe,kBAAkB;AACpC,iBAAW,WAAW,MAAM,YAAY,KAAK,GAAG;AAC/C,cAAM;AAAA,UACL;AAAA,UACA,QAAQ,YAAY;AAAA,UACpB,MAAM,iBAAiB;AAAA,QACxB;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAGA,aAAW,SAAS,QAAQ;AAC3B,QAAI,MAAM,UAAU,MAAM,WAAW,QAAQ,QAAQ;AACpD;AAAA,IACD;AACA,UAAM,eAAe,MAAM,MAAM,UAAU,QAAQ,aAAa,MAAM,GAAG;AAAA,MACxE,KAAK;AAAA,IACN,CAAC;AACD,UAAM,eAAe,MAAM,MAAM,UAAU,QAAQ,aAAa,MAAM,GAAG;AAAA,MACxE,KAAK;AAAA,IACN,CAAC;AACD,UAAM,cAAc,aAAa,WAAW;AAC5C,UAAM,mBAAmB,aAAa,WAAW;AACjD,QAAI,eAAe,oBAAoB,MAAM,QAAQ,QAAQ;AAC5D,iBAAW,WAAW,MAAM,QAAQ,KAAK,GAAG;AAC3C,cAAM;AAAA,UACL;AAAA,UACA,QAAQ,YAAY;AAAA,UACpB,MAAM,YAAY;AAAA,QACnB;AAAA,MACD;AACA;AAAA,IACD;AAAA,EACD;AACD;AArDU;AAuDV,IAAO,gCAAQ;AAAA,EACd,MAAM,MACL,iBACA,KACA,eACC;AACD,QAAI,UAAU;AACd,UAAM,kBAAkB,eAAe,OAAO;AAC9C,QAAI,OAAO,CAAC;AACZ,QAAI,aAAa;AAEjB,UAAM,OAAO,8BAAO,OAAqB,SAAuB;AAC/D,UAAI,UAAU,QAAW;AACxB,YAAI,MAAM;AACV,YAAI,OAAO,UAAU,UAAU;AAC9B,gBAAM,IAAI,IAAI,OAAO,QAAQ,GAAG,EAAE,SAAS;AAAA,QAC5C;AACA,kBAAU,IAAI,QAAQ,KAAK,IAAI;AAAA,MAChC;AAEA,YAAM,SAAS,gBAAgB,KAAK;AAEpC,UAAI,OAAO,SAAS,OAAO;AAC1B,cAAM,EAAE,SAAS,QAAQ,KAAK,IAAI,OAAO;AACzC,cAAM,UAAU;AAAA,UACf,SAAS,IAAI,QAAQ,QAAQ,MAAM,CAAC;AAAA,UACpC,cAAc;AAAA,UACd;AAAA,UACA;AAAA,UACA,IAAI,OAAO;AACV,mBAAO;AAAA,UACR;AAAA,UACA,IAAI,KAAK,OAAO;AACf,gBAAI,OAAO,UAAU,YAAY,UAAU,MAAM;AAChD,oBAAM,IAAI,MAAM,gCAAgC;AAAA,YACjD;AAEA,mBAAO;AAAA,UACR;AAAA,UACA;AAAA,UACA,WAAW,cAAc,UAAU,KAAK,aAAa;AAAA,UACrD,wBAAwB,6BAAM;AAC7B,yBAAa;AAAA,UACd,GAFwB;AAAA,QAGzB;AAEA,cAAM,WAAW,MAAM,QAAQ,OAAO;AAEtC,YAAI,EAAE,oBAAoB,WAAW;AACpC,gBAAM,IAAI,MAAM,8CAA8C;AAAA,QAC/D;AAEA,eAAO,cAAc,QAAQ;AAAA,MAC9B,WAAW,UAAsB;AAEhC,cAAM,WAAW,MAAM,IAAI,QAAoB,EAAE,MAAM,OAAO;AAC9D,eAAO,cAAc,QAAQ;AAAA,MAC9B,OAAO;AAEN,cAAM,WAAW,MAAM,MAAM,OAAO;AACpC,eAAO,cAAc,QAAQ;AAAA,MAC9B;AAAA,IACD,GAnDa;AAqDb,QAAI;AACH,aAAO,MAAM,KAAK;AAAA,IACnB,SAAS,OAAO;AACf,UAAI,YAAY;AACf,cAAM,WAAW,MAAM,IAAI,QAAoB,EAAE,MAAM,OAAO;AAC9D,eAAO,cAAc,QAAQ;AAAA,MAC9B;AAEA,YAAM;AAAA,IACP;AAAA,EACD;AACD;AAGA,IAAM,gBAAgB,wBAAC;AAAA;AAAA,EAEtB,IAAI;AAAA,IACH,CAAC,KAAK,KAAK,KAAK,GAAG,EAAE,SAAS,SAAS,MAAM,IAAI,OAAO,SAAS;AAAA,IACjE;AAAA,EACD;AAAA,GALqB;;;AC9LtB,IAAM,YAAwB,8BAAO,SAAS,KAAK,MAAM,kBAAkB;AAC1E,MAAI;AACH,WAAO,MAAM,cAAc,KAAK,SAAS,GAAG;AAAA,EAC7C,UAAE;AACD,QAAI;AACH,UAAI,QAAQ,SAAS,QAAQ,CAAC,QAAQ,UAAU;AAC/C,cAAM,SAAS,QAAQ,KAAK,UAAU;AACtC,eAAO,EAAE,MAAM,OAAO,KAAK,GAAG,MAAM;AAAA,QAAC;AAAA,MACtC;AAAA,IACD,SAAS,GAAG;AACX,cAAQ,MAAM,4CAA4C,CAAC;AAAA,IAC5D;AAAA,EACD;AACD,GAb8B;AAe9B,IAAO,6CAAQ;;;ACRf,SAAS,YAAY,GAAmB;AACvC,SAAO;AAAA,IACN,MAAM,GAAG;AAAA,IACT,SAAS,GAAG,WAAW,OAAO,CAAC;AAAA,IAC/B,OAAO,GAAG;AAAA,IACV,OAAO,GAAG,UAAU,SAAY,SAAY,YAAY,EAAE,KAAK;AAAA,EAChE;AACD;AAPS;AAUT,IAAM,YAAwB,8BAAO,SAAS,KAAK,MAAM,kBAAkB;AAC1E,MAAI;AACH,WAAO,MAAM,cAAc,KAAK,SAAS,GAAG;AAAA,EAC7C,SAAS,GAAQ;AAChB,UAAM,QAAQ,YAAY,CAAC;AAC3B,WAAO,SAAS,KAAK,OAAO;AAAA,MAC3B,QAAQ;AAAA,MACR,SAAS,EAAE,+BAA+B,OAAO;AAAA,IAClD,CAAC;AAAA,EACF;AACD,GAV8B;AAY9B,IAAO,2CAAQ;;;ACzBJ,IAAM,mCAAmC;AAAA,EAE9B;AAAA,EAAyB;AAC3C;AACA,IAAO,sCAAQ;;;ACcnB,IAAM,wBAAsC,CAAC;AAKtC,SAAS,uBAAuB,MAAqC;AAC3E,wBAAsB,KAAK,GAAG,KAAK,KAAK,CAAC;AAC1C;AAFgB;AAShB,SAAS,uBACR,SACA,KACA,KACA,UACA,iBACsB;AACtB,QAAM,CAAC,MAAM,GAAG,IAAI,IAAI;AACxB,QAAM,gBAAmC;AAAA,IACxC;AAAA,IACA,KAAK,YAAY,QAAQ;AACxB,aAAO,uBAAuB,YAAY,QAAQ,KAAK,UAAU,IAAI;AAAA,IACtE;AAAA,EACD;AACA,SAAO,KAAK,SAAS,KAAK,KAAK,aAAa;AAC7C;AAfS;AAiBF,SAAS,kBACf,SACA,KACA,KACA,UACA,iBACsB;AACtB,SAAO,uBAAuB,SAAS,KAAK,KAAK,UAAU;AAAA,IAC1D,GAAG;AAAA,IACH;AAAA,EACD,CAAC;AACF;AAXgB;;;AC3ChB,IAAM,iCAAN,MAAM,gCAA8D;AAAA,EAGnE,YACU,eACA,MACT,SACC;AAHQ;AACA;AAGT,SAAK,WAAW;AAAA,EACjB;AAAA,EArBD,OAYoE;AAAA;AAAA;AAAA,EAC1D;AAAA,EAUT,UAAU;AACT,QAAI,EAAE,gBAAgB,kCAAiC;AACtD,YAAM,IAAI,UAAU,oBAAoB;AAAA,IACzC;AAEA,SAAK,SAAS;AAAA,EACf;AACD;AAEA,SAAS,oBAAoB,QAA0C;AAEtE,MACC,qCAAqC,UACrC,iCAAiC,WAAW,GAC3C;AACD,WAAO;AAAA,EACR;AAEA,aAAW,cAAc,kCAAkC;AAC1D,wBAAoB,UAAU;AAAA,EAC/B;AAEA,QAAM,kBAA+C,gCACpD,SACA,KACA,KACC;AACD,QAAI,OAAO,UAAU,QAAW;AAC/B,YAAM,IAAI,MAAM,6CAA6C;AAAA,IAC9D;AACA,WAAO,OAAO,MAAM,SAAS,KAAK,GAAG;AAAA,EACtC,GATqD;AAWrD,SAAO;AAAA,IACN,GAAG;AAAA,IACH,MAAM,SAAS,KAAK,KAAK;AACxB,YAAM,aAAyB,gCAAU,MAAM,MAAM;AACpD,YAAI,SAAS,eAAe,OAAO,cAAc,QAAW;AAC3D,gBAAM,aAAa,IAAI;AAAA,YACtB,KAAK,IAAI;AAAA,YACT,KAAK,QAAQ;AAAA,YACb,MAAM;AAAA,YAAC;AAAA,UACR;AACA,iBAAO,OAAO,UAAU,YAAY,KAAK,GAAG;AAAA,QAC7C;AAAA,MACD,GAT+B;AAU/B,aAAO,kBAAkB,SAAS,KAAK,KAAK,YAAY,eAAe;AAAA,IACxE;AAAA,EACD;AACD;AAxCS;AA0CT,SAAS,qBACR,OAC8B;AAE9B,MACC,qCAAqC,UACrC,iCAAiC,WAAW,GAC3C;AACD,WAAO;AAAA,EACR;AAEA,aAAW,cAAc,kCAAkC;AAC1D,wBAAoB,UAAU;AAAA,EAC/B;AAGA,SAAO,cAAc,MAAM;AAAA,IAC1B,mBAAyE,wBACxE,SACA,KACA,QACI;AACJ,WAAK,MAAM;AACX,WAAK,MAAM;AACX,UAAI,MAAM,UAAU,QAAW;AAC9B,cAAM,IAAI,MAAM,sDAAsD;AAAA,MACvE;AACA,aAAO,MAAM,MAAM,OAAO;AAAA,IAC3B,GAXyE;AAAA,IAazE,cAA0B,wBAAC,MAAM,SAAS;AACzC,UAAI,SAAS,eAAe,MAAM,cAAc,QAAW;AAC1D,cAAM,aAAa,IAAI;AAAA,UACtB,KAAK,IAAI;AAAA,UACT,KAAK,QAAQ;AAAA,UACb,MAAM;AAAA,UAAC;AAAA,QACR;AACA,eAAO,MAAM,UAAU,UAAU;AAAA,MAClC;AAAA,IACD,GAT0B;AAAA,IAW1B,MAAM,SAAwD;AAC7D,aAAO;AAAA,QACN;AAAA,QACA,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,MACN;AAAA,IACD;AAAA,EACD;AACD;AAnDS;AAqDT,IAAI;AACJ,IAAI,OAAO,wCAAU,UAAU;AAC9B,kBAAgB,oBAAoB,mCAAK;AAC1C,WAAW,OAAO,wCAAU,YAAY;AACvC,kBAAgB,qBAAqB,mCAAK;AAC3C;AACA,IAAO,kCAAQ;",
  "names": ["match", "match", "match", "match", "onRequestPost", "onRequestOptions", "onRequestPost", "onRequestGet", "onRequestPost", "onRequestGet", "onRequestOptions", "match", "onRequestGet", "onRequestPost", "onRequestOptions", "onRequestPost", "onRequestPost", "onRequestOptions", "onRequestPost", "onRequestGet", "value", "_a", "result", "char", "prefix", "i"]
}
