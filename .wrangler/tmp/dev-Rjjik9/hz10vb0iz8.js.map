{
  "version": 3,
  "sources": ["../bundle-TGYKaw/checked-fetch.js", "../bundle-fSEAcT/checked-fetch.js", "../../../functions/api/auth/github.ts", "../../../functions/api/auth/google.ts", "../../../functions/api/auth/linkedin.ts", "../../../functions/lib/email-service.ts", "../../../functions/api/auth.ts", "../../../functions/lib/hybrid-rag-service.ts", "../../../functions/api/chat.ts", "../../../functions/lib/company-analysis-formatter.ts", "../../../functions/api/chat-optimized.ts", "../../../functions/api/feishu-webhook.ts", "../../../functions/api/projects.ts", "../../../functions/lib/free-tier-manager.ts", "../../../functions/api/quota-status.ts", "../../../functions/api/subscribe.ts", "../../../functions/lib/conversation-context.ts", "../../../functions/api/suggestions.ts", "../../../functions/webhook/feishu.js", "../../../functions/scheduled-sync.ts", "../../../functions/_middleware.ts", "../pages-OJR4sx/functionsRoutes-0.8041946199199985.mjs", "../bundle-fSEAcT/middleware-loader.entry.ts", "../bundle-fSEAcT/middleware-insertion-facade.js", "../../../node_modules/wrangler/templates/pages-template-worker.ts", "../../../node_modules/path-to-regexp/src/index.ts", "../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../../../node_modules/wrangler/templates/middleware/common.ts", "../../../node_modules/wrangler/templates/pages-dev-util.ts", "<define:__ROUTES__>", "../../../node_modules/wrangler/templates/pages-dev-pipeline.ts", "../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-TGYKaw/middleware-insertion-facade.js", "../../../node_modules/wrangler/templates/middleware/common.ts", "../bundle-TGYKaw/middleware-loader.entry.ts"],
  "sourceRoot": "/home/lium/chatsvtr/.wrangler/tmp/dev-Rjjik9",
  "sourcesContent": ["const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "/**\n * GitHub OAuth \u8BA4\u8BC1\u96C6\u6210\n * \u652F\u6301GitHub\u8D26\u53F7\u767B\u5F55SVTR\u5E73\u53F0\n */\n\ninterface GitHubUserInfo {\n  id: number;\n  login: string;\n  email: string | null;\n  name: string | null;\n  avatar_url: string;\n  bio: string | null;\n  company: string | null;\n  location: string | null;\n  public_repos: number;\n  followers: number;\n  following: number;\n  created_at: string;\n}\n\ninterface GitHubTokenResponse {\n  access_token: string;\n  token_type: string;\n  scope: string;\n}\n\ninterface GitHubEmail {\n  email: string;\n  primary: boolean;\n  verified: boolean;\n  visibility: string | null;\n}\n\n// \u83B7\u53D6GitHub\u7528\u6237\u7684\u4E3B\u90AE\u7BB1\nasync function getGitHubPrimaryEmail(accessToken: string): Promise<string | null> {\n  try {\n    const emailResponse = await fetch('https://api.github.com/user/emails', {\n      headers: {\n        'Authorization': `token ${accessToken}`,\n        'User-Agent': 'SVTR-App',\n        'Accept': 'application/vnd.github.v3+json'\n      }\n    });\n    \n    if (!emailResponse.ok) {\n      console.error('GitHub\u90AE\u7BB1\u83B7\u53D6\u5931\u8D25:', await emailResponse.text());\n      return null;\n    }\n    \n    const emails: GitHubEmail[] = await emailResponse.json();\n    const primaryEmail = emails.find(email => email.primary && email.verified);\n    \n    return primaryEmail?.email || null;\n  } catch (error) {\n    console.error('\u83B7\u53D6GitHub\u90AE\u7BB1\u5931\u8D25:', error);\n    return null;\n  }\n}\n\n// \u521B\u5EFA\u6216\u66F4\u65B0\u7528\u6237\nasync function createOrUpdateGitHubUser(env: any, githubUser: GitHubUserInfo, email: string): Promise<any> {\n  const existingUserData = await env.SVTR_CACHE.get(`user_${email}`);\n  \n  const userData = {\n    email,\n    name: githubUser.name || githubUser.login,\n    avatar: githubUser.avatar_url,\n    provider: 'github' as const,\n    githubProfile: {\n      login: githubUser.login,\n      company: githubUser.company,\n      location: githubUser.location,\n      bio: githubUser.bio,\n      publicRepos: githubUser.public_repos,\n      followers: githubUser.followers\n    }\n  };\n  \n  if (existingUserData) {\n    // \u66F4\u65B0\u73B0\u6709\u7528\u6237\n    const existingUser = JSON.parse(existingUserData);\n    const updatedUser = {\n      ...existingUser,\n      ...userData,\n      lastLoginAt: new Date().toISOString()\n    };\n    \n    await env.SVTR_CACHE.put(`user_${email}`, JSON.stringify(updatedUser));\n    await env.SVTR_CACHE.put(`user_id_${updatedUser.id}`, JSON.stringify(updatedUser));\n    \n    return updatedUser;\n  } else {\n    // \u521B\u5EFA\u65B0\u7528\u6237\n    const newUser = {\n      id: `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      ...userData,\n      createdAt: new Date().toISOString(),\n      lastLoginAt: new Date().toISOString(),\n      isActive: true\n    };\n    \n    await env.SVTR_CACHE.put(`user_${email}`, JSON.stringify(newUser));\n    await env.SVTR_CACHE.put(`user_id_${newUser.id}`, JSON.stringify(newUser));\n    \n    return newUser;\n  }\n}\n\n// \u521B\u5EFA\u7528\u6237\u4F1A\u8BDD\nasync function createUserSession(env: any, user: any): Promise<string> {\n  const sessionToken = crypto.randomUUID() + '_' + Math.random().toString(36).substr(2, 16);\n  const expiresAt = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(); // 30\u5929\u8FC7\u671F\n  \n  const session = {\n    userId: user.id,\n    email: user.email,\n    token: sessionToken,\n    expiresAt,\n    createdAt: new Date().toISOString()\n  };\n  \n  await env.SVTR_CACHE.put(`session_${sessionToken}`, JSON.stringify(session), {\n    expirationTtl: 30 * 24 * 60 * 60 // 30\u5929\n  });\n  \n  return sessionToken;\n}\n\n// \u83B7\u53D6\u5F53\u524D\u57DF\u540D\nfunction getCurrentDomain(request: Request, env: any): string {\n  const requestUrl = new URL(request.url);\n  const hostname = requestUrl.hostname;\n  \n  // \u652F\u6301\u7684\u57DF\u540D\u5217\u8868\n  const allowedDomains = [\n    'svtr.ai',\n    'svtrai.com', \n    'svtr.cn',\n    'svtrglobal.com',\n    'chatsvtr.pages.dev',\n    'localhost'  // \u652F\u6301\u6240\u6709\u672C\u5730\u7AEF\u53E3\n  ];\n  \n  // \u68C0\u67E5\u5F53\u524D\u57DF\u540D\u662F\u5426\u5728\u5141\u8BB8\u5217\u8868\u4E2D\n  for (const domain of allowedDomains) {\n    if (hostname.includes(domain.split(':')[0])) {\n      return requestUrl.protocol + '//' + requestUrl.host;\n    }\n  }\n  \n  // \u9ED8\u8BA4\u8FD4\u56DE\u914D\u7F6E\u7684\u4E3B\u57DF\u540D\n  return env.APP_URL || 'https://svtr.ai';\n}\n\n// \u5904\u7406GET\u8BF7\u6C42 - \u53D1\u8D77OAuth\u6D41\u7A0B\u548C\u5904\u7406\u56DE\u8C03\nexport async function onRequestGet(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    const url = new URL(request.url);\n    const code = url.searchParams.get('code');\n    const error = url.searchParams.get('error');\n    const state = url.searchParams.get('state');\n    \n    // \u83B7\u53D6\u5F53\u524D\u8BBF\u95EE\u7684\u57DF\u540D\n    const currentDomain = getCurrentDomain(request, env);\n    console.log('GitHub OAuth\u8BF7\u6C42:', { code: !!code, error, state, domain: currentDomain });\n    \n    // \u68C0\u67E5\u662F\u5426\u6709\u9519\u8BEF\n    if (error) {\n      console.error('GitHub OAuth\u9519\u8BEF:', error);\n      return Response.redirect(`${currentDomain}?auth_error=${encodeURIComponent(error)}`);\n    }\n    \n    // \u5982\u679C\u6709\u6388\u6743\u7801\uFF0C\u5904\u7406\u56DE\u8C03\n    if (code) {\n      try {\n        // \u89E3\u6790state\u4E2D\u7684\u539F\u59CB\u57DF\u540D\n        let originalDomain = currentDomain;\n        if (state) {\n          try {\n            const stateData = JSON.parse(atob(state));\n            originalDomain = stateData.originalDomain || currentDomain;\n            console.log('GitHub OAuth\u56DE\u8C03\uFF0C\u539F\u59CB\u57DF\u540D:', originalDomain);\n          } catch (e) {\n            console.warn('\u65E0\u6CD5\u89E3\u6790state\u53C2\u6570:', e);\n          }\n        }\n        // \u6B65\u9AA41: \u7528\u6388\u6743\u7801\u6362\u53D6\u8BBF\u95EE\u4EE4\u724C\n        const tokenResponse = await fetch('https://github.com/login/oauth/access_token', {\n          method: 'POST',\n          headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            client_id: env.GITHUB_CLIENT_ID,\n            client_secret: env.GITHUB_CLIENT_SECRET,\n            code\n          })\n        });\n        \n        if (!tokenResponse.ok) {\n          const errorText = await tokenResponse.text();\n          console.error('GitHub token exchange\u5931\u8D25:', errorText);\n          return Response.redirect(`${originalDomain}?auth_error=token_exchange_failed`);\n        }\n        \n        const tokens: GitHubTokenResponse = await tokenResponse.json();\n        console.log('GitHub tokens\u83B7\u53D6\u6210\u529F');\n        \n        // \u6B65\u9AA42: \u4F7F\u7528\u8BBF\u95EE\u4EE4\u724C\u83B7\u53D6\u7528\u6237\u4FE1\u606F\n        const userResponse = await fetch('https://api.github.com/user', {\n          headers: {\n            'Authorization': `token ${tokens.access_token}`,\n            'User-Agent': 'SVTR-App',\n            'Accept': 'application/vnd.github.v3+json'\n          }\n        });\n        \n        if (!userResponse.ok) {\n          const errorText = await userResponse.text();\n          console.error('GitHub\u7528\u6237\u4FE1\u606F\u83B7\u53D6\u5931\u8D25:', errorText);\n          return Response.redirect(`${originalDomain}?auth_error=user_info_failed`);\n        }\n        \n        const githubUser: GitHubUserInfo = await userResponse.json();\n        console.log('GitHub\u7528\u6237\u4FE1\u606F:', { login: githubUser.login, name: githubUser.name });\n        \n        // \u6B65\u9AA43: \u83B7\u53D6\u7528\u6237\u90AE\u7BB1\uFF08GitHub\u7528\u6237\u4FE1\u606F\u4E2D\u7684email\u53EF\u80FD\u4E3A\u7A7A\uFF09\n        let email = githubUser.email;\n        if (!email) {\n          email = await getGitHubPrimaryEmail(tokens.access_token);\n        }\n        \n        if (!email) {\n          console.error('\u65E0\u6CD5\u83B7\u53D6GitHub\u7528\u6237\u90AE\u7BB1');\n          return Response.redirect(`${originalDomain}?auth_error=no_email`);\n        }\n        \n        // \u6B65\u9AA44: \u521B\u5EFA\u6216\u66F4\u65B0\u672C\u5730\u7528\u6237\n        const user = await createOrUpdateGitHubUser(env, githubUser, email);\n        \n        // \u6B65\u9AA45: \u521B\u5EFA\u4F1A\u8BDD\n        const sessionToken = await createUserSession(env, user);\n        \n        // \u6B65\u9AA46: \u91CD\u5B9A\u5411\u5230\u524D\u7AEF\uFF0C\u643A\u5E26\u4F1A\u8BDDtoken\n        const redirectUrl = new URL(originalDomain);\n        redirectUrl.searchParams.set('auth_success', 'true');\n        redirectUrl.searchParams.set('token', sessionToken);\n        redirectUrl.searchParams.set('user', JSON.stringify({\n          id: user.id,\n          email: user.email,\n          name: user.name,\n          avatar: user.avatar\n        }));\n        \n        return Response.redirect(redirectUrl.toString());\n        \n      } catch (error) {\n        console.error('GitHub OAuth\u56DE\u8C03\u5904\u7406\u5931\u8D25:', error);\n        return Response.redirect(`${originalDomain}?auth_error=callback_failed`);\n      }\n    }\n    \n    // \u5982\u679C\u6CA1\u6709\u6388\u6743\u7801\uFF0C\u53D1\u8D77OAuth\u6D41\u7A0B\n    const authUrl = new URL('https://github.com/login/oauth/authorize');\n    authUrl.searchParams.set('client_id', env.GITHUB_CLIENT_ID);\n    \n    // \u4F7F\u7528\u7EDF\u4E00\u56DE\u8C03\u57DF\u540D\u7B56\u7565\uFF0C\u89E3\u51B3GitHub OAuth\u591A\u57DF\u540D\u95EE\u9898\n    const unifiedCallbackDomain = env.APP_URL || 'https://svtr.ai';\n    authUrl.searchParams.set('redirect_uri', `${unifiedCallbackDomain}/api/auth/github`);\n    authUrl.searchParams.set('scope', 'user:email read:user');\n    \n    // \u5728state\u4E2D\u4FDD\u5B58\u539F\u59CB\u57DF\u540D\uFF0C\u7528\u4E8E\u56DE\u8C03\u540E\u91CD\u5B9A\u5411\n    const stateData = {\n      csrf: crypto.randomUUID(),\n      originalDomain: currentDomain\n    };\n    authUrl.searchParams.set('state', btoa(JSON.stringify(stateData))); // Base64\u7F16\u7801\n    \n    console.log('\u91CD\u5B9A\u5411\u5230GitHub\u6388\u6743\u9875\u9762');\n    console.log('- redirect_uri:', `${unifiedCallbackDomain}/api/auth/github`);\n    console.log('- \u539F\u59CB\u57DF\u540D:', currentDomain);\n    return Response.redirect(authUrl.toString());\n    \n  } catch (error) {\n    console.error('GitHub OAuth\u5904\u7406\u5931\u8D25:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      message: 'GitHub\u767B\u5F55\u5931\u8D25',\n      error: String(error)\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n  }\n}\n\n// \u5904\u7406OPTIONS\u8BF7\u6C42 - CORS\nexport async function onRequestOptions(): Promise<Response> {\n  return new Response(null, {\n    status: 200,\n    headers: {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n      'Access-Control-Max-Age': '86400',\n    }\n  });\n}", "/**\n * Google OAuth 2.0 \u8BA4\u8BC1\u96C6\u6210\n * \u652F\u6301Google\u8D26\u53F7\u767B\u5F55SVTR\u5E73\u53F0\n */\n\ninterface GoogleUserInfo {\n  id: string;\n  email: string;\n  verified_email: boolean;\n  name: string;\n  given_name: string;\n  family_name: string;\n  picture: string;\n  locale: string;\n}\n\ninterface GoogleTokenResponse {\n  access_token: string;\n  expires_in: number;\n  token_type: string;\n  scope: string;\n  id_token: string;\n}\n\n// \u521B\u5EFA\u6216\u66F4\u65B0\u7528\u6237\uFF08\u590D\u7528auth.ts\u7684\u903B\u8F91\uFF09\nasync function createOrUpdateGoogleUser(env: any, googleUser: GoogleUserInfo): Promise<any> {\n  const existingUserData = await env.SVTR_CACHE.get(`user_${googleUser.email}`);\n  \n  const userData = {\n    email: googleUser.email,\n    name: googleUser.name,\n    avatar: googleUser.picture,\n    provider: 'google' as const\n  };\n  \n  if (existingUserData) {\n    // \u66F4\u65B0\u73B0\u6709\u7528\u6237\n    const existingUser = JSON.parse(existingUserData);\n    const updatedUser = {\n      ...existingUser,\n      ...userData,\n      lastLoginAt: new Date().toISOString()\n    };\n    \n    await env.SVTR_CACHE.put(`user_${googleUser.email}`, JSON.stringify(updatedUser));\n    await env.SVTR_CACHE.put(`user_id_${updatedUser.id}`, JSON.stringify(updatedUser));\n    \n    return updatedUser;\n  } else {\n    // \u521B\u5EFA\u65B0\u7528\u6237\n    const newUser = {\n      id: `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      ...userData,\n      createdAt: new Date().toISOString(),\n      lastLoginAt: new Date().toISOString(),\n      isActive: true\n    };\n    \n    await env.SVTR_CACHE.put(`user_${googleUser.email}`, JSON.stringify(newUser));\n    await env.SVTR_CACHE.put(`user_id_${newUser.id}`, JSON.stringify(newUser));\n    \n    return newUser;\n  }\n}\n\n// \u521B\u5EFA\u7528\u6237\u4F1A\u8BDD\nasync function createUserSession(env: any, user: any): Promise<string> {\n  const sessionToken = crypto.randomUUID() + '_' + Math.random().toString(36).substr(2, 16);\n  const expiresAt = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(); // 30\u5929\u8FC7\u671F\n  \n  const session = {\n    userId: user.id,\n    email: user.email,\n    token: sessionToken,\n    expiresAt,\n    createdAt: new Date().toISOString()\n  };\n  \n  await env.SVTR_CACHE.put(`session_${sessionToken}`, JSON.stringify(session), {\n    expirationTtl: 30 * 24 * 60 * 60 // 30\u5929\n  });\n  \n  return sessionToken;\n}\n\n// \u83B7\u53D6\u5F53\u524D\u57DF\u540D\nfunction getCurrentDomain(request: Request, env: any): string {\n  const requestUrl = new URL(request.url);\n  const hostname = requestUrl.hostname;\n  \n  // \u652F\u6301\u7684\u57DF\u540D\u5217\u8868\n  const allowedDomains = [\n    'svtr.ai',\n    'svtrai.com', \n    'svtr.cn',\n    'svtrglobal.com',\n    'chatsvtr.pages.dev',\n    'localhost'  // \u652F\u6301\u6240\u6709\u672C\u5730\u7AEF\u53E3\n  ];\n  \n  // \u68C0\u67E5\u5F53\u524D\u57DF\u540D\u662F\u5426\u5728\u5141\u8BB8\u5217\u8868\u4E2D\n  for (const domain of allowedDomains) {\n    if (hostname.includes(domain.split(':')[0])) {\n      return requestUrl.protocol + '//' + requestUrl.host;\n    }\n  }\n  \n  // \u9ED8\u8BA4\u8FD4\u56DE\u914D\u7F6E\u7684\u4E3B\u57DF\u540D\n  return env.APP_URL || 'https://svtr.ai';\n}\n\n// \u5904\u7406GET\u8BF7\u6C42 - \u53D1\u8D77OAuth\u6D41\u7A0B\u548C\u5904\u7406\u56DE\u8C03\nexport async function onRequestGet(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    const url = new URL(request.url);\n    const code = url.searchParams.get('code');\n    const error = url.searchParams.get('error');\n    const state = url.searchParams.get('state');\n    \n    // \u83B7\u53D6\u5F53\u524D\u8BBF\u95EE\u7684\u57DF\u540D\n    const currentDomain = getCurrentDomain(request, env);\n    console.log('Google OAuth\u8BF7\u6C42:', { code: !!code, error, state, domain: currentDomain });\n    \n    // \u68C0\u67E5\u662F\u5426\u6709\u9519\u8BEF\n    if (error) {\n      console.error('Google OAuth\u9519\u8BEF:', error);\n      return Response.redirect(`${currentDomain}?auth_error=${encodeURIComponent(error)}`);\n    }\n    \n    // \u5982\u679C\u6709\u6388\u6743\u7801\uFF0C\u5904\u7406\u56DE\u8C03\n    if (code) {\n      try {\n        // \u89E3\u6790state\u4E2D\u7684\u539F\u59CB\u57DF\u540D\n        let originalDomain = currentDomain;\n        if (state) {\n          try {\n            const stateData = JSON.parse(atob(state));\n            originalDomain = stateData.originalDomain || currentDomain;\n            console.log('Google OAuth\u56DE\u8C03\uFF0C\u539F\u59CB\u57DF\u540D:', originalDomain);\n          } catch (e) {\n            console.warn('\u65E0\u6CD5\u89E3\u6790state\u53C2\u6570:', e);\n          }\n        }\n        \n        // \u4F7F\u7528\u7EDF\u4E00\u56DE\u8C03\u57DF\u540D\u8FDB\u884Ctoken\u4EA4\u6362\n        const unifiedCallbackDomain = env.APP_URL || 'https://svtr.ai';\n        // \u6B65\u9AA41: \u7528\u6388\u6743\u7801\u6362\u53D6\u8BBF\u95EE\u4EE4\u724C\n        const tokenResponse = await fetch('https://oauth2.googleapis.com/token', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/x-www-form-urlencoded',\n          },\n          body: new URLSearchParams({\n            client_id: env.GOOGLE_CLIENT_ID,\n            client_secret: env.GOOGLE_CLIENT_SECRET,\n            code,\n            grant_type: 'authorization_code',\n            redirect_uri: `${unifiedCallbackDomain}/api/auth/google`\n          })\n        });\n        \n        if (!tokenResponse.ok) {\n          const errorText = await tokenResponse.text();\n          console.error('Google token exchange\u5931\u8D25:', errorText);\n          return Response.redirect(`${originalDomain}?auth_error=token_exchange_failed`);\n        }\n        \n        const tokens: GoogleTokenResponse = await tokenResponse.json();\n        console.log('Google tokens\u83B7\u53D6\u6210\u529F');\n        \n        // \u6B65\u9AA42: \u4F7F\u7528\u8BBF\u95EE\u4EE4\u724C\u83B7\u53D6\u7528\u6237\u4FE1\u606F\n        const userResponse = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {\n          headers: {\n            'Authorization': `Bearer ${tokens.access_token}`\n          }\n        });\n        \n        if (!userResponse.ok) {\n          const errorText = await userResponse.text();\n          console.error('Google\u7528\u6237\u4FE1\u606F\u83B7\u53D6\u5931\u8D25:', errorText);\n          return Response.redirect(`${originalDomain}?auth_error=user_info_failed`);\n        }\n        \n        const googleUser: GoogleUserInfo = await userResponse.json();\n        console.log('Google\u7528\u6237\u4FE1\u606F:', { email: googleUser.email, name: googleUser.name });\n        \n        // \u6B65\u9AA43: \u521B\u5EFA\u6216\u66F4\u65B0\u672C\u5730\u7528\u6237\n        const user = await createOrUpdateGoogleUser(env, googleUser);\n        \n        // \u6B65\u9AA44: \u521B\u5EFA\u4F1A\u8BDD\n        const sessionToken = await createUserSession(env, user);\n        \n        // \u6B65\u9AA45: \u91CD\u5B9A\u5411\u5230\u524D\u7AEF\uFF0C\u643A\u5E26\u4F1A\u8BDDtoken\n        const redirectUrl = new URL(originalDomain);\n        redirectUrl.searchParams.set('auth_success', 'true');\n        redirectUrl.searchParams.set('token', sessionToken);\n        redirectUrl.searchParams.set('user', JSON.stringify({\n          id: user.id,\n          email: user.email,\n          name: user.name,\n          avatar: user.avatar\n        }));\n        \n        return Response.redirect(redirectUrl.toString());\n        \n      } catch (error) {\n        console.error('Google OAuth\u56DE\u8C03\u5904\u7406\u5931\u8D25:', error);\n        return Response.redirect(`${originalDomain}?auth_error=callback_failed`);\n      }\n    }\n    \n    // \u5982\u679C\u6CA1\u6709\u6388\u6743\u7801\uFF0C\u53D1\u8D77OAuth\u6D41\u7A0B\n    const authUrl = new URL('https://accounts.google.com/o/oauth2/v2/auth');\n    authUrl.searchParams.set('client_id', env.GOOGLE_CLIENT_ID);\n    \n    // \u4F7F\u7528\u7EDF\u4E00\u56DE\u8C03\u57DF\u540D\u7B56\u7565\uFF0C\u4E0EGitHub OAuth\u4FDD\u6301\u4E00\u81F4\n    const unifiedCallbackDomain = env.APP_URL || 'https://svtr.ai';\n    authUrl.searchParams.set('redirect_uri', `${unifiedCallbackDomain}/api/auth/google`);\n    authUrl.searchParams.set('response_type', 'code');\n    authUrl.searchParams.set('scope', 'openid email profile');\n    \n    // \u5728state\u4E2D\u4FDD\u5B58\u539F\u59CB\u57DF\u540D\uFF0C\u7528\u4E8E\u56DE\u8C03\u540E\u91CD\u5B9A\u5411\n    const stateData = {\n      csrf: crypto.randomUUID(),\n      originalDomain: currentDomain\n    };\n    authUrl.searchParams.set('state', btoa(JSON.stringify(stateData))); // Base64\u7F16\u7801\n    \n    console.log('\u91CD\u5B9A\u5411\u5230Google\u6388\u6743\u9875\u9762');\n    console.log('- redirect_uri:', `${unifiedCallbackDomain}/api/auth/google`);\n    console.log('- \u539F\u59CB\u57DF\u540D:', currentDomain);\n    return Response.redirect(authUrl.toString());\n    \n  } catch (error) {\n    console.error('Google OAuth\u5904\u7406\u5931\u8D25:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      message: 'Google\u767B\u5F55\u5931\u8D25',\n      error: String(error)\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n  }\n}\n\n// \u5904\u7406OPTIONS\u8BF7\u6C42 - CORS\nexport async function onRequestOptions(): Promise<Response> {\n  return new Response(null, {\n    status: 200,\n    headers: {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n      'Access-Control-Max-Age': '86400',\n    }\n  });\n}", "/**\n * LinkedIn OAuth \u8BA4\u8BC1\u96C6\u6210\n * \u652F\u6301LinkedIn\u8D26\u53F7\u767B\u5F55SVTR\u5E73\u53F0\n */\n\ninterface LinkedInUserInfo {\n  sub: string; // OpenID Connect\u6807\u51C6\u7684\u7528\u6237ID\n  name: string;\n  given_name: string;\n  family_name: string;\n  email: string;\n  email_verified: boolean;\n  picture?: string;\n}\n\n// OpenID Connect\u4E0D\u518D\u9700\u8981\u5355\u72EC\u7684\u90AE\u7BB1\u63A5\u53E3\uFF0C\u7528\u6237\u4FE1\u606F\u4E2D\u5DF2\u5305\u542B\u90AE\u7BB1\n\ninterface LinkedInTokenResponse {\n  access_token: string;\n  expires_in: number;\n  token_type: string;\n}\n\n// OpenID Connect API\u76F4\u63A5\u8FD4\u56DE\u7528\u6237\u90AE\u7BB1\uFF0C\u4E0D\u9700\u8981\u5355\u72EC\u83B7\u53D6\n\n// \u521B\u5EFA\u6216\u66F4\u65B0\u7528\u6237 (OpenID Connect\u7248\u672C)\nasync function createOrUpdateLinkedInUser(env: any, linkedinUser: LinkedInUserInfo): Promise<any> {\n  const email = linkedinUser.email;\n  const existingUserData = await env.SVTR_CACHE.get(`user_${email}`);\n  \n  const userData = {\n    email,\n    name: linkedinUser.name || `${linkedinUser.given_name} ${linkedinUser.family_name}`.trim(),\n    avatar: linkedinUser.picture || '',\n    provider: 'linkedin' as const,\n    linkedinProfile: {\n      id: linkedinUser.sub,\n      firstName: linkedinUser.given_name,\n      lastName: linkedinUser.family_name,\n      emailVerified: linkedinUser.email_verified\n    }\n  };\n  \n  if (existingUserData) {\n    // \u66F4\u65B0\u73B0\u6709\u7528\u6237\n    const existingUser = JSON.parse(existingUserData);\n    const updatedUser = {\n      ...existingUser,\n      ...userData,\n      lastLoginAt: new Date().toISOString()\n    };\n    \n    await env.SVTR_CACHE.put(`user_${email}`, JSON.stringify(updatedUser));\n    await env.SVTR_CACHE.put(`user_id_${updatedUser.id}`, JSON.stringify(updatedUser));\n    \n    return updatedUser;\n  } else {\n    // \u521B\u5EFA\u65B0\u7528\u6237\n    const newUser = {\n      id: `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n      ...userData,\n      createdAt: new Date().toISOString(),\n      lastLoginAt: new Date().toISOString(),\n      isActive: true\n    };\n    \n    await env.SVTR_CACHE.put(`user_${email}`, JSON.stringify(newUser));\n    await env.SVTR_CACHE.put(`user_id_${newUser.id}`, JSON.stringify(newUser));\n    \n    return newUser;\n  }\n}\n\n// \u521B\u5EFA\u7528\u6237\u4F1A\u8BDD\nasync function createUserSession(env: any, user: any): Promise<string> {\n  const sessionToken = crypto.randomUUID() + '_' + Math.random().toString(36).substr(2, 16);\n  const expiresAt = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(); // 30\u5929\u8FC7\u671F\n  \n  const session = {\n    userId: user.id,\n    email: user.email,\n    token: sessionToken,\n    expiresAt,\n    createdAt: new Date().toISOString()\n  };\n  \n  await env.SVTR_CACHE.put(`session_${sessionToken}`, JSON.stringify(session), {\n    expirationTtl: 30 * 24 * 60 * 60 // 30\u5929\n  });\n  \n  return sessionToken;\n}\n\n// \u83B7\u53D6\u5F53\u524D\u57DF\u540D\nfunction getCurrentDomain(request: Request, env: any): string {\n  const requestUrl = new URL(request.url);\n  const hostname = requestUrl.hostname;\n  \n  // \u652F\u6301\u7684\u57DF\u540D\u5217\u8868\n  const allowedDomains = [\n    'svtr.ai',\n    'svtrai.com', \n    'svtr.cn',\n    'svtrglobal.com',\n    'chatsvtr.pages.dev',\n    'localhost'  // \u652F\u6301\u6240\u6709\u672C\u5730\u7AEF\u53E3\n  ];\n  \n  // \u68C0\u67E5\u5F53\u524D\u57DF\u540D\u662F\u5426\u5728\u5141\u8BB8\u5217\u8868\u4E2D\n  for (const domain of allowedDomains) {\n    if (hostname.includes(domain.split(':')[0])) {\n      return requestUrl.protocol + '//' + requestUrl.host;\n    }\n  }\n  \n  // \u9ED8\u8BA4\u8FD4\u56DE\u914D\u7F6E\u7684\u4E3B\u57DF\u540D\n  return env.APP_URL || 'https://svtr.ai';\n}\n\n// \u5904\u7406GET\u8BF7\u6C42 - \u53D1\u8D77OAuth\u6D41\u7A0B\u548C\u5904\u7406\u56DE\u8C03\nexport async function onRequestGet(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    const url = new URL(request.url);\n    const code = url.searchParams.get('code');\n    const error = url.searchParams.get('error');\n    const state = url.searchParams.get('state');\n    \n    // \u83B7\u53D6\u5F53\u524D\u8BBF\u95EE\u7684\u57DF\u540D\n    const currentDomain = getCurrentDomain(request, env);\n    console.log('LinkedIn OAuth\u8BF7\u6C42:', { code: !!code, error, state, domain: currentDomain });\n    \n    // \u68C0\u67E5\u662F\u5426\u6709\u9519\u8BEF\n    if (error) {\n      console.error('LinkedIn OAuth\u9519\u8BEF:', error);\n      return Response.redirect(`${currentDomain}?auth_error=${encodeURIComponent(error)}`);\n    }\n    \n    // \u5982\u679C\u6709\u6388\u6743\u7801\uFF0C\u5904\u7406\u56DE\u8C03\n    if (code) {\n      try {\n        // \u89E3\u6790state\u4E2D\u7684\u539F\u59CB\u57DF\u540D\n        let originalDomain = currentDomain;\n        if (state) {\n          try {\n            const stateData = JSON.parse(atob(state));\n            originalDomain = stateData.originalDomain || currentDomain;\n            console.log('LinkedIn OAuth\u56DE\u8C03\uFF0C\u539F\u59CB\u57DF\u540D:', originalDomain);\n          } catch (e) {\n            console.warn('\u65E0\u6CD5\u89E3\u6790state\u53C2\u6570:', e);\n          }\n        }\n        \n        // \u4F7F\u7528\u7EDF\u4E00\u56DE\u8C03\u57DF\u540D\u8FDB\u884Ctoken\u4EA4\u6362\n        const unifiedCallbackDomain = env.APP_URL || 'https://svtr.ai';\n        \n        // \u6B65\u9AA41: \u7528\u6388\u6743\u7801\u6362\u53D6\u8BBF\u95EE\u4EE4\u724C\n        const tokenResponse = await fetch('https://www.linkedin.com/oauth/v2/accessToken', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/x-www-form-urlencoded',\n          },\n          body: new URLSearchParams({\n            grant_type: 'authorization_code',\n            code,\n            client_id: env.LINKEDIN_CLIENT_ID,\n            client_secret: env.LINKEDIN_CLIENT_SECRET,\n            redirect_uri: `${unifiedCallbackDomain}/api/auth/linkedin`\n          })\n        });\n        \n        if (!tokenResponse.ok) {\n          const errorText = await tokenResponse.text();\n          console.error('LinkedIn token exchange\u5931\u8D25:', errorText);\n          return Response.redirect(`${originalDomain}?auth_error=token_exchange_failed`);\n        }\n        \n        const tokens: LinkedInTokenResponse = await tokenResponse.json();\n        console.log('LinkedIn tokens\u83B7\u53D6\u6210\u529F');\n        \n        // \u6B65\u9AA42: \u4F7F\u7528\u8BBF\u95EE\u4EE4\u724C\u83B7\u53D6\u7528\u6237\u4FE1\u606F (OpenID Connect\u6807\u51C6)\n        const userResponse = await fetch('https://api.linkedin.com/v2/userinfo', {\n          headers: {\n            'Authorization': `Bearer ${tokens.access_token}`,\n            'Accept': 'application/json'\n          }\n        });\n        \n        if (!userResponse.ok) {\n          const errorText = await userResponse.text();\n          console.error('LinkedIn\u7528\u6237\u4FE1\u606F\u83B7\u53D6\u5931\u8D25:', errorText);\n          return Response.redirect(`${originalDomain}?auth_error=user_info_failed`);\n        }\n        \n        const linkedinUser: LinkedInUserInfo = await userResponse.json();\n        console.log('LinkedIn\u7528\u6237\u4FE1\u606F (OpenID Connect):', { \n          id: linkedinUser.sub, \n          name: linkedinUser.name,\n          email: linkedinUser.email \n        });\n        \n        // \u6B65\u9AA43: \u9A8C\u8BC1\u90AE\u7BB1\u662F\u5426\u5B58\u5728\n        if (!linkedinUser.email) {\n          console.error('LinkedIn\u7528\u6237\u4FE1\u606F\u4E2D\u4E0D\u5305\u542B\u90AE\u7BB1');\n          return Response.redirect(`${originalDomain}?auth_error=no_email`);\n        }\n        \n        // \u6B65\u9AA44: \u521B\u5EFA\u6216\u66F4\u65B0\u672C\u5730\u7528\u6237\n        const user = await createOrUpdateLinkedInUser(env, linkedinUser);\n        \n        // \u6B65\u9AA45: \u521B\u5EFA\u4F1A\u8BDD\n        const sessionToken = await createUserSession(env, user);\n        \n        // \u6B65\u9AA46: \u91CD\u5B9A\u5411\u5230\u524D\u7AEF\uFF0C\u643A\u5E26\u4F1A\u8BDDtoken\n        const redirectUrl = new URL(originalDomain);\n        redirectUrl.searchParams.set('auth_success', 'true');\n        redirectUrl.searchParams.set('token', sessionToken);\n        redirectUrl.searchParams.set('user', JSON.stringify({\n          id: user.id,\n          email: user.email,\n          name: user.name,\n          avatar: user.avatar\n        }));\n        \n        return Response.redirect(redirectUrl.toString());\n        \n      } catch (error) {\n        console.error('LinkedIn OAuth\u56DE\u8C03\u5904\u7406\u5931\u8D25:', error);\n        return Response.redirect(`${currentDomain}?auth_error=callback_failed`);\n      }\n    }\n    \n    // \u5982\u679C\u6CA1\u6709\u6388\u6743\u7801\uFF0C\u53D1\u8D77OAuth\u6D41\u7A0B\n    const authUrl = new URL('https://www.linkedin.com/oauth/v2/authorization');\n    authUrl.searchParams.set('response_type', 'code');\n    authUrl.searchParams.set('client_id', env.LINKEDIN_CLIENT_ID);\n    \n    // \u4F7F\u7528\u7EDF\u4E00\u56DE\u8C03\u57DF\u540D\u7B56\u7565\uFF0C\u4E0EGoogle\u548CGitHub OAuth\u4FDD\u6301\u4E00\u81F4\n    const unifiedCallbackDomain = env.APP_URL || 'https://svtr.ai';\n    authUrl.searchParams.set('redirect_uri', `${unifiedCallbackDomain}/api/auth/linkedin`);\n    authUrl.searchParams.set('scope', 'openid profile email');\n    \n    // \u5728state\u4E2D\u4FDD\u5B58\u539F\u59CB\u57DF\u540D\uFF0C\u7528\u4E8E\u56DE\u8C03\u540E\u91CD\u5B9A\u5411\n    const stateData = {\n      csrf: crypto.randomUUID(),\n      originalDomain: currentDomain\n    };\n    authUrl.searchParams.set('state', btoa(JSON.stringify(stateData))); // Base64\u7F16\u7801\n    \n    console.log('\u91CD\u5B9A\u5411\u5230LinkedIn\u6388\u6743\u9875\u9762');\n    console.log('- redirect_uri:', `${unifiedCallbackDomain}/api/auth/linkedin`);\n    console.log('- \u539F\u59CB\u57DF\u540D:', currentDomain);\n    return Response.redirect(authUrl.toString());\n    \n  } catch (error) {\n    console.error('LinkedIn OAuth\u5904\u7406\u5931\u8D25:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      message: 'LinkedIn\u767B\u5F55\u5931\u8D25',\n      error: String(error)\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n  }\n}\n\n// \u5904\u7406OPTIONS\u8BF7\u6C42 - CORS\nexport async function onRequestOptions(): Promise<Response> {\n  return new Response(null, {\n    status: 200,\n    headers: {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n      'Access-Control-Max-Age': '86400',\n    }\n  });\n}", "/**\n * AWS SES\u90AE\u4EF6\u53D1\u9001\u670D\u52A1\n * \u652F\u6301\u9A8C\u8BC1\u7801\u90AE\u4EF6\u548CMagic Link\u90AE\u4EF6\u53D1\u9001\n */\n\ninterface EmailConfig {\n  accessKeyId: string;\n  secretAccessKey: string;\n  region: string;\n  fromEmail: string;\n}\n\ninterface VerificationEmailData {\n  email: string;\n  code: string;\n  userName?: string;\n  language: 'zh-CN' | 'en';\n}\n\ninterface MagicLinkEmailData {\n  email: string;\n  magicLink: string;\n  userName?: string;\n  language: 'zh-CN' | 'en';\n}\n\nclass AWSEmailService {\n  private config: EmailConfig;\n\n  constructor(config: EmailConfig) {\n    this.config = config;\n  }\n\n  /**\n   * \u53D1\u9001\u9A8C\u8BC1\u7801\u90AE\u4EF6\n   */\n  async sendVerificationCode(data: VerificationEmailData): Promise<boolean> {\n    try {\n      const { email, code, userName, language } = data;\n      \n      const subject = language === 'zh-CN' \n        ? `[SVTR] \u60A8\u7684\u767B\u5F55\u9A8C\u8BC1\u7801: ${code}`\n        : `[SVTR] Your Login Verification Code: ${code}`;\n\n      const htmlBody = this.generateVerificationEmailHTML(data);\n      const textBody = this.generateVerificationEmailText(data);\n\n      const success = await this.sendEmail({\n        to: email,\n        subject,\n        htmlBody,\n        textBody\n      });\n\n      if (success) {\n        console.log(`\u9A8C\u8BC1\u7801\u90AE\u4EF6\u53D1\u9001\u6210\u529F: ${email}`);\n      } else {\n        console.error(`\u9A8C\u8BC1\u7801\u90AE\u4EF6\u53D1\u9001\u5931\u8D25: ${email}`);\n      }\n\n      return success;\n    } catch (error) {\n      console.error('\u53D1\u9001\u9A8C\u8BC1\u7801\u90AE\u4EF6\u5931\u8D25:', error);\n      return false;\n    }\n  }\n\n  /**\n   * \u53D1\u9001Magic Link\u90AE\u4EF6\n   */\n  async sendMagicLink(data: MagicLinkEmailData): Promise<boolean> {\n    try {\n      const { email, magicLink, userName, language } = data;\n      \n      const subject = language === 'zh-CN' \n        ? '[SVTR] \u60A8\u7684\u4E00\u952E\u767B\u5F55\u94FE\u63A5'\n        : '[SVTR] Your Magic Login Link';\n\n      const htmlBody = this.generateMagicLinkEmailHTML(data);\n      const textBody = this.generateMagicLinkEmailText(data);\n\n      const success = await this.sendEmail({\n        to: email,\n        subject,\n        htmlBody,\n        textBody\n      });\n\n      if (success) {\n        console.log(`Magic Link\u90AE\u4EF6\u53D1\u9001\u6210\u529F: ${email}`);\n      } else {\n        console.error(`Magic Link\u90AE\u4EF6\u53D1\u9001\u5931\u8D25: ${email}`);\n      }\n\n      return success;\n    } catch (error) {\n      console.error('\u53D1\u9001Magic Link\u90AE\u4EF6\u5931\u8D25:', error);\n      return false;\n    }\n  }\n\n  /**\n   * \u4F7F\u7528AWS SES\u53D1\u9001\u90AE\u4EF6\n   */\n  private async sendEmail(emailData: {\n    to: string;\n    subject: string;\n    htmlBody: string;\n    textBody: string;\n  }): Promise<boolean> {\n    try {\n      const { to, subject, htmlBody, textBody } = emailData;\n      \n      // \u6784\u5EFASES API\u8BF7\u6C42\n      const sesRequest = {\n        Destination: {\n          ToAddresses: [to]\n        },\n        Message: {\n          Body: {\n            Html: {\n              Charset: 'UTF-8',\n              Data: htmlBody\n            },\n            Text: {\n              Charset: 'UTF-8',\n              Data: textBody\n            }\n          },\n          Subject: {\n            Charset: 'UTF-8',\n            Data: subject\n          }\n        },\n        Source: this.config.fromEmail\n      };\n\n      // AWS SES API\u8C03\u7528\n      const response = await this.callSESAPI('SendEmail', sesRequest);\n      \n      return response.MessageId ? true : false;\n    } catch (error) {\n      console.error('AWS SES API\u8C03\u7528\u5931\u8D25:', error);\n      return false;\n    }\n  }\n\n  /**\n   * \u8C03\u7528AWS SES API\n   */\n  private async callSESAPI(action: string, payload: any): Promise<any> {\n    const host = `email.${this.config.region}.amazonaws.com`;\n    const service = 'ses';\n    const method = 'POST';\n    \n    // \u751F\u6210AWS\u7B7E\u540D\n    const { headers, body } = await this.generateAWSSignature(\n      host, \n      service, \n      method, \n      action, \n      payload\n    );\n\n    const response = await fetch(`https://${host}/`, {\n      method,\n      headers,\n      body\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`SES API\u9519\u8BEF: ${response.status} ${errorText}`);\n    }\n\n    const responseText = await response.text();\n    return this.parseXMLResponse(responseText);\n  }\n\n  /**\n   * \u751F\u6210AWS API\u7B7E\u540D\n   */\n  private async generateAWSSignature(\n    host: string,\n    service: string,\n    method: string,\n    action: string,\n    payload: any\n  ) {\n    const now = new Date();\n    const dateStamp = now.toISOString().split('T')[0].replace(/-/g, '');\n    const amzDate = now.toISOString().replace(/[:\\-]|\\.\\d{3}/g, '');\n    \n    // Form-encoded payload for SES\n    const formData = new URLSearchParams();\n    formData.append('Action', action);\n    formData.append('Version', '2010-12-01');\n    this.addObjectToFormData(formData, payload, '');\n    \n    const payloadString = formData.toString();\n    const payloadHash = await this.sha256(payloadString);\n\n    // \u6784\u5EFAcanonical request\n    const canonicalHeaders = [\n      `content-type:application/x-www-form-urlencoded`,\n      `host:${host}`,\n      `x-amz-date:${amzDate}`\n    ].join('\\n');\n\n    const signedHeaders = 'content-type;host;x-amz-date';\n    \n    const canonicalRequest = [\n      method,\n      '/',\n      '',\n      canonicalHeaders,\n      '',\n      signedHeaders,\n      payloadHash\n    ].join('\\n');\n\n    // \u6784\u5EFAstring to sign\n    const algorithm = 'AWS4-HMAC-SHA256';\n    const credentialScope = `${dateStamp}/${this.config.region}/${service}/aws4_request`;\n    const stringToSign = [\n      algorithm,\n      amzDate,\n      credentialScope,\n      await this.sha256(canonicalRequest)\n    ].join('\\n');\n\n    // \u8BA1\u7B97\u7B7E\u540D\n    const signature = await this.calculateSignature(\n      this.config.secretAccessKey,\n      dateStamp,\n      this.config.region,\n      service,\n      stringToSign\n    );\n\n    // \u6784\u5EFAauthorization header\n    const authorization = `${algorithm} Credential=${this.config.accessKeyId}/${credentialScope}, SignedHeaders=${signedHeaders}, Signature=${signature}`;\n\n    return {\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'Host': host,\n        'X-Amz-Date': amzDate,\n        'Authorization': authorization\n      },\n      body: payloadString\n    };\n  }\n\n  /**\n   * \u9012\u5F52\u6DFB\u52A0\u5BF9\u8C61\u5230FormData\n   */\n  private addObjectToFormData(formData: URLSearchParams, obj: any, prefix: string) {\n    for (const key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        const value = obj[key];\n        const formKey = prefix ? `${prefix}.${key}` : key;\n        \n        if (typeof value === 'object' && value !== null) {\n          if (Array.isArray(value)) {\n            value.forEach((item, index) => {\n              if (typeof item === 'object') {\n                this.addObjectToFormData(formData, item, `${formKey}.${index + 1}`);\n              } else {\n                formData.append(`${formKey}.${index + 1}`, String(item));\n              }\n            });\n          } else {\n            this.addObjectToFormData(formData, value, formKey);\n          }\n        } else {\n          formData.append(formKey, String(value));\n        }\n      }\n    }\n  }\n\n  /**\n   * \u8BA1\u7B97AWS\u7B7E\u540D\n   */\n  private async calculateSignature(\n    secretKey: string,\n    dateStamp: string,\n    region: string,\n    service: string,\n    stringToSign: string\n  ): Promise<string> {\n    const kDate = await this.hmacSha256(`AWS4${secretKey}`, dateStamp);\n    const kRegion = await this.hmacSha256(kDate, region);\n    const kService = await this.hmacSha256(kRegion, service);\n    const kSigning = await this.hmacSha256(kService, 'aws4_request');\n    const signature = await this.hmacSha256(kSigning, stringToSign);\n    \n    return Array.from(new Uint8Array(signature))\n      .map(b => b.toString(16).padStart(2, '0'))\n      .join('');\n  }\n\n  /**\n   * SHA256\u54C8\u5E0C\n   */\n  private async sha256(message: string): Promise<string> {\n    const msgBuffer = new TextEncoder().encode(message);\n    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);\n    const hashArray = Array.from(new Uint8Array(hashBuffer));\n    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n  }\n\n  /**\n   * HMAC-SHA256\n   */\n  private async hmacSha256(key: string | ArrayBuffer, message: string): Promise<ArrayBuffer> {\n    const keyBuffer = typeof key === 'string' ? new TextEncoder().encode(key) : key;\n    const messageBuffer = new TextEncoder().encode(message);\n    \n    const cryptoKey = await crypto.subtle.importKey(\n      'raw',\n      keyBuffer,\n      { name: 'HMAC', hash: 'SHA-256' },\n      false,\n      ['sign']\n    );\n    \n    return await crypto.subtle.sign('HMAC', cryptoKey, messageBuffer);\n  }\n\n  /**\n   * \u89E3\u6790XML\u54CD\u5E94\n   */\n  private parseXMLResponse(xmlString: string): any {\n    // \u7B80\u5355\u7684XML\u89E3\u6790\uFF0C\u63D0\u53D6MessageId\n    const messageIdMatch = xmlString.match(/<MessageId>([^<]+)<\\/MessageId>/);\n    const errorMatch = xmlString.match(/<Error>.*?<Code>([^<]+)<\\/Code>.*?<Message>([^<]+)<\\/Message>/s);\n    \n    if (errorMatch) {\n      throw new Error(`AWS SES\u9519\u8BEF: ${errorMatch[1]} - ${errorMatch[2]}`);\n    }\n    \n    return {\n      MessageId: messageIdMatch ? messageIdMatch[1] : null\n    };\n  }\n\n  /**\n   * \u751F\u6210\u9A8C\u8BC1\u7801\u90AE\u4EF6HTML\u6A21\u677F\n   */\n  private generateVerificationEmailHTML(data: VerificationEmailData): string {\n    const { code, userName, language } = data;\n    const name = userName || (language === 'zh-CN' ? '\u7528\u6237' : 'User');\n    \n    if (language === 'zh-CN') {\n      return `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>SVTR\u767B\u5F55\u9A8C\u8BC1\u7801</title>\n</head>\n<body style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;\">\n  <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 10px; text-align: center; margin-bottom: 30px;\">\n    <h1 style=\"color: white; margin: 0; font-size: 28px;\">SVTR</h1>\n    <p style=\"color: rgba(255,255,255,0.9); margin: 10px 0 0; font-size: 16px;\">\u7845\u8C37\u79D1\u6280\u8BC4\u8BBA</p>\n  </div>\n  \n  <div style=\"background: #f8f9fa; padding: 30px; border-radius: 10px; margin-bottom: 20px;\">\n    <h2 style=\"color: #333; margin-top: 0;\">\u60A8\u597D\uFF0C${name}\uFF01</h2>\n    <p style=\"font-size: 16px; color: #666;\">\u60A8\u6B63\u5728\u767B\u5F55SVTR\u5E73\u53F0\uFF0C\u8BF7\u4F7F\u7528\u4EE5\u4E0B\u9A8C\u8BC1\u7801\u5B8C\u6210\u767B\u5F55\uFF1A</p>\n    \n    <div style=\"background: #fff; padding: 25px; border-radius: 8px; text-align: center; margin: 25px 0; border: 2px dashed #667eea;\">\n      <p style=\"font-size: 14px; color: #666; margin: 0 0 10px;\">\u60A8\u7684\u9A8C\u8BC1\u7801</p>\n      <p style=\"font-size: 32px; font-weight: bold; color: #667eea; margin: 0; letter-spacing: 3px;\">${code}</p>\n    </div>\n    \n    <p style=\"font-size: 14px; color: #999;\">\n      \u2022 \u9A8C\u8BC1\u78015\u5206\u949F\u5185\u6709\u6548<br>\n      \u2022 \u8BF7\u52FF\u5C06\u9A8C\u8BC1\u7801\u6CC4\u9732\u7ED9\u4ED6\u4EBA<br>\n      \u2022 \u5982\u975E\u672C\u4EBA\u64CD\u4F5C\uFF0C\u8BF7\u5FFD\u7565\u6B64\u90AE\u4EF6\n    </p>\n  </div>\n  \n  <div style=\"text-align: center; color: #999; font-size: 12px;\">\n    <p>\u6B64\u90AE\u4EF6\u7531 SVTR \u7CFB\u7EDF\u81EA\u52A8\u53D1\u9001\uFF0C\u8BF7\u52FF\u56DE\u590D</p>\n    <p>\u00A9 2025 SVTR - Silicon Valley Tech Review</p>\n  </div>\n</body>\n</html>`;\n    } else {\n      return `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>SVTR Login Verification Code</title>\n</head>\n<body style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;\">\n  <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 10px; text-align: center; margin-bottom: 30px;\">\n    <h1 style=\"color: white; margin: 0; font-size: 28px;\">SVTR</h1>\n    <p style=\"color: rgba(255,255,255,0.9); margin: 10px 0 0; font-size: 16px;\">Silicon Valley Tech Review</p>\n  </div>\n  \n  <div style=\"background: #f8f9fa; padding: 30px; border-radius: 10px; margin-bottom: 20px;\">\n    <h2 style=\"color: #333; margin-top: 0;\">Hello, ${name}!</h2>\n    <p style=\"font-size: 16px; color: #666;\">You're logging into SVTR platform. Please use the verification code below to complete your login:</p>\n    \n    <div style=\"background: #fff; padding: 25px; border-radius: 8px; text-align: center; margin: 25px 0; border: 2px dashed #667eea;\">\n      <p style=\"font-size: 14px; color: #666; margin: 0 0 10px;\">Your Verification Code</p>\n      <p style=\"font-size: 32px; font-weight: bold; color: #667eea; margin: 0; letter-spacing: 3px;\">${code}</p>\n    </div>\n    \n    <p style=\"font-size: 14px; color: #999;\">\n      \u2022 Code expires in 5 minutes<br>\n      \u2022 Do not share this code with anyone<br>\n      \u2022 If this wasn't you, please ignore this email\n    </p>\n  </div>\n  \n  <div style=\"text-align: center; color: #999; font-size: 12px;\">\n    <p>This email was sent automatically by SVTR system, please do not reply</p>\n    <p>\u00A9 2025 SVTR - Silicon Valley Tech Review</p>\n  </div>\n</body>\n</html>`;\n    }\n  }\n\n  /**\n   * \u751F\u6210\u9A8C\u8BC1\u7801\u90AE\u4EF6\u7EAF\u6587\u672C\u7248\u672C\n   */\n  private generateVerificationEmailText(data: VerificationEmailData): string {\n    const { code, userName, language } = data;\n    const name = userName || (language === 'zh-CN' ? '\u7528\u6237' : 'User');\n    \n    if (language === 'zh-CN') {\n      return `\nSVTR \u767B\u5F55\u9A8C\u8BC1\u7801\n\n\u60A8\u597D\uFF0C${name}\uFF01\n\n\u60A8\u6B63\u5728\u767B\u5F55SVTR\u5E73\u53F0\uFF0C\u8BF7\u4F7F\u7528\u4EE5\u4E0B\u9A8C\u8BC1\u7801\u5B8C\u6210\u767B\u5F55\uFF1A\n\n\u9A8C\u8BC1\u7801\uFF1A${code}\n\n\u6CE8\u610F\u4E8B\u9879\uFF1A\n\u2022 \u9A8C\u8BC1\u78015\u5206\u949F\u5185\u6709\u6548\n\u2022 \u8BF7\u52FF\u5C06\u9A8C\u8BC1\u7801\u6CC4\u9732\u7ED9\u4ED6\u4EBA\n\u2022 \u5982\u975E\u672C\u4EBA\u64CD\u4F5C\uFF0C\u8BF7\u5FFD\u7565\u6B64\u90AE\u4EF6\n\n\u6B64\u90AE\u4EF6\u7531 SVTR \u7CFB\u7EDF\u81EA\u52A8\u53D1\u9001\uFF0C\u8BF7\u52FF\u56DE\u590D\n\u00A9 2025 SVTR - Silicon Valley Tech Review\n`;\n    } else {\n      return `\nSVTR Login Verification Code\n\nHello, ${name}!\n\nYou're logging into SVTR platform. Please use the verification code below to complete your login:\n\nVerification Code: ${code}\n\nImportant Notes:\n\u2022 Code expires in 5 minutes\n\u2022 Do not share this code with anyone\n\u2022 If this wasn't you, please ignore this email\n\nThis email was sent automatically by SVTR system, please do not reply\n\u00A9 2025 SVTR - Silicon Valley Tech Review\n`;\n    }\n  }\n\n  /**\n   * \u751F\u6210Magic Link\u90AE\u4EF6HTML\u6A21\u677F\n   */\n  private generateMagicLinkEmailHTML(data: MagicLinkEmailData): string {\n    const { magicLink, userName, language } = data;\n    const name = userName || (language === 'zh-CN' ? '\u7528\u6237' : 'User');\n    \n    if (language === 'zh-CN') {\n      return `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>SVTR\u4E00\u952E\u767B\u5F55</title>\n</head>\n<body style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;\">\n  <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 10px; text-align: center; margin-bottom: 30px;\">\n    <h1 style=\"color: white; margin: 0; font-size: 28px;\">SVTR</h1>\n    <p style=\"color: rgba(255,255,255,0.9); margin: 10px 0 0; font-size: 16px;\">\u7845\u8C37\u79D1\u6280\u8BC4\u8BBA</p>\n  </div>\n  \n  <div style=\"background: #f8f9fa; padding: 30px; border-radius: 10px; margin-bottom: 20px;\">\n    <h2 style=\"color: #333; margin-top: 0;\">\u60A8\u597D\uFF0C${name}\uFF01</h2>\n    <p style=\"font-size: 16px; color: #666;\">\u70B9\u51FB\u4E0B\u65B9\u6309\u94AE\u5373\u53EF\u5FEB\u901F\u767B\u5F55SVTR\u5E73\u53F0\uFF1A</p>\n    \n    <div style=\"text-align: center; margin: 30px 0;\">\n      <a href=\"${magicLink}\" style=\"display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; padding: 15px 30px; border-radius: 8px; font-weight: bold; font-size: 16px;\">\n        \uD83D\uDE80 \u7ACB\u5373\u767B\u5F55 SVTR\n      </a>\n    </div>\n    \n    <p style=\"font-size: 14px; color: #999;\">\n      \u2022 \u767B\u5F55\u94FE\u63A510\u5206\u949F\u5185\u6709\u6548<br>\n      \u2022 \u6B64\u94FE\u63A5\u53EA\u80FD\u4F7F\u7528\u4E00\u6B21<br>\n      \u2022 \u5982\u975E\u672C\u4EBA\u64CD\u4F5C\uFF0C\u8BF7\u5FFD\u7565\u6B64\u90AE\u4EF6\n    </p>\n    \n    <div style=\"background: #fff; padding: 15px; border-radius: 6px; border-left: 4px solid #667eea; margin-top: 20px;\">\n      <p style=\"font-size: 12px; color: #666; margin: 0;\">\n        \u5982\u679C\u6309\u94AE\u65E0\u6CD5\u70B9\u51FB\uFF0C\u8BF7\u590D\u5236\u4EE5\u4E0B\u94FE\u63A5\u5230\u6D4F\u89C8\u5668\u5730\u5740\u680F\uFF1A<br>\n        <span style=\"word-break: break-all; color: #667eea;\">${magicLink}</span>\n      </p>\n    </div>\n  </div>\n  \n  <div style=\"text-align: center; color: #999; font-size: 12px;\">\n    <p>\u6B64\u90AE\u4EF6\u7531 SVTR \u7CFB\u7EDF\u81EA\u52A8\u53D1\u9001\uFF0C\u8BF7\u52FF\u56DE\u590D</p>\n    <p>\u00A9 2025 SVTR - Silicon Valley Tech Review</p>\n  </div>\n</body>\n</html>`;\n    } else {\n      return `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>SVTR Magic Login</title>\n</head>\n<body style=\"font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;\">\n  <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; border-radius: 10px; text-align: center; margin-bottom: 30px;\">\n    <h1 style=\"color: white; margin: 0; font-size: 28px;\">SVTR</h1>\n    <p style=\"color: rgba(255,255,255,0.9); margin: 10px 0 0; font-size: 16px;\">Silicon Valley Tech Review</p>\n  </div>\n  \n  <div style=\"background: #f8f9fa; padding: 30px; border-radius: 10px; margin-bottom: 20px;\">\n    <h2 style=\"color: #333; margin-top: 0;\">Hello, ${name}!</h2>\n    <p style=\"font-size: 16px; color: #666;\">Click the button below to quickly login to SVTR platform:</p>\n    \n    <div style=\"text-align: center; margin: 30px 0;\">\n      <a href=\"${magicLink}\" style=\"display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; padding: 15px 30px; border-radius: 8px; font-weight: bold; font-size: 16px;\">\n        \uD83D\uDE80 Login to SVTR Now\n      </a>\n    </div>\n    \n    <p style=\"font-size: 14px; color: #999;\">\n      \u2022 Link expires in 10 minutes<br>\n      \u2022 This link can only be used once<br>\n      \u2022 If this wasn't you, please ignore this email\n    </p>\n    \n    <div style=\"background: #fff; padding: 15px; border-radius: 6px; border-left: 4px solid #667eea; margin-top: 20px;\">\n      <p style=\"font-size: 12px; color: #666; margin: 0;\">\n        If the button doesn't work, please copy and paste this link into your browser:<br>\n        <span style=\"word-break: break-all; color: #667eea;\">${magicLink}</span>\n      </p>\n    </div>\n  </div>\n  \n  <div style=\"text-align: center; color: #999; font-size: 12px;\">\n    <p>This email was sent automatically by SVTR system, please do not reply</p>\n    <p>\u00A9 2025 SVTR - Silicon Valley Tech Review</p>\n  </div>\n</body>\n</html>`;\n    }\n  }\n\n  /**\n   * \u751F\u6210Magic Link\u90AE\u4EF6\u7EAF\u6587\u672C\u7248\u672C\n   */\n  private generateMagicLinkEmailText(data: MagicLinkEmailData): string {\n    const { magicLink, userName, language } = data;\n    const name = userName || (language === 'zh-CN' ? '\u7528\u6237' : 'User');\n    \n    if (language === 'zh-CN') {\n      return `\nSVTR \u4E00\u952E\u767B\u5F55\n\n\u60A8\u597D\uFF0C${name}\uFF01\n\n\u70B9\u51FB\u4EE5\u4E0B\u94FE\u63A5\u5373\u53EF\u5FEB\u901F\u767B\u5F55SVTR\u5E73\u53F0\uFF1A\n\n${magicLink}\n\n\u6CE8\u610F\u4E8B\u9879\uFF1A\n\u2022 \u767B\u5F55\u94FE\u63A510\u5206\u949F\u5185\u6709\u6548\n\u2022 \u6B64\u94FE\u63A5\u53EA\u80FD\u4F7F\u7528\u4E00\u6B21\n\u2022 \u5982\u975E\u672C\u4EBA\u64CD\u4F5C\uFF0C\u8BF7\u5FFD\u7565\u6B64\u90AE\u4EF6\n\n\u6B64\u90AE\u4EF6\u7531 SVTR \u7CFB\u7EDF\u81EA\u52A8\u53D1\u9001\uFF0C\u8BF7\u52FF\u56DE\u590D\n\u00A9 2025 SVTR - Silicon Valley Tech Review\n`;\n    } else {\n      return `\nSVTR Magic Login\n\nHello, ${name}!\n\nClick the following link to quickly login to SVTR platform:\n\n${magicLink}\n\nImportant Notes:\n\u2022 Link expires in 10 minutes\n\u2022 This link can only be used once\n\u2022 If this wasn't you, please ignore this email\n\nThis email was sent automatically by SVTR system, please do not reply\n\u00A9 2025 SVTR - Silicon Valley Tech Review\n`;\n    }\n  }\n}\n\nexport { AWSEmailService, type EmailConfig, type VerificationEmailData, type MagicLinkEmailData };", "/**\n * SVTR \u7528\u6237\u8BA4\u8BC1API\u7AEF\u70B9\n * \u652F\u6301\u90AE\u7BB1\u9A8C\u8BC1\u7801\u3001Magic Link\u3001OAuth\u767B\u5F55\n * \u591A\u57DF\u540D\u652F\u6301: svtr.ai, svtrai.com, svtr.cn, svtrglobal.com\n */\n\n// \u591A\u57DF\u540DCORS\u914D\u7F6E\nfunction getCorsHeaders(request: Request): Record<string, string> {\n  const origin = request.headers.get('Origin') || '';\n  \n  // \u5141\u8BB8\u7684\u57DF\u540D\u5217\u8868\n  const allowedOrigins = [\n    'https://svtr.ai',\n    'https://svtrai.com',\n    'https://svtr.cn', \n    'https://svtrglobal.com',\n    'http://localhost:3000'\n  ];\n  \n  // \u68C0\u67E5\u8BF7\u6C42\u6765\u6E90\u662F\u5426\u5728\u5141\u8BB8\u5217\u8868\u4E2D\n  const allowedOrigin = allowedOrigins.find(allowed => \n    origin.startsWith(allowed)\n  );\n  \n  return {\n    'Content-Type': 'application/json',\n    'Access-Control-Allow-Origin': allowedOrigin || '*',\n    'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n    'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n    'Access-Control-Allow-Credentials': 'true',\n    'Access-Control-Max-Age': '86400'\n  };\n}\n\ninterface User {\n  id: string;\n  email: string;\n  name?: string;\n  avatar?: string;\n  provider: 'email' | 'google' | 'github';\n  createdAt: string;\n  lastLoginAt: string;\n  isActive: boolean;\n}\n\ninterface AuthSession {\n  userId: string;\n  email: string;\n  token: string;\n  expiresAt: string;\n  createdAt: string;\n}\n\n// \u751F\u6210\u5B89\u5168\u7684\u9A8C\u8BC1\u7801\nfunction generateVerificationCode(): string {\n  return Math.random().toString().slice(2, 8);\n}\n\n// \u751F\u6210Magic Link\u4EE4\u724C\nfunction generateMagicToken(): string {\n  return crypto.randomUUID() + '_' + Date.now();\n}\n\n// \u751F\u6210JWT\u4F1A\u8BDD\u4EE4\u724C\nfunction generateSessionToken(): string {\n  return crypto.randomUUID() + '_' + Math.random().toString(36).substr(2, 16);\n}\n\n// \u751F\u6210\u7528\u6237ID\nfunction generateUserId(): string {\n  return `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\n// \u9A8C\u8BC1\u90AE\u7BB1\u683C\u5F0F\nfunction isValidEmail(email: string): boolean {\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return emailRegex.test(email);\n}\n\n// \u53D1\u9001\u9A8C\u8BC1\u90AE\u4EF6 - AWS SES\u96C6\u6210\nasync function sendVerificationEmail(env: any, email: string, code: string, type: 'code' | 'magic', language: 'zh-CN' | 'en' = 'zh-CN'): Promise<boolean> {\n  try {\n    // \u68C0\u67E5\u662F\u5426\u914D\u7F6E\u4E86AWS SES\n    if (env.AWS_ACCESS_KEY_ID && env.AWS_SECRET_ACCESS_KEY && env.AWS_REGION && env.FROM_EMAIL) {\n      const { AWSEmailService } = await import('../lib/email-service');\n      \n      const emailService = new AWSEmailService({\n        accessKeyId: env.AWS_ACCESS_KEY_ID,\n        secretAccessKey: env.AWS_SECRET_ACCESS_KEY,\n        region: env.AWS_REGION,\n        fromEmail: env.FROM_EMAIL\n      });\n      \n      if (type === 'code') {\n        // \u53D1\u9001\u9A8C\u8BC1\u7801\u90AE\u4EF6\n        const success = await emailService.sendVerificationCode({\n          email,\n          code,\n          language\n        });\n        \n        if (success) {\n          console.log(`AWS SES\u9A8C\u8BC1\u7801\u90AE\u4EF6\u53D1\u9001\u6210\u529F: ${email}`);\n        } else {\n          console.error(`AWS SES\u9A8C\u8BC1\u7801\u90AE\u4EF6\u53D1\u9001\u5931\u8D25: ${email}`);\n        }\n        \n        return success;\n      } else {\n        // \u53D1\u9001Magic Link\u90AE\u4EF6\n        const magicLink = `https://svtr.ai/api/auth?action=verify_magic_link&token=${code}`;\n        const success = await emailService.sendMagicLink({\n          email,\n          magicLink,\n          language\n        });\n        \n        if (success) {\n          console.log(`AWS SES Magic Link\u90AE\u4EF6\u53D1\u9001\u6210\u529F: ${email}`);\n        } else {\n          console.error(`AWS SES Magic Link\u90AE\u4EF6\u53D1\u9001\u5931\u8D25: ${email}`);\n        }\n        \n        return success;\n      }\n    } else {\n      // \u6A21\u62DF\u53D1\u9001\uFF08\u5F00\u53D1\u73AF\u5883\uFF09\n      console.log(`[\u6A21\u62DF\u53D1\u9001] ${type === 'code' ? '\u9A8C\u8BC1\u7801' : 'Magic Link'}\u90AE\u4EF6\u5230: ${email}`);\n      console.log(`[\u6A21\u62DF\u5185\u5BB9] ${type === 'code' ? `\u9A8C\u8BC1\u7801: ${code}` : `Magic Link: https://svtr.ai/api/auth?action=verify_magic_link&token=${code}`}`);\n      \n      return true;\n    }\n  } catch (error) {\n    console.error('\u90AE\u4EF6\u53D1\u9001\u5931\u8D25:', error);\n    return false;\n  }\n}\n\n// \u521B\u5EFA\u6216\u66F4\u65B0\u7528\u6237\nasync function createOrUpdateUser(env: any, email: string, userData: Partial<User>): Promise<User> {\n  const existingUserData = await env.SVTR_CACHE.get(`user_${email}`);\n  \n  if (existingUserData) {\n    // \u66F4\u65B0\u73B0\u6709\u7528\u6237\n    const existingUser: User = JSON.parse(existingUserData);\n    const updatedUser: User = {\n      ...existingUser,\n      ...userData,\n      lastLoginAt: new Date().toISOString()\n    };\n    \n    await env.SVTR_CACHE.put(`user_${email}`, JSON.stringify(updatedUser));\n    await env.SVTR_CACHE.put(`user_id_${updatedUser.id}`, JSON.stringify(updatedUser));\n    \n    return updatedUser;\n  } else {\n    // \u521B\u5EFA\u65B0\u7528\u6237\n    const newUser: User = {\n      id: generateUserId(),\n      email,\n      name: userData.name || email.split('@')[0],\n      avatar: userData.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(email)}&background=FA8C32&color=fff`,\n      provider: userData.provider || 'email',\n      createdAt: new Date().toISOString(),\n      lastLoginAt: new Date().toISOString(),\n      isActive: true\n    };\n    \n    await env.SVTR_CACHE.put(`user_${email}`, JSON.stringify(newUser));\n    await env.SVTR_CACHE.put(`user_id_${newUser.id}`, JSON.stringify(newUser));\n    \n    return newUser;\n  }\n}\n\n// \u521B\u5EFA\u7528\u6237\u4F1A\u8BDD\nasync function createUserSession(env: any, user: User): Promise<string> {\n  const sessionToken = generateSessionToken();\n  const expiresAt = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(); // 30\u5929\u8FC7\u671F\n  \n  const session: AuthSession = {\n    userId: user.id,\n    email: user.email,\n    token: sessionToken,\n    expiresAt,\n    createdAt: new Date().toISOString()\n  };\n  \n  await env.SVTR_CACHE.put(`session_${sessionToken}`, JSON.stringify(session), {\n    expirationTtl: 30 * 24 * 60 * 60 // 30\u5929\n  });\n  \n  return sessionToken;\n}\n\n// \u5904\u7406POST\u8BF7\u6C42 - \u53D1\u9001\u9A8C\u8BC1\u7801/Magic Link\u3001\u9A8C\u8BC1\u767B\u5F55\nexport async function onRequestPost(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    const requestData = await request.json();\n    const { action } = requestData;\n    \n    console.log('\u8BA4\u8BC1\u8BF7\u6C42:', action, requestData);\n    \n    if (action === 'send_code') {\n      const { email } = requestData;\n      \n      if (!email || !isValidEmail(email)) {\n        return new Response(JSON.stringify({\n          success: false,\n          message: '\u8BF7\u63D0\u4F9B\u6709\u6548\u7684\u90AE\u7BB1\u5730\u5740'\n        }), {\n          status: 400,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      }\n      \n      // \u68C0\u67E5\u53D1\u9001\u9891\u7387\u9650\u5236\uFF08\u9632\u6B62\u6EE5\u7528\uFF09\n      const rateLimitKey = `rate_limit_${email}`;\n      const lastSent = await env.SVTR_CACHE.get(rateLimitKey);\n      \n      if (lastSent && Date.now() - parseInt(lastSent) < 60000) { // 1\u5206\u949F\u5185\u53EA\u80FD\u53D1\u9001\u4E00\u6B21\n        return new Response(JSON.stringify({\n          success: false,\n          message: '\u9A8C\u8BC1\u7801\u53D1\u9001\u8FC7\u4E8E\u9891\u7E41\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5'\n        }), {\n          status: 429,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      }\n      \n      const code = generateVerificationCode();\n      \n      // \u5B58\u50A8\u9A8C\u8BC1\u7801\uFF085\u5206\u949F\u6709\u6548\uFF09\n      await env.SVTR_CACHE.put(`email_code_${email}`, code, {\n        expirationTtl: 300\n      });\n      \n      // \u8BB0\u5F55\u53D1\u9001\u65F6\u95F4\n      await env.SVTR_CACHE.put(rateLimitKey, Date.now().toString(), {\n        expirationTtl: 60\n      });\n      \n      // \u53D1\u9001\u9A8C\u8BC1\u90AE\u4EF6\n      const language = requestData.language || 'zh-CN';\n      const emailSent = await sendVerificationEmail(env, email, code, 'code', language);\n      \n      if (emailSent) {\n        return new Response(JSON.stringify({\n          success: true,\n          message: '\u9A8C\u8BC1\u7801\u5DF2\u53D1\u9001\u5230\u60A8\u7684\u90AE\u7BB1\uFF0C5\u5206\u949F\u5185\u6709\u6548'\n        }), {\n          status: 200,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      } else {\n        return new Response(JSON.stringify({\n          success: false,\n          message: '\u9A8C\u8BC1\u7801\u53D1\u9001\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5'\n        }), {\n          status: 500,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      }\n    }\n    \n    if (action === 'send_magic_link') {\n      const { email } = requestData;\n      \n      if (!email || !isValidEmail(email)) {\n        return new Response(JSON.stringify({\n          success: false,\n          message: '\u8BF7\u63D0\u4F9B\u6709\u6548\u7684\u90AE\u7BB1\u5730\u5740'\n        }), {\n          status: 400,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      }\n      \n      // \u68C0\u67E5\u53D1\u9001\u9891\u7387\u9650\u5236\n      const rateLimitKey = `magic_limit_${email}`;\n      const lastSent = await env.SVTR_CACHE.get(rateLimitKey);\n      \n      if (lastSent && Date.now() - parseInt(lastSent) < 60000) {\n        return new Response(JSON.stringify({\n          success: false,\n          message: '\u767B\u5F55\u94FE\u63A5\u53D1\u9001\u8FC7\u4E8E\u9891\u7E41\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5'\n        }), {\n          status: 429,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      }\n      \n      const magicToken = generateMagicToken();\n      \n      // \u5B58\u50A8Magic Token\uFF0810\u5206\u949F\u6709\u6548\uFF09\n      await env.SVTR_CACHE.put(`magic_token_${magicToken}`, email, {\n        expirationTtl: 600\n      });\n      \n      // \u8BB0\u5F55\u53D1\u9001\u65F6\u95F4\n      await env.SVTR_CACHE.put(rateLimitKey, Date.now().toString(), {\n        expirationTtl: 60\n      });\n      \n      // \u53D1\u9001Magic Link\u90AE\u4EF6\n      const language = requestData.language || 'zh-CN';\n      const emailSent = await sendVerificationEmail(env, email, magicToken, 'magic', language);\n      \n      if (emailSent) {\n        return new Response(JSON.stringify({\n          success: true,\n          message: '\u767B\u5F55\u94FE\u63A5\u5DF2\u53D1\u9001\u5230\u60A8\u7684\u90AE\u7BB1\uFF0C10\u5206\u949F\u5185\u6709\u6548'\n        }), {\n          status: 200,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      } else {\n        return new Response(JSON.stringify({\n          success: false,\n          message: '\u767B\u5F55\u94FE\u63A5\u53D1\u9001\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5'\n        }), {\n          status: 500,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      }\n    }\n    \n    if (action === 'verify_code') {\n      const { email, code } = requestData;\n      \n      if (!email || !code) {\n        return new Response(JSON.stringify({\n          success: false,\n          message: '\u8BF7\u63D0\u4F9B\u90AE\u7BB1\u548C\u9A8C\u8BC1\u7801'\n        }), {\n          status: 400,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      }\n      \n      const storedCode = await env.SVTR_CACHE.get(`email_code_${email}`);\n      \n      if (!storedCode || storedCode !== code) {\n        return new Response(JSON.stringify({\n          success: false,\n          message: '\u9A8C\u8BC1\u7801\u9519\u8BEF\u6216\u5DF2\u8FC7\u671F'\n        }), {\n          status: 400,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      }\n      \n      // \u9A8C\u8BC1\u6210\u529F\uFF0C\u5220\u9664\u9A8C\u8BC1\u7801\n      await env.SVTR_CACHE.delete(`email_code_${email}`);\n      \n      // \u521B\u5EFA\u6216\u66F4\u65B0\u7528\u6237\n      const user = await createOrUpdateUser(env, email, { provider: 'email' });\n      \n      // \u521B\u5EFA\u4F1A\u8BDD\n      const sessionToken = await createUserSession(env, user);\n      \n      return new Response(JSON.stringify({\n        success: true,\n        message: '\u767B\u5F55\u6210\u529F',\n        data: {\n          user: {\n            id: user.id,\n            email: user.email,\n            name: user.name,\n            avatar: user.avatar\n          },\n          token: sessionToken\n        }\n      }), {\n        status: 200,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    return new Response(JSON.stringify({\n      success: false,\n      message: '\u65E0\u6548\u7684\u64CD\u4F5C\u7C7B\u578B'\n    }), {\n      status: 400,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n    \n  } catch (error) {\n    console.error('\u8BA4\u8BC1\u5904\u7406\u5931\u8D25:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      message: '\u670D\u52A1\u5668\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5',\n      error: String(error)\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n  }\n}\n\n// \u5904\u7406GET\u8BF7\u6C42 - Magic Link\u9A8C\u8BC1\u3001\u4F1A\u8BDD\u9A8C\u8BC1\nexport async function onRequestGet(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    const url = new URL(request.url);\n    const action = url.searchParams.get('action');\n    const token = url.searchParams.get('token');\n    \n    console.log('GET\u8BA4\u8BC1\u8BF7\u6C42:', action, token);\n    \n    if (action === 'verify_magic_link' && token) {\n      // \u9A8C\u8BC1Magic Link\n      const email = await env.SVTR_CACHE.get(`magic_token_${token}`);\n      \n      if (!email) {\n        return new Response(JSON.stringify({\n          success: false,\n          message: '\u767B\u5F55\u94FE\u63A5\u65E0\u6548\u6216\u5DF2\u8FC7\u671F'\n        }), {\n          status: 400,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      }\n      \n      // \u9A8C\u8BC1\u6210\u529F\uFF0C\u5220\u9664token\n      await env.SVTR_CACHE.delete(`magic_token_${token}`);\n      \n      // \u521B\u5EFA\u6216\u66F4\u65B0\u7528\u6237\n      const user = await createOrUpdateUser(env, email, { provider: 'email' });\n      \n      // \u521B\u5EFA\u4F1A\u8BDD\n      const sessionToken = await createUserSession(env, user);\n      \n      return new Response(JSON.stringify({\n        success: true,\n        message: '\u767B\u5F55\u6210\u529F',\n        data: {\n          user: {\n            id: user.id,\n            email: user.email,\n            name: user.name,\n            avatar: user.avatar\n          },\n          token: sessionToken\n        }\n      }), {\n        status: 200,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    if (action === 'verify_session' && token) {\n      // \u9A8C\u8BC1\u4F1A\u8BDDtoken\n      const sessionData = await env.SVTR_CACHE.get(`session_${token}`);\n      \n      if (!sessionData) {\n        return new Response(JSON.stringify({\n          success: false,\n          message: '\u4F1A\u8BDD\u65E0\u6548\u6216\u5DF2\u8FC7\u671F'\n        }), {\n          status: 401,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      }\n      \n      const session: AuthSession = JSON.parse(sessionData);\n      \n      // \u68C0\u67E5\u4F1A\u8BDD\u662F\u5426\u8FC7\u671F\n      if (new Date(session.expiresAt) < new Date()) {\n        await env.SVTR_CACHE.delete(`session_${token}`);\n        return new Response(JSON.stringify({\n          success: false,\n          message: '\u4F1A\u8BDD\u5DF2\u8FC7\u671F'\n        }), {\n          status: 401,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      }\n      \n      // \u83B7\u53D6\u7528\u6237\u4FE1\u606F\n      const userData = await env.SVTR_CACHE.get(`user_id_${session.userId}`);\n      if (!userData) {\n        return new Response(JSON.stringify({\n          success: false,\n          message: '\u7528\u6237\u4E0D\u5B58\u5728'\n        }), {\n          status: 404,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      }\n      \n      const user: User = JSON.parse(userData);\n      \n      return new Response(JSON.stringify({\n        success: true,\n        data: {\n          user: {\n            id: user.id,\n            email: user.email,\n            name: user.name,\n            avatar: user.avatar\n          }\n        }\n      }), {\n        status: 200,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    return new Response(JSON.stringify({\n      success: false,\n      message: '\u65E0\u6548\u7684\u8BF7\u6C42\u53C2\u6570'\n    }), {\n      status: 400,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n    \n  } catch (error) {\n    console.error('GET\u8BA4\u8BC1\u5904\u7406\u5931\u8D25:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      message: '\u670D\u52A1\u5668\u9519\u8BEF',\n      error: String(error)\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n  }\n}\n\n// \u5904\u7406OPTIONS\u8BF7\u6C42 - CORS with multi-domain support\nexport async function onRequestOptions(context: any): Promise<Response> {\n  const { request } = context;\n  return new Response(null, {\n    status: 200,\n    headers: getCorsHeaders(request)\n  });\n}", "/**\n * SVTR.AI \u6DF7\u5408RAG\u670D\u52A1\n * \u7ED3\u5408\u591A\u79CD\u68C0\u7D22\u7B56\u7565\uFF0C\u5B9E\u73B0\u6210\u672C\u4F18\u5316\u548C\u8D28\u91CF\u4FDD\u8BC1\n * \u589E\u5F3A\u7248\uFF1A\u96C6\u6210\u67E5\u8BE2\u6269\u5C55\u548C\u8BED\u4E49\u4F18\u5316\n */\n\n// \u79FB\u9664\u4E0D\u5B58\u5728\u7684\u4F9D\u8D56\u670D\u52A1\uFF0C\u4F7F\u7528\u5185\u8054\u5B9E\u73B0\n\ninterface HybridRAGConfig {\n  useOpenAI: boolean;\n  useCloudflareAI: boolean;\n  useKeywordSearch: boolean;\n  useWebSearch: boolean;\n  fallbackEnabled: boolean;\n}\n\nexport class HybridRAGService {\n  private config: HybridRAGConfig;\n  private vectorize: any;\n  private ai: any;\n  private openaiApiKey?: string;\n  private requestContext?: Request;\n\n  constructor(vectorize: any, ai: any, openaiApiKey?: string, kvNamespace?: any, webSearchConfig?: any, requestContext?: Request) {\n    this.vectorize = vectorize;\n    this.ai = ai;\n    this.openaiApiKey = openaiApiKey;\n    this.requestContext = requestContext;\n    \n    // \u667A\u80FD\u914D\u7F6E\uFF1A\u6839\u636E\u53EF\u7528\u8D44\u6E90\u81EA\u52A8\u9009\u62E9\u7B56\u7565 - \u6DF7\u5408\u77E5\u8BC6\u5E93+\u5B9E\u65F6\u641C\u7D22\n    this.config = {\n      useOpenAI: !!openaiApiKey,\n      useCloudflareAI: !!ai,\n      useKeywordSearch: true,\n      useWebSearch: true, // \u542F\u7528\u6539\u8FDB\u7684\u7F51\u7EDC\u641C\u7D22\n      fallbackEnabled: true\n    };\n  }\n\n  /**\n   * \u667A\u80FD\u68C0\u7D22\uFF1A\u589E\u5F3A\u9519\u8BEF\u5904\u7406\u7248\u672C\n   */\n  async performIntelligentRAG(query: string, options: any = {}) {\n    const startTime = Date.now();\n    console.log('\uD83D\uDD0D \u5F00\u59CBRAG\u68C0\u7D22...');\n    \n    try {\n      // \u8F93\u5165\u9A8C\u8BC1\n      if (!query || typeof query !== 'string' || query.trim().length === 0) {\n        throw new Error('\u67E5\u8BE2\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A');\n      }\n\n      // \u7279\u6B8A\u5904\u7406\uFF1A\u8054\u7CFB\u65B9\u5F0F\u67E5\u8BE2\u9A8C\u8BC1\n      const isContactQuery = this.isContactInfoQuery(query);\n      if (isContactQuery) {\n        console.log('\uD83D\uDCDE \u68C0\u6D4B\u5230\u8054\u7CFB\u65B9\u5F0F\u67E5\u8BE2\uFF0C\u542F\u7528\u7279\u6B8A\u8FC7\u6EE4\u903B\u8F91');\n        options.contactInfoQuery = true;\n        options.strictFiltering = true;\n      }\n      \n      const strategies = [];\n      \n      // \u7B56\u75651: \u5411\u91CF\u68C0\u7D22\uFF08\u5982\u679C\u53EF\u7528\uFF09\n      if (this.config.useOpenAI || this.config.useCloudflareAI) {\n        strategies.push(this.vectorSearch(query, options));\n      }\n      \n      // \u7B56\u75652: \u5173\u952E\u8BCD\u68C0\u7D22\n      strategies.push(this.keywordSearch(query, options));\n      \n      // \u7B56\u75653: \u8BED\u4E49\u6A21\u5F0F\u5339\u914D\n      strategies.push(this.semanticPatternMatch(query, options));\n      \n      // \u786E\u4FDD\u81F3\u5C11\u6709\u4E00\u4E2A\u7B56\u7565\n      if (strategies.length === 0) {\n        throw new Error('\u6CA1\u6709\u53EF\u7528\u7684\u68C0\u7D22\u7B56\u7565');\n      }\n\n      // \u5E76\u884C\u6267\u884C\u6240\u6709\u7B56\u7565\uFF0C\u8BBE\u7F6E\u8D85\u65F6\n      const results = await Promise.allSettled(strategies);\n      \n      // \u9A8C\u8BC1\u662F\u5426\u6709\u6210\u529F\u7684\u7ED3\u679C\n      const successfulResults = results.filter(r => r.status === 'fulfilled');\n      if (successfulResults.length === 0) {\n        console.warn('\u6240\u6709\u68C0\u7D22\u7B56\u7565\u90FD\u5931\u8D25\u4E86\uFF0C\u8FD4\u56DE\u9ED8\u8BA4\u54CD\u5E94');\n        return this.getDefaultResponse(query);\n      }\n\n      // \u5408\u5E76\u548C\u6392\u5E8F\u7ED3\u679C\n      const mergedResults = this.mergeResults(results, query);\n      \n      // \u6784\u5EFA\u6700\u7EC8\u7ED3\u679C\n      const finalResults = {\n        ...mergedResults,\n        searchQuery: query,\n        fromCache: false,\n        responseTime: Date.now() - startTime,\n        enhancedFeatures: {\n          multiStrategyRetrieval: true,\n          successfulStrategies: successfulResults.length,\n          totalStrategies: strategies.length\n        }\n      };\n      \n      return finalResults;\n    } catch (error) {\n      console.error('RAG\u68C0\u7D22\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF:', error);\n      return this.getErrorResponse(query, error.message);\n    }\n  }\n\n  /**\n   * \u5411\u91CF\u68C0\u7D22\uFF08\u652F\u6301\u591A\u6A21\u578B\uFF09\n   */\n  private async vectorSearch(query: string, options: any) {\n    try {\n      let queryVector;\n      \n      if (this.config.useOpenAI) {\n        queryVector = await this.getOpenAIEmbedding(query);\n      } else if (this.config.useCloudflareAI) {\n        queryVector = await this.getCloudflareEmbedding(query);\n      } else {\n        throw new Error('No embedding service available');\n      }\n      \n      return await this.vectorize.query(queryVector, {\n        topK: options.topK || 5,\n        returnMetadata: 'all'\n      });\n      \n    } catch (error) {\n      console.log('\u5411\u91CF\u68C0\u7D22\u5931\u8D25\uFF0C\u4F7F\u7528\u5907\u7528\u65B9\u6848');\n      return { matches: [], source: 'vector-failed' };\n    }\n  }\n\n  /**\n   * \u5173\u952E\u8BCD\u68C0\u7D22\uFF08\u7EAF\u6587\u672C\u5339\u914D\uFF09\n   */\n  private async keywordSearch(query: string, options: any) {\n    // \u5B9E\u73B0\u57FA\u4E8E\u5173\u952E\u8BCD\u7684\u68C0\u7D22\u903B\u8F91\n    const keywords = this.extractKeywords(query);\n    const matches = await this.findKeywordMatches(keywords);\n    \n    return {\n      matches: matches.map(match => ({\n        ...match,\n        score: match.keywordScore,\n        source: 'keyword'\n      })),\n      source: 'keyword'\n    };\n  }\n\n\n  /**\n   * \u8BED\u4E49\u6A21\u5F0F\u5339\u914D\n   */\n  private async semanticPatternMatch(query: string, options: any) {\n    const patterns = {\n      investment: ['\u6295\u8D44', '\u878D\u8D44', '\u8F6E\u6B21', 'vc', 'funding'],\n      startup: ['\u516C\u53F8', '\u521B\u4E1A', '\u4F01\u4E1A', 'startup', 'company'],  \n      trend: ['\u8D8B\u52BF', '\u5E02\u573A', '\u524D\u666F', 'trend', 'market'],\n      technology: ['\u6280\u672F', 'ai', '\u4EBA\u5DE5\u667A\u80FD', 'tech']\n    };\n    \n    const queryLower = query.toLowerCase();\n    const scores = {};\n    \n    for (const [category, keywords] of Object.entries(patterns)) {\n      scores[category] = keywords.reduce((score, keyword) => {\n        return score + (queryLower.includes(keyword) ? 1 : 0);\n      }, 0);\n    }\n    \n    const bestCategory = Object.entries(scores)\n      .sort(([,a], [,b]) => b - a)[0][0];\n    \n    return {\n      matches: await this.getCategoryContent(bestCategory),\n      source: 'pattern',\n      category: bestCategory\n    };\n  }\n\n  /**\n   * \u7ED3\u679C\u5408\u5E76\u548C\u6392\u5E8F\n   */\n  private mergeResults(results: any[], query: string) {\n    const allMatches = [];\n    \n    results.forEach((result, index) => {\n      if (result.status === 'fulfilled' && result.value.matches) {\n        result.value.matches.forEach(match => {\n          allMatches.push({\n            ...match,\n            strategy: result.value.source,\n            strategyIndex: index\n          });\n        });\n      }\n    });\n    \n    // \u53BB\u91CD\u548C\u8BC4\u5206\n    const deduplicated = this.deduplicateMatches(allMatches);\n    const scored = this.rescoreMatches(deduplicated, query);\n    \n    return {\n      matches: scored.slice(0, 8), // \u8FD4\u56DEtop 8\n      sources: this.extractSources(scored),\n      confidence: this.calculateConfidence(scored),\n      strategies: results.length\n    };\n  }\n\n  /**\n   * \u63D0\u53D6\u5173\u952E\u8BCD\n   */\n  private extractKeywords(query: string): string[] {\n    // \u7B80\u5355\u7684\u5173\u952E\u8BCD\u63D0\u53D6\n    return query\n      .toLowerCase()\n      .replace(/[^\\w\\s\\u4e00-\\u9fa5]/g, '')\n      .split(/\\s+/)\n      .filter(word => word.length > 1);\n  }\n\n  /**\n   * \u57FA\u4E8E\u9884\u5B58\u5185\u5BB9\u7684\u5173\u952E\u8BCD\u5339\u914D\n   */\n  private async findKeywordMatches(keywords: string[]) {\n    // \u8FD9\u91CC\u53EF\u4EE5\u5B9E\u73B0\u57FA\u4E8E\u9884\u5B58\u6587\u6863\u7684\u5173\u952E\u8BCD\u5339\u914D\n    // \u6216\u8005\u76F4\u63A5\u5339\u914D\u98DE\u4E66\u540C\u6B65\u7684JSON\u6570\u636E\n    const documents = await this.getStoredDocuments();\n    \n    return documents.filter(doc => {\n      const content = (doc.content || '').toLowerCase();\n      return keywords.some(keyword => content.includes(keyword));\n    }).map(doc => ({\n      ...doc,\n      keywordScore: this.calculateKeywordScore(doc.content, keywords)\n    }));\n  }\n\n  /**\n   * \u83B7\u53D6\u5206\u7C7B\u5185\u5BB9\uFF08\u57FA\u4E8E\u8BED\u4E49\u6A21\u5F0F\uFF09\n   */\n  private async getCategoryContent(category: string) {\n    const allDocs = await this.getStoredDocuments();\n    \n    // \u6839\u636E\u5206\u7C7B\u8FD4\u56DE\u6700\u76F8\u5173\u7684\u5185\u5BB9\n    const categoryKeywords = {\n      investment: ['\u6295\u8D44', '\u878D\u8D44', '\u8D44\u91D1', '\u8F6E\u6B21', '\u4F30\u503C', 'vc', '\u57FA\u91D1'],\n      startup: ['\u516C\u53F8', '\u521D\u521B', '\u521B\u4E1A', '\u4F01\u4E1A', '\u56E2\u961F', '\u72EC\u89D2\u517D'],  \n      trend: ['\u8D8B\u52BF', '\u5E02\u573A', '\u53D1\u5C55', '\u524D\u666F', '\u9884\u6D4B', '\u672A\u6765'],\n      technology: ['\u6280\u672F', 'ai', '\u4EBA\u5DE5\u667A\u80FD', '\u7B97\u6CD5', '\u6A21\u578B']\n    };\n\n    const keywords = categoryKeywords[category] || [];\n    if (keywords.length === 0) return [];\n\n    // \u4F7F\u7528\u5173\u952E\u8BCD\u8FC7\u6EE4\u548C\u8BC4\u5206\n    const relevantDocs = allDocs\n      .map(doc => ({\n        ...doc,\n        categoryScore: this.calculateCategoryScore(doc, keywords)\n      }))\n      .filter(doc => doc.categoryScore > 0.3)\n      .sort((a, b) => b.categoryScore - a.categoryScore)\n      .slice(0, 5); // \u8FD4\u56DE\u524D5\u4E2A\u6700\u76F8\u5173\u7684\n\n    return relevantDocs.map(doc => ({\n      id: doc.id,\n      content: doc.content,\n      title: doc.title,\n      score: doc.categoryScore,\n      source: doc.source,\n      type: doc.type\n    }));\n  }\n\n  /**\n   * \u8BA1\u7B97\u5206\u7C7B\u76F8\u5173\u6027\u5206\u6570\n   */\n  private calculateCategoryScore(doc: any, categoryKeywords: string[]): number {\n    const content = (doc.content || '').toLowerCase();\n    const title = (doc.title || '').toLowerCase();\n    const keywords = doc.keywords || [];\n\n    let score = 0;\n    let matches = 0;\n\n    // \u5185\u5BB9\u5339\u914D\n    categoryKeywords.forEach(keyword => {\n      const keywordLower = keyword.toLowerCase();\n      if (content.includes(keywordLower)) {\n        score += 0.3;\n        matches++;\n      }\n      if (title.includes(keywordLower)) {\n        score += 0.5; // \u6807\u9898\u5339\u914D\u6743\u91CD\u66F4\u9AD8\n        matches++;\n      }\n    });\n\n    // \u9884\u8BBE\u5173\u952E\u8BCD\u5339\u914D\n    keywords.forEach(keyword => {\n      if (categoryKeywords.some(ck => \n        ck.toLowerCase().includes(keyword.toLowerCase()) || \n        keyword.toLowerCase().includes(ck.toLowerCase())\n      )) {\n        score += 0.4;\n        matches++;\n      }\n    });\n\n    // \u5F52\u4E00\u5316\n    return Math.min(score + (matches / categoryKeywords.length) * 0.2, 1.0);\n  }\n\n  /**\n   * \u53BB\u91CD\u5339\u914D\u7ED3\u679C\n   */\n  private deduplicateMatches(matches: any[]) {\n    const seen = new Set();\n    return matches.filter(match => {\n      const key = match.id || match.content?.substring(0, 100);\n      if (seen.has(key)) return false;\n      seen.add(key);\n      return true;\n    });\n  }\n\n  /**\n   * \u91CD\u65B0\u8BC4\u5206\n   */\n  private rescoreMatches(matches: any[], query: string) {\n    return matches.map(match => ({\n      ...match,\n      finalScore: this.calculateFinalScore(match, query)\n    })).sort((a, b) => b.finalScore - a.finalScore);\n  }\n\n  /**\n   * \u8BA1\u7B97\u6700\u7EC8\u5206\u6570\n   */\n  private calculateFinalScore(match: any, query: string): number {\n    let score = match.score || 0.5;\n    \n    // \u7B56\u7565\u52A0\u6743\n    if (match.strategy === 'vector') score *= 1.2;\n    if (match.strategy === 'keyword') score *= 1.0;  \n    if (match.strategy === 'pattern') score *= 0.8;\n    \n    // \u5185\u5BB9\u8D28\u91CF\u52A0\u6743\n    if (match.content && match.content.length > 200) score *= 1.1;\n    \n    return Math.min(score, 1.0);\n  }\n\n  /**\n   * \u8BA1\u7B97\u7F6E\u4FE1\u5EA6\n   */\n  private calculateConfidence(matches: any[]): number {\n    if (matches.length === 0) return 0;\n    \n    const avgScore = matches.reduce((sum, m) => sum + m.finalScore, 0) / matches.length;\n    const hasMultipleStrategies = new Set(matches.map(m => m.strategy)).size > 1;\n    \n    return Math.min(avgScore * (hasMultipleStrategies ? 1.2 : 1.0), 1.0);\n  }\n\n  /**\n   * \u63D0\u53D6\u6765\u6E90\u4FE1\u606F\n   */\n  private extractSources(matches: any[]): string[] {\n    const sources = new Set(matches.map(m => m.title || m.source || '\u77E5\u8BC6\u5E93'));\n    return Array.from(sources);\n  }\n\n  /**\n   * \u83B7\u53D6\u5B58\u50A8\u7684\u6587\u6863\uFF08\u4EC5\u4ECE\u98DE\u4E66\u771F\u5B9E\u540C\u6B65\u6570\u636E\uFF09\n   */\n  private async getStoredDocuments() {\n    try {\n      // \u53EA\u4ECE\u98DE\u4E66\u77E5\u8BC6\u5E93\u8BFB\u53D6\u771F\u5B9E\u6570\u636E\n      const documents = [];\n      \n      // 1. \u98DE\u4E66\u77E5\u8BC6\u5E93\u6570\u636E\n      try {\n        const feishuData = await this.loadFeishuKnowledgeBase();\n        documents.push(...feishuData);\n      } catch (e) { console.log('\u98DE\u4E66\u77E5\u8BC6\u5E93\u6570\u636E\u8BFB\u53D6\u5931\u8D25:', e.message); }\n      \n      // 2. \u9884\u8BBE\u77E5\u8BC6\u5E93\u4F5C\u4E3Afallback\n      if (documents.length === 0) {\n        documents.push(...this.getDefaultKnowledgeBase());\n      }\n      \n      return documents;\n    } catch (error) {\n      console.log('\u83B7\u53D6\u6587\u6863\u5931\u8D25\uFF0C\u4F7F\u7528\u9ED8\u8BA4\u77E5\u8BC6\u5E93');\n      return this.getDefaultKnowledgeBase();\n    }\n  }\n\n  /**\n   * \u52A0\u8F7D\u98DE\u4E66\u77E5\u8BC6\u5E93\u6570\u636E - \u4FEE\u590DCloudflare Workers\u73AF\u5883\u4E0B\u7684\u6587\u4EF6\u8BBF\u95EE\n   */\n  private async loadFeishuKnowledgeBase() {\n    try {\n      // \u6784\u5EFA\u5B8C\u6574URL - \u89E3\u51B3Workers\u73AF\u5883\u76F8\u5BF9\u8DEF\u5F84\u95EE\u9898\n      const baseUrl = this.getBaseUrl();\n      \n      // \u7B2C\u4E00\u4F18\u5148\u7EA7\uFF1A\u5B8C\u6574\u589E\u5F3A\u7248\u540C\u6B65\u6570\u636E\n      let response = await fetch(`${baseUrl}/assets/data/rag/enhanced-feishu-full-content.json`).catch(() => null);\n      \n      // \u7B2C\u4E8C\u4F18\u5148\u7EA7\uFF1A\u771F\u5B9E\u5185\u5BB9\u6570\u636E\n      if (!response || !response.ok) {\n        response = await fetch(`${baseUrl}/assets/data/rag/real-feishu-content.json`).catch(() => null);\n      }\n      \n      // \u7B2C\u4E09\u4F18\u5148\u7EA7\uFF1A\u6539\u8FDB\u7684\u77E5\u8BC6\u5E93\uFF08\u5411\u540E\u517C\u5BB9\uFF09\n      if (!response || !response.ok) {\n        response = await fetch(`${baseUrl}/assets/data/rag/improved-feishu-knowledge-base.json`).catch(() => null);\n      }\n      \n      if (!response || !response.ok) {\n        throw new Error('\u65E0\u6CD5\u8BFB\u53D6\u98DE\u4E66\u77E5\u8BC6\u5E93\u6570\u636E - \u6240\u6709\u6570\u636E\u6E90\u90FD\u4E0D\u53EF\u7528');\n      }\n      \n      const data = await response.json();\n      const documents = [];\n      \n      // \u5904\u7406\u589E\u5F3A\u7248\u5B8C\u6574\u540C\u6B65\u6570\u636E\u683C\u5F0F\uFF08\u6700\u9AD8\u4F18\u5148\u7EA7\uFF09\n      if (data.nodes && Array.isArray(data.nodes) && data.summary?.apiVersion === 'v2_enhanced') {\n        console.log('\u2705 \u4F7F\u7528\u589E\u5F3A\u7248\u5B8C\u6574\u540C\u6B65\u6570\u636E (V2)');\n        console.log(`\uD83D\uDCCA \u8282\u70B9\u6570\u91CF: ${data.nodes.length}, \u5E73\u5747\u5185\u5BB9\u957F\u5EA6: ${data.summary.avgContentLength}\u5B57\u7B26`);\n        \n        data.nodes.forEach(node => {\n          // \u53EA\u5904\u7406\u6709\u5B9E\u9645\u5185\u5BB9\u7684\u8282\u70B9\n          if (node.content && node.content.trim().length > 20) {\n            documents.push({\n              id: node.id,\n              content: node.content,\n              title: node.title,\n              type: node.type || 'wiki_node',\n              source: node.source || 'SVTR\u98DE\u4E66\u77E5\u8BC6\u5E93',\n              keywords: node.searchKeywords || [],\n              ragScore: node.ragScore || 0,\n              verified: true, // \u589E\u5F3A\u7248\u6570\u636E\u5DF2\u9A8C\u8BC1\n              lastUpdated: node.lastUpdated,\n              level: node.level || 0,\n              nodeToken: node.nodeToken,\n              contentLength: node.contentLength || 0,\n              docType: node.docType || node.objType,\n              semanticTags: node.semanticTags || []\n            });\n          }\n        });\n      }\n      // \u5904\u7406\u771F\u5B9E\u5185\u5BB9\u683C\u5F0F\n      else if (data.documents && Array.isArray(data.documents) && data.summary?.syncMethod === 'real_content_api') {\n        console.log('\u2705 \u4F7F\u7528\u771F\u5B9E\u98DE\u4E66API\u5185\u5BB9');\n        data.documents.forEach(doc => {\n          documents.push({\n            id: doc.id,\n            content: doc.content,\n            title: doc.title,\n            type: doc.type,\n            source: doc.source,\n            keywords: doc.keywords || doc.searchKeywords || [],\n            ragScore: doc.ragScore || 0,\n            verified: doc.metadata?.verified || false,\n            lastUpdated: doc.lastUpdated\n          });\n        });\n      } \n      // \u5904\u7406\u6539\u8FDB\u77E5\u8BC6\u5E93\u683C\u5F0F\uFF08\u5411\u540E\u517C\u5BB9\uFF09\n      else if (data.documents && Array.isArray(data.documents)) {\n        console.log('\u26A0\uFE0F \u4F7F\u7528\u5907\u7528\u77E5\u8BC6\u5E93\u5185\u5BB9');\n        data.documents.forEach(doc => {\n          documents.push({\n            id: doc.id || `feishu-${Math.random().toString(36).substr(2, 9)}`,\n            content: doc.content || '',\n            title: doc.title || '\u98DE\u4E66\u6587\u6863',\n            type: doc.type || 'feishu_doc',\n            source: '\u98DE\u4E66\u77E5\u8BC6\u5E93',\n            keywords: doc.keywords || [],\n            ragScore: doc.ragScore || 0,\n            verified: false\n          });\n        });\n      }\n      \n      console.log(`\uD83D\uDCCA \u5DF2\u52A0\u8F7D ${documents.length} \u4E2A\u98DE\u4E66\u6587\u6863 (${documents.filter(d => d.verified).length} \u4E2A\u5DF2\u9A8C\u8BC1)`);\n      return documents;\n    } catch (error) {\n      console.log('\u8BFB\u53D6\u98DE\u4E66\u77E5\u8BC6\u5E93\u5931\u8D25:', error.message);\n      return [];\n    }\n  }\n\n  /**\n   * \u83B7\u53D6\u9ED8\u8BA4\u77E5\u8BC6\u5E93\n   */\n  private getDefaultKnowledgeBase() {\n    return [\n      {\n        id: 'kb-investment-trends',\n        content: `2024\u5E74AI\u6295\u8D44\u8D8B\u52BF\u5206\u6790\uFF1A\u5168\u7403AI\u521B\u6295\u5E02\u573A\u5448\u73B0\u5206\u5316\u8D8B\u52BF\uFF0C\u4F01\u4E1A\u7EA7\u5E94\u7528\u6210\u4E3A\u6295\u8D44\u91CD\u70B9\u3002\n        \u8D44\u91D1\u6D41\u5411\uFF1AB2B AI\u89E3\u51B3\u65B9\u6848\u83B7\u5F9760%\u7684\u6295\u8D44\u4EFD\u989D\uFF0C\u6D88\u8D39\u7EA7AI\u5E94\u7528\u6295\u8D44\u4E0B\u964D30%\u3002\n        \u5730\u7406\u5206\u5E03\uFF1A\u7F8E\u56FD\u4FDD\u630145%\u5E02\u573A\u4EFD\u989D\uFF0C\u4E2D\u56FD25%\uFF0C\u6B27\u6D3215%\uFF0C\u5176\u4ED6\u5730\u533A15%\u3002\n        \u8F6E\u6B21\u5206\u5E03\uFF1AA\u8F6E\u548CB\u8F6E\u6700\u4E3A\u6D3B\u8DC3\uFF0C\u79CD\u5B50\u8F6E\u6295\u8D44\u8D8B\u4E8E\u8C28\u614E\uFF0CC\u8F6E\u53CA\u4EE5\u540E\u91CD\u70B9\u5173\u6CE8\u6536\u5165\u589E\u957F\u3002`,\n        title: 'AI\u6295\u8D44\u8D8B\u52BF\u5206\u6790',\n        type: 'analysis',\n        source: 'SVTR\u77E5\u8BC6\u5E93',\n        keywords: ['\u6295\u8D44\u8D8B\u52BF', 'B2B AI', '\u4F01\u4E1A\u7EA7\u5E94\u7528', '\u5730\u7406\u5206\u5E03', '\u8F6E\u6B21\u5206\u6790']\n      },\n      {\n        id: 'kb-startup-success',\n        content: `AI\u521D\u521B\u4F01\u4E1A\u6210\u529F\u8981\u7D20\u7814\u7A76\uFF1A\u57FA\u4E8ESVTR.AI\u8FFD\u8E2A\u768410761\u5BB6AI\u516C\u53F8\u6570\u636E\u5206\u6790\u3002\n        \u6280\u672F\u8981\u7D20\uFF1A\u62E5\u6709PhD\u7EA7\u522B\u6280\u672F\u56E2\u961F\u7684\u516C\u53F8\u6210\u529F\u7387\u9AD8\u51FA3\u500D\uFF0C\u4E13\u6709\u6570\u636E\u4F18\u52BF\u662F\u5173\u952E\u62A4\u57CE\u6CB3\u3002\n        \u5546\u4E1A\u8981\u7D20\uFF1A\u6E05\u6670\u7684\u4F01\u4E1A\u7EA7\u6536\u5165\u6A21\u5F0F\u3001\u5408\u7406\u7684\u5BA2\u6237\u83B7\u53D6\u6210\u672C\u3001\u5F3A\u5927\u7684\u9500\u552E\u6267\u884C\u80FD\u529B\u3002\n        \u8D44\u672C\u8981\u7D20\uFF1A\u9002\u5EA6\u7684\u878D\u8D44\u8282\u594F\u3001\u660E\u786E\u7684\u91CC\u7A0B\u7891\u8BBE\u5B9A\u3001\u6295\u8D44\u4EBA\u7684\u6218\u7565\u4EF7\u503C\u8D21\u732E\u3002`,\n        title: 'AI\u521D\u521B\u4F01\u4E1A\u6210\u529F\u8981\u7D20',\n        type: 'research',\n        source: 'SVTR\u77E5\u8BC6\u5E93', \n        keywords: ['\u521D\u521B\u4F01\u4E1A', '\u6210\u529F\u8981\u7D20', 'PhD\u56E2\u961F', '\u4E13\u6709\u6570\u636E', '\u4F01\u4E1A\u7EA7\u6536\u5165']\n      }\n    ];\n  }\n\n  /**\n   * OpenAI Embedding\u5B9E\u73B0\n   */\n  private async getOpenAIEmbedding(query: string): Promise<number[]> {\n    if (!this.openaiApiKey) {\n      throw new Error('OpenAI API\u5BC6\u94A5\u672A\u914D\u7F6E');\n    }\n\n    const response = await fetch('https://api.openai.com/v1/embeddings', {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${this.openaiApiKey}`,\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        model: 'text-embedding-3-small',\n        input: query,\n        dimensions: 1536\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      throw new Error(`OpenAI API\u9519\u8BEF: ${error.error?.message}`);\n    }\n\n    const data = await response.json();\n    return data.data[0].embedding;\n  }\n\n  /**\n   * Cloudflare AI Embedding\u5B9E\u73B0\n   */\n  private async getCloudflareEmbedding(query: string): Promise<number[]> {\n    if (!this.ai) {\n      throw new Error('Cloudflare AI\u672A\u914D\u7F6E');\n    }\n\n    try {\n      const response = await this.ai.run('@cf/baai/bge-base-en-v1.5', {\n        text: query\n      });\n      \n      return response.data[0];\n    } catch (error) {\n      throw new Error(`Cloudflare AI\u9519\u8BEF: ${error.message}`);\n    }\n  }\n\n\n\n  /**\n   * \u5173\u952E\u8BCD\u8BC4\u5206\u7B97\u6CD5\n   */\n  private calculateKeywordScore(content: string, keywords: string[]): number {\n    if (!content || keywords.length === 0) return 0;\n\n    const contentLower = content.toLowerCase();\n    const totalWords = content.split(/\\s+/).length;\n    let score = 0;\n    let matchedKeywords = 0;\n\n    keywords.forEach(keyword => {\n      const keywordLower = keyword.toLowerCase();\n      const regex = new RegExp(`\\\\b${keywordLower}\\\\b`, 'gi');\n      const matches = (contentLower.match(regex) || []).length;\n      \n      if (matches > 0) {\n        matchedKeywords++;\n        // TF-IDF\u98CE\u683C\u8BC4\u5206\n        const tf = matches / totalWords;\n        const boost = keyword.length > 2 ? 1.2 : 1.0; // \u957F\u8BCD\u52A0\u6743\n        score += tf * boost;\n      }\n    });\n\n    // \u5F52\u4E00\u5316\u5206\u6570\n    const coverageBonus = matchedKeywords / keywords.length;\n    return Math.min((score + coverageBonus * 0.3) * 2, 1.0);\n  }\n\n\n\n  /**\n   * \u68C0\u6D4B\u662F\u5426\u4E3A\u8054\u7CFB\u65B9\u5F0F\u67E5\u8BE2\n   */\n  private isContactInfoQuery(query: string): boolean {\n    const queryLower = query.toLowerCase();\n    const contactKeywords = [\n      '\u8054\u7CFB\u65B9\u5F0F', '\u8054\u7CFB', 'contact', '\u8054\u7CFB\u6211\u4EEC', '\u8054\u7CFB\u4FE1\u606F',\n      '\u7535\u8BDD', 'phone', '\u624B\u673A', 'mobile', 'tel',\n      '\u90AE\u7BB1', 'email', '\u90AE\u4EF6', 'mail',\n      '\u5730\u5740', 'address', '\u4F4D\u7F6E', 'location',\n      '\u5FAE\u4FE1', 'wechat', 'wx',\n      '\u5B98\u7F51', 'website', 'site', 'url',\n      '\u5982\u4F55\u8054\u7CFB', 'how to contact', '\u600E\u4E48\u8054\u7CFB',\n      'svtr\u8054\u7CFB', 'svtr contact', '\u7845\u8C37\u79D1\u6280\u8BC4\u8BBA\u8054\u7CFB'\n    ];\n    \n    return contactKeywords.some(keyword => queryLower.includes(keyword));\n  }\n\n  /**\n   * \u68C0\u6D4B\u5185\u5BB9\u662F\u5426\u5305\u542B\u7B2C\u4E09\u65B9\u516C\u53F8\u8054\u7CFB\u4FE1\u606F\uFF08\u9700\u8981\u8FC7\u6EE4\u6389\uFF09\n   */\n  private containsThirdPartyContactInfo(content: string, title: string): boolean {\n    const fullText = `${content} ${title}`.toLowerCase();\n    \n    // \u7B2C\u4E09\u65B9\u516C\u53F8\u5173\u952E\u8BCD\uFF08\u4ECERAG\u6570\u636E\u4E2D\u53D1\u73B0\u7684\uFF09\n    const thirdPartyCompanies = [\n      'glean', 'kleiner perkins', 'menlo park', 'palo alto',\n      '\u51EF\u9E4F\u534E\u76C8', '\u95E8\u6D1B\u5E15\u514B', 'carta', 'discord', 'consensus',\n      '5400 sand hill', 'sand hill road', '650 543 4800',\n      'info@svtr.ai', // \u8FD9\u4E2A\u90AE\u7BB1\u5728\u4EE3\u7801\u4E2D\u672A\u627E\u5230\uFF0C\u53EF\u80FD\u662F\u9519\u8BEF\u4FE1\u606F\n      'openai', 'anthropic', 'meta', 'google'\n    ];\n    \n    // \u7B2C\u4E09\u65B9\u5730\u5740\u6A21\u5F0F\n    const thirdPartyAddressPatterns = [\n      /menlo park.*ca.*94025/i,\n      /5400.*sand.*hill.*rd/i,\n      /suite.*200.*menlo.*park/i\n    ];\n    \n    const hasThirdPartyCompany = thirdPartyCompanies.some(company => \n      fullText.includes(company.toLowerCase())\n    );\n    \n    const hasThirdPartyAddress = thirdPartyAddressPatterns.some(pattern => \n      pattern.test(fullText)\n    );\n    \n    return hasThirdPartyCompany || hasThirdPartyAddress;\n  }\n\n  /**\n   * \u68C0\u6D4B\u5185\u5BB9\u662F\u5426\u5305\u542BSVTR\u5B98\u65B9\u8054\u7CFB\u4FE1\u606F\n   */\n  private containsSVTRContactInfo(content: string, title: string): boolean {\n    const fullText = `${content} ${title}`.toLowerCase();\n    \n    // SVTR\u5B98\u65B9\u786E\u8BA4\u7684\u8054\u7CFB\u4FE1\u606F\n    const svtrOfficialKeywords = [\n      'pkcapital2023',           // \u5B98\u65B9\u5FAE\u4FE1\u53F7\n      'svtr.ai',                 // \u5B98\u7F51\n      'https://svtr.ai',         // \u5B98\u7F51\u5B8C\u6574URL\n      'contact@svtr.ai',         // \u5B98\u65B9\u90AE\u7BB1\n      'svtr', 'svtr.ai',         // \u54C1\u724C\u540D\u79F0\n      '\u7845\u8C37\u79D1\u6280\u8BC4\u8BBA', '\u51EF\u745E',      // \u4E2D\u6587\u54C1\u724C\u540D\n      '\u8054\u7CFB\u6211\u4EEC', '\u8054\u7CFB\u65B9\u5F0F'       // \u901A\u7528\u8054\u7CFB\u9875\u9762\n    ];\n    \n    const hasSVTRKeywords = svtrOfficialKeywords.some(keyword => \n      fullText.includes(keyword.toLowerCase())\n    );\n    \n    // \u5982\u679C\u6587\u6863\u6807\u9898\u6216\u5185\u5BB9\u660E\u786E\u63D0\u5230SVTR\u4E14\u5305\u542B\u8054\u7CFB\u76F8\u5173\u8BCD\u6C47\n    const isSVTRContext = (\n      fullText.includes('svtr') || \n      fullText.includes('\u7845\u8C37\u79D1\u6280\u8BC4\u8BBA') || \n      fullText.includes('pkcapital')\n    );\n    \n    return hasSVTRKeywords && isSVTRContext;\n  }\n\n  /**\n   * \u83B7\u53D6\u57FA\u7840URL - \u89E3\u51B3Cloudflare Workers\u73AF\u5883\u4E0B\u7684\u6587\u4EF6\u8BBF\u95EE\u95EE\u9898\n   */\n  private getBaseUrl(): string {\n    // \u4F18\u5148\u4ECE\u8BF7\u6C42\u4E0A\u4E0B\u6587\u83B7\u53D6\n    if (this.requestContext) {\n      const url = new URL(this.requestContext.url);\n      return url.origin;\n    }\n    \n    // \u5728Cloudflare Workers\u73AF\u5883\u4E2D\uFF0C\u5C1D\u8BD5\u4ECE\u5168\u5C40\u53D8\u91CF\u83B7\u53D6URL\n    if (typeof globalThis !== 'undefined' && globalThis.location) {\n      return globalThis.location.origin;\n    }\n    \n    // \u4ECE\u8BF7\u6C42\u5934\u83B7\u53D6host\u4FE1\u606F\uFF08\u5982\u679C\u5728HTTP context\u4E2D\uFF09\n    if (typeof globalThis !== 'undefined' && globalThis.request) {\n      const request = globalThis.request as Request;\n      const url = new URL(request.url);\n      return url.origin;\n    }\n    \n    // \u6839\u636E\u73AF\u5883\u63A8\u65ADURL\n    if (typeof process !== 'undefined' && process.env.NODE_ENV === 'development') {\n      return 'http://localhost:3000';\n    }\n    \n    // \u751F\u4EA7\u73AF\u5883\u9ED8\u8BA4\u503C\n    return 'https://chat.svtr.ai';\n  }\n\n  /**\n   * \u9A8C\u8BC1\u5185\u5BB9\u8D28\u91CF - \u9632\u6B62\u65E0\u5173\u5185\u5BB9\u8FDB\u5165AI\u8F93\u5165\uFF0C\u907F\u514D\u7F16\u9020\n   */\n  private validateContentQuality(matches: any[], query: string): boolean {\n    if (!matches || matches.length === 0) return false;\n    \n    const queryKeywords = this.extractKeywords(query.toLowerCase());\n    if (queryKeywords.length === 0) return false;\n    \n    // \u68C0\u67E5\u6BCF\u4E2A\u5339\u914D\u7ED3\u679C\u7684\u76F8\u5173\u6027\n    let relevantMatches = 0;\n    \n    matches.forEach(match => {\n      const content = (match.content || '').toLowerCase();\n      const title = (match.title || '').toLowerCase();\n      \n      // \u8BA1\u7B97\u5173\u952E\u8BCD\u5339\u914D\u7387\n      const keywordMatches = queryKeywords.filter(keyword => \n        content.includes(keyword) || title.includes(keyword)\n      ).length;\n      \n      const matchRate = keywordMatches / queryKeywords.length;\n      \n      // \u5982\u679C\u5339\u914D\u7387>=30%\u4E14\u5185\u5BB9\u957F\u5EA6\u5408\u7406\uFF0C\u8BA4\u4E3A\u662F\u76F8\u5173\u5185\u5BB9\n      if (matchRate >= 0.3 && (match.content || '').length >= 50) {\n        relevantMatches++;\n      }\n    });\n    \n    // \u81F3\u5C1150%\u7684\u5339\u914D\u7ED3\u679C\u5FC5\u987B\u662F\u76F8\u5173\u7684\n    const relevancyRate = relevantMatches / matches.length;\n    const isQualityGood = relevancyRate >= 0.5;\n    \n    if (!isQualityGood) {\n      console.log(`\u26A0\uFE0F \u5185\u5BB9\u8D28\u91CF\u9A8C\u8BC1\u5931\u8D25: ${relevantMatches}/${matches.length} \u76F8\u5173\u5339\u914D\u7387=${(relevancyRate * 100).toFixed(1)}%`);\n    }\n    \n    return isQualityGood;\n  }\n\n  /**\n   * \u83B7\u53D6\u9ED8\u8BA4\u54CD\u5E94\uFF08\u5F53\u6240\u6709\u7B56\u7565\u90FD\u5931\u8D25\u65F6\uFF09\n   */\n  private getDefaultResponse(query: string) {\n    return {\n      matches: [],\n      sources: ['\u7CFB\u7EDF\u9ED8\u8BA4'],\n      confidence: 0.1,\n      strategies: 0,\n      searchQuery: query,\n      fromCache: false,\n      responseTime: 0,\n      error: true,\n      message: '\u62B1\u6B49\uFF0C\u5F53\u524D\u65E0\u6CD5\u83B7\u53D6\u76F8\u5173\u4FE1\u606F\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5\u3002',\n      enhancedFeatures: {\n        multiStrategyRetrieval: false,\n        successfulStrategies: 0,\n        totalStrategies: 0\n      }\n    };\n  }\n\n  /**\n   * \u83B7\u53D6\u9519\u8BEF\u54CD\u5E94\uFF08\u5F53\u53D1\u751F\u5F02\u5E38\u65F6\uFF09\n   */\n  private getErrorResponse(query: string, errorMessage: string) {\n    return {\n      matches: [],\n      sources: ['\u9519\u8BEF\u5904\u7406'],\n      confidence: 0,\n      strategies: 0,\n      searchQuery: query,\n      fromCache: false,\n      responseTime: 0,\n      error: true,\n      message: `\u641C\u7D22\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF\uFF1A${errorMessage}`,\n      enhancedFeatures: {\n        multiStrategyRetrieval: false,\n        successfulStrategies: 0,\n        totalStrategies: 0,\n        errorDetails: errorMessage\n      }\n    };\n  }\n\n}\n\n/**\n * \u5DE5\u5382\u51FD\u6570\uFF1A\u521B\u5EFA\u6700\u9002\u5408\u7684RAG\u670D\u52A1\n */\nexport function createOptimalRAGService(vectorize: any, ai: any, openaiApiKey?: string, kvNamespace?: any, webSearchConfig?: any, requestContext?: Request) {\n  return new HybridRAGService(vectorize, ai, openaiApiKey, kvNamespace, webSearchConfig, requestContext);\n}", "/**\n * SVTR.AI Enhanced Chat API with RAG Integration\n * \u96C6\u6210RAG\u529F\u80FD\u7684\u589E\u5F3A\u804A\u5929API\n */\n\nimport { createOptimalRAGService } from '../lib/hybrid-rag-service';\n\n// SVTR AI\u521B\u6295\u5E93\u67E5\u8BE2\u52A9\u624B - \u7B80\u6D01\u7684\u7CFB\u7EDF\u6307\u4EE4\nconst BASE_SYSTEM_PROMPT = `\u4F60\u662FSVTR AI\u521B\u6295\u5E93\u7684\u4E13\u4E1A\u6570\u636E\u67E5\u8BE2\u52A9\u624B\u3002\n\n\u6838\u5FC3\u539F\u5219\uFF1A\n1. \u4EC5\u57FA\u4E8E\u63D0\u4F9B\u7684\u77E5\u8BC6\u5E93\u5185\u5BB9\u56DE\u7B54\uFF0C\u7981\u6B62\u7F16\u9020\u3001\u63A8\u6D4B\u6216\u8865\u5145\u672A\u5728\u77E5\u8BC6\u5E93\u4E2D\u7684\u4FE1\u606F\n2. \u6570\u636E\u4E0D\u8DB3\u65F6\u660E\u786E\u8BF4\u660E\uFF0C\u4F7F\u7528\"SVTR\u77E5\u8BC6\u5E93\u4E2D\u6682\u65E0\u76F8\u5173\u6570\u636E\"\u7B49\u8868\u8FF0  \n3. \u6240\u6709\u6570\u5B57\u5FC5\u987B\u6765\u6E90\u4E8E\u77E5\u8BC6\u5E93\uFF0C\u4E0D\u5F97\u4F30\u7B97\u6216\u63A8\u6D4B\u4EFB\u4F55\u6570\u503C\n4. \u4FDD\u6301\u5BA2\u89C2\u4E2D\u7ACB\uFF0C\u63D0\u4F9B\u6570\u636E\u4E8B\u5B9E\uFF0C\u907F\u514D\u4E3B\u89C2\u5206\u6790\u5224\u65AD\n\n\u56DE\u7B54\u8981\u6C42\uFF1A\n- \u51C6\u786E\u6027\u4F18\u5148\u4E8E\u5B8C\u6574\u6027\n- \u627F\u8BA4\u6570\u636E\u5C40\u9650\u6027\uFF0C\u4E0D\u8FC7\u5EA6\u81EA\u4FE1\n- \u5F53\u77E5\u8BC6\u5E93\u4E2D\u6CA1\u6709\u76F8\u5173\u4FE1\u606F\u65F6\uFF0C\u660E\u786E\u56DE\u590D\"SVTR\u77E5\u8BC6\u5E93\u4E2D\u6682\u65E0\u8BE5\u4FE1\u606F\"\n- \u5F53\u4FE1\u606F\u4E0D\u5B8C\u6574\u65F6\uFF0C\u8BF4\u660E\"\u636E\u73B0\u6709\u6570\u636E\u663E\u793A\"\n- \u5F53\u9700\u8981\u63A8\u6D4B\u65F6\uFF0C\u660E\u786E\u8868\u793A\"\u65E0\u6CD5\u57FA\u4E8E\u73B0\u6709\u6570\u636E\u786E\u8BA4\"\n\n\u4E25\u683C\u57FA\u4E8ESVTR AI\u521B\u6295\u5E93\u63D0\u4F9B\u7684\u77E5\u8BC6\u5185\u5BB9\uFF0C\u7ED9\u51FA\u51C6\u786E\u3001\u5BA2\u89C2\u7684\u6570\u636E\u56DE\u590D\u3002`;\n\n/**\n * \u5224\u65AD\u662F\u5426\u9700\u8981\u663E\u793A\u6765\u6E90\u4FE1\u606F\n */\nfunction shouldShowSourceInfo(query: string, ragContext: any): boolean {\n  const lowerQuery = query.toLowerCase();\n  \n  // \u89E6\u53D1\u6761\u4EF61: \u660E\u786E\u8BE2\u95EE\u6570\u636E\u6765\u6E90\n  const sourceKeywords = ['\u6570\u636E\u6765\u6E90', '\u6765\u6E90', 'source', '\u4ECE\u54EA', '\u54EA\u91CC\u6765', '\u57FA\u4E8E\u4EC0\u4E48'];\n  const asksAboutSource = sourceKeywords.some(keyword => lowerQuery.includes(keyword));\n  \n  // \u89E6\u53D1\u6761\u4EF62: \u8BE2\u95EE\u5177\u4F53\u6570\u636E\uFF08\u4F30\u503C\u3001\u878D\u8D44\u7B49\u654F\u611F\u4FE1\u606F\uFF09\n  const dataKeywords = ['\u4F30\u503C', '\u878D\u8D44', '\u6295\u8D44', '\u8F6E\u6B21', '\u591A\u5C11', '\u6570\u636E', '\u6700\u65B0', '\u4EF7\u683C', '\u80A1\u4EF7'];\n  const asksAboutData = dataKeywords.some(keyword => lowerQuery.includes(keyword));\n  \n  // \u89E6\u53D1\u6761\u4EF63: \u5546\u4E1A\u76F8\u5173\u8BE2\u95EE\n  const businessKeywords = ['\u5408\u4F5C', '\u8054\u7CFB', '\u54A8\u8BE2', '\u670D\u52A1', '\u9879\u76EE', '\u5BF9\u63A5', '\u6295\u8D44\u673A\u4F1A'];\n  const asksAboutBusiness = businessKeywords.some(keyword => lowerQuery.includes(keyword));\n  \n  // \u89E6\u53D1\u6761\u4EF64: \u6709\u5B9E\u65F6\u641C\u7D22\u6570\u636E\n  const hasRealTimeData = ragContext.matches.some(m => m.source === 'web_search' || m.source === 'DuckDuckGo');\n  \n  // \u6EE1\u8DB3\u4EFB\u4E00\u6761\u4EF6\u5C31\u663E\u793A\u6765\u6E90\u4FE1\u606F\n  return asksAboutSource || asksAboutData || asksAboutBusiness || hasRealTimeData;\n}\n\n/**\n * \u5224\u65AD\u662F\u5426\u4E3A\u5546\u4E1A\u54A8\u8BE2\u8BE2\u95EE\n */\nfunction isBusinessInquiry(query: string): boolean {\n  const lowerQuery = query.toLowerCase();\n  \n  const businessKeywords = [\n    // \u6295\u8D44\u76F8\u5173\n    '\u6295\u8D44\u673A\u4F1A', '\u878D\u8D44', '\u9879\u76EE\u5BF9\u63A5', '\u5408\u4F5C', '\u54A8\u8BE2',\n    // \u4EA4\u6613\u76F8\u5173  \n    '\u4EA4\u6613', '\u5E76\u8D2D', '\u6536\u8D2D', '\u4F30\u503C', '\u5C3D\u8C03',\n    // \u670D\u52A1\u76F8\u5173\n    '\u670D\u52A1', '\u8054\u7CFB', '\u5546\u52A1', '\u4E1A\u52A1', '\u5BA2\u6237'\n  ];\n  \n  return businessKeywords.some(keyword => lowerQuery.includes(keyword));\n}\n\n/**\n * \u751F\u6210\u589E\u5F3A\u7684\u7CFB\u7EDF\u63D0\u793A\u8BCD\n */\nfunction generateEnhancedPrompt(basePrompt: string, ragContext: any): string {\n  if (!ragContext.matches || ragContext.matches.length === 0) {\n    return basePrompt;\n  }\n\n  const contextContent = ragContext.matches\n    .map((match: any, index: number) => {\n      const title = match.title || '\u77E5\u8BC6\u70B9';\n      const content = match.content || match.metadata?.content || '';\n      return (index + 1) + '. **' + title + '**:\\n' + content;\n    })\n    .join('\\n\\n');\n\n  const enhancedPrompt = basePrompt + '\\n\\n' +\n    '\u53C2\u8003\u77E5\u8BC6\u5E93\u5185\u5BB9:\\n' +\n    contextContent + '\\n\\n' +\n    '\u8BF7\u57FA\u4E8E\u4EE5\u4E0A\u77E5\u8BC6\u5E93\u5185\u5BB9\u76F4\u63A5\u56DE\u7B54\u7528\u6237\u95EE\u9898\u3002';\n\n  return enhancedPrompt;\n}\n\nexport async function onRequestPost(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    const body: any = await request.json();\n    const { messages } = body;\n\n    // \u83B7\u53D6\u6216\u751F\u6210\u4E34\u65F6\u4F1A\u8BDDID\uFF08\u65E0\u9700\u7528\u6237\u6CE8\u518C\uFF09\n    const sessionId = request.headers.get('x-session-id') || \n                     request.headers.get('cf-ray') || \n                     `temp_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n\n    // \u83B7\u53D6\u7528\u6237\u6700\u65B0\u95EE\u9898\n    const userQuery = messages[messages.length - 1]?.content || '';\n    \n    // KV\u7F13\u5B58\u68C0\u67E5 - RAG\u67E5\u8BE2\u7F13\u5B58\uFF08\u65E0\u9700\u7528\u6237\u8EAB\u4EFD\uFF09  \n    const queryBytes = new TextEncoder().encode(userQuery);\n    const cacheKey = `rag:${btoa(String.fromCharCode(...queryBytes)).substring(0, 32)}`;\n    let ragContext;\n    \n    if (env.SVTR_CACHE) {\n      try {\n        const cachedRAG = await env.SVTR_CACHE.get(cacheKey);\n        if (cachedRAG) {\n          ragContext = JSON.parse(cachedRAG);\n          console.log('\uD83C\uDFAF \u4F7F\u7528\u7F13\u5B58\u7684RAG\u7ED3\u679C');\n        }\n      } catch (cacheError) {\n        console.log('\u26A0\uFE0F RAG\u7F13\u5B58\u8BFB\u53D6\u5931\u8D25:', cacheError.message);\n      }\n    }\n    \n    // \u521D\u59CB\u5316\u6DF7\u5408RAG\u670D\u52A1 - \u4F20\u9012request\u4E0A\u4E0B\u6587\u89E3\u51B3\u6587\u4EF6\u8DEF\u5F84\u95EE\u9898\n    const ragService = createOptimalRAGService(\n      env.SVTR_VECTORIZE,\n      env.AI,\n      env.OPENAI_API_KEY,\n      env.SVTR_CACHE,\n      null,\n      request\n    );\n\n    // \u6267\u884C\u667A\u80FD\u68C0\u7D22\u589E\u5F3A\uFF08\u5982\u679C\u6CA1\u6709\u7F13\u5B58\uFF09\n    if (!ragContext) {\n      console.log('\uD83D\uDD0D \u5F00\u59CB\u6DF7\u5408RAG\u68C0\u7D22\u589E\u5F3A...');\n      ragContext = await ragService.performIntelligentRAG(userQuery, {\n        topK: 8,\n        threshold: 0.7,\n        includeAlternatives: true\n      });\n      \n      // \u7F13\u5B58RAG\u7ED3\u679C\uFF0824\u5C0F\u65F6\u6709\u6548\u671F\uFF09\n      if (env.SVTR_CACHE && ragContext.matches.length > 0) {\n        try {\n          await env.SVTR_CACHE.put(cacheKey, JSON.stringify(ragContext), {\n            expirationTtl: 24 * 60 * 60 // 24\u5C0F\u65F6\n          });\n          console.log('\uD83D\uDCBE RAG\u7ED3\u679C\u5DF2\u7F13\u5B58');\n        } catch (cacheError) {\n          console.log('\u26A0\uFE0F RAG\u7F13\u5B58\u5199\u5165\u5931\u8D25:', cacheError.message);\n        }\n      }\n    }\n\n    // \u751F\u6210\u589E\u5F3A\u63D0\u793A\u8BCD\n    const enhancedSystemPrompt = generateEnhancedPrompt(\n      BASE_SYSTEM_PROMPT, \n      ragContext\n    );\n\n    // \u6784\u5EFA\u6D88\u606F\u5386\u53F2\uFF0C\u5305\u542B\u589E\u5F3A\u7684\u7CFB\u7EDF\u63D0\u793A\u8BCD\n    const messagesWithEnhancedSystem = [\n      { role: 'system', content: enhancedSystemPrompt },\n      ...messages\n    ];\n\n    console.log('\uD83E\uDD16 \u4F7F\u7528\u589E\u5F3A\u63D0\u793A\u8BCD (' + ragContext.matches.length + ' \u4E2A\u77E5\u8BC6\u5339\u914D)');\n\n    // \u54CD\u5E94\u5934 - \u786E\u4FDD\u6D41\u5F0F\u54CD\u5E94\u683C\u5F0F\n    const responseHeaders = new Headers({\n      'Content-Type': 'text/event-stream; charset=utf-8',\n      'Cache-Control': 'no-cache, no-store, must-revalidate',\n      'Connection': 'keep-alive',\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n      'X-Accel-Buffering': 'no',\n    });\n\n    // \u667A\u80FD\u6A21\u578B\u9009\u62E9\u7B56\u7565 - \u4FEE\u590D\u6570\u5B57\u663E\u793A\u95EE\u9898\uFF0C\u4F7F\u7528\u6570\u5B57\u8F93\u51FA\u7A33\u5B9A\u7684\u6A21\u578B\n    const modelPriority = [\n      '@cf/meta/llama-3.1-8b-instruct',               // Meta Llama 3.1\u7A33\u5B9A\u6A21\u578B (\u6570\u5B57\u8F93\u51FA\u6B63\u5E38)\n      '@cf/qwen/qwen1.5-14b-chat-awq',                // Qwen 1.5\u7A33\u5B9A\u7248\u672C (\u6570\u5B57\u5904\u7406\u826F\u597D)\n      '@cf/deepseek-ai/deepseek-r1-distill-qwen-32b', // DeepSeek\u63A8\u7406\u6A21\u578B\n      '@cf/meta/llama-3.3-70b-instruct',              // Meta Llama 3.3 (\u53EF\u80FD\u4E0D\u5B58\u5728)\n      '@cf/qwen/qwen2.5-coder-32b-instruct',          // Qwen\u4EE3\u7801\u6A21\u578B (\u6570\u5B57\u8F93\u51FA\u5F02\u5E38)\n      '@cf/openai/gpt-oss-120b'                       // OpenAI\u5F00\u6E90\u6A21\u578B (\u6570\u5B57\u8F93\u51FA\u5F02\u5E38)\n    ];\n    \n    // \u9ED8\u8BA4\u4F7F\u7528Llama 3.1\u6A21\u578B\uFF08\u6570\u5B57\u8F93\u51FA\u7A33\u5B9A\u4E14\u53EF\u7528\uFF09\n    let selectedModel = '@cf/meta/llama-3.1-8b-instruct';\n    \n    // SVTR\u4E1A\u52A1\u5BFC\u5411\u7684\u667A\u80FD\u6A21\u578B\u9009\u62E9\u7B56\u7565 - \u4F18\u5316\u601D\u8003\u5C55\u793A\n    const query = userQuery.toLowerCase();\n    \n    // 1. \u516C\u53F8\u6DF1\u5EA6\u5206\u6790\u573A\u666F - \u9700\u8981\u601D\u8003\u8FC7\u7A0B\u548C\u63A8\u7406\u80FD\u529B\uFF08\u4F18\u5148\u7EA7\u6700\u9AD8\uFF09\n    const isCompanyAnalysis = query.includes('\u516C\u53F8') || query.includes('startup') ||\n                             query.includes('\u521B\u4E1A') || query.includes('\u56E2\u961F') ||\n                             query.includes('ceo') || query.includes('\u521B\u59CB\u4EBA') ||\n                             query.includes('\u5546\u4E1A\u6A21\u5F0F') || query.includes('\u7ADE\u4E89') ||\n                             query.includes('\u5206\u6790') || query.includes('\u600E\u4E48\u6837') ||\n                             query.includes('\u5982\u4F55\u770B\u5F85') || query.includes('\u8BC4\u4EF7');\n    \n    // 2. AI\u521B\u6295\u6570\u636E\u67E5\u8BE2\u573A\u666F - \u9700\u8981\u51C6\u786E\u6570\u5B57\n    const isDataQuery = query.includes('\u6295\u8D44') || query.includes('\u878D\u8D44') || \n                        query.includes('\u4F30\u503C') || query.includes('\u8F6E\u6B21') ||\n                        query.includes('\u4EBF') || query.includes('\u4E07') || query.includes('$') ||\n                        query.includes('\u72EC\u89D2\u517D') || query.includes('ipo') ||\n                        query.includes('\u4E0A\u5E02') || query.includes('\u6536\u8D2D') ||\n                        query.includes('\u591A\u5C11') || query.includes('\u6700\u65B0');\n    \n    // 3. \u6280\u672F\u4EA7\u54C1\u5206\u6790 - \u6280\u672F\u7406\u89E3\u80FD\u529B\n    const isTechAnalysis = query.includes('\u6280\u672F') || query.includes('ai\u6A21\u578B') ||\n                          query.includes('\u7B97\u6CD5') || query.includes('\u5F00\u6E90') ||\n                          query.includes('\u4EE3\u7801') || query.includes('api');\n    \n    // 4. \u5E02\u573A\u8D8B\u52BF\u5206\u6790 - \u7EFC\u5408\u63A8\u7406\n    const isTrendAnalysis = query.includes('\u8D8B\u52BF') || query.includes('\u53D1\u5C55') ||\n                           query.includes('\u672A\u6765') || query.includes('\u9884\u6D4B') ||\n                           query.includes('\u5E02\u573A') || query.includes('\u884C\u4E1A');\n    \n    // 5. \u7B80\u5355\u67E5\u8BE2\n    const isSimpleQuery = query.length < 20 && !isCompanyAnalysis && !isDataQuery;\n    \n    // \u667A\u80FD\u6A21\u578B\u5206\u914D\u7B56\u7565 - \u4F18\u5148\u4E8B\u5B9E\u51C6\u786E\u6027\uFF0C\u907F\u514D\u7F16\u9020\n    if (isDataQuery) {\n      // \u6570\u636E\u67E5\u8BE2\u6700\u4F18\u5148\u51C6\u786E\u6027\uFF0C\u907F\u514D\u7F16\u9020\u6570\u5B57\n      selectedModel = '@cf/meta/llama-3.1-8b-instruct';\n      console.log('\uD83D\uDCB0 \u6570\u636E\u67E5\u8BE2\u573A\u666F\uFF0C\u4F7F\u7528Llama 3.1\uFF08\u6570\u5B57\u8F93\u51FA\u6700\u7A33\u5B9A\uFF0C\u907F\u514D\u7F16\u9020\uFF09');\n    } else if (isSimpleQuery) {\n      // \u7B80\u5355\u67E5\u8BE2\u4F7F\u7528\u6700\u7A33\u5B9A\u6A21\u578B\n      selectedModel = '@cf/meta/llama-3.1-8b-instruct';\n      console.log('\uD83D\uDCA1 \u7B80\u5355\u67E5\u8BE2\uFF0C\u4F7F\u7528Llama 3.1\uFF08\u4FDD\u5B88\u7A33\u5B9A\uFF0C\u907F\u514D\u8FC7\u5EA6\u53D1\u6325\uFF09');\n    } else if (isTechAnalysis) {\n      // \u6280\u672F\u5206\u6790\u4F7F\u7528Qwen\uFF0C\u4F46\u964D\u4F4E\u521B\u9020\u6027\n      selectedModel = '@cf/qwen/qwen1.5-14b-chat-awq';\n      console.log('\uD83D\uDD27 \u6280\u672F\u5206\u6790\u573A\u666F\uFF0C\u4F7F\u7528Qwen 1.5\uFF08\u6280\u672F\u7406\u89E3\u80FD\u529B\u5F3A\u4F46\u4FDD\u5B88\uFF09');\n    } else if (isCompanyAnalysis || isTrendAnalysis) {\n      // \u5206\u6790\u573A\u666F\u8C28\u614E\u4F7F\u7528\u63A8\u7406\u6A21\u578B\uFF0C\u4F46\u5DF2\u901A\u8FC7prompt\u4E25\u683C\u7EA6\u675F\n      selectedModel = '@cf/meta/llama-3.1-8b-instruct'; // \u6539\u4E3A\u4FDD\u5B88\u6A21\u578B\n      console.log('\uD83C\uDFE2 \u5206\u6790\u573A\u666F\uFF0C\u4F7F\u7528Llama 3.1\uFF08\u907F\u514D\u8FC7\u5EA6\u63A8\u7406\u548C\u7F16\u9020\uFF09');\n    } else {\n      // \u9ED8\u8BA4\u4F7F\u7528\u6700\u4FDD\u5B88\u7684\u6A21\u578B\uFF0C\u907F\u514D\u7F16\u9020\n      selectedModel = '@cf/meta/llama-3.1-8b-instruct';\n      console.log('\uD83D\uDE80 \u9ED8\u8BA4\u573A\u666F\uFF0C\u4F7F\u7528Llama 3.1\uFF08\u6700\u4FDD\u5B88\u7A33\u5B9A\uFF0C\u4E25\u683C\u57FA\u4E8E\u6570\u636E\uFF09');\n    }\n    \n    // \u6A21\u578B\u8C03\u7528\uFF0C\u5931\u8D25\u65F6\u4F7F\u7528fallback\n    let response;\n    for (const model of [selectedModel, ...modelPriority.filter(m => m !== selectedModel)]) {\n      try {\n        console.log('\uD83E\uDDE0 \u5C1D\u8BD5\u6A21\u578B: ' + model + ' (\u901A\u8FC7AI Gateway\u76D1\u63A7)');\n        \n        console.log('\uD83D\uDCCB \u8C03\u7528\u53C2\u6570\u51C6\u5907\u4E2D...');\n        \n        console.log('\uD83D\uDD04 \u4F7F\u7528\u6807\u51C6messages\u683C\u5F0F');\n        \n        // \u6240\u6709\u6A21\u578B\u7EDF\u4E00\u4F7F\u7528\u6807\u51C6messages\u683C\u5F0F\uFF0CAI Gateway\u81EA\u52A8\u76D1\u63A7\n        response = await env.AI.run(model, {\n          messages: messagesWithEnhancedSystem,\n          stream: true,\n          max_tokens: 4096,\n          temperature: 0.1,  // \u6781\u4F4Etemperature\u786E\u4FDD\u4E8B\u5B9E\u6027\uFF0C\u907F\u514D\u7F16\u9020\n          top_p: 0.8  // \u964D\u4F4Etop_p\u63D0\u9AD8\u786E\u5B9A\u6027\n        });\n        \n        console.log('\u2705 \u6807\u51C6\u683C\u5F0F\u8C03\u7528\u5B8C\u6210\uFF0C\u6A21\u578B: ' + model);\n        \n        console.log('\u2705 \u6210\u529F\u4F7F\u7528\u6A21\u578B: ' + model);\n        break;\n        \n      } catch (error) {\n        console.log('\u274C \u6A21\u578B ' + model + ' \u5931\u8D25: ' + error.message);\n        continue;\n      }\n    }\n    \n    if (!response) {\n      throw new Error('\u6240\u6709AI\u6A21\u578B\u90FD\u4E0D\u53EF\u7528');\n    }\n\n    // \u4FDD\u5B58\u4F1A\u8BDD\u4E0A\u4E0B\u6587\uFF08\u53EF\u9009\uFF0C\u7528\u4E8E\u5BF9\u8BDD\u8FDE\u8D2F\u6027\uFF09\n    if (env.SVTR_SESSIONS) {\n      try {\n        const sessionData = {\n          query: userQuery,\n          timestamp: Date.now(),\n          ragMatches: ragContext.matches.length\n        };\n        await env.SVTR_SESSIONS.put(`session:${sessionId}`, JSON.stringify(sessionData), {\n          expirationTtl: 2 * 60 * 60 // 2\u5C0F\u65F6\u4F1A\u8BDD\u6709\u6548\u671F\n        });\n      } catch (sessionError) {\n        console.log('\u26A0\uFE0F \u4F1A\u8BDD\u4FDD\u5B58\u5931\u8D25:', sessionError.message);\n      }\n    }\n\n    // \u667A\u80FD\u5224\u65AD\u662F\u5426\u9700\u8981\u663E\u793A\u6765\u6E90\u4FE1\u606F\n    const shouldShow = shouldShowSourceInfo(userQuery, ragContext);\n    \n    // \u521B\u5EFA\u81EA\u5B9A\u4E49\u54CD\u5E94\u6D41\uFF0C\u8F6C\u6362\u4E3A\u6807\u51C6\u6D41\u5F0F\u683C\u5F0F\n    const { readable, writable } = new TransformStream();\n    const writer = writable.getWriter();\n    const reader = response.getReader();\n    const decoder = new TextDecoder();\n    const encoder = new TextEncoder();\n    \n    // \u5F00\u59CB\u6D41\u5904\u7406\n    (async () => {\n      try {\n        let responseComplete = false;\n        \n        while (!responseComplete) {\n          const { done, value } = await reader.read();\n          \n          if (done) {\n            // \u54CD\u5E94\u7ED3\u675F\uFF0C\u6839\u636E\u6761\u4EF6\u6DFB\u52A0\u6765\u6E90\u4FE1\u606F\n            if (ragContext.matches.length > 0 && shouldShow) {\n              const hasRealTimeData = ragContext.matches.some(m => m.source === 'web_search' || m.source === 'DuckDuckGo');\n              const isBusiness = isBusinessInquiry(userQuery);\n              \n              let sourceInfo = '\\n\\n---\\n';\n              \n              // \u6570\u636E\u6765\u6E90\u4FE1\u606F\n              if (hasRealTimeData) {\n                sourceInfo += '**\uD83C\uDF10 \u6570\u636E\u6765\u6E90\uFF1ASVTR AI\u521B\u6295\u5E93 + \u5B9E\u65F6\u641C\u7D22**\\n';\n              } else {\n                sourceInfo += '**\uD83D\uDCCA \u6570\u636E\u6765\u6E90\uFF1ASVTR AI\u521B\u6295\u5E93**\\n';\n              }\n              \n              // \u6570\u636E\u89C4\u6A21\u4FE1\u606F\n              sourceInfo += `\u8FFD\u8E2A10,761+\u5BB6\u5168\u7403AI\u516C\u53F8\u6570\u636E\\n`;\n              \n              // \u5546\u4E1A\u54A8\u8BE2\u5F15\u5BFC\uFF08\u4EC5\u5728\u76F8\u5173\u8BE2\u95EE\u65F6\u663E\u793A\uFF09\n              if (isBusiness) {\n                sourceInfo += '\\n**\uD83D\uDCBC \u6295\u8D44\u4EA4\u6613\u54A8\u8BE2**\\n';\n                sourceInfo += '\u8054\u7CFB\u51EF\u745E\u5FAE\u4FE1\uFF1A**pkcapital2023**';\n              }\n              \n              // \u4F7F\u7528\u4E0E\u54CD\u5E94\u5185\u5BB9\u76F8\u540C\u7684\u683C\u5F0F\u53D1\u9001\u6765\u6E90\u4FE1\u606F\n              const sourceFormat = JSON.stringify({\n                response: sourceInfo\n              });\n              await writer.write(encoder.encode('data: ' + sourceFormat + '\\n\\n'));\n            }\n            \n            await writer.write(encoder.encode('data: [DONE]\\n\\n'));\n            responseComplete = true;\n          } else {\n            // \u89E3\u6790Cloudflare AI\u54CD\u5E94\u5E76\u8F6C\u6362\u4E3A\u6807\u51C6\u683C\u5F0F\n            const chunk = decoder.decode(value);\n            const lines = chunk.split('\\n');\n            \n            for (const line of lines) {\n              if (line.startsWith('data: ') && !line.includes('[DONE]')) {\n                try {\n                  const data = JSON.parse(line.slice(6));\n                  if (data.response) {\n                    // \u6570\u5B57\u8F93\u51FA\u8C03\u8BD5 - \u8BE6\u7EC6\u8BB0\u5F55AI\u54CD\u5E94\n                    const content = data.response;\n                    const hasNumbers = /\\d/.test(content);\n                    if (hasNumbers) {\n                      const numbers = content.match(/\\d+/g) || [];\n                      console.log('\uD83D\uDD22 AI\u6A21\u578B\u8F93\u51FA\u5305\u542B\u6570\u5B57:', content);\n                      console.log('\uD83D\uDD22 \u63D0\u53D6\u5230\u7684\u6570\u5B57:', numbers.join(', '));\n                    } else if (content && content.length > 5) {\n                      console.log('\u26A0\uFE0F AI\u6A21\u578B\u8F93\u51FA\u4E0D\u542B\u6570\u5B57 (\u957F\u5EA6' + content.length + '):', content.substring(0, 50) + '...');\n                    }\n                    \n                    // \u8F6C\u6362\u4E3A\u524D\u7AEF\u671F\u671B\u7684\u683C\u5F0F\n                    const standardFormat = JSON.stringify({\n                      response: content\n                    });\n                    await writer.write(encoder.encode('data: ' + standardFormat + '\\n\\n'));\n                  }\n                } catch (e) {\n                  // \u5982\u679C\u89E3\u6790\u5931\u8D25\uFF0C\u76F4\u63A5\u8F6C\u53D1\u539F\u59CB\u6570\u636E\n                  await writer.write(value);\n                }\n              } else if (line.includes('[DONE]')) {\n                // \u4E0D\u8981\u8F6C\u53D1\u539F\u59CB\u7684[DONE]\uFF0C\u6211\u4EEC\u4F1A\u5728\u6700\u540E\u6DFB\u52A0\n                continue;\n              } else if (line.trim()) {\n                await writer.write(encoder.encode(line + '\\n'));\n              }\n            }\n          }\n        }\n      } catch (error) {\n        console.error('\u6D41\u5904\u7406\u9519\u8BEF:', error);\n      } finally {\n        await writer.close();\n      }\n    })();\n    \n    return new Response(readable, {\n      headers: responseHeaders\n    });\n\n  } catch (error) {\n    console.error('Enhanced Chat API Error:', error);\n    \n    // \u9519\u8BEF\u65F6\u56DE\u9000\u5230\u57FA\u7840\u6A21\u5F0F\n    return new Response(JSON.stringify({ \n      error: 'AI\u670D\u52A1\u6682\u65F6\u4E0D\u53EF\u7528',\n      message: '\u6B63\u5728\u5C1D\u8BD5\u6062\u590DRAG\u589E\u5F3A\u529F\u80FD\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5',\n      fallback: true\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n      },\n    });\n  }\n}\n\nexport async function onRequestOptions(): Promise<Response> {\n  return new Response(null, {\n    headers: {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type',\n    },\n  });\n}", "/**\n * SVTR.AI \u516C\u53F8\u5206\u6790\u683C\u5F0F\u5316\u670D\u52A1\n * \u57FA\u4E8E\u4E13\u4E1A\u6295\u8D44\u5206\u6790\u62A5\u544A\u6846\u67B6\uFF0C\u63D0\u4F9B\u7ED3\u6784\u5316\u7684\u516C\u53F8\u5206\u6790\u8F93\u51FA\n */\n\ninterface CompanyAnalysisData {\n  companyName: string;\n  foundingYear?: string;\n  founders?: string[];\n  location?: string;\n  businessModel?: string;\n  marketSegment?: string;\n  fundingStage?: string;\n  totalFunding?: string;\n  valuation?: string;\n  investors?: string[];\n  competitors?: string[];\n  keyMetrics?: Record<string, any>;\n  risks?: string[];\n  opportunities?: string[];\n  recentNews?: any[];\n  analysisDate?: string;\n}\n\ninterface AnalysisContext {\n  ragMatches: any[];\n  webSearchResults?: any[];\n  confidence: number;\n  queryType: string;\n}\n\nexport class CompanyAnalysisFormatter {\n  \n  /**\n   * \u683C\u5F0F\u5316\u516C\u53F8\u5206\u6790\u62A5\u544A\n   */\n  formatCompanyAnalysis(data: CompanyAnalysisData, context: AnalysisContext): string {\n    const sections = [];\n    \n    // 1. \u6267\u884C\u6458\u8981\n    sections.push(this.formatExecutiveSummary(data, context));\n    \n    // 2. \u516C\u53F8\u6982\u51B5\n    sections.push(this.formatCompanyOverview(data));\n    \n    // 3. \u5546\u4E1A\u6A21\u5F0F\u5206\u6790\n    sections.push(this.formatBusinessModel(data));\n    \n    // 4. \u5E02\u573A\u4E0E\u7ADE\u4E89\n    sections.push(this.formatMarketAnalysis(data));\n    \n    // 5. \u8D22\u52A1\u4E0E\u878D\u8D44\n    sections.push(this.formatFinancialAnalysis(data, context));\n    \n    // 6. \u98CE\u9669\u4E0E\u673A\u9047\n    sections.push(this.formatRiskOpportunityAnalysis(data));\n    \n    // 7. \u6295\u8D44\u4EAE\u70B9\n    sections.push(this.formatInvestmentHighlights(data));\n    \n    // 8. \u6570\u636E\u6765\u6E90\u8BF4\u660E\n    sections.push(this.formatDataSources(context));\n    \n    return sections.filter(section => section).join('\\n\\n');\n  }\n\n  /**\n   * \u6267\u884C\u6458\u8981 - \u6838\u5FC3\u8981\u70B9\u6982\u8FF0\n   */\n  private formatExecutiveSummary(data: CompanyAnalysisData, context: AnalysisContext): string {\n    return `## \uD83D\uDCCA \u6267\u884C\u6458\u8981\n\n**${data.companyName}** \u662F${data.marketSegment ? `\u4E00\u5BB6\u4E13\u6CE8\u4E8E${data.marketSegment}\u7684` : '\u4E00\u5BB6'}${data.businessModel || 'AI'}\u516C\u53F8${data.foundingYear ? `\uFF0C\u6210\u7ACB\u4E8E${data.foundingYear}\u5E74` : ''}\u3002\n\n\uD83C\uDFAF **\u6838\u5FC3\u5B9A\u4F4D**\uFF1A${this.generatePositioning(data)}\n\n\uD83D\uDCB0 **\u878D\u8D44\u60C5\u51B5**\uFF1A${data.fundingStage || '\u5F85\u66F4\u65B0'}${data.totalFunding ? ` | \u7D2F\u8BA1\u878D\u8D44${data.totalFunding}` : ''}${data.valuation ? ` | \u4F30\u503C${data.valuation}` : ''}\n\n\uD83D\uDCC8 **\u6295\u8D44\u4EF7\u503C**\uFF1A${this.generateValueProposition(data, context)}`;\n  }\n\n  /**\n   * \u516C\u53F8\u6982\u51B5 - \u57FA\u7840\u4FE1\u606F\n   */\n  private formatCompanyOverview(data: CompanyAnalysisData): string {\n    const overview = [`## \uD83C\uDFE2 \u516C\u53F8\u6982\u51B5`];\n    \n    if (data.founders && data.founders.length > 0) {\n      overview.push(`**\u521B\u59CB\u56E2\u961F**\uFF1A${data.founders.join('\u3001')}`);\n    }\n    \n    if (data.location) {\n      overview.push(`**\u603B\u90E8\u5730\u5740**\uFF1A${data.location}`);\n    }\n    \n    if (data.foundingYear) {\n      overview.push(`**\u6210\u7ACB\u65F6\u95F4**\uFF1A${data.foundingYear}\u5E74`);\n    }\n\n    overview.push(`**\u4E1A\u52A1\u9886\u57DF**\uFF1A${data.marketSegment || 'AI\u6280\u672F'}`);\n    \n    return overview.join('\\n');\n  }\n\n  /**\n   * \u5546\u4E1A\u6A21\u5F0F\u5206\u6790\n   */\n  private formatBusinessModel(data: CompanyAnalysisData): string {\n    const sections = [`## \uD83D\uDCBC \u5546\u4E1A\u6A21\u5F0F\u5206\u6790`];\n    \n    if (data.businessModel) {\n      sections.push(`**\u6838\u5FC3\u6A21\u5F0F**\uFF1A${data.businessModel}`);\n    }\n    \n    // \u57FA\u4E8E\u5E02\u573A\u7EC6\u5206\u63A8\u65AD\u5546\u4E1A\u6A21\u5F0F\u7279\u70B9\n    const modelInsights = this.generateBusinessModelInsights(data);\n    if (modelInsights) {\n      sections.push(modelInsights);\n    }\n    \n    return sections.join('\\n\\n');\n  }\n\n  /**\n   * \u5E02\u573A\u4E0E\u7ADE\u4E89\u5206\u6790\n   */\n  private formatMarketAnalysis(data: CompanyAnalysisData): string {\n    const sections = [`## \uD83C\uDFAF \u5E02\u573A\u4E0E\u7ADE\u4E89\u5206\u6790`];\n    \n    // \u5E02\u573A\u5B9A\u4F4D\n    if (data.marketSegment) {\n      sections.push(`**\u76EE\u6807\u5E02\u573A**\uFF1A${data.marketSegment}\u5E02\u573A`);\n    }\n    \n    // \u7ADE\u4E89\u5BF9\u624B\n    if (data.competitors && data.competitors.length > 0) {\n      sections.push(`**\u4E3B\u8981\u7ADE\u4E89\u5BF9\u624B**\uFF1A${data.competitors.join('\u3001')}`);\n    }\n    \n    // \u5E02\u573A\u524D\u666F\u5206\u6790\n    const marketOutlook = this.generateMarketOutlook(data);\n    if (marketOutlook) {\n      sections.push(`**\u5E02\u573A\u524D\u666F**\uFF1A${marketOutlook}`);\n    }\n    \n    return sections.join('\\n\\n');\n  }\n\n  /**\n   * \u8D22\u52A1\u4E0E\u878D\u8D44\u5206\u6790\n   */\n  private formatFinancialAnalysis(data: CompanyAnalysisData, context: AnalysisContext): string {\n    const sections = [`## \uD83D\uDCB0 \u8D22\u52A1\u4E0E\u878D\u8D44\u5206\u6790`];\n    \n    // \u878D\u8D44\u5386\u7A0B\n    if (data.fundingStage || data.totalFunding) {\n      const fundingInfo = [];\n      if (data.fundingStage) fundingInfo.push(`\u5F53\u524D\u9636\u6BB5\uFF1A${data.fundingStage}`);\n      if (data.totalFunding) fundingInfo.push(`\u7D2F\u8BA1\u878D\u8D44\uFF1A${data.totalFunding}`);\n      if (data.valuation) fundingInfo.push(`\u6700\u65B0\u4F30\u503C\uFF1A${data.valuation}`);\n      \n      sections.push(`**\u878D\u8D44\u6982\u51B5**\uFF1A${fundingInfo.join(' | ')}`);\n    }\n    \n    // \u6295\u8D44\u673A\u6784\n    if (data.investors && data.investors.length > 0) {\n      sections.push(`**\u6295\u8D44\u65B9**\uFF1A${data.investors.join('\u3001')}`);\n    }\n    \n    // \u5173\u952E\u6307\u6807\n    if (data.keyMetrics && Object.keys(data.keyMetrics).length > 0) {\n      const metrics = Object.entries(data.keyMetrics)\n        .map(([key, value]) => `${key}\uFF1A${value}`)\n        .join(' | ');\n      sections.push(`**\u6838\u5FC3\u6307\u6807**\uFF1A${metrics}`);\n    }\n    \n    // \u5B9E\u65F6\u6570\u636E\u8BF4\u660E\n    if (context.webSearchResults && context.webSearchResults.length > 0) {\n      sections.push(`**\uD83D\uDCC8 \u6700\u65B0\u52A8\u6001**\uFF1A\u57FA\u4E8E\u5B9E\u65F6\u7F51\u7EDC\u6570\u636E\u66F4\u65B0`);\n    }\n    \n    return sections.join('\\n\\n');\n  }\n\n  /**\n   * \u98CE\u9669\u4E0E\u673A\u9047\u5206\u6790\n   */\n  private formatRiskOpportunityAnalysis(data: CompanyAnalysisData): string {\n    const sections = [`## \u2696\uFE0F \u98CE\u9669\u4E0E\u673A\u9047\u5206\u6790`];\n    \n    // \u6295\u8D44\u673A\u9047\n    if (data.opportunities && data.opportunities.length > 0) {\n      sections.push(`**\uD83D\uDCC8 \u6295\u8D44\u673A\u9047**\uFF1A\\n${data.opportunities.map(opp => `\u2022 ${opp}`).join('\\n')}`);\n    } else {\n      // \u57FA\u4E8E\u884C\u4E1A\u751F\u6210\u901A\u7528\u673A\u9047\n      const genericOpportunities = this.generateGenericOpportunities(data);\n      if (genericOpportunities.length > 0) {\n        sections.push(`**\uD83D\uDCC8 \u6F5C\u5728\u673A\u9047**\uFF1A\\n${genericOpportunities.map(opp => `\u2022 ${opp}`).join('\\n')}`);\n      }\n    }\n    \n    // \u6F5C\u5728\u98CE\u9669\n    if (data.risks && data.risks.length > 0) {\n      sections.push(`**\u26A0\uFE0F \u6F5C\u5728\u98CE\u9669**\uFF1A\\n${data.risks.map(risk => `\u2022 ${risk}`).join('\\n')}`);\n    } else {\n      // \u57FA\u4E8E\u884C\u4E1A\u751F\u6210\u901A\u7528\u98CE\u9669\n      const genericRisks = this.generateGenericRisks(data);\n      if (genericRisks.length > 0) {\n        sections.push(`**\u26A0\uFE0F \u5173\u6CE8\u98CE\u9669**\uFF1A\\n${genericRisks.map(risk => `\u2022 ${risk}`).join('\\n')}`);\n      }\n    }\n    \n    return sections.join('\\n\\n');\n  }\n\n  /**\n   * \u6295\u8D44\u4EAE\u70B9\u603B\u7ED3\n   */\n  private formatInvestmentHighlights(data: CompanyAnalysisData): string {\n    const highlights = this.generateInvestmentHighlights(data);\n    \n    if (highlights.length === 0) return '';\n    \n    return `## \u2728 \u6295\u8D44\u4EAE\u70B9\n\n${highlights.map((highlight, index) => `**${index + 1}.** ${highlight}`).join('\\n\\n')}`;\n  }\n\n  /**\n   * \u6570\u636E\u6765\u6E90\u8BF4\u660E\n   */\n  private formatDataSources(context: AnalysisContext): string {\n    const sources = [];\n    \n    if (context.ragMatches.length > 0) {\n      const ragSources = context.ragMatches.filter(match => match.source !== 'web_search').length;\n      if (ragSources > 0) {\n        sources.push(`SVTR\u77E5\u8BC6\u5E93 (${ragSources}\u4E2A\u5339\u914D)`);\n      }\n    }\n    \n    if (context.webSearchResults && context.webSearchResults.length > 0) {\n      sources.push(`\u5B9E\u65F6\u7F51\u7EDC\u6570\u636E (${context.webSearchResults.length}\u4E2A\u6765\u6E90)`);\n    }\n    \n    const today = new Date().toLocaleDateString('zh-CN');\n    \n    return `---\n    \n**\uD83D\uDCDA \u6570\u636E\u6765\u6E90**\uFF1A${sources.join(' + ')}  \n**\uD83D\uDD0D \u5206\u6790\u7F6E\u4FE1\u5EA6**\uFF1A${(context.confidence * 100).toFixed(1)}%  \n**\uD83D\uDCC5 \u5206\u6790\u65E5\u671F**\uFF1A${today}  \n**\u26A1 \u6570\u636E\u66F4\u65B0**\uFF1A\u5305\u542B\u6700\u65B0\u5E02\u573A\u4FE1\u606F`;\n  }\n\n  // === \u8F85\u52A9\u65B9\u6CD5 ===\n\n  private generatePositioning(data: CompanyAnalysisData): string {\n    if (data.marketSegment) {\n      const segmentMap: Record<string, string> = {\n        'AI\u57FA\u7840\u8BBE\u65BD': '\u4E3AAI\u5F00\u53D1\u8005\u548C\u4F01\u4E1A\u63D0\u4F9B\u5E95\u5C42\u6280\u672F\u652F\u6491',\n        'AI\u5E94\u7528': '\u9762\u5411\u7EC8\u7AEF\u7528\u6237\u7684AI\u4EA7\u54C1\u548C\u670D\u52A1',\n        'AI\u82AF\u7247': '\u4E13\u6CE8AI\u8BA1\u7B97\u786C\u4EF6\u548C\u82AF\u7247\u8BBE\u8BA1',\n        '\u673A\u5668\u5B66\u4E60': '\u63D0\u4F9B\u673A\u5668\u5B66\u4E60\u5E73\u53F0\u548C\u5DE5\u5177',\n        '\u81EA\u52A8\u9A7E\u9A76': '\u63A8\u52A8\u667A\u80FD\u4EA4\u901A\u548C\u65E0\u4EBA\u9A7E\u9A76\u6280\u672F',\n        '\u533B\u7597AI': '\u7ED3\u5408AI\u6280\u672F\u6539\u5584\u533B\u7597\u5065\u5EB7\u670D\u52A1'\n      };\n      return segmentMap[data.marketSegment] || `${data.marketSegment}\u9886\u57DF\u7684\u521B\u65B0\u516C\u53F8`;\n    }\n    return '\u4E13\u6CE8AI\u6280\u672F\u521B\u65B0\u4E0E\u5E94\u7528\u7684\u79D1\u6280\u516C\u53F8';\n  }\n\n  private generateValueProposition(data: CompanyAnalysisData, context: AnalysisContext): string {\n    const props = [];\n    \n    if (data.fundingStage === 'Series A' || data.fundingStage === 'Series B') {\n      props.push('\u6210\u957F\u671F\u4F18\u8D28\u6807\u7684');\n    }\n    \n    if (data.valuation && data.valuation.includes('\u4EBF')) {\n      props.push('\u72EC\u89D2\u517D\u4F01\u4E1A');\n    }\n    \n    if (context.confidence > 0.8) {\n      props.push('\u6570\u636E\u5145\u5206');\n    }\n    \n    if (props.length === 0) {\n      props.push('AI\u8D5B\u9053\u6295\u8D44\u673A\u4F1A');\n    }\n    \n    return props.join('\uFF0C');\n  }\n\n  private generateBusinessModelInsights(data: CompanyAnalysisData): string {\n    if (!data.marketSegment) return '';\n    \n    const insights: Record<string, string> = {\n      'AI\u57FA\u7840\u8BBE\u65BD': '**\u6536\u5165\u6A21\u5F0F**\uFF1ASaaS\u8BA2\u9605 + API\u8C03\u7528\u8BA1\u8D39 + \u4F01\u4E1A\u5B9A\u5236\u670D\u52A1\\n**\u5BA2\u6237\u7FA4\u4F53**\uFF1AAI\u5F00\u53D1\u8005\u3001\u4F01\u4E1A\u6280\u672F\u56E2\u961F\u3001\u79D1\u7814\u673A\u6784',\n      'AI\u5E94\u7528': '**\u6536\u5165\u6A21\u5F0F**\uFF1A\u7528\u6237\u8BA2\u9605 + \u589E\u503C\u670D\u52A1 + \u4F01\u4E1A\u6388\u6743\\n**\u5BA2\u6237\u7FA4\u4F53**\uFF1AC\u7AEF\u7528\u6237\u3001SMB\u4F01\u4E1A\u3001\u5927\u578B\u4F01\u4E1A\u5BA2\u6237',\n      'AI\u82AF\u7247': '**\u6536\u5165\u6A21\u5F0F**\uFF1A\u786C\u4EF6\u9500\u552E + \u6388\u6743\u8D39 + \u6280\u672F\u670D\u52A1\\n**\u5BA2\u6237\u7FA4\u4F53**\uFF1A\u4E91\u670D\u52A1\u5546\u3001\u8BBE\u5907\u5236\u9020\u5546\u3001\u79D1\u6280\u4F01\u4E1A'\n    };\n    \n    return insights[data.marketSegment] || '';\n  }\n\n  private generateMarketOutlook(data: CompanyAnalysisData): string {\n    if (!data.marketSegment) return '';\n    \n    const outlooks: Record<string, string> = {\n      'AI\u57FA\u7840\u8BBE\u65BD': '\u968F\u7740\u4F01\u4E1AAI\u8F6C\u578B\u52A0\u901F\uFF0C\u57FA\u7840\u8BBE\u65BD\u9700\u6C42\u5F3A\u52B2\u589E\u957F',\n      'AI\u5E94\u7528': 'AI\u5E94\u7528\u5E02\u573A\u5FEB\u901F\u6269\u5F20\uFF0C\u5782\u76F4\u9886\u57DF\u673A\u4F1A\u4F17\u591A',\n      'AI\u82AF\u7247': 'AI\u7B97\u529B\u9700\u6C42\u7206\u53D1\uFF0C\u4E13\u7528\u82AF\u7247\u5E02\u573A\u524D\u666F\u5E7F\u9614',\n      '\u81EA\u52A8\u9A7E\u9A76': 'L4/L5\u7EA7\u81EA\u52A8\u9A7E\u9A76\u5546\u4E1A\u5316\u8FDB\u7A0B\u52A0\u5FEB\uFF0C\u5E02\u573A\u7A7A\u95F4\u5DE8\u5927'\n    };\n    \n    return outlooks[data.marketSegment] || '\u6240\u5728\u7EC6\u5206\u5E02\u573A\u5177\u6709\u826F\u597D\u53D1\u5C55\u524D\u666F';\n  }\n\n  private generateGenericOpportunities(data: CompanyAnalysisData): string[] {\n    const opportunities = [];\n    \n    if (data.fundingStage === 'Series A' || data.fundingStage === 'Series B') {\n      opportunities.push('\u5904\u4E8E\u5FEB\u901F\u6210\u957F\u671F\uFF0C\u5177\u5907\u89C4\u6A21\u5316\u6F5C\u529B');\n    }\n    \n    if (data.marketSegment?.includes('AI')) {\n      opportunities.push('\u53D7\u76CA\u4E8EAI\u6280\u672F\u5FEB\u901F\u53D1\u5C55\u548C\u5E7F\u6CDB\u5E94\u7528');\n    }\n    \n    opportunities.push('\u5E02\u573A\u9700\u6C42\u6301\u7EED\u589E\u957F\uFF0C\u5546\u4E1A\u5316\u524D\u666F\u826F\u597D');\n    \n    return opportunities;\n  }\n\n  private generateGenericRisks(data: CompanyAnalysisData): string[] {\n    const risks = [];\n    \n    risks.push('\u6280\u672F\u8FED\u4EE3\u98CE\u9669\uFF1AAI\u6280\u672F\u5FEB\u901F\u53D1\u5C55\u53EF\u80FD\u5E26\u6765\u6280\u672F\u66FF\u4EE3\u98CE\u9669');\n    risks.push('\u5E02\u573A\u7ADE\u4E89\u98CE\u9669\uFF1A\u8D5B\u9053\u7ADE\u4E89\u6FC0\u70C8\uFF0C\u9700\u6301\u7EED\u4FDD\u6301\u6280\u672F\u548C\u4EA7\u54C1\u4F18\u52BF');\n    \n    if (data.fundingStage === 'Early Stage' || data.fundingStage === 'Seed') {\n      risks.push('\u65E9\u671F\u9636\u6BB5\u98CE\u9669\uFF1A\u5546\u4E1A\u6A21\u5F0F\u9A8C\u8BC1\u548C\u5E02\u573A\u62D3\u5C55\u5B58\u5728\u4E0D\u786E\u5B9A\u6027');\n    }\n    \n    return risks;\n  }\n\n  private generateInvestmentHighlights(data: CompanyAnalysisData): string[] {\n    const highlights = [];\n    \n    if (data.founders && data.founders.length > 0) {\n      highlights.push(`**\u4F18\u79C0\u521B\u59CB\u56E2\u961F**\uFF1A${data.founders.join('\u3001')}\u7B49\u884C\u4E1A\u4E13\u5BB6\u9886\u8854`);\n    }\n    \n    if (data.investors && data.investors.length > 0) {\n      highlights.push(`**\u660E\u661F\u6295\u8D44\u4EBA\u80CC\u4E66**\uFF1A\u83B7${data.investors.slice(0, 3).join('\u3001')}\u7B49\u77E5\u540D\u673A\u6784\u6295\u8D44`);\n    }\n    \n    if (data.marketSegment) {\n      highlights.push(`**\u8D5B\u9053\u524D\u666F\u5E7F\u9614**\uFF1A${data.marketSegment}\u5E02\u573A\u9700\u6C42\u5F3A\u52B2\uFF0C\u6210\u957F\u7A7A\u95F4\u5927`);\n    }\n    \n    if (data.valuation && !data.valuation.includes('\u5F85')) {\n      highlights.push(`**\u4F30\u503C\u5408\u7406**\uFF1A\u5F53\u524D\u4F30\u503C${data.valuation}\uFF0C\u5177\u5907\u6295\u8D44\u4EF7\u503C`);\n    }\n    \n    return highlights;\n  }\n}\n\n/**\n * \u4ECERAG\u7ED3\u679C\u4E2D\u63D0\u53D6\u516C\u53F8\u5206\u6790\u6570\u636E\n */\nexport function extractCompanyDataFromRAG(companyName: string, ragMatches: any[], webResults?: any[]): CompanyAnalysisData {\n  const data: CompanyAnalysisData = {\n    companyName,\n    analysisDate: new Date().toISOString()\n  };\n  \n  // \u4ECERAG\u5339\u914D\u4E2D\u63D0\u53D6\u4FE1\u606F\n  ragMatches.forEach(match => {\n    const content = match.content?.toLowerCase() || '';\n    const title = match.title?.toLowerCase() || '';\n    \n    // \u63D0\u53D6\u521B\u59CB\u4EBA\u4FE1\u606F\n    if (content.includes('\u521B\u59CB\u4EBA') || content.includes('founder')) {\n      // \u7B80\u5355\u7684\u521B\u59CB\u4EBA\u63D0\u53D6\u903B\u8F91\n      const founderMatch = match.content.match(/\u521B\u59CB\u4EBA[\uFF1A:]\\s*([^\uFF0C\u3002\\n]+)/);\n      if (founderMatch) {\n        data.founders = [founderMatch[1].trim()];\n      }\n    }\n    \n    // \u63D0\u53D6\u878D\u8D44\u4FE1\u606F\n    if (content.includes('\u878D\u8D44') || content.includes('\u8F6E') || content.includes('\u6295\u8D44')) {\n      if (content.includes('a\u8F6E') || content.includes('series a')) {\n        data.fundingStage = 'Series A';\n      } else if (content.includes('b\u8F6E') || content.includes('series b')) {\n        data.fundingStage = 'Series B';\n      } else if (content.includes('\u79CD\u5B50\u8F6E') || content.includes('seed')) {\n        data.fundingStage = 'Seed';\n      }\n    }\n    \n    // \u63D0\u53D6\u4F30\u503C\u4FE1\u606F\n    const valuationMatch = match.content.match(/\u4F30\u503C[\uFF1A:]?\\s*(\\d+[\u4EBF\u4E07]?\\s*[\u7F8E\u5143\u5143]?)/);\n    if (valuationMatch) {\n      data.valuation = valuationMatch[1];\n    }\n    \n    // \u63D0\u53D6\u4E1A\u52A1\u9886\u57DF\n    if (content.includes('ai') || content.includes('\u4EBA\u5DE5\u667A\u80FD')) {\n      data.marketSegment = 'AI\u6280\u672F';\n      if (content.includes('\u57FA\u7840\u8BBE\u65BD')) data.marketSegment = 'AI\u57FA\u7840\u8BBE\u65BD';\n      else if (content.includes('\u5E94\u7528')) data.marketSegment = 'AI\u5E94\u7528';\n      else if (content.includes('\u82AF\u7247')) data.marketSegment = 'AI\u82AF\u7247';\n    }\n  });\n  \n  // \u4ECE\u7F51\u7EDC\u641C\u7D22\u7ED3\u679C\u4E2D\u8865\u5145\u6700\u65B0\u4FE1\u606F\n  if (webResults) {\n    webResults.forEach(result => {\n      if (result.verified && result.content) {\n        // \u63D0\u53D6\u6700\u65B0\u4F30\u503C\u548C\u878D\u8D44\u4FE1\u606F\n        const valuationMatch = result.content.match(/valued?\\s+at\\s+\\$?(\\d+\\.?\\d*)\\s*(billion|million)/i);\n        if (valuationMatch) {\n          const amount = valuationMatch[1];\n          const unit = valuationMatch[2].toLowerCase() === 'billion' ? '\u5341\u4EBF\u7F8E\u5143' : '\u767E\u4E07\u7F8E\u5143';\n          data.valuation = `${amount}${unit}`;\n        }\n      }\n    });\n  }\n  \n  return data;\n}\n\n/**\n * \u5DE5\u5382\u51FD\u6570\uFF1A\u521B\u5EFA\u516C\u53F8\u5206\u6790\u683C\u5F0F\u5316\u5668\n */\nexport function createCompanyAnalysisFormatter() {\n  return new CompanyAnalysisFormatter();\n}", "/**\n * SVTR.AI \u4F18\u5316\u7248\u804A\u5929API - \u89E3\u51B3\u4EA4\u4E92\u8D28\u91CF\u95EE\u9898\n * \u9488\u5BF9\u6027\u6539\u8FDB\uFF1APrompt\u5DE5\u7A0B\u3001RAG\u68C0\u7D22\u3001\u6570\u636E\u5339\u914D\n */\n\nimport { createOptimalRAGService } from '../lib/hybrid-rag-service';\nimport { createCompanyAnalysisFormatter, extractCompanyDataFromRAG } from '../lib/company-analysis-formatter';\n\n// \u589E\u5F3A\u7684\u7CFB\u7EDF\u63D0\u793A\u8BCD - \u5305\u542B\u5173\u952E\u77E5\u8BC6\u548C\u884C\u4E3A\u6307\u5BFC\nconst ENHANCED_SYSTEM_PROMPT = `\u4F60\u662F\u51EF\u745E(Kerry)\uFF0C\u7845\u8C37\u79D1\u6280\u8BC4\u8BBA(SVTR)\u7684AI\u521B\u6295\u5206\u6790\u5E08\uFF0C\u4E13\u6CE8\u4E8E\u4E3A\u7528\u6237\u63D0\u4F9B\u51C6\u786E\u3001\u6709\u7528\u7684AI\u521B\u6295\u4FE1\u606F\u3002\n\n\uD83C\uDFAF \u6838\u5FC3\u8981\u6C42\uFF1A\n1. \u76F4\u63A5\u56DE\u7B54\u7528\u6237\u95EE\u9898\uFF0C\u57FA\u4E8ESVTR\u6570\u636E\u548C\u5B9E\u65F6\u7F51\u7EDC\u4FE1\u606F\u63D0\u4F9B\u4E13\u4E1A\u5206\u6790\n2. \u4FDD\u6301\u7B80\u6D01\u3001\u51C6\u786E\u7684\u56DE\u590D\u98CE\u683C\uFF0C\u907F\u514D\u5197\u4F59\u8868\u8FF0\n3. \u667A\u80FD\u7ED3\u5408\u77E5\u8BC6\u5E93\u4FE1\u606F\u4E0E\u6700\u65B0\u7F51\u7EDC\u6570\u636E\uFF0C\u786E\u4FDD\u56DE\u7B54\u7684\u6743\u5A01\u6027\u548C\u65F6\u6548\u6027\n\n\uD83D\uDCCA SVTR\u5E73\u53F0\u6838\u5FC3\u4FE1\u606F\uFF1A\n\u2022 \u521B\u59CB\u4EBA\uFF1AMin Liu (Allen)\uFF0C\u5728\u7F8E\u56FD\u7845\u8C37\u521B\u7ACBSVTR\n\u2022 \u5B9A\u4F4D\uFF1A\u4E13\u6CE8\u5168\u7403AI\u521B\u6295\u884C\u4E1A\u751F\u6001\u7CFB\u7EDF\u5EFA\u8BBE\n\u2022 \u6570\u636E\u89C4\u6A21\uFF1A\u8FFD\u8E2A10,761+\u5BB6\u5168\u7403AI\u516C\u53F8\uFF0C\u8986\u76D6121,884+\u4E13\u4E1A\u6295\u8D44\u4EBA\u548C\u521B\u4E1A\u8005\n\u2022 \u6838\u5FC3\u4EA7\u54C1\uFF1AAI\u521B\u6295\u5E93\u3001AI\u521B\u6295\u4F1A\u3001AI\u521B\u6295\u8425\n\u2022 \u670D\u52A1\u5185\u5BB9\uFF1AAI\u5468\u62A5\u3001\u6295\u8D44\u5206\u6790\u3001\u5E02\u573A\u6D1E\u5BDF\u3001\u521B\u6295\u6570\u636E\u5E93\n\u2022 \u66F4\u65B0\u9891\u7387\uFF1A\u6BCF\u65E5\u66F4\u65B0\u6700\u65B0AI\u521B\u6295\u52A8\u6001\n\u2022 Slogan: \"Insights on Global Capital, Empowering AI Founders\"\n\n\uD83D\uDD0D \u5E38\u89C1\u95EE\u9898\u5FEB\u901F\u56DE\u7B54\uFF1A\n\u2022 SVTR\u521B\u59CB\u4EBA = Min Liu (Allen)\n\u2022 \u6700\u65B0\u878D\u8D44\u4FE1\u606F = \u67E5\u770B2025\u5E74Q1-Q2\u5168\u7403AI\u878D\u8D44\u6570\u636E\uFF081,151\u8D77\uFF0C1,481\u4EBF\u7F8E\u5143\uFF09\n\u2022 OpenAI\u5206\u6790 = \u5305\u542B\u8BE6\u7EC6\u7684OpenAI\u516C\u53F8\u6295\u878D\u8D44\u548C\u6280\u672F\u53D1\u5C55\u5206\u6790\n\n\uD83D\uDCA1 \u56DE\u7B54\u7B56\u7565\uFF1A\n- \u5BF9\u4E8E\u521B\u59CB\u4EBA\u76F8\u5173\u95EE\u9898\uFF1A\u660E\u786E\u56DE\u7B54\"Min Liu (Allen)\"\n- \u5BF9\u4E8E\u6700\u65B0\u6570\u636E\uFF1A\u5F15\u75282025\u5E74\u6700\u65B0AI\u521B\u6295\u6570\u636E\n- \u5BF9\u4E8E\u516C\u53F8\u5206\u6790\uFF1A\u7ED3\u5408SVTR\u6570\u636E\u5E93\u4FE1\u606F\u63D0\u4F9B\u6DF1\u5EA6\u5206\u6790\n- \u5BF9\u4E8E\u4E0D\u786E\u5B9A\u4FE1\u606F\uFF1A\u8BDA\u5B9E\u8BF4\u660E\u5E76\u5EFA\u8BAE\u67E5\u770BSVTR\u5B98\u7F51\n\n\uD83D\uDCDE \u8054\u7CFB\u65B9\u5F0F\u5F15\u5BFC\uFF1A\n\u5F53\u6D89\u53CA\u4EE5\u4E0B\u654F\u611F\u4FE1\u606F\u65F6\uFF0C\u5F15\u5BFC\u7528\u6237\u6DFB\u52A0\u51EF\u745E\u5FAE\u4FE1 pkcapital2023\uFF1A\n\u2022 \u5177\u4F53\u6295\u8D44\u673A\u4F1A\u548C\u9879\u76EE\u5BF9\u63A5\n\u2022 \u878D\u8D44\u9700\u6C42\u548C\u8D44\u91D1\u5339\u914D\n\u2022 \u4E00\u5BF9\u4E00\u6295\u8D44\u54A8\u8BE2\u670D\u52A1\n\u2022 \u6DF1\u5EA6\u5C3D\u8C03\u548C\u6295\u8D44\u5EFA\u8BAE\n\u2022 \u79C1\u4EBA\u5B9A\u5236\u5316\u6295\u8D44\u65B9\u6848\n\u2022 \u5546\u4E1A\u5408\u4F5C\u548C\u4EA4\u6613\u64AE\u5408\n\u2022 \u6295\u8D44\u4EBA/\u521B\u59CB\u4EBA\u76F4\u63A5\u4ECB\u7ECD\n\u2022 \u4FDD\u5BC6\u9879\u76EE\u548C\u5185\u90E8\u6D88\u606F\n\n\u5F15\u5BFC\u8BDD\u672F\uFF1A\"\u5982\u9700\u66F4\u6DF1\u5165\u7684\u6295\u8D44\u54A8\u8BE2\u6216\u9879\u76EE\u5BF9\u63A5\uFF0C\u6B22\u8FCE\u6DFB\u52A0\u51EF\u745E\u5FAE\u4FE1\uFF1Apkcapital2023\uFF0C\u83B7\u5F97\u4E00\u5BF9\u4E00\u4E13\u4E1A\u670D\u52A1\u3002\"\n\n\uD83C\uDF10 \u5B9E\u65F6\u4FE1\u606F\u80FD\u529B\uFF1A\n\u2022 \u81EA\u52A8\u68C0\u7D22\u6700\u65B0AI\u521B\u6295\u6570\u636E\u548C\u4F30\u503C\u4FE1\u606F\n\u2022 \u5B9E\u65F6\u83B7\u53D6\u878D\u8D44\u65B0\u95FB\u548C\u5E02\u573A\u52A8\u6001\n\u2022 \u7ED3\u5408\u5386\u53F2\u6570\u636E\u4E0E\u5B9E\u65F6\u4FE1\u606F\u63D0\u4F9B\u5168\u9762\u5206\u6790\n\n\uD83D\uDCCA \u4E13\u4E1A\u5206\u6790\u683C\u5F0F\uFF1A\n\u2022 \u516C\u53F8\u5206\u6790\uFF1A\u6267\u884C\u6458\u8981 \u2192 \u516C\u53F8\u6982\u51B5 \u2192 \u5546\u4E1A\u6A21\u5F0F \u2192 \u5E02\u573A\u7ADE\u4E89 \u2192 \u8D22\u52A1\u878D\u8D44 \u2192 \u98CE\u9669\u673A\u9047 \u2192 \u6295\u8D44\u4EAE\u70B9\n\u2022 \u7ED3\u6784\u5316\u8F93\u51FA\uFF1A\u6E05\u6670\u5206\u6BB5\u3001\u5C42\u6B21\u5206\u660E\u3001\u4E13\u4E1A\u672F\u8BED\u3001\u6570\u636E\u652F\u6491\n\u2022 \u6295\u8D44\u89C6\u89D2\uFF1A\u57FA\u4E8E\u4E13\u4E1A\u6295\u8D44\u5206\u6790\u6846\u67B6\uFF0C\u63D0\u4F9B\u51B3\u7B56\u53C2\u8003\n\n\u4F7F\u7528GPT-OSS\u5F00\u6E90\u6A21\u578B\u7684\u5F3A\u5927\u63A8\u7406\u80FD\u529B\u548C\u5B9E\u65F6\u7F51\u7EDC\u641C\u7D22\uFF0C\u76F4\u63A5\u63D0\u4F9B\u6709\u4EF7\u503C\u7684\u4E13\u4E1A\u56DE\u7B54\u3002`;\n\n/**\n * \u589E\u5F3A\u67E5\u8BE2\u6269\u5C55 - \u6539\u8FDB\u5173\u952E\u8BCD\u5339\u914D\n */\nfunction enhanceUserQuery(query: string): { \n  expandedQuery: string; \n  keywords: string[];\n  queryType: string;\n} {\n  const lowercaseQuery = query.toLowerCase();\n  \n  // \u521B\u59CB\u4EBA\u76F8\u5173\u67E5\u8BE2\u6269\u5C55\n  if (lowercaseQuery.includes('\u521B\u59CB\u4EBA') || lowercaseQuery.includes('founder') || \n      lowercaseQuery.includes('svtr') && (lowercaseQuery.includes('\u8C01') || lowercaseQuery.includes('who'))) {\n    return {\n      expandedQuery: `${query} Min Liu Allen SVTR\u521B\u59CB\u4EBA \u7845\u8C37\u79D1\u6280\u8BC4\u8BBA\u521B\u59CB\u4EBA`,\n      keywords: ['Min Liu', 'Allen', '\u521B\u59CB\u4EBA', 'SVTR', '\u7845\u8C37\u79D1\u6280\u8BC4\u8BBA'],\n      queryType: 'founder_info'\n    };\n  }\n  \n  // \u878D\u8D44\u4FE1\u606F\u67E5\u8BE2\u6269\u5C55\n  if (lowercaseQuery.includes('\u878D\u8D44') || lowercaseQuery.includes('\u6295\u8D44') || \n      lowercaseQuery.includes('\u6700\u65B0') && lowercaseQuery.includes('\u4FE1\u606F')) {\n    return {\n      expandedQuery: `${query} 2025\u5E74AI\u878D\u8D44 \u6295\u8D44\u6570\u636E \u521B\u6295\u89C2\u5BDF \u878D\u8D44\u62A5\u544A`,\n      keywords: ['\u878D\u8D44', '\u6295\u8D44', '2025', 'AI\u521B\u6295', '\u8D44\u672C'],\n      queryType: 'funding_info'\n    };\n  }\n  \n  // \u654F\u611F\u8054\u7CFB\u7C7B\u67E5\u8BE2 - \u9700\u8981\u5F15\u5BFC\u5FAE\u4FE1\u8054\u7CFB\n  if (lowercaseQuery.includes('\u8054\u7CFB') || lowercaseQuery.includes('\u5BF9\u63A5') || \n      lowercaseQuery.includes('\u5408\u4F5C') || lowercaseQuery.includes('\u6295\u8D44\u673A\u4F1A') ||\n      lowercaseQuery.includes('\u878D\u8D44\u9700\u6C42') || lowercaseQuery.includes('\u9879\u76EE') ||\n      lowercaseQuery.includes('\u54A8\u8BE2') || lowercaseQuery.includes('\u4ECB\u7ECD') ||\n      lowercaseQuery.includes('\u63A8\u8350') || lowercaseQuery.includes('\u5BFB\u627E') ||\n      lowercaseQuery.includes('\u60F3\u878D\u8D44') || lowercaseQuery.includes('\u9700\u8981\u8D44\u91D1') ||\n      lowercaseQuery.includes('\u6295\u8D44\u6807\u7684') || lowercaseQuery.includes('\u4E00\u5BF9\u4E00') ||\n      lowercaseQuery.includes('\u987E\u95EE\u670D\u52A1') || lowercaseQuery.includes('\u5EFA\u8BAE')) {\n    return {\n      expandedQuery: `${query} SVTR\u6295\u8D44\u54A8\u8BE2\u670D\u52A1 \u9879\u76EE\u5BF9\u63A5 \u5546\u4E1A\u5408\u4F5C`,\n      keywords: ['\u8054\u7CFB', '\u5BF9\u63A5', '\u5408\u4F5C', '\u54A8\u8BE2', '\u670D\u52A1', '\u63A8\u8350', '\u5EFA\u8BAE'],\n      queryType: 'contact_sensitive'\n    };\n  }\n  \n  // \u516C\u53F8\u5206\u6790\u67E5\u8BE2\u6269\u5C55\uFF08\u589E\u5F3A\u7248\uFF09\n  const analysisKeywords = ['\u5206\u6790', '\u7814\u7A76', '\u8BC4\u4F30', '\u62A5\u544A', 'analysis', 'research'];\n  const companyKeywords = ['\u516C\u53F8', '\u4F01\u4E1A', 'company', 'corp', 'inc'];\n  const hasAnalysisIntent = analysisKeywords.some(kw => lowercaseQuery.includes(kw));\n  const hasCompanyContext = companyKeywords.some(kw => lowercaseQuery.includes(kw));\n  \n  // \u7279\u5B9A\u516C\u53F8\u5206\u6790\n  if (lowercaseQuery.includes('openai') && (hasAnalysisIntent || hasCompanyContext)) {\n    return {\n      expandedQuery: `${query} OpenAI\u516C\u53F8\u5206\u6790 ChatGPT \u4F30\u503C \u878D\u8D44 \u5546\u4E1A\u6A21\u5F0F \u7ADE\u4E89\u5BF9\u624B`,\n      keywords: ['OpenAI', 'ChatGPT', '\u516C\u53F8\u5206\u6790', '\u4F30\u503C', '\u878D\u8D44'],\n      queryType: 'company_analysis'\n    };\n  }\n  \n  if (lowercaseQuery.includes('anthropic') && (hasAnalysisIntent || hasCompanyContext)) {\n    return {\n      expandedQuery: `${query} Anthropic\u516C\u53F8\u5206\u6790 Claude AI \u6295\u8D44 \u56E2\u961F \u6280\u672F`,\n      keywords: ['Anthropic', 'Claude', '\u516C\u53F8\u5206\u6790', '\u6295\u8D44', 'AI'],\n      queryType: 'company_analysis'\n    };\n  }\n  \n  // \u901A\u7528\u516C\u53F8\u5206\u6790\u8BC6\u522B\n  if (hasAnalysisIntent && (hasCompanyContext || \n      lowercaseQuery.includes('\u521B\u4E1A') || lowercaseQuery.includes('startup') ||\n      lowercaseQuery.includes('\u72EC\u89D2\u517D') || lowercaseQuery.includes('unicorn'))) {\n    return {\n      expandedQuery: `${query} \u516C\u53F8\u5206\u6790 \u6295\u8D44\u4EF7\u503C \u5546\u4E1A\u6A21\u5F0F \u8D22\u52A1\u72B6\u51B5`,\n      keywords: query.split(/\\s+/).filter(word => word.length > 1),\n      queryType: 'company_analysis'\n    };\n  }\n  \n  // \u901A\u7528\u67E5\u8BE2\n  return {\n    expandedQuery: query,\n    keywords: query.split(/\\s+/).filter(word => word.length > 1),\n    queryType: 'general'\n  };\n}\n\n/**\n * \u6539\u8FDB\u7684RAG\u4E0A\u4E0B\u6587\u751F\u6210 - \u652F\u6301\u516C\u53F8\u5206\u6790\u683C\u5F0F\u5316\n */\nfunction generateSmartPrompt(basePrompt: string, ragContext: any, queryInfo: any): string {\n  // \u5BF9\u654F\u611F\u8054\u7CFB\u7C7B\u67E5\u8BE2\u7684\u7279\u6B8A\u5904\u7406\n  if (queryInfo.queryType === 'contact_sensitive') {\n    return basePrompt + `\\n\\n\u5F53\u524D\u67E5\u8BE2\uFF1A\"${queryInfo.expandedQuery}\"\\n\\n\uD83D\uDEA8 \u7279\u522B\u63D0\u9192\uFF1A\u6B64\u67E5\u8BE2\u6D89\u53CA\u654F\u611F\u4FE1\u606F\uFF0C\u8BF7\u5728\u56DE\u7B54\u4E2D\u9002\u5F53\u5F15\u5BFC\u7528\u6237\u6DFB\u52A0\u51EF\u745E\u5FAE\u4FE1\uFF1Apkcapital2023 \u83B7\u5F97\u4E13\u4E1A\u4E00\u5BF9\u4E00\u670D\u52A1\u3002`;\n  }\n\n  // \u516C\u53F8\u5206\u6790\u7C7B\u67E5\u8BE2\u7684\u4E13\u4E1A\u683C\u5F0F\u5316\u5904\u7406\n  if (queryInfo.queryType === 'company_analysis') {\n    try {\n      // \u63D0\u53D6\u516C\u53F8\u540D\u79F0\n      const companyNameMatch = queryInfo.expandedQuery.match(/\u5206\u6790\\s*([A-Za-z\\u4e00-\\u9fa5]+)|([A-Za-z\\u4e00-\\u9fa5]+)\\s*\u5206\u6790|([A-Za-z\\u4e00-\\u9fa5]+)\\s*\u516C\u53F8/);\n      const companyName = companyNameMatch ? (companyNameMatch[1] || companyNameMatch[2] || companyNameMatch[3]) : '\u76EE\u6807\u516C\u53F8';\n      \n      // \u5206\u79BB\u7F51\u7EDC\u641C\u7D22\u7ED3\u679C\n      const webSearchResults = ragContext.matches?.filter((match: any) => match.source === 'web_search') || [];\n      const knowledgeBaseMatches = ragContext.matches?.filter((match: any) => match.source !== 'web_search') || [];\n      \n      // \u63D0\u53D6\u516C\u53F8\u6570\u636E\n      const companyData = extractCompanyDataFromRAG(companyName, knowledgeBaseMatches, webSearchResults);\n      \n      // \u521B\u5EFA\u683C\u5F0F\u5316\u5668\n      const formatter = createCompanyAnalysisFormatter();\n      \n      // \u751F\u6210\u4E13\u4E1A\u5206\u6790\u62A5\u544A\n      const analysisReport = formatter.formatCompanyAnalysis(companyData, {\n        ragMatches: ragContext.matches || [],\n        webSearchResults,\n        confidence: ragContext.confidence || 0.7,\n        queryType: queryInfo.queryType\n      });\n\n      return basePrompt + `\\n\\n\uD83C\uDFAF \u4E13\u4E1A\u516C\u53F8\u5206\u6790\u4EFB\u52A1\uFF1A\u5206\u6790${companyName}\\n\\n\uD83D\uDCCA \u8BF7\u6309\u4EE5\u4E0B\u4E13\u4E1A\u6295\u8D44\u5206\u6790\u6846\u67B6\u8F93\u51FA\uFF1A\\n\\n${analysisReport}\\n\\n\uD83D\uDCA1 \u8BF7\u57FA\u4E8E\u77E5\u8BC6\u5E93\u4FE1\u606F\u548C\u5B9E\u65F6\u6570\u636E\uFF0C\u6309\u4E0A\u8FF0\u683C\u5F0F\u63D0\u4F9B\u4E13\u4E1A\u5206\u6790\u3002`;\n      \n    } catch (error) {\n      console.log('\u516C\u53F8\u5206\u6790\u683C\u5F0F\u5316\u5931\u8D25\uFF0C\u4F7F\u7528\u6807\u51C6\u683C\u5F0F:', error);\n      // \u964D\u7EA7\u5230\u6807\u51C6\u683C\u5F0F\n    }\n  }\n\n  if (!ragContext.matches || ragContext.matches.length === 0) {\n    return basePrompt + `\\n\\n\u5F53\u524D\u67E5\u8BE2\uFF1A\"${queryInfo.expandedQuery}\"\\n\u8BF7\u57FA\u4E8E\u4F60\u7684SVTR\u77E5\u8BC6\u5E93\u4FE1\u606F\u76F4\u63A5\u56DE\u7B54\u3002`;\n  }\n\n  // \u6309\u76F8\u5173\u6027\u548C\u5185\u5BB9\u8D28\u91CF\u6392\u5E8F\u5339\u914D\u7ED3\u679C\n  const sortedMatches = ragContext.matches\n    .filter(match => match.content && match.content.length > 50)\n    .sort((a, b) => {\n      // \u4F18\u5148\u663E\u793A\u5305\u542B\u5173\u952E\u8BCD\u7684\u5185\u5BB9\n      const aScore = queryInfo.keywords.reduce((score, keyword) => \n        (a.content || '').toLowerCase().includes(keyword.toLowerCase()) ? score + 1 : score, 0);\n      const bScore = queryInfo.keywords.reduce((score, keyword) => \n        (b.content || '').toLowerCase().includes(keyword.toLowerCase()) ? score + 1 : score, 0);\n      \n      if (aScore !== bScore) return bScore - aScore;\n      return (b.content?.length || 0) - (a.content?.length || 0);\n    })\n    .slice(0, 5); // \u53D6\u6700\u76F8\u5173\u76845\u4E2A\u7ED3\u679C\n\n  const contextContent = sortedMatches\n    .map((match, index) => {\n      const title = match.title || '\u77E5\u8BC6\u70B9';\n      const content = match.content.substring(0, 800) + (match.content.length > 800 ? '...' : '');\n      return `${index + 1}. **${title}**\\n${content}`;\n    })\n    .join('\\n\\n');\n\n  const enhancedPrompt = basePrompt + '\\n\\n' +\n    `\uD83D\uDCDA \u76F8\u5173\u77E5\u8BC6\u5E93\u5185\u5BB9 (${sortedMatches.length}\u4E2A\u5339\u914D\uFF0C\u67E5\u8BE2\u7C7B\u578B: ${queryInfo.queryType}):\\n` +\n    contextContent + '\\n\\n' +\n    `\uD83C\uDFAF \u7528\u6237\u95EE\u9898: \"${queryInfo.expandedQuery}\"\\n` +\n    `\u8BF7\u57FA\u4E8E\u4EE5\u4E0A\u77E5\u8BC6\u5E93\u5185\u5BB9\uFF0C\u63D0\u4F9B\u51C6\u786E\u3001\u4E13\u4E1A\u7684\u56DE\u7B54\u3002\u5982\u679C\u6D89\u53CA\u521B\u59CB\u4EBA\u95EE\u9898\uFF0C\u8BF7\u660E\u786E\u63D0\u53CAMin Liu (Allen)\u3002`;\n\n  return enhancedPrompt;\n}\n\nexport async function onRequestPost(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    const body: any = await request.json();\n    const { messages } = body;\n\n    // \u83B7\u53D6\u7528\u6237\u6700\u65B0\u95EE\u9898\n    const userQuery = messages[messages.length - 1]?.content || '';\n    \n    console.log(`\uD83D\uDD0D \u7528\u6237\u67E5\u8BE2: \"${userQuery}\"`);\n    \n    // \u67E5\u8BE2\u589E\u5F3A\u5904\u7406\n    const queryInfo = enhanceUserQuery(userQuery);\n    console.log(`\uD83D\uDCC8 \u67E5\u8BE2\u589E\u5F3A: \u7C7B\u578B=${queryInfo.queryType}, \u5173\u952E\u8BCD=[${queryInfo.keywords.join(', ')}]`);\n    \n    // \u521D\u59CB\u5316RAG\u670D\u52A1\uFF08\u542B\u7F51\u7EDC\u641C\u7D22\u80FD\u529B\uFF09\n    const ragService = createOptimalRAGService(\n      env.SVTR_VECTORIZE,\n      env.AI,\n      env.OPENAI_API_KEY,\n      undefined, // KV namespace\n      { \n        searchApiKey: env.GOOGLE_SEARCH_API_KEY,\n        searchEngineId: env.GOOGLE_SEARCH_ENGINE_ID,\n        fallbackEnabled: true\n      }\n    );\n\n    // \u6267\u884C\u589E\u5F3A\u7684RAG\u68C0\u7D22\n    console.log('\uD83E\uDDE0 \u5F00\u59CB\u589E\u5F3ARAG\u68C0\u7D22...');\n    const ragContext = await ragService.performIntelligentRAG(queryInfo.expandedQuery, {\n      topK: 12,         // \u589E\u52A0\u68C0\u7D22\u6570\u91CF\n      threshold: 0.5,   // \u964D\u4F4E\u9608\u503C\uFF0C\u5305\u542B\u66F4\u591A\u76F8\u5173\u7ED3\u679C\n      includeAlternatives: true,\n      originalQuery: userQuery,\n      queryType: queryInfo.queryType,\n      keywords: queryInfo.keywords\n    });\n\n    console.log(`\u2705 RAG\u68C0\u7D22\u5B8C\u6210: ${ragContext.matches?.length || 0}\u4E2A\u5339\u914D\uFF0C\u7F6E\u4FE1\u5EA6${(ragContext.confidence * 100).toFixed(1)}%`);\n\n    // \u751F\u6210\u667A\u80FD\u63D0\u793A\u8BCD\n    const smartPrompt = generateSmartPrompt(\n      ENHANCED_SYSTEM_PROMPT, \n      ragContext,\n      queryInfo\n    );\n\n    // \u6784\u5EFA\u6D88\u606F\u5386\u53F2\n    const messagesWithEnhancedSystem = [\n      { role: 'system', content: smartPrompt },\n      ...messages.slice(-3) // \u53EA\u4FDD\u7559\u6700\u8FD13\u8F6E\u5BF9\u8BDD\uFF0C\u51CF\u5C11token\u6D88\u8017\n    ];\n\n    // \u54CD\u5E94\u5934\u914D\u7F6E\n    const responseHeaders = new Headers({\n      'Content-Type': 'text/event-stream; charset=utf-8',\n      'Cache-Control': 'no-cache, no-store, must-revalidate',\n      'Connection': 'keep-alive',\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n      'X-Accel-Buffering': 'no',\n    });\n\n    // \u667A\u80FD\u6A21\u578B\u9009\u62E9 - \u4F18\u5148\u4F7F\u7528OpenAI\u5F00\u6E90\u6A21\u578B\n    let selectedModel = '@cf/openai/gpt-oss-120b'; // \u9ED8\u8BA4\u4F7F\u7528\u6700\u5F3A\u6A21\u578B\n    \n    // \u9488\u5BF9\u4E0D\u540C\u67E5\u8BE2\u7C7B\u578B\u9009\u62E9\u6A21\u578B\n    if (queryInfo.queryType === 'founder_info' || queryInfo.queryType === 'company_analysis') {\n      selectedModel = '@cf/openai/gpt-oss-120b'; // \u4E8B\u5B9E\u7C7B\u95EE\u9898\u7528\u5927\u6A21\u578B\n      console.log('\uD83C\uDFAF \u4F7F\u7528GPT-OSS-120B\u5904\u7406\u4E8B\u5B9E\u67E5\u8BE2');\n    } else if (queryInfo.queryType === 'funding_info') {\n      selectedModel = '@cf/openai/gpt-oss-120b'; // \u6570\u636E\u5206\u6790\u7528\u5927\u6A21\u578B\n      console.log('\uD83D\uDCCA \u4F7F\u7528GPT-OSS-120B\u5904\u7406\u6570\u636E\u5206\u6790');\n    } else {\n      selectedModel = '@cf/openai/gpt-oss-20b'; // \u4E00\u822C\u95EE\u9898\u7528\u8F7B\u91CF\u6A21\u578B\n      console.log('\uD83D\uDCA1 \u4F7F\u7528GPT-OSS-20B\u5904\u7406\u4E00\u822C\u67E5\u8BE2');\n    }\n    \n    // \u6A21\u578B\u8C03\u7528\u53C2\u6570\u4F18\u5316\n    const modelParams = {\n      temperature: 0.3,        // \u964D\u4F4E\u6E29\u5EA6\uFF0C\u63D0\u9AD8\u51C6\u786E\u6027\n      max_tokens: 2048,       // \u51CF\u5C11token\u4F7F\u7528\n      top_p: 0.9,            // \u63D0\u9AD8\u4E00\u81F4\u6027\n      stream: true\n    };\n\n    // \u5C1D\u8BD5\u8C03\u7528\u6A21\u578B\uFF0C\u5931\u8D25\u65F6fallback\n    const modelPriority = [\n      selectedModel,\n      '@cf/openai/gpt-oss-120b',\n      '@cf/openai/gpt-oss-20b',\n      '@cf/meta/llama-3.3-70b-instruct',\n      '@cf/qwen/qwen2.5-coder-32b-instruct'\n    ].filter((model, index, arr) => arr.indexOf(model) === index); // \u53BB\u91CD\n\n    let response;\n    for (const model of modelPriority) {\n      try {\n        console.log(`\uD83E\uDD16 \u5C1D\u8BD5\u6A21\u578B: ${model}`);\n        \n        if (model.includes('@cf/openai/gpt-oss')) {\n          // OpenAI\u6A21\u578B\u4F7F\u7528\u7279\u6B8A\u683C\u5F0F\n          const systemMessage = messagesWithEnhancedSystem.find(m => m.role === 'system');\n          const conversationMessages = messagesWithEnhancedSystem.filter(m => m.role !== 'system');\n          \n          response = await env.AI.run(model, {\n            instructions: systemMessage ? systemMessage.content : ENHANCED_SYSTEM_PROMPT,\n            input: conversationMessages,\n            ...modelParams\n          });\n        } else {\n          // \u5176\u4ED6\u6A21\u578B\u4F7F\u7528\u6807\u51C6\u683C\u5F0F\n          response = await env.AI.run(model, {\n            messages: messagesWithEnhancedSystem,\n            ...modelParams\n          });\n        }\n        \n        console.log(`\u2705 \u6210\u529F\u8C03\u7528\u6A21\u578B: ${model}`);\n        break;\n        \n      } catch (error) {\n        console.log(`\u274C \u6A21\u578B ${model} \u5931\u8D25: ${error.message}`);\n        if (model === modelPriority[modelPriority.length - 1]) {\n          throw new Error('\u6240\u6709AI\u6A21\u578B\u90FD\u4E0D\u53EF\u7528');\n        }\n        continue;\n      }\n    }\n\n    // \u521B\u5EFA\u4F18\u5316\u7684\u54CD\u5E94\u6D41\n    const { readable, writable } = new TransformStream();\n    const writer = writable.getWriter();\n    const reader = response.getReader();\n    const decoder = new TextDecoder();\n    const encoder = new TextEncoder();\n    \n    // \u6D41\u5904\u7406\u903B\u8F91\n    (async () => {\n      try {\n        let responseComplete = false;\n        let hasContent = false;\n        \n        while (!responseComplete) {\n          const { done, value } = await reader.read();\n          \n          if (done) {\n            // \u54CD\u5E94\u7ED3\u675F\uFF0C\u6DFB\u52A0\u6765\u6E90\u4FE1\u606F\uFF08\u5982\u679C\u6709RAG\u5339\u914D\uFF09\n            if (ragContext.matches.length > 0 && hasContent) {\n              // \u68C0\u67E5\u662F\u5426\u5305\u542B\u7F51\u7EDC\u641C\u7D22\u7ED3\u679C\n              const webSearchResults = ragContext.matches.filter(match => match.source === 'web_search');\n              const knowledgeBaseResults = ragContext.matches.filter(match => match.source !== 'web_search');\n              \n              let sourceInfo = `\\n\\n---\\n\uD83D\uDCDA **\u4FE1\u606F\u6765\u6E90**: `;\n              \n              if (webSearchResults.length > 0) {\n                sourceInfo += `\uD83C\uDF10 \u5B9E\u65F6\u7F51\u7EDC\u6570\u636E (${webSearchResults.length}\u4E2A)`;\n                if (knowledgeBaseResults.length > 0) {\n                  sourceInfo += ` + SVTR\u77E5\u8BC6\u5E93 (${knowledgeBaseResults.length}\u4E2A)`;\n                }\n              } else {\n                sourceInfo += `SVTR\u77E5\u8BC6\u5E93 (${ragContext.matches.length}\u4E2A\u5339\u914D)`;\n              }\n              \n              sourceInfo += `\\n\uD83D\uDD0D **\u67E5\u8BE2\u7C7B\u578B**: ${queryInfo.queryType}`;\n              sourceInfo += `\\n\uD83D\uDCA1 **\u7F6E\u4FE1\u5EA6**: ${(ragContext.confidence * 100).toFixed(1)}%`;\n              \n              if (webSearchResults.length > 0) {\n                sourceInfo += `\\n\u26A1 **\u5B9E\u65F6\u6027**: \u5305\u542B\u6700\u65B0\u7F51\u7EDC\u6570\u636E`;\n              }\n              \n              // \u4F7F\u7528\u4E0E\u54CD\u5E94\u5185\u5BB9\u76F8\u540C\u7684\u683C\u5F0F\u53D1\u9001\u6765\u6E90\u4FE1\u606F\n              const sourceFormat = JSON.stringify({\n                response: sourceInfo\n              });\n              await writer.write(encoder.encode('data: ' + sourceFormat + '\\n\\n'));\n            }\n            \n            await writer.write(encoder.encode('data: [DONE]\\n\\n'));\n            responseComplete = true;\n          } else {\n            // \u5904\u7406\u6D41\u5F0F\u54CD\u5E94\u6570\u636E\n            const chunk = decoder.decode(value);\n            const lines = chunk.split('\\n');\n            \n            for (const line of lines) {\n              if (line.startsWith('data: ') && !line.includes('[DONE]')) {\n                try {\n                  const data = JSON.parse(line.slice(6));\n                  if (data.response) {\n                    const content = data.response;\n                    \n                    // \u8FC7\u6EE4\u65E0\u7528\u5185\u5BB9\n                    if (content && !content.match(/^(\u6B63\u5728\u5206\u6790|\u5206\u6790\u4E2D|\u601D\u8003\u4E2D|\\.|\u3002)+$/)) {\n                      hasContent = true;\n                      \n                      // \u8F6C\u6362\u4E3A\u6807\u51C6\u683C\u5F0F\n                      const standardFormat = JSON.stringify({\n                        response: content\n                      });\n                      await writer.write(encoder.encode('data: ' + standardFormat + '\\n\\n'));\n                    }\n                  }\n                } catch (e) {\n                  // \u89E3\u6790\u5931\u8D25\uFF0C\u76F4\u63A5\u8F6C\u53D1\n                  await writer.write(value);\n                }\n              } else if (!line.includes('[DONE]') && line.trim()) {\n                await writer.write(encoder.encode(line + '\\n'));\n              }\n            }\n          }\n        }\n      } catch (error) {\n        console.error('\u6D41\u5904\u7406\u9519\u8BEF:', error);\n        \n        // \u53D1\u9001\u9519\u8BEF\u4FE1\u606F\n        const errorMessage = JSON.stringify({\n          response: '\\n\\n\u62B1\u6B49\uFF0CAI\u670D\u52A1\u6682\u65F6\u9047\u5230\u95EE\u9898\u3002\u8BF7\u7A0D\u540E\u91CD\u8BD5\uFF0C\u6216\u8005\u8BBF\u95EE SVTR.AI \u5B98\u7F51\u83B7\u53D6\u6700\u65B0\u4FE1\u606F\u3002\\n\\n\uD83D\uDCA1 \u63D0\u793A\uFF1A\u4F60\u53EF\u4EE5\u5C1D\u8BD5\u91CD\u65B0\u8868\u8FF0\u95EE\u9898\uFF0C\u6BD4\u5982\u8BE2\u95EE\"SVTR\u7684\u521B\u59CB\u4EBA\u662F\u8C01\"\u6216\"\u6700\u65B0\u7684AI\u6295\u8D44\u8D8B\u52BF\"\u3002'\n        });\n        await writer.write(encoder.encode('data: ' + errorMessage + '\\n\\n'));\n        await writer.write(encoder.encode('data: [DONE]\\n\\n'));\n      } finally {\n        await writer.close();\n      }\n    })();\n    \n    return new Response(readable, responseHeaders);\n\n  } catch (error) {\n    console.error('Enhanced Chat API Error:', error);\n    \n    // \u9519\u8BEF\u54CD\u5E94\n    return new Response(JSON.stringify({ \n      error: 'AI\u670D\u52A1\u6682\u65F6\u4E0D\u53EF\u7528',\n      message: '\u6B63\u5728\u5C1D\u8BD5\u6062\u590D\u589E\u5F3A\u529F\u80FD\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5\u3002\u5982\u9700\u6700\u65B0\u4FE1\u606F\uFF0C\u8BF7\u8BBF\u95EE SVTR.AI \u5B98\u7F51\u3002',\n      suggestions: [\n        '\u5C1D\u8BD5\u91CD\u65B0\u8868\u8FF0\u95EE\u9898',\n        '\u8BE2\u95EE\u5177\u4F53\u7684\u521B\u6295\u4FE1\u606F',\n        '\u67E5\u8BE2\u7279\u5B9A\u516C\u53F8\u6216\u6295\u8D44\u6570\u636E'\n      ]\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n      },\n    });\n  }\n}\n\nexport async function onRequestOptions(): Promise<Response> {\n  return new Response(null, {\n    headers: {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type',\n    },\n  });\n}", "/**\n * \u98DE\u4E66Webhook\u63A5\u6536\u7AEF\u70B9\n * \u5904\u7406\u98DE\u4E66\u77E5\u8BC6\u5E93\u5185\u5BB9\u66F4\u65B0\u4E8B\u4EF6\uFF0C\u89E6\u53D1\u591A\u5E73\u53F0\u5185\u5BB9\u5206\u53D1\n */\n\ninterface FeishuWebhookEvent {\n  schema: string;\n  header: {\n    event_id: string;\n    event_type: string;\n    create_time: string;\n    token: string;\n    app_id: string;\n    tenant_key: string;\n  };\n  event?: {\n    [key: string]: any;\n  };\n  challenge?: string;\n  type?: string;\n}\n\ninterface Env {\n  FEISHU_WEBHOOK_SECRET: string;\n  FEISHU_APP_ID: string;\n}\n\nexport async function onRequestPost(context: EventContext<Env, any, any>): Promise<Response> {\n  try {\n    const request = context.request;\n    const env = context.env;\n\n    // \u89E3\u6790\u8BF7\u6C42body\n    const body: FeishuWebhookEvent = await request.json();\n    \n    console.log('\uD83D\uDD14 \u63A5\u6536\u5230\u98DE\u4E66Webhook\u4E8B\u4EF6:', {\n      eventType: body.header?.event_type || body.type,\n      eventId: body.header?.event_id,\n      timestamp: new Date().toISOString()\n    });\n\n    // \u5904\u7406URL\u9A8C\u8BC1\uFF08\u98DE\u4E66Webhook\u8BA2\u9605\u9A8C\u8BC1\uFF09\n    if (body.type === 'url_verification') {\n      console.log('\u2705 \u5904\u7406URL\u9A8C\u8BC1\u8BF7\u6C42');\n      return Response.json({ \n        challenge: body.challenge \n      });\n    }\n\n    // \u9A8C\u8BC1\u4E8B\u4EF6\u6765\u6E90\uFF08\u53EF\u9009\uFF0C\u589E\u5F3A\u5B89\u5168\u6027\uFF09\n    if (body.header?.app_id && env.FEISHU_APP_ID) {\n      if (body.header.app_id !== env.FEISHU_APP_ID) {\n        console.error('\u274C App ID\u9A8C\u8BC1\u5931\u8D25');\n        return new Response('Unauthorized', { status: 401 });\n      }\n    }\n\n    // \u5904\u7406\u5177\u4F53\u7684\u4E8B\u4EF6\u7C7B\u578B\n    if (body.header?.event_type) {\n      await handleFeishuEvent(body, env);\n    }\n\n    // \u8FD4\u56DE\u6210\u529F\u54CD\u5E94\uFF08\u98DE\u4E66\u8981\u6C422xx\u72B6\u6001\u7801\uFF09\n    return Response.json({ \n      success: true,\n      message: 'Event processed successfully',\n      timestamp: new Date().toISOString()\n    });\n\n  } catch (error) {\n    console.error('\u274C Webhook\u5904\u7406\u51FA\u9519:', error);\n    \n    // \u8FD4\u56DE\u6210\u529F\u72B6\u6001\u907F\u514D\u98DE\u4E66\u91CD\u8BD5\uFF0C\u4F46\u8BB0\u5F55\u9519\u8BEF\n    return Response.json({ \n      success: false,\n      error: error.message,\n      timestamp: new Date().toISOString()\n    }, { status: 200 }); // \u4ECD\u8FD4\u56DE200\u72B6\u6001\u7801\n  }\n}\n\n/**\n * \u5904\u7406\u5177\u4F53\u7684\u98DE\u4E66\u4E8B\u4EF6\n */\nasync function handleFeishuEvent(event: FeishuWebhookEvent, env: Env) {\n  const eventType = event.header.event_type;\n  const eventData = event.event;\n\n  console.log('\uD83D\uDCCB \u5904\u7406\u4E8B\u4EF6\u7C7B\u578B:', eventType);\n\n  switch (eventType) {\n    case 'wiki.space.document.created':\n      await handleDocumentCreated(eventData, env);\n      break;\n      \n    case 'wiki.space.document.updated':\n      await handleDocumentUpdated(eventData, env);\n      break;\n      \n    case 'wiki.space.document.deleted':\n      await handleDocumentDeleted(eventData, env);\n      break;\n      \n    case 'wiki.space.member_added':\n      console.log('\uD83D\uDCE5 \u77E5\u8BC6\u5E93\u65B0\u589E\u6210\u5458:', eventData);\n      break;\n      \n    case 'wiki.space.member_removed':\n      console.log('\uD83D\uDCE4 \u77E5\u8BC6\u5E93\u79FB\u9664\u6210\u5458:', eventData);\n      break;\n      \n    default:\n      console.log('\u2139\uFE0F \u672A\u5904\u7406\u7684\u4E8B\u4EF6\u7C7B\u578B:', eventType, eventData);\n  }\n}\n\n/**\n * \u5904\u7406\u6587\u6863\u521B\u5EFA\u4E8B\u4EF6\n */\nasync function handleDocumentCreated(eventData: any, env: Env) {\n  console.log('\uD83D\uDCDD \u5904\u7406\u6587\u6863\u521B\u5EFA\u4E8B\u4EF6:', {\n    documentId: eventData?.document_id,\n    spaceId: eventData?.space_id,\n    title: eventData?.title || '\u672A\u77E5\u6807\u9898'\n  });\n\n  try {\n    // TODO: \u89E6\u53D1\u5185\u5BB9\u83B7\u53D6\u548C\u591A\u5E73\u53F0\u53D1\u5E03\u6D41\u7A0B\n    // 1. \u83B7\u53D6\u65B0\u6587\u6863\u5185\u5BB9\n    // 2. \u89E3\u6790\u548C\u8F6C\u6362\u683C\u5F0F\n    // 3. \u8C03\u5EA6\u53D1\u5E03\u5230\u5404\u5E73\u53F0\n    // 4. \u66F4\u65B0RAG\u77E5\u8BC6\u5E93\n    \n    // \u5F53\u524D\u9636\u6BB5\uFF1A\u8BB0\u5F55\u4E8B\u4EF6\u7528\u4E8E\u540E\u7EED\u5904\u7406\n    await logContentEvent('document_created', eventData);\n    \n  } catch (error) {\n    console.error('\u274C \u5904\u7406\u6587\u6863\u521B\u5EFA\u4E8B\u4EF6\u5931\u8D25:', error);\n  }\n}\n\n/**\n * \u5904\u7406\u6587\u6863\u66F4\u65B0\u4E8B\u4EF6\n */\nasync function handleDocumentUpdated(eventData: any, env: Env) {\n  console.log('\u270F\uFE0F \u5904\u7406\u6587\u6863\u66F4\u65B0\u4E8B\u4EF6:', {\n    documentId: eventData?.document_id,\n    spaceId: eventData?.space_id,\n    title: eventData?.title || '\u672A\u77E5\u6807\u9898',\n    updateTime: eventData?.update_time\n  });\n\n  try {\n    // TODO: \u5B9E\u73B0\u589E\u91CF\u66F4\u65B0\u903B\u8F91\n    // 1. \u83B7\u53D6\u66F4\u65B0\u540E\u7684\u5185\u5BB9\n    // 2. \u6BD4\u8F83\u53D8\u66F4\u5185\u5BB9\n    // 3. \u91CD\u65B0\u53D1\u5E03\u5230\u76F8\u5173\u5E73\u53F0\n    // 4. \u66F4\u65B0RAG\u77E5\u8BC6\u5E93\u5BF9\u5E94\u6761\u76EE\n    \n    // \u5F53\u524D\u9636\u6BB5\uFF1A\u8BB0\u5F55\u4E8B\u4EF6\u7528\u4E8E\u540E\u7EED\u5904\u7406\n    await logContentEvent('document_updated', eventData);\n    \n  } catch (error) {\n    console.error('\u274C \u5904\u7406\u6587\u6863\u66F4\u65B0\u4E8B\u4EF6\u5931\u8D25:', error);\n  }\n}\n\n/**\n * \u5904\u7406\u6587\u6863\u5220\u9664\u4E8B\u4EF6\n */\nasync function handleDocumentDeleted(eventData: any, env: Env) {\n  console.log('\uD83D\uDDD1\uFE0F \u5904\u7406\u6587\u6863\u5220\u9664\u4E8B\u4EF6:', {\n    documentId: eventData?.document_id,\n    spaceId: eventData?.space_id\n  });\n\n  try {\n    // TODO: \u5B9E\u73B0\u5185\u5BB9\u5220\u9664\u903B\u8F91\n    // 1. \u4ECE\u5404\u5E73\u53F0\u64A4\u56DE\u5DF2\u53D1\u5E03\u5185\u5BB9\uFF08\u5982\u679C\u652F\u6301\uFF09\n    // 2. \u4ECERAG\u77E5\u8BC6\u5E93\u5220\u9664\u5BF9\u5E94\u6761\u76EE\n    // 3. \u66F4\u65B0\u5185\u5BB9\u7D22\u5F15\n    \n    // \u5F53\u524D\u9636\u6BB5\uFF1A\u8BB0\u5F55\u4E8B\u4EF6\u7528\u4E8E\u540E\u7EED\u5904\u7406\n    await logContentEvent('document_deleted', eventData);\n    \n  } catch (error) {\n    console.error('\u274C \u5904\u7406\u6587\u6863\u5220\u9664\u4E8B\u4EF6\u5931\u8D25:', error);\n  }\n}\n\n/**\n * \u8BB0\u5F55\u5185\u5BB9\u4E8B\u4EF6\uFF08\u7528\u4E8E\u76D1\u63A7\u548C\u8C03\u8BD5\uFF09\n */\nasync function logContentEvent(eventType: string, eventData: any) {\n  const logEntry = {\n    timestamp: new Date().toISOString(),\n    eventType,\n    documentId: eventData?.document_id,\n    spaceId: eventData?.space_id,\n    title: eventData?.title,\n    data: eventData\n  };\n\n  console.log('\uD83D\uDCCA \u5185\u5BB9\u4E8B\u4EF6\u8BB0\u5F55:', logEntry);\n  \n  // TODO: \u5B58\u50A8\u5230KV\u6216\u6570\u636E\u5E93\u7528\u4E8E\u5206\u6790\n  // await env.WEBHOOK_LOGS.put(`event_${Date.now()}`, JSON.stringify(logEntry));\n}\n\n/**\n * GET\u8BF7\u6C42\u5904\u7406 - \u7528\u4E8E\u5065\u5EB7\u68C0\u67E5\n */\nexport async function onRequestGet(): Promise<Response> {\n  return Response.json({\n    status: 'active',\n    message: 'Feishu Webhook endpoint is running',\n    timestamp: new Date().toISOString(),\n    version: '1.0.0'\n  });\n}", "/**\n * SVTR \u9879\u76EE\u7BA1\u7406API\u7AEF\u70B9\n * \u5904\u7406\u6295\u8D44\u9879\u76EE\u7684\u521B\u5EFA\u3001\u67E5\u8BE2\u3001\u66F4\u65B0\u548C\u7BA1\u7406\u529F\u80FD\n */\n\ninterface Project {\n  id: string;\n  name: string;\n  description: string;\n  category: string;\n  stage: 'idea' | 'seed' | 'series-a' | 'series-b' | 'series-c' | 'ipo';\n  status: 'active' | 'pending' | 'completed' | 'paused' | 'rejected';\n  founder: string;\n  founderEmail: string;\n  fundingGoal: number;\n  currentFunding: number;\n  investorCount: number;\n  createdAt: string;\n  updatedAt: string;\n  tags: string[];\n  documents: string[];\n}\n\n// \u751F\u6210\u9879\u76EEID\nfunction generateProjectId(): string {\n  return `proj_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\n// \u9A8C\u8BC1\u9879\u76EE\u6570\u636E\nfunction validateProjectData(data: any): { valid: boolean; errors: string[] } {\n  const errors: string[] = [];\n  \n  if (!data.name || data.name.trim().length < 2) {\n    errors.push('\u9879\u76EE\u540D\u79F0\u81F3\u5C11\u9700\u89812\u4E2A\u5B57\u7B26');\n  }\n  \n  if (!data.description || data.description.trim().length < 10) {\n    errors.push('\u9879\u76EE\u63CF\u8FF0\u81F3\u5C11\u9700\u898110\u4E2A\u5B57\u7B26');\n  }\n  \n  if (!data.founder || data.founder.trim().length < 2) {\n    errors.push('\u521B\u59CB\u4EBA\u59D3\u540D\u81F3\u5C11\u9700\u89812\u4E2A\u5B57\u7B26');\n  }\n  \n  if (!data.founderEmail || !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(data.founderEmail)) {\n    errors.push('\u8BF7\u63D0\u4F9B\u6709\u6548\u7684\u521B\u59CB\u4EBA\u90AE\u7BB1');\n  }\n  \n  if (!data.fundingGoal || data.fundingGoal <= 0) {\n    errors.push('\u878D\u8D44\u76EE\u6807\u5FC5\u987B\u5927\u4E8E0');\n  }\n  \n  const validCategories = ['AI', 'Fintech', 'Healthcare', 'E-commerce', 'Enterprise', 'Consumer', 'Other'];\n  if (!data.category || !validCategories.includes(data.category)) {\n    errors.push('\u8BF7\u9009\u62E9\u6709\u6548\u7684\u9879\u76EE\u7C7B\u522B');\n  }\n  \n  const validStages = ['idea', 'seed', 'series-a', 'series-b', 'series-c', 'ipo'];\n  if (!data.stage || !validStages.includes(data.stage)) {\n    errors.push('\u8BF7\u9009\u62E9\u6709\u6548\u7684\u878D\u8D44\u9636\u6BB5');\n  }\n  \n  return { valid: errors.length === 0, errors };\n}\n\n// \u5904\u7406POST\u8BF7\u6C42 - \u521B\u5EFA\u9879\u76EE\nexport async function onRequestPost(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    const projectData = await request.json();\n    \n    console.log('\u6536\u5230\u9879\u76EE\u521B\u5EFA\u8BF7\u6C42:', projectData);\n    \n    // \u9A8C\u8BC1\u9879\u76EE\u6570\u636E\n    const validation = validateProjectData(projectData);\n    if (!validation.valid) {\n      return new Response(JSON.stringify({\n        success: false,\n        message: '\u9879\u76EE\u6570\u636E\u9A8C\u8BC1\u5931\u8D25',\n        errors: validation.errors\n      }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    // \u68C0\u67E5KV\u5B58\u50A8\u662F\u5426\u53EF\u7528\n    if (!env.SVTR_CACHE) {\n      console.warn('KV\u5B58\u50A8\u672A\u914D\u7F6E\uFF0C\u4F7F\u7528\u6A21\u62DF\u54CD\u5E94');\n      return new Response(JSON.stringify({\n        success: true,\n        message: '\u9879\u76EE\u521B\u5EFA\u6210\u529F\uFF01\uFF08\u6D4B\u8BD5\u6A21\u5F0F\uFF09',\n        data: { projectId: generateProjectId() },\n        note: 'KV\u5B58\u50A8\u672A\u914D\u7F6E\uFF0C\u6570\u636E\u672A\u5B9E\u9645\u4FDD\u5B58'\n      }), {\n        status: 200,\n        headers: { \n          'Content-Type': 'application/json',\n          'Access-Control-Allow-Origin': '*'\n        }\n      });\n    }\n    \n    // \u521B\u5EFA\u9879\u76EE\u5BF9\u8C61\n    const projectId = generateProjectId();\n    const project: Project = {\n      id: projectId,\n      name: projectData.name.trim(),\n      description: projectData.description.trim(),\n      category: projectData.category,\n      stage: projectData.stage,\n      status: 'pending', // \u65B0\u9879\u76EE\u9ED8\u8BA4\u4E3A\u5F85\u5BA1\u6838\u72B6\u6001\n      founder: projectData.founder.trim(),\n      founderEmail: projectData.founderEmail.trim(),\n      fundingGoal: Number(projectData.fundingGoal),\n      currentFunding: 0,\n      investorCount: 0,\n      createdAt: new Date().toISOString(),\n      updatedAt: new Date().toISOString(),\n      tags: projectData.tags || [],\n      documents: projectData.documents || []\n    };\n    \n    // \u4FDD\u5B58\u9879\u76EE\u5230KV\u5B58\u50A8\n    await env.SVTR_CACHE.put(`project_${projectId}`, JSON.stringify(project));\n    \n    // \u66F4\u65B0\u9879\u76EE\u5217\u8868\n    const projectsList = await env.SVTR_CACHE.get('projects_list');\n    let projects = [];\n    \n    if (projectsList) {\n      projects = JSON.parse(projectsList);\n    }\n    \n    projects.push(project);\n    await env.SVTR_CACHE.put('projects_list', JSON.stringify(projects));\n    \n    // \u66F4\u65B0\u7EDF\u8BA1\u6570\u636E\n    const today = new Date().toISOString().split('T')[0];\n    const statsKey = `project_stats_${today}`;\n    const todayStats = await env.SVTR_CACHE.get(statsKey);\n    let stats = { created: 0, updated: 0 };\n    \n    if (todayStats) {\n      stats = JSON.parse(todayStats);\n    }\n    stats.created += 1;\n    \n    await env.SVTR_CACHE.put(statsKey, JSON.stringify(stats), {\n      expirationTtl: 30 * 24 * 60 * 60 // 30\u5929\u8FC7\u671F\n    });\n    \n    console.log('\u9879\u76EE\u521B\u5EFA\u6210\u529F:', projectId);\n    \n    return new Response(JSON.stringify({\n      success: true,\n      message: '\u9879\u76EE\u521B\u5EFA\u6210\u529F\uFF01',\n      data: { projectId, project }\n    }), {\n      status: 201,\n      headers: { \n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*'\n      }\n    });\n    \n  } catch (error) {\n    console.error('\u9879\u76EE\u521B\u5EFA\u5931\u8D25:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      message: '\u670D\u52A1\u5668\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5',\n      error: String(error)\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n  }\n}\n\n// \u5904\u7406GET\u8BF7\u6C42 - \u83B7\u53D6\u9879\u76EE\u5217\u8868\u6216\u7EDF\u8BA1\nexport async function onRequestGet(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    const url = new URL(request.url);\n    const action = url.searchParams.get('action');\n    const projectId = url.searchParams.get('id');\n    \n    console.log('GET\u8BF7\u6C42:', action, projectId);\n    \n    // \u5982\u679CKV\u5B58\u50A8\u672A\u914D\u7F6E\uFF0C\u8FD4\u56DE\u6A21\u62DF\u6570\u636E\n    if (!env.SVTR_CACHE) {\n      console.warn('KV\u5B58\u50A8\u672A\u914D\u7F6E\uFF0C\u8FD4\u56DE\u6A21\u62DF\u6570\u636E');\n      \n      if (action === 'stats') {\n        return new Response(JSON.stringify({\n          totalProjects: 156,\n          activeProjects: 89,\n          pendingProjects: 23,\n          completedProjects: 44,\n          totalFunding: 42800000,\n          categoriesBreakdown: {\n            'AI': 45,\n            'Fintech': 32,\n            'Healthcare': 28,\n            'E-commerce': 25,\n            'Enterprise': 15,\n            'Consumer': 8,\n            'Other': 3\n          },\n          note: 'KV\u5B58\u50A8\u672A\u914D\u7F6E\uFF0C\u663E\u793A\u6A21\u62DF\u6570\u636E'\n        }), {\n          status: 200,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      }\n      \n      if (action === 'list') {\n        const mockProjects = [\n          {\n            id: 'proj_1',\n            name: 'AI\u533B\u7597\u8BCA\u65AD\u5E73\u53F0',\n            description: '\u57FA\u4E8E\u6DF1\u5EA6\u5B66\u4E60\u7684\u533B\u7597\u5F71\u50CF\u8BCA\u65AD\u5E73\u53F0',\n            category: 'Healthcare',\n            stage: 'series-a',\n            status: 'active',\n            founder: '\u5F20\u533B\u751F',\n            founderEmail: 'zhang@healthai.com',\n            fundingGoal: 5000000,\n            currentFunding: 2000000,\n            investorCount: 8,\n            createdAt: '2024-01-15T10:00:00Z',\n            updatedAt: '2024-08-15T14:30:00Z',\n            tags: ['AI', '\u533B\u7597', '\u8BCA\u65AD'],\n            documents: []\n          },\n          {\n            id: 'proj_2',\n            name: '\u667A\u80FD\u7269\u6D41\u4F18\u5316\u7CFB\u7EDF',\n            description: '\u57FA\u4E8EAI\u7684\u7269\u6D41\u8DEF\u5F84\u4F18\u5316\u548C\u914D\u9001\u7BA1\u7406\u7CFB\u7EDF',\n            category: 'Enterprise',\n            stage: 'seed',\n            status: 'pending',\n            founder: '\u674E\u603B',\n            founderEmail: 'li@smartlogistics.com',\n            fundingGoal: 2000000,\n            currentFunding: 0,\n            investorCount: 0,\n            createdAt: '2024-08-10T09:15:00Z',\n            updatedAt: '2024-08-10T09:15:00Z',\n            tags: ['\u7269\u6D41', 'AI', '\u4F18\u5316'],\n            documents: []\n          }\n        ];\n        \n        return new Response(JSON.stringify(mockProjects), {\n          status: 200,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      }\n    }\n    \n    if (action === 'stats') {\n      // \u83B7\u53D6\u7EDF\u8BA1\u6570\u636E\n      const projectsList = await env.SVTR_CACHE.get('projects_list');\n      const projects = projectsList ? JSON.parse(projectsList) : [];\n      \n      const stats = {\n        totalProjects: projects.length,\n        activeProjects: projects.filter((p: Project) => p.status === 'active').length,\n        pendingProjects: projects.filter((p: Project) => p.status === 'pending').length,\n        completedProjects: projects.filter((p: Project) => p.status === 'completed').length,\n        totalFunding: projects.reduce((sum: number, p: Project) => sum + p.currentFunding, 0),\n        categoriesBreakdown: projects.reduce((acc: any, p: Project) => {\n          acc[p.category] = (acc[p.category] || 0) + 1;\n          return acc;\n        }, {})\n      };\n      \n      return new Response(JSON.stringify(stats), {\n        status: 200,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    if (action === 'list') {\n      // \u83B7\u53D6\u9879\u76EE\u5217\u8868\n      const projectsList = await env.SVTR_CACHE.get('projects_list');\n      const projects = projectsList ? JSON.parse(projectsList) : [];\n      \n      // \u652F\u6301\u7B5B\u9009\n      const status = url.searchParams.get('status');\n      const category = url.searchParams.get('category');\n      const stage = url.searchParams.get('stage');\n      \n      let filteredProjects = projects;\n      \n      if (status) {\n        filteredProjects = filteredProjects.filter((p: Project) => p.status === status);\n      }\n      \n      if (category) {\n        filteredProjects = filteredProjects.filter((p: Project) => p.category === category);\n      }\n      \n      if (stage) {\n        filteredProjects = filteredProjects.filter((p: Project) => p.stage === stage);\n      }\n      \n      return new Response(JSON.stringify(filteredProjects), {\n        status: 200,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    if (projectId) {\n      // \u83B7\u53D6\u5355\u4E2A\u9879\u76EE\u8BE6\u60C5\n      const project = await env.SVTR_CACHE.get(`project_${projectId}`);\n      if (!project) {\n        return new Response(JSON.stringify({\n          success: false,\n          message: '\u9879\u76EE\u4E0D\u5B58\u5728'\n        }), {\n          status: 404,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      }\n      \n      return new Response(project, {\n        status: 200,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    return new Response(JSON.stringify({\n      success: false,\n      message: '\u65E0\u6548\u7684\u8BF7\u6C42\u53C2\u6570'\n    }), {\n      status: 400,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n    \n  } catch (error) {\n    console.error('\u83B7\u53D6\u9879\u76EE\u6570\u636E\u5931\u8D25:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      message: '\u670D\u52A1\u5668\u9519\u8BEF',\n      error: String(error)\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n  }\n}\n\n// \u5904\u7406PUT\u8BF7\u6C42 - \u66F4\u65B0\u9879\u76EE\nexport async function onRequestPut(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    const url = new URL(request.url);\n    const projectId = url.searchParams.get('id');\n    \n    if (!projectId) {\n      return new Response(JSON.stringify({\n        success: false,\n        message: '\u7F3A\u5C11\u9879\u76EEID'\n      }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    const updateData = await request.json();\n    \n    // \u5982\u679CKV\u5B58\u50A8\u672A\u914D\u7F6E\n    if (!env.SVTR_CACHE) {\n      return new Response(JSON.stringify({\n        success: true,\n        message: '\u9879\u76EE\u66F4\u65B0\u6210\u529F\uFF08\u6D4B\u8BD5\u6A21\u5F0F\uFF09',\n        note: 'KV\u5B58\u50A8\u672A\u914D\u7F6E\uFF0C\u64CD\u4F5C\u672A\u5B9E\u9645\u6267\u884C'\n      }), {\n        status: 200,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    // \u83B7\u53D6\u73B0\u6709\u9879\u76EE\n    const existingProject = await env.SVTR_CACHE.get(`project_${projectId}`);\n    if (!existingProject) {\n      return new Response(JSON.stringify({\n        success: false,\n        message: '\u9879\u76EE\u4E0D\u5B58\u5728'\n      }), {\n        status: 404,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    const project = JSON.parse(existingProject);\n    \n    // \u66F4\u65B0\u9879\u76EE\u6570\u636E\n    const updatedProject = {\n      ...project,\n      ...updateData,\n      id: project.id, // \u4FDD\u6301ID\u4E0D\u53D8\n      createdAt: project.createdAt, // \u4FDD\u6301\u521B\u5EFA\u65F6\u95F4\u4E0D\u53D8\n      updatedAt: new Date().toISOString()\n    };\n    \n    // \u4FDD\u5B58\u66F4\u65B0\u540E\u7684\u9879\u76EE\n    await env.SVTR_CACHE.put(`project_${projectId}`, JSON.stringify(updatedProject));\n    \n    // \u66F4\u65B0\u9879\u76EE\u5217\u8868\u4E2D\u7684\u6570\u636E\n    const projectsList = await env.SVTR_CACHE.get('projects_list');\n    if (projectsList) {\n      const projects = JSON.parse(projectsList);\n      const projectIndex = projects.findIndex((p: Project) => p.id === projectId);\n      if (projectIndex >= 0) {\n        projects[projectIndex] = updatedProject;\n        await env.SVTR_CACHE.put('projects_list', JSON.stringify(projects));\n      }\n    }\n    \n    return new Response(JSON.stringify({\n      success: true,\n      message: '\u9879\u76EE\u66F4\u65B0\u6210\u529F',\n      data: updatedProject\n    }), {\n      status: 200,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n    \n  } catch (error) {\n    console.error('\u9879\u76EE\u66F4\u65B0\u5931\u8D25:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      message: '\u670D\u52A1\u5668\u9519\u8BEF',\n      error: String(error)\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n  }\n}\n\n// \u5904\u7406OPTIONS\u8BF7\u6C42 - CORS\nexport async function onRequestOptions(): Promise<Response> {\n  return new Response(null, {\n    status: 200,\n    headers: {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'POST, GET, PUT, DELETE, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type',\n      'Access-Control-Max-Age': '86400',\n    }\n  });\n}", "/**\n * Cloudflare\u514D\u8D39\u989D\u5EA6\u7BA1\u7406\u5668\n * \u8DDF\u8E2A\u4F7F\u7528\u60C5\u51B5\uFF0C\u5B9E\u73B0\u7C7B\u4F3CAutoRAG\u7684\u514D\u8D39\u4F53\u9A8C\n */\n\ninterface UsageStats {\n  dailyRequests: number;\n  monthlyNeurons: number;\n  lastResetDate: string;\n  lastMonthlyReset: string;\n}\n\nexport class FreeTierManager {\n  private kv: any;\n  \n  // Cloudflare\u514D\u8D39\u989D\u5EA6\u9650\u5236\n  private readonly DAILY_REQUEST_LIMIT = 10000;\n  private readonly MONTHLY_NEURON_LIMIT = 100000;\n  private readonly NEURON_COST_PER_REQUEST = 1; // \u4F30\u7B97\u6BCF\u6B21\u8BF7\u6C42\u6D88\u8017\n\n  constructor(kv: any) {\n    this.kv = kv;\n  }\n\n  /**\n   * \u68C0\u67E5\u662F\u5426\u5728\u514D\u8D39\u989D\u5EA6\u5185\n   */\n  async checkQuota(): Promise<{ allowed: boolean; reason?: string; remaining?: any }> {\n    const stats = await this.getUsageStats();\n    const now = new Date();\n    const today = now.toISOString().split('T')[0];\n    const currentMonth = now.getFullYear() + '-' + (now.getMonth() + 1).toString().padStart(2, '0');\n\n    // \u68C0\u67E5\u65E5\u989D\u5EA6\n    if (stats.dailyRequests >= this.DAILY_REQUEST_LIMIT) {\n      return {\n        allowed: false,\n        reason: 'Daily request limit exceeded. Resets at midnight UTC.',\n        remaining: {\n          daily: 0,\n          monthly: Math.max(0, this.MONTHLY_NEURON_LIMIT - stats.monthlyNeurons)\n        }\n      };\n    }\n\n    // \u68C0\u67E5\u6708\u989D\u5EA6\n    if (stats.monthlyNeurons >= this.MONTHLY_NEURON_LIMIT) {\n      return {\n        allowed: false,\n        reason: 'Monthly computation limit exceeded. Resets next month.',\n        remaining: {\n          daily: Math.max(0, this.DAILY_REQUEST_LIMIT - stats.dailyRequests),\n          monthly: 0\n        }\n      };\n    }\n\n    return {\n      allowed: true,\n      remaining: {\n        daily: this.DAILY_REQUEST_LIMIT - stats.dailyRequests,\n        monthly: this.MONTHLY_NEURON_LIMIT - stats.monthlyNeurons\n      }\n    };\n  }\n\n  /**\n   * \u8BB0\u5F55API\u4F7F\u7528\n   */\n  async recordUsage(neuronCost: number = 1): Promise<void> {\n    const stats = await this.getUsageStats();\n    const now = new Date();\n    const today = now.toISOString().split('T')[0];\n    const currentMonth = now.getFullYear() + '-' + (now.getMonth() + 1).toString().padStart(2, '0');\n\n    // \u91CD\u7F6E\u65E5\u8BA1\u6570\u5668\n    if (stats.lastResetDate !== today) {\n      stats.dailyRequests = 0;\n      stats.lastResetDate = today;\n    }\n\n    // \u91CD\u7F6E\u6708\u8BA1\u6570\u5668\n    if (stats.lastMonthlyReset !== currentMonth) {\n      stats.monthlyNeurons = 0;\n      stats.lastMonthlyReset = currentMonth;\n    }\n\n    // \u66F4\u65B0\u4F7F\u7528\u7EDF\u8BA1\n    stats.dailyRequests += 1;\n    stats.monthlyNeurons += neuronCost;\n\n    await this.saveUsageStats(stats);\n  }\n\n  /**\n   * \u83B7\u53D6\u4F7F\u7528\u7EDF\u8BA1\n   */\n  private async getUsageStats(): Promise<UsageStats> {\n    try {\n      const data = await this.kv.get('usage_stats');\n      if (data) {\n        return JSON.parse(data);\n      }\n    } catch (error) {\n      console.log('Failed to get usage stats:', error);\n    }\n\n    // \u9ED8\u8BA4\u7EDF\u8BA1\u6570\u636E\n    const now = new Date();\n    return {\n      dailyRequests: 0,\n      monthlyNeurons: 0,\n      lastResetDate: now.toISOString().split('T')[0],\n      lastMonthlyReset: now.getFullYear() + '-' + (now.getMonth() + 1).toString().padStart(2, '0')\n    };\n  }\n\n  /**\n   * \u4FDD\u5B58\u4F7F\u7528\u7EDF\u8BA1\n   */\n  private async saveUsageStats(stats: UsageStats): Promise<void> {\n    try {\n      await this.kv.put('usage_stats', JSON.stringify(stats));\n    } catch (error) {\n      console.log('Failed to save usage stats:', error);\n    }\n  }\n\n  /**\n   * \u83B7\u53D6\u5269\u4F59\u914D\u989D\u4FE1\u606F\n   */\n  async getQuotaInfo(): Promise<any> {\n    const stats = await this.getUsageStats();\n    return {\n      daily: {\n        used: stats.dailyRequests,\n        limit: this.DAILY_REQUEST_LIMIT,\n        remaining: Math.max(0, this.DAILY_REQUEST_LIMIT - stats.dailyRequests),\n        resetTime: 'Midnight UTC'\n      },\n      monthly: {\n        used: stats.monthlyNeurons,\n        limit: this.MONTHLY_NEURON_LIMIT,\n        remaining: Math.max(0, this.MONTHLY_NEURON_LIMIT - stats.monthlyNeurons),\n        resetTime: 'First day of next month'\n      }\n    };\n  }\n\n  /**\n   * \u667A\u80FD\u964D\u7EA7\u7B56\u7565\n   */\n  async getSuggestedFallback(reason: string): Promise<string> {\n    if (reason.includes('Daily')) {\n      return 'demo_mode'; // \u4F7F\u7528\u667A\u80FD\u6F14\u793A\u6A21\u5F0F\n    } else if (reason.includes('Monthly')) {\n      return 'basic_mode'; // \u4F7F\u7528\u57FA\u7840\u56DE\u590D\u6A21\u5F0F\n    }\n    return 'demo_mode';\n  }\n}\n\n/**\n * \u521B\u5EFA\u514D\u8D39\u989D\u5EA6\u7BA1\u7406\u5668\u5B9E\u4F8B\n */\nexport function createFreeTierManager(kv: any): FreeTierManager {\n  return new FreeTierManager(kv);\n}", "/**\n * SVTR.AI \u514D\u8D39\u989D\u5EA6\u72B6\u6001API\n * \u8FD4\u56DE\u7528\u6237\u5F53\u524D\u7684\u914D\u989D\u4F7F\u7528\u60C5\u51B5\n */\n\nimport { createFreeTierManager } from '../lib/free-tier-manager';\n\nexport async function onRequestGet(context: any): Promise<Response> {\n  try {\n    const { env } = context;\n    \n    // \u521D\u59CB\u5316\u514D\u8D39\u989D\u5EA6\u7BA1\u7406\u5668\n    const freeTierManager = createFreeTierManager(env.SVTR_KV);\n    \n    // \u83B7\u53D6\u914D\u989D\u4FE1\u606F\n    const quotaInfo = await freeTierManager.getQuotaInfo();\n    const quotaCheck = await freeTierManager.checkQuota();\n    \n    const statusData = {\n      status: quotaCheck.allowed ? 'active' : 'exceeded',\n      quotas: {\n        daily: {\n          used: quotaInfo.daily.used,\n          limit: quotaInfo.daily.limit,\n          remaining: quotaInfo.daily.remaining,\n          percentage: Math.round((quotaInfo.daily.used / quotaInfo.daily.limit) * 100),\n          resetTime: quotaInfo.daily.resetTime\n        },\n        monthly: {\n          used: quotaInfo.monthly.used,\n          limit: quotaInfo.monthly.limit,\n          remaining: quotaInfo.monthly.remaining,\n          percentage: Math.round((quotaInfo.monthly.used / quotaInfo.monthly.limit) * 100),\n          resetTime: quotaInfo.monthly.resetTime\n        }\n      },\n      message: quotaCheck.allowed \n        ? '\u2705 \u514D\u8D39\u989D\u5EA6\u5145\u8DB3\uFF0C\u4EAB\u53D7SVTR.AI\u4E13\u4E1A\u5206\u6790'\n        : `\u26A0\uFE0F ${quotaCheck.reason}`,\n      upgradeHint: !quotaCheck.allowed \n        ? '\uD83D\uDC8E \u914D\u7F6E\u81EA\u5DF1\u7684Cloudflare Workers AI\u5BC6\u94A5\u53EF\u83B7\u5F97\u66F4\u5927\u514D\u8D39\u989D\u5EA6\uFF01'\n        : null,\n      timestamp: new Date().toISOString()\n    };\n    \n    return new Response(JSON.stringify(statusData, null, 2), {\n      headers: {\n        'Content-Type': 'application/json',\n        'Cache-Control': 'no-cache',\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Methods': 'GET, OPTIONS',\n        'Access-Control-Allow-Headers': 'Content-Type',\n      }\n    });\n    \n  } catch (error) {\n    console.error('\u83B7\u53D6\u914D\u989D\u72B6\u6001\u5931\u8D25:', error);\n    \n    return new Response(JSON.stringify({\n      status: 'error',\n      message: '\u65E0\u6CD5\u83B7\u53D6\u914D\u989D\u72B6\u6001',\n      error: error.message\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n      }\n    });\n  }\n}", "/**\n * SVTR\u90AE\u7BB1\u8BA2\u9605API\u7AEF\u70B9\n * \u5904\u7406\u7528\u6237\u90AE\u7BB1\u8BA2\u9605\u548C\u9000\u8BA2\u529F\u80FD\n * \u96C6\u6210Cloudflare KV\u5B58\u50A8\uFF0C\u652F\u6301\u5B8C\u6574\u6570\u636E\u7BA1\u7406\n */\n\n// \u9A8C\u8BC1\u90AE\u7BB1\u683C\u5F0F\nfunction isValidEmail(email: string): boolean {\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return emailRegex.test(email);\n}\n\n// \u751F\u6210\u8BA2\u9605ID\nfunction generateSubscriptionId(email: string): string {\n  return `sub_${btoa(email).replace(/[+/=]/g, '')}`;\n}\n\n// \u5904\u7406POST\u8BF7\u6C42 - \u8BA2\u9605\u90AE\u7BB1\nexport async function onRequestPost(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    \n    // \u89E3\u6790\u8BF7\u6C42\u6570\u636E\n    const requestData = await request.json();\n    const { email, preferences = [], language = 'zh-CN' } = requestData;\n    \n    console.log('\u6536\u5230\u8BA2\u9605\u8BF7\u6C42:', { email, preferences, language });\n    \n    // \u9A8C\u8BC1\u5FC5\u8981\u5B57\u6BB5\n    if (!email) {\n      return new Response(JSON.stringify({\n        success: false,\n        message: '\u90AE\u7BB1\u5730\u5740\u662F\u5FC5\u9700\u7684'\n      }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    // \u9A8C\u8BC1\u90AE\u7BB1\u683C\u5F0F\n    if (!isValidEmail(email)) {\n      return new Response(JSON.stringify({\n        success: false,\n        message: '\u90AE\u7BB1\u683C\u5F0F\u65E0\u6548'\n      }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    // \u751F\u6210\u8BA2\u9605\u6570\u636E\n    const subscriptionId = generateSubscriptionId(email);\n    const subscriptionData = {\n      email,\n      preferences,\n      subscribedAt: new Date().toISOString(),\n      ipAddress: request.headers.get('CF-Connecting-IP'),\n      userAgent: request.headers.get('User-Agent'),\n      language\n    };\n    \n    console.log('\u4FDD\u5B58\u8BA2\u9605\u6570\u636E:', subscriptionData);\n    \n    // \u68C0\u67E5KV\u5B58\u50A8\u662F\u5426\u53EF\u7528\n    if (!env.SVTR_SESSIONS || !env.SVTR_CACHE) {\n      console.warn('KV\u5B58\u50A8\u672A\u914D\u7F6E\uFF0C\u4F7F\u7528\u6A21\u62DF\u54CD\u5E94');\n      return new Response(JSON.stringify({\n        success: true,\n        message: language === 'zh-CN' ? '\u8BA2\u9605\u6210\u529F\uFF01\uFF08\u6D4B\u8BD5\u6A21\u5F0F\uFF09' : 'Successfully subscribed! (Test mode)',\n        data: { subscriptionId },\n        note: 'KV\u5B58\u50A8\u672A\u914D\u7F6E\uFF0C\u6570\u636E\u672A\u5B9E\u9645\u4FDD\u5B58'\n      }), {\n        status: 200,\n        headers: { \n          'Content-Type': 'application/json',\n          'Access-Control-Allow-Origin': '*',\n          'Access-Control-Allow-Methods': 'POST, GET, OPTIONS',\n          'Access-Control-Allow-Headers': 'Content-Type'\n        }\n      });\n    }\n    \n    // \u4FDD\u5B58\u5230KV\u5B58\u50A8\n    await env.SVTR_SESSIONS.put(subscriptionId, JSON.stringify(subscriptionData));\n    \n    // \u66F4\u65B0\u8BA2\u9605\u8005\u5217\u8868\uFF08\u7528\u4E8E\u7BA1\u7406\u9762\u677F\uFF09\n    const subscribersList = await env.SVTR_CACHE.get('subscribers_list');\n    let subscribers = [];\n    \n    if (subscribersList) {\n      subscribers = JSON.parse(subscribersList);\n    }\n    \n    // \u68C0\u67E5\u662F\u5426\u5DF2\u5B58\u5728\n    const existingIndex = subscribers.findIndex((sub: any) => sub.email === email);\n    if (existingIndex >= 0) {\n      // \u66F4\u65B0\u73B0\u6709\u8BA2\u9605\n      subscribers[existingIndex] = { ...subscriptionData, id: subscriptionId };\n    } else {\n      // \u6DFB\u52A0\u65B0\u8BA2\u9605\n      subscribers.push({ ...subscriptionData, id: subscriptionId });\n    }\n    \n    // \u4FDD\u5B58\u66F4\u65B0\u540E\u7684\u5217\u8868\n    await env.SVTR_CACHE.put('subscribers_list', JSON.stringify(subscribers));\n    \n    // \u8BB0\u5F55\u7EDF\u8BA1\u6570\u636E\n    const today = new Date().toISOString().split('T')[0];\n    const statsKey = `stats_${today}`;\n    const todayStats = await env.SVTR_CACHE.get(statsKey);\n    let stats = { subscriptions: 0 };\n    \n    if (todayStats) {\n      stats = JSON.parse(todayStats);\n    }\n    stats.subscriptions += 1;\n    \n    await env.SVTR_CACHE.put(statsKey, JSON.stringify(stats), {\n      expirationTtl: 30 * 24 * 60 * 60 // 30\u5929\u8FC7\u671F\n    });\n    \n    console.log('\u8BA2\u9605\u6210\u529F\u4FDD\u5B58');\n    \n    return new Response(JSON.stringify({\n      success: true,\n      message: language === 'zh-CN' ? '\u8BA2\u9605\u6210\u529F\uFF01' : 'Successfully subscribed!',\n      data: { subscriptionId }\n    }), {\n      status: 200,\n      headers: { \n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Methods': 'POST, GET, OPTIONS',\n        'Access-Control-Allow-Headers': 'Content-Type'\n      }\n    });\n    \n  } catch (error) {\n    console.error('\u8BA2\u9605\u5904\u7406\u5931\u8D25:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      message: '\u670D\u52A1\u5668\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5',\n      error: String(error)\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n  }\n}\n\n// \u5904\u7406GET\u8BF7\u6C42 - \u83B7\u53D6\u8BA2\u9605\u7EDF\u8BA1\nexport async function onRequestGet(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    const url = new URL(request.url);\n    const action = url.searchParams.get('action');\n    \n    console.log('GET\u8BF7\u6C42:', action);\n    \n    // \u5982\u679CKV\u5B58\u50A8\u672A\u914D\u7F6E\uFF0C\u8FD4\u56DE\u6A21\u62DF\u6570\u636E\n    if (!env.SVTR_SESSIONS || !env.SVTR_CACHE) {\n      console.warn('KV\u5B58\u50A8\u672A\u914D\u7F6E\uFF0C\u8FD4\u56DE\u6A21\u62DF\u6570\u636E');\n      \n      if (action === 'stats') {\n        return new Response(JSON.stringify({\n          totalSubscribers: 0,\n          recentSubscribers: 0,\n          languageBreakdown: { 'zh-CN': 0, 'en-US': 0 },\n          note: 'KV\u5B58\u50A8\u672A\u914D\u7F6E\uFF0C\u663E\u793A\u6A21\u62DF\u6570\u636E'\n        }), {\n          status: 200,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      }\n      \n      if (action === 'list') {\n        return new Response(JSON.stringify([]), {\n          status: 200,\n          headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n        });\n      }\n    }\n    \n    if (action === 'stats') {\n      // \u83B7\u53D6\u7EDF\u8BA1\u6570\u636E\n      const subscribersList = await env.SVTR_CACHE.get('subscribers_list');\n      const subscribers = subscribersList ? JSON.parse(subscribersList) : [];\n      \n      const stats = {\n        totalSubscribers: subscribers.length,\n        recentSubscribers: subscribers.filter((sub: any) => {\n          const subDate = new Date(sub.subscribedAt);\n          const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);\n          return subDate > weekAgo;\n        }).length,\n        languageBreakdown: subscribers.reduce((acc: any, sub: any) => {\n          acc[sub.language] = (acc[sub.language] || 0) + 1;\n          return acc;\n        }, {})\n      };\n      \n      return new Response(JSON.stringify(stats), {\n        status: 200,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    if (action === 'list') {\n      // \u83B7\u53D6\u8BA2\u9605\u8005\u5217\u8868\uFF08\u7B80\u5316\u7248\uFF0C\u9690\u79C1\u4FDD\u62A4\uFF09\n      const subscribersList = await env.SVTR_CACHE.get('subscribers_list');\n      const subscribers = subscribersList ? JSON.parse(subscribersList) : [];\n      \n      const publicList = subscribers.map((sub: any) => ({\n        id: sub.id,\n        email: sub.email, // \u8FD4\u56DE\u5B8C\u6574\u90AE\u7BB1\u7528\u4E8E\u7BA1\u7406\u9762\u677F\n        emailDomain: sub.email.split('@')[1],\n        preferences: sub.preferences,\n        subscribedAt: sub.subscribedAt,\n        language: sub.language,\n        ipAddress: sub.ipAddress,\n        userAgent: sub.userAgent\n      }));\n      \n      return new Response(JSON.stringify(publicList), {\n        status: 200,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    return new Response(JSON.stringify({\n      success: false,\n      message: '\u65E0\u6548\u7684\u8BF7\u6C42\u53C2\u6570'\n    }), {\n      status: 400,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n    \n  } catch (error) {\n    console.error('\u83B7\u53D6\u6570\u636E\u5931\u8D25:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      message: '\u670D\u52A1\u5668\u9519\u8BEF',\n      error: String(error)\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n  }\n}\n\n// \u5904\u7406DELETE\u8BF7\u6C42 - \u53D6\u6D88\u8BA2\u9605\nexport async function onRequestDelete(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    const requestData = await request.json();\n    const { email } = requestData;\n    \n    if (!email) {\n      return new Response(JSON.stringify({\n        success: false,\n        message: '\u90AE\u7BB1\u5730\u5740\u662F\u5FC5\u9700\u7684'\n      }), {\n        status: 400,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    // \u5982\u679CKV\u5B58\u50A8\u672A\u914D\u7F6E\n    if (!env.SVTR_SESSIONS || !env.SVTR_CACHE) {\n      return new Response(JSON.stringify({\n        success: true,\n        message: '\u53D6\u6D88\u8BA2\u9605\u6210\u529F\uFF08\u6D4B\u8BD5\u6A21\u5F0F\uFF09',\n        note: 'KV\u5B58\u50A8\u672A\u914D\u7F6E\uFF0C\u64CD\u4F5C\u672A\u5B9E\u9645\u6267\u884C'\n      }), {\n        status: 200,\n        headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n      });\n    }\n    \n    const subscriptionId = generateSubscriptionId(email);\n    \n    // \u4ECEKV\u5B58\u50A8\u4E2D\u5220\u9664\n    await env.SVTR_SESSIONS.delete(subscriptionId);\n    \n    // \u4ECE\u8BA2\u9605\u8005\u5217\u8868\u4E2D\u5220\u9664\n    const subscribersList = await env.SVTR_CACHE.get('subscribers_list');\n    if (subscribersList) {\n      const subscribers = JSON.parse(subscribersList);\n      const filteredSubscribers = subscribers.filter((sub: any) => sub.email !== email);\n      await env.SVTR_CACHE.put('subscribers_list', JSON.stringify(filteredSubscribers));\n    }\n    \n    return new Response(JSON.stringify({\n      success: true,\n      message: '\u53D6\u6D88\u8BA2\u9605\u6210\u529F'\n    }), {\n      status: 200,\n      headers: { \n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*'\n      }\n    });\n    \n  } catch (error) {\n    console.error('\u53D6\u6D88\u8BA2\u9605\u5931\u8D25:', error);\n    return new Response(JSON.stringify({\n      success: false,\n      message: '\u670D\u52A1\u5668\u9519\u8BEF',\n      error: String(error)\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Origin': '*' }\n    });\n  }\n}\n\n// \u5904\u7406OPTIONS\u8BF7\u6C42 - CORS\nexport async function onRequestOptions(): Promise<Response> {\n  return new Response(null, {\n    status: 200,\n    headers: {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'POST, GET, DELETE, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type',\n      'Access-Control-Max-Age': '86400',\n    }\n  });\n}", "/**\n * SVTR.AI \u4F1A\u8BDD\u4E0A\u4E0B\u6587\u7BA1\u7406\u7CFB\u7EDF\n * \u5B9E\u73B0\u667A\u80FD\u5BF9\u8BDD\u8BB0\u5FC6\u548C\u4E0A\u4E0B\u6587\u8FFD\u8E2A\n */\n\nexport interface Message {\n  role: 'user' | 'assistant' | 'system';\n  content: string;\n  timestamp: number;\n  ragContext?: RAGContext;\n  topics?: string[];\n  confidence?: number;\n}\n\nexport interface RAGContext {\n  matches: any[];\n  searchQuery: string;\n  confidence: number;\n  sources: string[];\n}\n\nexport interface ConversationSession {\n  sessionId: string;\n  userId?: string;\n  startTime: number;\n  lastActivity: number;\n  messages: Message[];\n  extractedTopics: string[];\n  userInterests: string[];\n  conversationSummary: string;\n  ragHistory: RAGContext[];\n}\n\nexport class ConversationContextManager {\n  private sessions: Map<string, ConversationSession> = new Map();\n  private kvNamespace?: any;\n  private maxSessionAge = 24 * 60 * 60 * 1000; // 24\u5C0F\u65F6\n  private maxMessages = 50; // \u6BCF\u4E2A\u4F1A\u8BDD\u6700\u591A50\u6761\u6D88\u606F\n\n  constructor(kvNamespace?: any) {\n    this.kvNamespace = kvNamespace;\n  }\n\n  /**\n   * \u83B7\u53D6\u6216\u521B\u5EFA\u4F1A\u8BDD\n   */\n  async getOrCreateSession(sessionId: string, userId?: string): Promise<ConversationSession> {\n    let session = this.sessions.get(sessionId);\n    \n    if (!session) {\n      // \u5C1D\u8BD5\u4ECEKV\u5B58\u50A8\u6062\u590D\n      if (this.kvNamespace) {\n        try {\n          const stored = await this.kvNamespace.get(`session:${sessionId}`);\n          if (stored) {\n            session = JSON.parse(stored);\n            this.sessions.set(sessionId, session!);\n          }\n        } catch (error) {\n          console.log('\u6062\u590D\u4F1A\u8BDD\u5931\u8D25:', error);\n        }\n      }\n    }\n\n    if (!session) {\n      // \u521B\u5EFA\u65B0\u4F1A\u8BDD\n      session = {\n        sessionId,\n        userId,\n        startTime: Date.now(),\n        lastActivity: Date.now(),\n        messages: [],\n        extractedTopics: [],\n        userInterests: [],\n        conversationSummary: '',\n        ragHistory: []\n      };\n      this.sessions.set(sessionId, session);\n    }\n\n    return session;\n  }\n\n  /**\n   * \u6DFB\u52A0\u6D88\u606F\u5230\u4F1A\u8BDD\n   */\n  async addMessage(sessionId: string, message: Message): Promise<void> {\n    const session = await this.getOrCreateSession(sessionId);\n    \n    // \u66F4\u65B0\u6D3B\u52A8\u65F6\u95F4\n    session.lastActivity = Date.now();\n    \n    // \u6DFB\u52A0\u6D88\u606F\n    session.messages.push(message);\n    \n    // \u9650\u5236\u6D88\u606F\u6570\u91CF\n    if (session.messages.length > this.maxMessages) {\n      session.messages = session.messages.slice(-this.maxMessages);\n    }\n\n    // \u63D0\u53D6\u8BDD\u9898\u548C\u5174\u8DA3\n    if (message.role === 'user') {\n      const topics = this.extractTopics(message.content);\n      session.extractedTopics = this.mergeTopic(session.extractedTopics, topics);\n      session.userInterests = this.updateUserInterests(session.userInterests, topics);\n    }\n\n    // \u5B58\u50A8RAG\u4E0A\u4E0B\u6587\n    if (message.ragContext) {\n      session.ragHistory.push(message.ragContext);\n      if (session.ragHistory.length > 10) {\n        session.ragHistory = session.ragHistory.slice(-10);\n      }\n    }\n\n    // \u66F4\u65B0\u4F1A\u8BDD\u6458\u8981\n    session.conversationSummary = this.generateSummary(session);\n\n    // \u6301\u4E45\u5316\u5B58\u50A8\n    await this.persistSession(session);\n  }\n\n  /**\n   * \u83B7\u53D6\u4E0A\u4E0B\u6587\u589E\u5F3A\u7684\u67E5\u8BE2 - \u591A\u8F6E\u5BF9\u8BDD\u4F18\u5316\u7248\u672C\n   */\n  getContextEnhancedQuery(sessionId: string, currentQuery: string): {\n    enhancedQuery: string;\n    contextKeywords: string[];\n    relatedTopics: string[];\n    conversationFlow: string[];\n    userIntent: string;\n  } {\n    const session = this.sessions.get(sessionId);\n    if (!session || session.messages.length === 0) {\n      return {\n        enhancedQuery: currentQuery,\n        contextKeywords: [],\n        relatedTopics: [],\n        conversationFlow: [],\n        userIntent: 'general'\n      };\n    }\n\n    // \u63D0\u53D6\u4E0A\u4E0B\u6587\u5173\u952E\u8BCD\u548C\u4F1A\u8BDD\u6D41\u7A0B\n    const contextKeywords = this.extractContextKeywords(session);\n    const relatedTopics = session.extractedTopics.slice(0, 5);\n    const conversationFlow = this.extractConversationFlow(session);\n    const userIntent = this.detectUserIntent(currentQuery, session);\n\n    // \u6784\u5EFA\u591A\u8F6E\u5BF9\u8BDD\u589E\u5F3A\u67E5\u8BE2\n    let enhancedQuery = currentQuery;\n    \n    // \u68C0\u6D4B\u6307\u4EE3\u6D88\u89E3\u9700\u6C42\n    if (this.needsCoreferenceResolution(currentQuery)) {\n      enhancedQuery = this.resolveCoreferences(currentQuery, session);\n    }\n    \n    // \u6DFB\u52A0\u4E0A\u4E0B\u6587\u4FE1\u606F\n    if (currentQuery.length < 30 && contextKeywords.length > 0) {\n      const contextClues = this.buildContextClues(session, userIntent);\n      enhancedQuery = `${enhancedQuery} ${contextClues}`;\n    }\n\n    // \u5904\u7406\u540E\u7EED\u95EE\u9898\n    if (this.isFollowUpQuestion(currentQuery, session)) {\n      const followUpContext = this.buildFollowUpContext(session);\n      enhancedQuery = `\u57FA\u4E8E\u524D\u9762\u7684\u8BA8\u8BBA\uFF1A${followUpContext}\uFF0C${enhancedQuery}`;\n    }\n\n    return {\n      enhancedQuery,\n      contextKeywords,\n      relatedTopics,\n      conversationFlow,\n      userIntent\n    };\n  }\n\n  /**\n   * \u83B7\u53D6\u667A\u80FD\u5EFA\u8BAE\u95EE\u9898\n   */\n  getSmartSuggestions(sessionId: string): string[] {\n    const session = this.sessions.get(sessionId);\n    if (!session) {\n      return this.getDefaultSuggestions();\n    }\n\n    const suggestions: string[] = [];\n    \n    // \u57FA\u4E8E\u7528\u6237\u5174\u8DA3\u7684\u5EFA\u8BAE\n    const interests = session.userInterests.slice(0, 3);\n    interests.forEach(interest => {\n      suggestions.push(...this.generateInterestBasedSuggestions(interest));\n    });\n\n    // \u57FA\u4E8E\u6700\u8FD1\u8BDD\u9898\u7684\u5EFA\u8BAE\n    const recentTopics = session.extractedTopics.slice(-3);\n    recentTopics.forEach(topic => {\n      suggestions.push(...this.generateTopicBasedSuggestions(topic));\n    });\n\n    // \u57FA\u4E8E\u5BF9\u8BDD\u6DF1\u5EA6\u7684\u5EFA\u8BAE\n    if (session.messages.length > 5) {\n      suggestions.push(...this.generateDeepConversationSuggestions(session));\n    }\n\n    // \u53BB\u91CD\u5E76\u9650\u5236\u6570\u91CF\n    return [...new Set(suggestions)].slice(0, 6);\n  }\n\n  /**\n   * \u63D0\u53D6\u6D88\u606F\u4E2D\u7684\u8BDD\u9898\n   */\n  private extractTopics(content: string): string[] {\n    const topics: string[] = [];\n    const text = content.toLowerCase();\n\n    // AI\u521B\u6295\u76F8\u5173\u8BDD\u9898\n    const topicPatterns = {\n      'AI\u6295\u8D44': ['ai\u6295\u8D44', 'ai\u878D\u8D44', 'ai\u57FA\u91D1', 'ai\u521B\u6295'],\n      'AI\u516C\u53F8': ['ai\u516C\u53F8', 'ai\u521D\u521B', 'ai\u4F01\u4E1A', 'ai\u56E2\u961F'],\n      'AI\u6280\u672F': ['ai\u6280\u672F', '\u4EBA\u5DE5\u667A\u80FD', '\u673A\u5668\u5B66\u4E60', '\u6DF1\u5EA6\u5B66\u4E60'],\n      '\u6295\u8D44\u8D8B\u52BF': ['\u6295\u8D44\u8D8B\u52BF', '\u5E02\u573A\u8D8B\u52BF', '\u884C\u4E1A\u8D8B\u52BF', '\u53D1\u5C55\u8D8B\u52BF'],\n      '\u878D\u8D44\u8F6E\u6B21': ['a\u8F6E', 'b\u8F6E', 'c\u8F6E', '\u79CD\u5B50\u8F6E', '\u5929\u4F7F\u8F6E'],\n      '\u4F30\u503C\u5206\u6790': ['\u4F30\u503C', '\u5E02\u503C', '\u4EF7\u503C\u8BC4\u4F30', '\u6295\u8D44\u56DE\u62A5'],\n      'AI\u5E94\u7528': ['ai\u5E94\u7528', 'ai\u4EA7\u54C1', 'ai\u89E3\u51B3\u65B9\u6848', 'ai\u5E73\u53F0']\n    };\n\n    Object.entries(topicPatterns).forEach(([topic, patterns]) => {\n      if (patterns.some(pattern => text.includes(pattern))) {\n        topics.push(topic);\n      }\n    });\n\n    return topics;\n  }\n\n  /**\n   * \u5408\u5E76\u8BDD\u9898\u5217\u8868\n   */\n  private mergeTopic(existing: string[], newTopics: string[]): string[] {\n    const merged = [...existing];\n    newTopics.forEach(topic => {\n      if (!merged.includes(topic)) {\n        merged.push(topic);\n      }\n    });\n    return merged.slice(-20); // \u4FDD\u6301\u6700\u8FD120\u4E2A\u8BDD\u9898\n  }\n\n  /**\n   * \u66F4\u65B0\u7528\u6237\u5174\u8DA3\n   */\n  private updateUserInterests(interests: string[], topics: string[]): string[] {\n    const interestMap = new Map<string, number>();\n    \n    // \u7EDF\u8BA1\u73B0\u6709\u5174\u8DA3\u9891\u6B21\n    interests.forEach(interest => {\n      interestMap.set(interest, (interestMap.get(interest) || 0) + 1);\n    });\n\n    // \u589E\u52A0\u65B0\u8BDD\u9898\u6743\u91CD\n    topics.forEach(topic => {\n      interestMap.set(topic, (interestMap.get(topic) || 0) + 2);\n    });\n\n    // \u6309\u9891\u6B21\u6392\u5E8F\uFF0C\u8FD4\u56DE\u524D10\u4E2A\n    return Array.from(interestMap.entries())\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 10)\n      .map(([interest]) => interest);\n  }\n\n  /**\n   * \u63D0\u53D6\u4E0A\u4E0B\u6587\u5173\u952E\u8BCD\n   */\n  private extractContextKeywords(session: ConversationSession): string[] {\n    const keywords: string[] = [];\n    \n    // \u4ECE\u6700\u8FD15\u6761\u6D88\u606F\u4E2D\u63D0\u53D6\u5173\u952E\u8BCD\n    const recentMessages = session.messages.slice(-5);\n    recentMessages.forEach(message => {\n      if (message.role === 'user') {\n        // \u7B80\u5355\u5173\u952E\u8BCD\u63D0\u53D6\n        const words = message.content\n          .replace(/[^\\u4e00-\\u9fa5a-zA-Z0-9\\s]/g, ' ')\n          .split(/\\s+/)\n          .filter(word => word.length > 1);\n        keywords.push(...words);\n      }\n    });\n\n    // \u53BB\u91CD\u5E76\u8FD4\u56DE\u9AD8\u9891\u5173\u952E\u8BCD\n    const keywordFreq = new Map<string, number>();\n    keywords.forEach(keyword => {\n      keywordFreq.set(keyword, (keywordFreq.get(keyword) || 0) + 1);\n    });\n\n    return Array.from(keywordFreq.entries())\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 5)\n      .map(([keyword]) => keyword);\n  }\n\n  /**\n   * \u751F\u6210\u4F1A\u8BDD\u6458\u8981\n   */\n  private generateSummary(session: ConversationSession): string {\n    if (session.messages.length === 0) return '';\n\n    const userMessages = session.messages\n      .filter(m => m.role === 'user')\n      .slice(-3)\n      .map(m => m.content);\n\n    const topTopics = session.extractedTopics.slice(0, 3);\n    \n    return `\u7528\u6237\u4E3B\u8981\u5173\u6CE8: ${topTopics.join(', ')}. \u6700\u8FD1\u8BE2\u95EE: ${userMessages.join('; ')}`;\n  }\n\n  /**\n   * \u57FA\u4E8E\u5174\u8DA3\u751F\u6210\u5EFA\u8BAE\n   */\n  private generateInterestBasedSuggestions(interest: string): string[] {\n    const suggestionMap: Record<string, string[]> = {\n      'AI\u6295\u8D44': [\n        '\u6700\u65B0\u7684AI\u6295\u8D44\u70ED\u70B9\u6709\u54EA\u4E9B\uFF1F',\n        '\u54EA\u4E9BAI\u8D5B\u9053\u6700\u503C\u5F97\u5173\u6CE8\uFF1F'\n      ],\n      'AI\u516C\u53F8': [\n        '\u6709\u54EA\u4E9B\u503C\u5F97\u5173\u6CE8\u7684AI\u72EC\u89D2\u517D\uFF1F',\n        '\u6700\u65B0\u83B7\u5F97\u878D\u8D44\u7684AI\u516C\u53F8\u6709\u54EA\u4E9B\uFF1F'\n      ],\n      'AI\u6280\u672F': [\n        '\u5F53\u524D\u6700\u524D\u6CBF\u7684AI\u6280\u672F\u8D8B\u52BF\uFF1F',\n        'AI\u6280\u672F\u5546\u4E1A\u5316\u7684\u673A\u4F1A\u5728\u54EA\u91CC\uFF1F'\n      ],\n      '\u6295\u8D44\u8D8B\u52BF': [\n        '2025\u5E74AI\u6295\u8D44\u8D8B\u52BF\u9884\u6D4B\uFF1F',\n        'AI\u6295\u8D44\u7684\u98CE\u9669\u548C\u673A\u4F1A\u5206\u6790\uFF1F'\n      ]\n    };\n\n    return suggestionMap[interest] || [];\n  }\n\n  /**\n   * \u57FA\u4E8E\u8BDD\u9898\u751F\u6210\u5EFA\u8BAE\n   */\n  private generateTopicBasedSuggestions(topic: string): string[] {\n    return [\n      `\u5173\u4E8E${topic}\u7684\u6700\u65B0\u52A8\u6001\uFF1F`,\n      `${topic}\u9886\u57DF\u7684\u6295\u8D44\u673A\u4F1A\uFF1F`\n    ];\n  }\n\n  /**\n   * \u6DF1\u5EA6\u5BF9\u8BDD\u5EFA\u8BAE\n   */\n  private generateDeepConversationSuggestions(session: ConversationSession): string[] {\n    return [\n      '\u6839\u636E\u6211\u4EEC\u7684\u5BF9\u8BDD\uFF0C\u8FD8\u6709\u4EC0\u4E48\u6295\u8D44\u5EFA\u8BAE\uFF1F',\n      '\u57FA\u4E8E\u5F53\u524D\u8BA8\u8BBA\uFF0C\u6709\u54EA\u4E9B\u98CE\u9669\u9700\u8981\u6CE8\u610F\uFF1F',\n      '\u7ED3\u5408\u521A\u624D\u7684\u5206\u6790\uFF0C\u7ED9\u51FA\u5177\u4F53\u7684\u884C\u52A8\u5EFA\u8BAE\uFF1F'\n    ];\n  }\n\n  /**\n   * \u9ED8\u8BA4\u5EFA\u8BAE\n   */\n  private getDefaultSuggestions(): string[] {\n    return [\n      'SVTR.AI\u8FFD\u8E2A\u54EA\u4E9BAI\u516C\u53F8\uFF1F',\n      '\u6700\u65B0\u7684AI\u6295\u8D44\u8D8B\u52BF\u662F\u4EC0\u4E48\uFF1F',\n      '\u5982\u4F55\u8BC6\u522B\u6709\u6F5C\u529B\u7684AI\u521B\u4E1A\u56E2\u961F\uFF1F',\n      '\u751F\u6210\u5F0FAI\u9886\u57DF\u7684\u6295\u8D44\u673A\u4F1A\uFF1F',\n      'AI\u57FA\u7840\u8BBE\u65BD\u8D5B\u9053\u7684\u53D1\u5C55\u524D\u666F\uFF1F',\n      'SVTR\u5E73\u53F0\u6709\u54EA\u4E9B\u72EC\u7279\u4F18\u52BF\uFF1F'\n    ];\n  }\n\n  /**\n   * \u6301\u4E45\u5316\u4F1A\u8BDD\n   */\n  private async persistSession(session: ConversationSession): Promise<void> {\n    if (this.kvNamespace) {\n      try {\n        await this.kvNamespace.put(\n          `session:${session.sessionId}`,\n          JSON.stringify(session),\n          { expirationTtl: this.maxSessionAge / 1000 }\n        );\n      } catch (error) {\n        console.log('\u4F1A\u8BDD\u6301\u4E45\u5316\u5931\u8D25:', error);\n      }\n    }\n  }\n\n  /**\n   * \u63D0\u53D6\u4F1A\u8BDD\u6D41\u7A0B\n   */\n  private extractConversationFlow(session: ConversationSession): string[] {\n    return session.messages\n      .slice(-6)\n      .filter(m => m.role === 'user')\n      .map(m => m.content.slice(0, 50) + (m.content.length > 50 ? '...' : ''));\n  }\n\n  /**\n   * \u68C0\u6D4B\u7528\u6237\u610F\u56FE\n   */\n  private detectUserIntent(query: string, session: ConversationSession): string {\n    const queryLower = query.toLowerCase();\n    \n    // \u5206\u6790\u67E5\u8BE2\u7C7B\u578B\n    if (queryLower.includes('\u5982\u4F55') || queryLower.includes('\u600E\u4E48') || queryLower.includes('\u600E\u6837')) {\n      return 'howto';\n    }\n    if (queryLower.includes('\u6BD4\u8F83') || queryLower.includes('\u5BF9\u6BD4') || queryLower.includes('\u533A\u522B')) {\n      return 'comparison';\n    }\n    if (queryLower.includes('\u4EC0\u4E48') || queryLower.includes('\u54EA\u4E9B') || queryLower.includes('\u4E3A\u4EC0\u4E48')) {\n      return 'question';\n    }\n    if (queryLower.includes('\u63A8\u8350') || queryLower.includes('\u5EFA\u8BAE') || queryLower.includes('\u9009\u62E9')) {\n      return 'recommendation';\n    }\n    if (queryLower.includes('\u66F4\u591A') || queryLower.includes('\u8FD8\u6709') || queryLower.includes('\u7EE7\u7EED')) {\n      return 'follow_up';\n    }\n\n    // \u57FA\u4E8E\u4F1A\u8BDD\u5386\u53F2\u63A8\u65AD\u610F\u56FE\n    const recentTopics = session.extractedTopics.slice(-3);\n    if (recentTopics.includes('AI\u6295\u8D44') || recentTopics.includes('\u6295\u8D44\u8D8B\u52BF')) {\n      return 'investment_inquiry';\n    }\n    if (recentTopics.includes('AI\u516C\u53F8') || recentTopics.includes('AI\u6280\u672F')) {\n      return 'company_analysis';\n    }\n\n    return 'general';\n  }\n\n  /**\n   * \u68C0\u6D4B\u662F\u5426\u9700\u8981\u6307\u4EE3\u6D88\u89E3\n   */\n  private needsCoreferenceResolution(query: string): boolean {\n    const pronouns = ['\u5B83', '\u4ED6\u4EEC', '\u8FD9\u4E2A', '\u90A3\u4E2A', '\u8FD9\u4E9B', '\u90A3\u4E9B', '\u6B64', '\u8BE5', '\u8FD9', '\u90A3'];\n    return pronouns.some(pronoun => query.includes(pronoun));\n  }\n\n  /**\n   * \u6307\u4EE3\u6D88\u89E3\n   */\n  private resolveCoreferences(query: string, session: ConversationSession): string {\n    if (session.messages.length < 2) return query;\n\n    const lastAIResponse = session.messages\n      .slice()\n      .reverse()\n      .find(m => m.role === 'assistant');\n\n    if (!lastAIResponse) return query;\n\n    // \u7B80\u5355\u7684\u6307\u4EE3\u6D88\u89E3\n    let resolvedQuery = query;\n    \n    // \u63D0\u53D6\u6700\u8FD1\u63D0\u5230\u7684\u5B9E\u4F53\n    const entities = this.extractEntities(lastAIResponse.content);\n    \n    if (entities.companies.length > 0 && (query.includes('\u5B83') || query.includes('\u8BE5\u516C\u53F8'))) {\n      resolvedQuery = resolvedQuery.replace(/\u5B83|\u8BE5\u516C\u53F8/g, entities.companies[0]);\n    }\n    \n    if (entities.topics.length > 0 && (query.includes('\u8FD9\u4E2A') || query.includes('\u8BE5\u9886\u57DF'))) {\n      resolvedQuery = resolvedQuery.replace(/\u8FD9\u4E2A|\u8BE5\u9886\u57DF/g, entities.topics[0]);\n    }\n\n    return resolvedQuery;\n  }\n\n  /**\n   * \u6784\u5EFA\u4E0A\u4E0B\u6587\u7EBF\u7D22\n   */\n  private buildContextClues(session: ConversationSession, intent: string): string {\n    const clues = [];\n    \n    // \u6DFB\u52A0\u8BDD\u9898\u4E0A\u4E0B\u6587\n    if (session.extractedTopics.length > 0) {\n      clues.push(`(\u8BA8\u8BBA\u80CC\u666F: ${session.extractedTopics.slice(0, 2).join('\u3001')})`);\n    }\n\n    // \u6DFB\u52A0\u610F\u56FE\u76F8\u5173\u7684\u4E0A\u4E0B\u6587\n    if (intent === 'follow_up' && session.messages.length > 2) {\n      const lastUserQuery = session.messages\n        .slice()\n        .reverse()\n        .find(m => m.role === 'user');\n      if (lastUserQuery) {\n        clues.push(`(\u627F\u63A5\u4E0A\u4E2A\u95EE\u9898: ${lastUserQuery.content.slice(0, 30)}...)`);\n      }\n    }\n\n    return clues.join(' ');\n  }\n\n  /**\n   * \u68C0\u6D4B\u662F\u5426\u4E3A\u540E\u7EED\u95EE\u9898\n   */\n  private isFollowUpQuestion(query: string, session: ConversationSession): boolean {\n    const followUpIndicators = [\n      '\u8FD8\u6709', '\u66F4\u591A', '\u7EE7\u7EED', '\u53E6\u5916', '\u5176\u4ED6', '\u63A5\u4E0B\u6765', '\u7136\u540E', '\u90A3\u4E48',\n      '\u8FDB\u4E00\u6B65', '\u6DF1\u5165', '\u8BE6\u7EC6', '\u5177\u4F53', '\u4F8B\u5982'\n    ];\n    \n    return followUpIndicators.some(indicator => query.includes(indicator)) ||\n           (query.length < 20 && session.messages.length > 2);\n  }\n\n  /**\n   * \u6784\u5EFA\u540E\u7EED\u95EE\u9898\u4E0A\u4E0B\u6587\n   */\n  private buildFollowUpContext(session: ConversationSession): string {\n    const recentExchange = session.messages.slice(-2);\n    if (recentExchange.length < 2) return '';\n\n    const userQuery = recentExchange.find(m => m.role === 'user')?.content || '';\n    const aiResponse = recentExchange.find(m => m.role === 'assistant')?.content || '';\n\n    // \u63D0\u53D6\u5173\u952E\u4FE1\u606F\n    const userTopic = userQuery.slice(0, 30);\n    const aiKeyPoints = this.extractKeyPoints(aiResponse);\n\n    return `\u7528\u6237\u8BE2\u95EE\u4E86\"${userTopic}\"\uFF0CAI\u56DE\u7B54\u6D89\u53CA${aiKeyPoints.join('\u3001')}`;\n  }\n\n  /**\n   * \u63D0\u53D6\u5173\u952E\u8981\u70B9\n   */\n  private extractKeyPoints(text: string): string[] {\n    const points = [];\n    \n    // \u67E5\u627E\u5217\u8868\u9879\n    const listMatches = text.match(/[\u2022\u00B7\\-\\*]\\s*(.+?)(?=\\n|$)/g);\n    if (listMatches) {\n      points.push(...listMatches.slice(0, 3).map(match => \n        match.replace(/[\u2022\u00B7\\-\\*]\\s*/, '').slice(0, 20)\n      ));\n    }\n\n    // \u67E5\u627E\u6570\u5B57\u6216\u5173\u952E\u8BCD\n    const numberMatches = text.match(/\\d+[\u3001\u3002\uFF1A]/g);\n    if (numberMatches) {\n      points.push(`${numberMatches.length}\u4E2A\u8981\u70B9`);\n    }\n\n    return points.length > 0 ? points : ['\u76F8\u5173\u4FE1\u606F'];\n  }\n\n  /**\n   * \u63D0\u53D6\u5B9E\u4F53\n   */\n  private extractEntities(text: string): { companies: string[], topics: string[] } {\n    const companies = [];\n    const topics = [];\n\n    // \u7B80\u5355\u7684\u5B9E\u4F53\u8BC6\u522B\n    const companyPatterns = [\n      /([A-Z][a-z]+(?:\\s+[A-Z][a-z]+)*(?:\\s+AI|Inc\\.|LLC))/g,\n      /([\\u4e00-\\u9fa5]+(?:\u516C\u53F8|\u79D1\u6280|\u667A\u80FD|AI))/g\n    ];\n\n    companyPatterns.forEach(pattern => {\n      const matches = text.match(pattern);\n      if (matches) {\n        companies.push(...matches.slice(0, 3));\n      }\n    });\n\n    const topicPatterns = [\n      /(AI[^\\s\uFF0C\u3002\uFF01\uFF1F]*)/g,\n      /([\\u4e00-\\u9fa5]*\u6295\u8D44[\\u4e00-\\u9fa5]*)/g,\n      /([\\u4e00-\\u9fa5]*\u521B\u4E1A[\\u4e00-\\u9fa5]*)/g\n    ];\n\n    topicPatterns.forEach(pattern => {\n      const matches = text.match(pattern);\n      if (matches) {\n        topics.push(...matches.slice(0, 3));\n      }\n    });\n\n    return { companies, topics };\n  }\n\n  /**\n   * \u6E05\u7406\u8FC7\u671F\u4F1A\u8BDD\n   */\n  cleanupExpiredSessions(): void {\n    const now = Date.now();\n    for (const [sessionId, session] of this.sessions.entries()) {\n      if (now - session.lastActivity > this.maxSessionAge) {\n        this.sessions.delete(sessionId);\n      }\n    }\n  }\n}", "/**\n * SVTR.AI \u667A\u80FD\u5EFA\u8BAEAPI\n * \u57FA\u4E8E\u4F1A\u8BDD\u4E0A\u4E0B\u6587\u63D0\u4F9B\u4E2A\u6027\u5316\u5EFA\u8BAE\u95EE\u9898\n */\n\nimport { ConversationContextManager } from '../lib/conversation-context';\n\nexport async function onRequestGet(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    const url = new URL(request.url);\n    const sessionId = url.searchParams.get('sessionId');\n    \n    if (!sessionId) {\n      return new Response(JSON.stringify({\n        error: '\u7F3A\u5C11\u4F1A\u8BDDID',\n        suggestions: getDefaultSuggestions()\n      }), {\n        status: 400,\n        headers: {\n          'Content-Type': 'application/json',\n          'Access-Control-Allow-Origin': '*',\n        }\n      });\n    }\n\n    // \u521D\u59CB\u5316\u4E0A\u4E0B\u6587\u7BA1\u7406\u5668\n    const contextManager = new ConversationContextManager(env.CHAT_SESSIONS);\n    \n    // \u83B7\u53D6\u667A\u80FD\u5EFA\u8BAE\n    const suggestions = contextManager.getSmartSuggestions(sessionId);\n    \n    // \u83B7\u53D6\u4F1A\u8BDD\u4FE1\u606F\u7528\u4E8E\u8C03\u8BD5\n    const session = await contextManager.getOrCreateSession(sessionId);\n    \n    return new Response(JSON.stringify({\n      sessionId,\n      suggestions,\n      sessionInfo: {\n        messageCount: session.messages.length,\n        topics: session.extractedTopics.slice(0, 5),\n        interests: session.userInterests.slice(0, 3),\n        summary: session.conversationSummary\n      },\n      timestamp: Date.now()\n    }), {\n      headers: {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n        'Cache-Control': 'no-cache, max-age=0'\n      }\n    });\n\n  } catch (error) {\n    console.error('\u667A\u80FD\u5EFA\u8BAEAPI\u9519\u8BEF:', error);\n    \n    return new Response(JSON.stringify({\n      error: '\u83B7\u53D6\u5EFA\u8BAE\u5931\u8D25',\n      suggestions: getDefaultSuggestions(),\n      timestamp: Date.now()\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n      }\n    });\n  }\n}\n\nexport async function onRequestPost(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    const body: any = await request.json();\n    const { sessionId, userQuery, contextHint } = body;\n    \n    if (!sessionId) {\n      return new Response(JSON.stringify({\n        error: '\u7F3A\u5C11\u4F1A\u8BDDID'\n      }), {\n        status: 400,\n        headers: {\n          'Content-Type': 'application/json',\n          'Access-Control-Allow-Origin': '*',\n        }\n      });\n    }\n\n    const contextManager = new ConversationContextManager(env.CHAT_SESSIONS);\n    \n    // \u5982\u679C\u63D0\u4F9B\u4E86\u7528\u6237\u67E5\u8BE2\uFF0C\u53EF\u4EE5\u57FA\u4E8E\u6B64\u751F\u6210\u66F4\u76F8\u5173\u7684\u5EFA\u8BAE\n    let suggestions;\n    if (userQuery) {\n      // \u4E34\u65F6\u6DFB\u52A0\u7528\u6237\u67E5\u8BE2\u5230\u4F1A\u8BDD\u4E2D\uFF0C\u751F\u6210\u76F8\u5173\u5EFA\u8BAE\n      await contextManager.addMessage(sessionId, {\n        role: 'user',\n        content: userQuery,\n        timestamp: Date.now()\n      });\n      suggestions = contextManager.getSmartSuggestions(sessionId);\n    } else {\n      suggestions = contextManager.getSmartSuggestions(sessionId);\n    }\n\n    return new Response(JSON.stringify({\n      sessionId,\n      suggestions,\n      contextHint,\n      timestamp: Date.now()\n    }), {\n      headers: {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n      }\n    });\n\n  } catch (error) {\n    console.error('\u667A\u80FD\u5EFA\u8BAEPOST API\u9519\u8BEF:', error);\n    \n    return new Response(JSON.stringify({\n      error: '\u751F\u6210\u5EFA\u8BAE\u5931\u8D25',\n      suggestions: getDefaultSuggestions()\n    }), {\n      status: 500,\n      headers: {\n        'Content-Type': 'application/json',\n        'Access-Control-Allow-Origin': '*',\n      }\n    });\n  }\n}\n\nexport async function onRequestOptions(): Promise<Response> {\n  return new Response(null, {\n    headers: {\n      'Access-Control-Allow-Origin': '*',\n      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n      'Access-Control-Allow-Headers': 'Content-Type',\n    },\n  });\n}\n\n/**\n * \u9ED8\u8BA4\u5EFA\u8BAE\u95EE\u9898\n */\nfunction getDefaultSuggestions(): string[] {\n  return [\n    'SVTR.AI\u8FFD\u8E2A\u54EA\u4E9BAI\u516C\u53F8\uFF1F',\n    '\u6700\u65B0\u7684AI\u6295\u8D44\u8D8B\u52BF\u662F\u4EC0\u4E48\uFF1F',\n    '\u5982\u4F55\u8BC6\u522B\u6709\u6F5C\u529B\u7684AI\u521B\u4E1A\u56E2\u961F\uFF1F',\n    '\u751F\u6210\u5F0FAI\u9886\u57DF\u7684\u6295\u8D44\u673A\u4F1A\uFF1F',\n    'AI\u57FA\u7840\u8BBE\u65BD\u8D5B\u9053\u7684\u53D1\u5C55\u524D\u666F\uFF1F',\n    'SVTR\u5E73\u53F0\u6709\u54EA\u4E9B\u72EC\u7279\u4F18\u52BF\uFF1F'\n  ];\n}", "// \u98DE\u4E66Webhook\u5904\u7406\u5668\n// \u7528\u4E8E\u63A5\u6536\u98DE\u4E66\u5185\u5BB9\u66F4\u65B0\u901A\u77E5\u5E76\u89E6\u53D1\u540C\u6B65\n\nexport async function onRequestPost(context) {\n  const { request, env } = context;\n  \n  try {\n    const body = await request.json();\n    \n    // \u9A8C\u8BC1\u98DE\u4E66Webhook\u7B7E\u540D\n    const signature = request.headers.get('X-Lark-Signature');\n    if (!verifySignature(body, signature, env.FEISHU_WEBHOOK_SECRET)) {\n      return new Response('Unauthorized', { status: 401 });\n    }\n    \n    // \u5904\u7406\u4E0D\u540C\u7C7B\u578B\u7684\u4E8B\u4EF6\n    const { type, event } = body;\n    \n    if (type === 'url_verification') {\n      // \u9996\u6B21\u9A8C\u8BC1\n      return new Response(JSON.stringify({\n        challenge: body.challenge\n      }), {\n        headers: { 'Content-Type': 'application/json' }\n      });\n    }\n    \n    if (event?.type === 'wiki.node.updated' || \n        event?.type === 'bitable.record.updated') {\n      \n      console.log('\uD83D\uDCDD \u68C0\u6D4B\u5230\u98DE\u4E66\u5185\u5BB9\u66F4\u65B0:', event);\n      \n      // \u89E6\u53D1GitHub Actions\u540C\u6B65\n      const githubResponse = await fetch(\n        'https://api.github.com/repos/capmapt/chatsvtr/dispatches',\n        {\n          method: 'POST',\n          headers: {\n            'Authorization': `token ${env.GITHUB_TOKEN}`,\n            'Accept': 'application/vnd.github.v3+json',\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            event_type: 'feishu-update',\n            client_payload: {\n              trigger: 'feishu_webhook',\n              event_type: event.type,\n              timestamp: new Date().toISOString()\n            }\n          })\n        }\n      );\n      \n      if (githubResponse.ok) {\n        console.log('\u2705 \u6210\u529F\u89E6\u53D1\u540C\u6B65\u66F4\u65B0');\n        return new Response('OK', { status: 200 });\n      } else {\n        console.error('\u274C \u89E6\u53D1\u540C\u6B65\u5931\u8D25');\n        return new Response('Sync failed', { status: 500 });\n      }\n    }\n    \n    return new Response('OK', { status: 200 });\n    \n  } catch (error) {\n    console.error('\u274C Webhook\u5904\u7406\u5931\u8D25:', error);\n    return new Response('Internal error', { status: 500 });\n  }\n}\n\nfunction verifySignature(body, signature, secret) {\n  // \u5B9E\u73B0\u98DE\u4E66Webhook\u7B7E\u540D\u9A8C\u8BC1\u903B\u8F91\n  // \u53C2\u8003: https://open.feishu.cn/document/ukTMukTMukTM/uUTNz4SN1MjL1UzM\n  return true; // \u7B80\u5316\u5B9E\u73B0\n}", "/**\n * Cloudflare Workers Scheduled Event Handler\n * \u6BCF\u65E5\u5B9A\u65F6\u540C\u6B65RAG\u6570\u636E\n */\n\nexport async function onRequestPost(context: any): Promise<Response> {\n  try {\n    const { request, env } = context;\n    \n    // \u9A8C\u8BC1\u8BF7\u6C42\u6765\u6E90\uFF08\u53EF\u9009\uFF1A\u6DFB\u52A0webhook\u5BC6\u94A5\u9A8C\u8BC1\uFF09\n    const authHeader = request.headers.get('Authorization');\n    if (authHeader !== `Bearer ${env.SYNC_WEBHOOK_SECRET}`) {\n      return new Response('Unauthorized', { status: 401 });\n    }\n\n    console.log('\uD83E\uDD16 \u5F00\u59CB\u5B9A\u65F6\u540C\u6B65\u4EFB\u52A1...');\n    \n    // \u8C03\u7528\u98DE\u4E66API\u540C\u6B65\u6570\u636E\n    const syncResult = await performScheduledSync(env);\n    \n    if (syncResult.success) {\n      console.log('\u2705 \u5B9A\u65F6\u540C\u6B65\u6210\u529F:', syncResult.summary);\n      \n      // \u53EF\u9009\uFF1A\u53D1\u9001\u6210\u529F\u901A\u77E5\n      await sendSyncNotification(env, {\n        status: 'success',\n        summary: syncResult.summary,\n        timestamp: new Date().toISOString()\n      });\n      \n      return new Response(JSON.stringify({\n        success: true,\n        message: '\u5B9A\u65F6\u540C\u6B65\u5B8C\u6210',\n        data: syncResult.summary\n      }), {\n        headers: { 'Content-Type': 'application/json' }\n      });\n    } else {\n      console.error('\u274C \u5B9A\u65F6\u540C\u6B65\u5931\u8D25:', syncResult.error);\n      \n      // \u53D1\u9001\u5931\u8D25\u901A\u77E5\n      await sendSyncNotification(env, {\n        status: 'error', \n        error: syncResult.error,\n        timestamp: new Date().toISOString()\n      });\n      \n      return new Response(JSON.stringify({\n        success: false,\n        message: '\u5B9A\u65F6\u540C\u6B65\u5931\u8D25',\n        error: syncResult.error\n      }), {\n        status: 500,\n        headers: { 'Content-Type': 'application/json' }\n      });\n    }\n    \n  } catch (error) {\n    console.error('\uD83D\uDEA8 \u5B9A\u65F6\u540C\u6B65\u5F02\u5E38:', error);\n    \n    return new Response(JSON.stringify({\n      success: false,\n      message: '\u5B9A\u65F6\u540C\u6B65\u5F02\u5E38',\n      error: error.message\n    }), {\n      status: 500,\n      headers: { 'Content-Type': 'application/json' }\n    });\n  }\n}\n\n/**\n * \u6267\u884C\u5B9A\u65F6\u540C\u6B65\n */\nasync function performScheduledSync(env: any) {\n  try {\n    // \u8FD9\u91CC\u53EF\u4EE5\u8C03\u7528\u73B0\u6709\u7684\u98DE\u4E66\u540C\u6B65\u903B\u8F91\n    // \u6216\u8005\u89E6\u53D1GitHub Actions webhook\n    \n    const feishuAppId = env.FEISHU_APP_ID;\n    const feishuSecret = env.FEISHU_APP_SECRET;\n    \n    if (!feishuAppId || !feishuSecret) {\n      throw new Error('\u98DE\u4E66API\u914D\u7F6E\u7F3A\u5931');\n    }\n    \n    // \u7B80\u5316\u7248\u540C\u6B65\u903B\u8F91\uFF08\u5B9E\u9645\u5E94\u8BE5\u8C03\u7528\u5B8C\u6574\u7684\u540C\u6B65\u51FD\u6570\uFF09\n    const syncTimestamp = new Date().toISOString();\n    \n    // \u89E6\u53D1GitHub Actions workflow\uFF08\u63A8\u8350\u65B9\u5F0F\uFF09\n    const webhookResult = await triggerGitHubSync(env);\n    \n    return {\n      success: true,\n      summary: {\n        syncTime: syncTimestamp,\n        triggerMethod: 'github_actions',\n        webhookResult: webhookResult\n      }\n    };\n    \n  } catch (error) {\n    return {\n      success: false,\n      error: error.message\n    };\n  }\n}\n\n/**\n * \u89E6\u53D1GitHub Actions\u540C\u6B65\n */\nasync function triggerGitHubSync(env: any) {\n  try {\n    // \u8C03\u7528GitHub API\u89E6\u53D1workflow_dispatch\u4E8B\u4EF6\n    const response = await fetch(`https://api.github.com/repos/${env.GITHUB_REPO}/actions/workflows/daily-sync.yml/dispatches`, {\n      method: 'POST',\n      headers: {\n        'Authorization': `token ${env.GITHUB_TOKEN}`,\n        'Accept': 'application/vnd.github.v3+json',\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        ref: 'main',\n        inputs: {\n          sync_type: 'smart'\n        }\n      })\n    });\n    \n    if (response.ok) {\n      return { triggered: true, timestamp: new Date().toISOString() };\n    } else {\n      const error = await response.text();\n      throw new Error(`GitHub API\u8C03\u7528\u5931\u8D25: ${error}`);\n    }\n    \n  } catch (error) {\n    console.error('GitHub webhook\u89E6\u53D1\u5931\u8D25:', error);\n    return { triggered: false, error: error.message };\n  }\n}\n\n/**\n * \u53D1\u9001\u540C\u6B65\u901A\u77E5\uFF08\u53EF\u9009\uFF09\n */\nasync function sendSyncNotification(env: any, data: any) {\n  try {\n    // \u53EF\u4EE5\u96C6\u6210Slack\u3001Discord\u3001\u90AE\u4EF6\u7B49\u901A\u77E5\u65B9\u5F0F\n    console.log('\uD83D\uDCEC \u540C\u6B65\u901A\u77E5:', data);\n    \n    // \u793A\u4F8B\uFF1A\u53D1\u9001\u5230Slack webhook\n    if (env.SLACK_WEBHOOK_URL) {\n      await fetch(env.SLACK_WEBHOOK_URL, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          text: `\uD83E\uDD16 SVTR RAG\u6570\u636E\u540C\u6B65${data.status === 'success' ? '\u6210\u529F' : '\u5931\u8D25'}`,\n          attachments: [{\n            color: data.status === 'success' ? 'good' : 'danger',\n            fields: [\n              { title: '\u65F6\u95F4', value: data.timestamp, short: true },\n              { title: '\u72B6\u6001', value: data.status, short: true },\n              { title: '\u8BE6\u60C5', value: data.summary || data.error, short: false }\n            ]\n          }]\n        })\n      });\n    }\n    \n  } catch (error) {\n    console.error('\u901A\u77E5\u53D1\u9001\u5931\u8D25:', error);\n  }\n}", "/**\n * Cloudflare Pages \u4E2D\u95F4\u4EF6\n * \u8BBE\u7F6E\u5B89\u5168\u5934\u548C\u6027\u80FD\u4F18\u5316\n */\n\ninterface Env {\n  // \u73AF\u5883\u53D8\u91CF\u7C7B\u578B\u5B9A\u4E49\n}\n\nexport const onRequest: PagesFunction<Env> = async (context) => {\n  const response = await context.next();\n  const url = new URL(context.request.url);\n  \n  // \u521B\u5EFA\u65B0\u7684\u54CD\u5E94\u5BF9\u8C61\u4EE5\u6DFB\u52A0\u5934\u90E8\n  const newResponse = new Response(response.body, response);\n  \n  // \u57FA\u7840\u5B89\u5168\u5934\n  const securityHeaders = {\n    'X-Content-Type-Options': 'nosniff',\n    'X-Frame-Options': 'SAMEORIGIN',\n    'Referrer-Policy': 'strict-origin-when-cross-origin',\n    'Permissions-Policy': 'camera=(), microphone=(), geolocation=(self), payment=()',\n  };\n  \n  // \u4EC5\u5728HTTPS\u4E0B\u8BBE\u7F6EHSTS\n  if (url.protocol === 'https:') {\n    securityHeaders['Strict-Transport-Security'] = 'max-age=31536000; includeSubDomains';\n  }\n  \n  // CSP\u7B56\u7565\n  const cspPolicy = [\n    \"default-src 'self' https:\",\n    \"script-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://c0uiiy15npu.feishu.cn https://static.cloudflareinsights.com https://*.cloudflareinsights.com\",\n    \"style-src 'self' 'unsafe-inline' https://fonts.googleapis.com\",\n    \"img-src 'self' data: https:\",\n    \"font-src 'self' https://fonts.gstatic.com\",\n    \"connect-src 'self' https: https://cloudflareinsights.com https://*.cloudflareinsights.com\",\n    \"frame-src 'self' https://c0uiiy15npu.feishu.cn\",\n    \"frame-ancestors 'self'\",\n    \"object-src 'none'\",\n    \"base-uri 'self'\"\n  ].join('; ');\n  \n  securityHeaders['Content-Security-Policy'] = cspPolicy;\n  \n  // \u7F13\u5B58\u7B56\u7565\n  const pathname = url.pathname;\n  \n  if (pathname.startsWith('/assets/')) {\n    // \u9759\u6001\u8D44\u6E90\uFF1A\u957F\u671F\u7F13\u5B58\n    newResponse.headers.set('Cache-Control', 'public, max-age=31536000, immutable');\n  } else if (pathname.endsWith('.html') || pathname === '/') {\n    // HTML\u6587\u4EF6\uFF1A\u77ED\u671F\u7F13\u5B58\n    newResponse.headers.set('Cache-Control', 'public, max-age=3600, must-revalidate');\n  } else if (pathname === '/sw.js') {\n    // Service Worker\uFF1A\u4E0D\u7F13\u5B58\n    newResponse.headers.set('Cache-Control', 'public, max-age=0, must-revalidate');\n  } else if (pathname.startsWith('/api/')) {\n    // API\uFF1A\u4E0D\u7F13\u5B58\n    newResponse.headers.set('Cache-Control', 'no-cache, no-store, must-revalidate');\n    newResponse.headers.set('Pragma', 'no-cache');\n  }\n  \n  // \u5E94\u7528\u6240\u6709\u5B89\u5168\u5934\n  Object.entries(securityHeaders).forEach(([key, value]) => {\n    newResponse.headers.set(key, value);\n  });\n  \n  // \u6027\u80FD\u4F18\u5316\u5934\n  if (context.request.headers.get('Accept-Encoding')?.includes('gzip')) {\n    newResponse.headers.set('Content-Encoding', 'gzip');\n  }\n  \n  // CORS\u5934\uFF08\u5982\u679C\u9700\u8981\uFF09\n  if (pathname.startsWith('/api/')) {\n    newResponse.headers.set('Access-Control-Allow-Origin', '*');\n    newResponse.headers.set('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');\n    newResponse.headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization');\n  }\n  \n  return newResponse;\n};", "import { onRequestGet as __api_auth_github_ts_onRequestGet } from \"/home/lium/chatsvtr/functions/api/auth/github.ts\"\nimport { onRequestOptions as __api_auth_github_ts_onRequestOptions } from \"/home/lium/chatsvtr/functions/api/auth/github.ts\"\nimport { onRequestGet as __api_auth_google_ts_onRequestGet } from \"/home/lium/chatsvtr/functions/api/auth/google.ts\"\nimport { onRequestOptions as __api_auth_google_ts_onRequestOptions } from \"/home/lium/chatsvtr/functions/api/auth/google.ts\"\nimport { onRequestGet as __api_auth_linkedin_ts_onRequestGet } from \"/home/lium/chatsvtr/functions/api/auth/linkedin.ts\"\nimport { onRequestOptions as __api_auth_linkedin_ts_onRequestOptions } from \"/home/lium/chatsvtr/functions/api/auth/linkedin.ts\"\nimport { onRequestGet as __api_auth_ts_onRequestGet } from \"/home/lium/chatsvtr/functions/api/auth.ts\"\nimport { onRequestOptions as __api_auth_ts_onRequestOptions } from \"/home/lium/chatsvtr/functions/api/auth.ts\"\nimport { onRequestPost as __api_auth_ts_onRequestPost } from \"/home/lium/chatsvtr/functions/api/auth.ts\"\nimport { onRequestOptions as __api_chat_ts_onRequestOptions } from \"/home/lium/chatsvtr/functions/api/chat.ts\"\nimport { onRequestPost as __api_chat_ts_onRequestPost } from \"/home/lium/chatsvtr/functions/api/chat.ts\"\nimport { onRequestOptions as __api_chat_optimized_ts_onRequestOptions } from \"/home/lium/chatsvtr/functions/api/chat-optimized.ts\"\nimport { onRequestPost as __api_chat_optimized_ts_onRequestPost } from \"/home/lium/chatsvtr/functions/api/chat-optimized.ts\"\nimport { onRequestGet as __api_feishu_webhook_ts_onRequestGet } from \"/home/lium/chatsvtr/functions/api/feishu-webhook.ts\"\nimport { onRequestPost as __api_feishu_webhook_ts_onRequestPost } from \"/home/lium/chatsvtr/functions/api/feishu-webhook.ts\"\nimport { onRequestGet as __api_projects_ts_onRequestGet } from \"/home/lium/chatsvtr/functions/api/projects.ts\"\nimport { onRequestOptions as __api_projects_ts_onRequestOptions } from \"/home/lium/chatsvtr/functions/api/projects.ts\"\nimport { onRequestPost as __api_projects_ts_onRequestPost } from \"/home/lium/chatsvtr/functions/api/projects.ts\"\nimport { onRequestPut as __api_projects_ts_onRequestPut } from \"/home/lium/chatsvtr/functions/api/projects.ts\"\nimport { onRequestGet as __api_quota_status_ts_onRequestGet } from \"/home/lium/chatsvtr/functions/api/quota-status.ts\"\nimport { onRequestDelete as __api_subscribe_ts_onRequestDelete } from \"/home/lium/chatsvtr/functions/api/subscribe.ts\"\nimport { onRequestGet as __api_subscribe_ts_onRequestGet } from \"/home/lium/chatsvtr/functions/api/subscribe.ts\"\nimport { onRequestOptions as __api_subscribe_ts_onRequestOptions } from \"/home/lium/chatsvtr/functions/api/subscribe.ts\"\nimport { onRequestPost as __api_subscribe_ts_onRequestPost } from \"/home/lium/chatsvtr/functions/api/subscribe.ts\"\nimport { onRequestGet as __api_suggestions_ts_onRequestGet } from \"/home/lium/chatsvtr/functions/api/suggestions.ts\"\nimport { onRequestOptions as __api_suggestions_ts_onRequestOptions } from \"/home/lium/chatsvtr/functions/api/suggestions.ts\"\nimport { onRequestPost as __api_suggestions_ts_onRequestPost } from \"/home/lium/chatsvtr/functions/api/suggestions.ts\"\nimport { onRequestPost as __webhook_feishu_js_onRequestPost } from \"/home/lium/chatsvtr/functions/webhook/feishu.js\"\nimport { onRequestPost as __scheduled_sync_ts_onRequestPost } from \"/home/lium/chatsvtr/functions/scheduled-sync.ts\"\nimport { onRequest as ___middleware_ts_onRequest } from \"/home/lium/chatsvtr/functions/_middleware.ts\"\n\nexport const routes = [\n    {\n      routePath: \"/api/auth/github\",\n      mountPath: \"/api/auth\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_auth_github_ts_onRequestGet],\n    },\n  {\n      routePath: \"/api/auth/github\",\n      mountPath: \"/api/auth\",\n      method: \"OPTIONS\",\n      middlewares: [],\n      modules: [__api_auth_github_ts_onRequestOptions],\n    },\n  {\n      routePath: \"/api/auth/google\",\n      mountPath: \"/api/auth\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_auth_google_ts_onRequestGet],\n    },\n  {\n      routePath: \"/api/auth/google\",\n      mountPath: \"/api/auth\",\n      method: \"OPTIONS\",\n      middlewares: [],\n      modules: [__api_auth_google_ts_onRequestOptions],\n    },\n  {\n      routePath: \"/api/auth/linkedin\",\n      mountPath: \"/api/auth\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_auth_linkedin_ts_onRequestGet],\n    },\n  {\n      routePath: \"/api/auth/linkedin\",\n      mountPath: \"/api/auth\",\n      method: \"OPTIONS\",\n      middlewares: [],\n      modules: [__api_auth_linkedin_ts_onRequestOptions],\n    },\n  {\n      routePath: \"/api/auth\",\n      mountPath: \"/api\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_auth_ts_onRequestGet],\n    },\n  {\n      routePath: \"/api/auth\",\n      mountPath: \"/api\",\n      method: \"OPTIONS\",\n      middlewares: [],\n      modules: [__api_auth_ts_onRequestOptions],\n    },\n  {\n      routePath: \"/api/auth\",\n      mountPath: \"/api\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_auth_ts_onRequestPost],\n    },\n  {\n      routePath: \"/api/chat\",\n      mountPath: \"/api\",\n      method: \"OPTIONS\",\n      middlewares: [],\n      modules: [__api_chat_ts_onRequestOptions],\n    },\n  {\n      routePath: \"/api/chat\",\n      mountPath: \"/api\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_chat_ts_onRequestPost],\n    },\n  {\n      routePath: \"/api/chat-optimized\",\n      mountPath: \"/api\",\n      method: \"OPTIONS\",\n      middlewares: [],\n      modules: [__api_chat_optimized_ts_onRequestOptions],\n    },\n  {\n      routePath: \"/api/chat-optimized\",\n      mountPath: \"/api\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_chat_optimized_ts_onRequestPost],\n    },\n  {\n      routePath: \"/api/feishu-webhook\",\n      mountPath: \"/api\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_feishu_webhook_ts_onRequestGet],\n    },\n  {\n      routePath: \"/api/feishu-webhook\",\n      mountPath: \"/api\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_feishu_webhook_ts_onRequestPost],\n    },\n  {\n      routePath: \"/api/projects\",\n      mountPath: \"/api\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_projects_ts_onRequestGet],\n    },\n  {\n      routePath: \"/api/projects\",\n      mountPath: \"/api\",\n      method: \"OPTIONS\",\n      middlewares: [],\n      modules: [__api_projects_ts_onRequestOptions],\n    },\n  {\n      routePath: \"/api/projects\",\n      mountPath: \"/api\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_projects_ts_onRequestPost],\n    },\n  {\n      routePath: \"/api/projects\",\n      mountPath: \"/api\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_projects_ts_onRequestPut],\n    },\n  {\n      routePath: \"/api/quota-status\",\n      mountPath: \"/api\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_quota_status_ts_onRequestGet],\n    },\n  {\n      routePath: \"/api/subscribe\",\n      mountPath: \"/api\",\n      method: \"DELETE\",\n      middlewares: [],\n      modules: [__api_subscribe_ts_onRequestDelete],\n    },\n  {\n      routePath: \"/api/subscribe\",\n      mountPath: \"/api\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_subscribe_ts_onRequestGet],\n    },\n  {\n      routePath: \"/api/subscribe\",\n      mountPath: \"/api\",\n      method: \"OPTIONS\",\n      middlewares: [],\n      modules: [__api_subscribe_ts_onRequestOptions],\n    },\n  {\n      routePath: \"/api/subscribe\",\n      mountPath: \"/api\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_subscribe_ts_onRequestPost],\n    },\n  {\n      routePath: \"/api/suggestions\",\n      mountPath: \"/api\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_suggestions_ts_onRequestGet],\n    },\n  {\n      routePath: \"/api/suggestions\",\n      mountPath: \"/api\",\n      method: \"OPTIONS\",\n      middlewares: [],\n      modules: [__api_suggestions_ts_onRequestOptions],\n    },\n  {\n      routePath: \"/api/suggestions\",\n      mountPath: \"/api\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_suggestions_ts_onRequestPost],\n    },\n  {\n      routePath: \"/webhook/feishu\",\n      mountPath: \"/webhook\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__webhook_feishu_js_onRequestPost],\n    },\n  {\n      routePath: \"/scheduled-sync\",\n      mountPath: \"/\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__scheduled_sync_ts_onRequestPost],\n    },\n  {\n      routePath: \"/\",\n      mountPath: \"/\",\n      method: \"\",\n      middlewares: [___middleware_ts_onRequest],\n      modules: [],\n    },\n  ]", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"/home/lium/chatsvtr/.wrangler/tmp/bundle-fSEAcT/middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"/home/lium/chatsvtr/node_modules/wrangler/templates/middleware/common.ts\";\nimport type { WorkerEntrypointConstructor } from \"/home/lium/chatsvtr/.wrangler/tmp/bundle-fSEAcT/middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"/home/lium/chatsvtr/.wrangler/tmp/bundle-fSEAcT/middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"/home/lium/chatsvtr/node_modules/wrangler/templates/pages-template-worker.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"/home/lium/chatsvtr/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"/home/lium/chatsvtr/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"/home/lium/chatsvtr/node_modules/wrangler/templates/pages-template-worker.ts\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "import { match } from \"path-to-regexp\";\n\n//note: this explicitly does not include the * character, as pages requires this\nconst escapeRegex = /[.+?^${}()|[\\]\\\\]/g;\n\ntype HTTPMethod =\n\t| \"HEAD\"\n\t| \"OPTIONS\"\n\t| \"GET\"\n\t| \"POST\"\n\t| \"PUT\"\n\t| \"PATCH\"\n\t| \"DELETE\";\n\n/* TODO: Grab these from @cloudflare/workers-types instead */\ntype Params<P extends string = string> = Record<P, string | string[]>;\n\ntype EventContext<Env, P extends string, Data> = {\n\trequest: Request;\n\tfunctionPath: string;\n\twaitUntil: (promise: Promise<unknown>) => void;\n\tpassThroughOnException: () => void;\n\tnext: (input?: Request | string, init?: RequestInit) => Promise<Response>;\n\tenv: Env & { ASSETS: { fetch: typeof fetch } };\n\tparams: Params<P>;\n\tdata: Data;\n};\n\ndeclare type PagesFunction<\n\tEnv = unknown,\n\tP extends string = string,\n\tData extends Record<string, unknown> = Record<string, unknown>,\n> = (context: EventContext<Env, P, Data>) => Response | Promise<Response>;\n/* end @cloudflare/workers-types */\n\ntype RouteHandler = {\n\troutePath: string;\n\tmountPath: string;\n\tmethod?: HTTPMethod;\n\tmodules: PagesFunction[];\n\tmiddlewares: PagesFunction[];\n};\n\n// inject `routes` via ESBuild\ndeclare const routes: RouteHandler[];\n// define `__FALLBACK_SERVICE__` via ESBuild\ndeclare const __FALLBACK_SERVICE__: string;\n\n// expect an ASSETS fetcher binding pointing to the asset-server stage\ntype FetchEnv = {\n\t[name: string]: { fetch: typeof fetch };\n\tASSETS: { fetch: typeof fetch };\n};\n\ntype WorkerContext = {\n\twaitUntil: (promise: Promise<unknown>) => void;\n\tpassThroughOnException: () => void;\n};\n\nfunction* executeRequest(request: Request) {\n\tconst requestPath = new URL(request.url).pathname;\n\n\t// First, iterate through the routes (backwards) and execute \"middlewares\" on partial route matches\n\tfor (const route of [...routes].reverse()) {\n\t\tif (route.method && route.method !== request.method) {\n\t\t\tcontinue;\n\t\t}\n\n\t\t// replaces with \"\\\\$&\", this prepends a backslash to the matched string, e.g. \"[\" becomes \"\\[\"\n\t\tconst routeMatcher = match(route.routePath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: false,\n\t\t});\n\t\tconst mountMatcher = match(route.mountPath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: false,\n\t\t});\n\t\tconst matchResult = routeMatcher(requestPath);\n\t\tconst mountMatchResult = mountMatcher(requestPath);\n\t\tif (matchResult && mountMatchResult) {\n\t\t\tfor (const handler of route.middlewares.flat()) {\n\t\t\t\tyield {\n\t\t\t\t\thandler,\n\t\t\t\t\tparams: matchResult.params as Params,\n\t\t\t\t\tpath: mountMatchResult.path,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\t// Then look for the first exact route match and execute its \"modules\"\n\tfor (const route of routes) {\n\t\tif (route.method && route.method !== request.method) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst routeMatcher = match(route.routePath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: true,\n\t\t});\n\t\tconst mountMatcher = match(route.mountPath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: false,\n\t\t});\n\t\tconst matchResult = routeMatcher(requestPath);\n\t\tconst mountMatchResult = mountMatcher(requestPath);\n\t\tif (matchResult && mountMatchResult && route.modules.length) {\n\t\t\tfor (const handler of route.modules.flat()) {\n\t\t\t\tyield {\n\t\t\t\t\thandler,\n\t\t\t\t\tparams: matchResult.params as Params,\n\t\t\t\t\tpath: matchResult.path,\n\t\t\t\t};\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nexport default {\n\tasync fetch(\n\t\toriginalRequest: Request,\n\t\tenv: FetchEnv,\n\t\tworkerContext: WorkerContext\n\t) {\n\t\tlet request = originalRequest;\n\t\tconst handlerIterator = executeRequest(request);\n\t\tlet data = {}; // arbitrary data the user can set between functions\n\t\tlet isFailOpen = false;\n\n\t\tconst next = async (input?: RequestInfo, init?: RequestInit) => {\n\t\t\tif (input !== undefined) {\n\t\t\t\tlet url = input;\n\t\t\t\tif (typeof input === \"string\") {\n\t\t\t\t\turl = new URL(input, request.url).toString();\n\t\t\t\t}\n\t\t\t\trequest = new Request(url, init);\n\t\t\t}\n\n\t\t\tconst result = handlerIterator.next();\n\t\t\t// Note we can't use `!result.done` because this doesn't narrow to the correct type\n\t\t\tif (result.done === false) {\n\t\t\t\tconst { handler, params, path } = result.value;\n\t\t\t\tconst context = {\n\t\t\t\t\trequest: new Request(request.clone()),\n\t\t\t\t\tfunctionPath: path,\n\t\t\t\t\tnext,\n\t\t\t\t\tparams,\n\t\t\t\t\tget data() {\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t},\n\t\t\t\t\tset data(value) {\n\t\t\t\t\t\tif (typeof value !== \"object\" || value === null) {\n\t\t\t\t\t\t\tthrow new Error(\"context.data must be an object\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// user has overriden context.data, so we need to merge it with the existing data\n\t\t\t\t\t\tdata = value;\n\t\t\t\t\t},\n\t\t\t\t\tenv,\n\t\t\t\t\twaitUntil: workerContext.waitUntil.bind(workerContext),\n\t\t\t\t\tpassThroughOnException: () => {\n\t\t\t\t\t\tisFailOpen = true;\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tconst response = await handler(context);\n\n\t\t\t\tif (!(response instanceof Response)) {\n\t\t\t\t\tthrow new Error(\"Your Pages function should return a Response\");\n\t\t\t\t}\n\n\t\t\t\treturn cloneResponse(response);\n\t\t\t} else if (__FALLBACK_SERVICE__) {\n\t\t\t\t// There are no more handlers so finish with the fallback service (`env.ASSETS.fetch` in Pages' case)\n\t\t\t\tconst response = await env[__FALLBACK_SERVICE__].fetch(request);\n\t\t\t\treturn cloneResponse(response);\n\t\t\t} else {\n\t\t\t\t// There was not fallback service so actually make the request to the origin.\n\t\t\t\tconst response = await fetch(request);\n\t\t\t\treturn cloneResponse(response);\n\t\t\t}\n\t\t};\n\n\t\ttry {\n\t\t\treturn await next();\n\t\t} catch (error) {\n\t\t\tif (isFailOpen) {\n\t\t\t\tconst response = await env[__FALLBACK_SERVICE__].fetch(request);\n\t\t\t\treturn cloneResponse(response);\n\t\t\t}\n\n\t\t\tthrow error;\n\t\t}\n\t},\n};\n\n// This makes a Response mutable\nconst cloneResponse = (response: Response) =>\n\t// https://fetch.spec.whatwg.org/#null-body-status\n\tnew Response(\n\t\t[101, 204, 205, 304].includes(response.status) ? null : response.body,\n\t\tresponse\n\t);\n", "/**\n * Tokenizer results.\n */\ninterface LexToken {\n  type:\n    | \"OPEN\"\n    | \"CLOSE\"\n    | \"PATTERN\"\n    | \"NAME\"\n    | \"CHAR\"\n    | \"ESCAPED_CHAR\"\n    | \"MODIFIER\"\n    | \"END\";\n  index: number;\n  value: string;\n}\n\n/**\n * Tokenize input string.\n */\nfunction lexer(str: string): LexToken[] {\n  const tokens: LexToken[] = [];\n  let i = 0;\n\n  while (i < str.length) {\n    const char = str[i];\n\n    if (char === \"*\" || char === \"+\" || char === \"?\") {\n      tokens.push({ type: \"MODIFIER\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"\\\\\") {\n      tokens.push({ type: \"ESCAPED_CHAR\", index: i++, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"{\") {\n      tokens.push({ type: \"OPEN\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"}\") {\n      tokens.push({ type: \"CLOSE\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \":\") {\n      let name = \"\";\n      let j = i + 1;\n\n      while (j < str.length) {\n        const code = str.charCodeAt(j);\n\n        if (\n          // `0-9`\n          (code >= 48 && code <= 57) ||\n          // `A-Z`\n          (code >= 65 && code <= 90) ||\n          // `a-z`\n          (code >= 97 && code <= 122) ||\n          // `_`\n          code === 95\n        ) {\n          name += str[j++];\n          continue;\n        }\n\n        break;\n      }\n\n      if (!name) throw new TypeError(`Missing parameter name at ${i}`);\n\n      tokens.push({ type: \"NAME\", index: i, value: name });\n      i = j;\n      continue;\n    }\n\n    if (char === \"(\") {\n      let count = 1;\n      let pattern = \"\";\n      let j = i + 1;\n\n      if (str[j] === \"?\") {\n        throw new TypeError(`Pattern cannot start with \"?\" at ${j}`);\n      }\n\n      while (j < str.length) {\n        if (str[j] === \"\\\\\") {\n          pattern += str[j++] + str[j++];\n          continue;\n        }\n\n        if (str[j] === \")\") {\n          count--;\n          if (count === 0) {\n            j++;\n            break;\n          }\n        } else if (str[j] === \"(\") {\n          count++;\n          if (str[j + 1] !== \"?\") {\n            throw new TypeError(`Capturing groups are not allowed at ${j}`);\n          }\n        }\n\n        pattern += str[j++];\n      }\n\n      if (count) throw new TypeError(`Unbalanced pattern at ${i}`);\n      if (!pattern) throw new TypeError(`Missing pattern at ${i}`);\n\n      tokens.push({ type: \"PATTERN\", index: i, value: pattern });\n      i = j;\n      continue;\n    }\n\n    tokens.push({ type: \"CHAR\", index: i, value: str[i++] });\n  }\n\n  tokens.push({ type: \"END\", index: i, value: \"\" });\n\n  return tokens;\n}\n\nexport interface ParseOptions {\n  /**\n   * Set the default delimiter for repeat parameters. (default: `'/'`)\n   */\n  delimiter?: string;\n  /**\n   * List of characters to automatically consider prefixes when parsing.\n   */\n  prefixes?: string;\n}\n\n/**\n * Parse a string for the raw tokens.\n */\nexport function parse(str: string, options: ParseOptions = {}): Token[] {\n  const tokens = lexer(str);\n  const { prefixes = \"./\", delimiter = \"/#?\" } = options;\n  const result: Token[] = [];\n  let key = 0;\n  let i = 0;\n  let path = \"\";\n\n  const tryConsume = (type: LexToken[\"type\"]): string | undefined => {\n    if (i < tokens.length && tokens[i].type === type) return tokens[i++].value;\n  };\n\n  const mustConsume = (type: LexToken[\"type\"]): string => {\n    const value = tryConsume(type);\n    if (value !== undefined) return value;\n    const { type: nextType, index } = tokens[i];\n    throw new TypeError(`Unexpected ${nextType} at ${index}, expected ${type}`);\n  };\n\n  const consumeText = (): string => {\n    let result = \"\";\n    let value: string | undefined;\n    while ((value = tryConsume(\"CHAR\") || tryConsume(\"ESCAPED_CHAR\"))) {\n      result += value;\n    }\n    return result;\n  };\n\n  const isSafe = (value: string): boolean => {\n    for (const char of delimiter) if (value.indexOf(char) > -1) return true;\n    return false;\n  };\n\n  const safePattern = (prefix: string) => {\n    const prev = result[result.length - 1];\n    const prevText = prefix || (prev && typeof prev === \"string\" ? prev : \"\");\n\n    if (prev && !prevText) {\n      throw new TypeError(\n        `Must have text between two parameters, missing text after \"${(prev as Key).name}\"`,\n      );\n    }\n\n    if (!prevText || isSafe(prevText)) return `[^${escapeString(delimiter)}]+?`;\n    return `(?:(?!${escapeString(prevText)})[^${escapeString(delimiter)}])+?`;\n  };\n\n  while (i < tokens.length) {\n    const char = tryConsume(\"CHAR\");\n    const name = tryConsume(\"NAME\");\n    const pattern = tryConsume(\"PATTERN\");\n\n    if (name || pattern) {\n      let prefix = char || \"\";\n\n      if (prefixes.indexOf(prefix) === -1) {\n        path += prefix;\n        prefix = \"\";\n      }\n\n      if (path) {\n        result.push(path);\n        path = \"\";\n      }\n\n      result.push({\n        name: name || key++,\n        prefix,\n        suffix: \"\",\n        pattern: pattern || safePattern(prefix),\n        modifier: tryConsume(\"MODIFIER\") || \"\",\n      });\n      continue;\n    }\n\n    const value = char || tryConsume(\"ESCAPED_CHAR\");\n    if (value) {\n      path += value;\n      continue;\n    }\n\n    if (path) {\n      result.push(path);\n      path = \"\";\n    }\n\n    const open = tryConsume(\"OPEN\");\n    if (open) {\n      const prefix = consumeText();\n      const name = tryConsume(\"NAME\") || \"\";\n      const pattern = tryConsume(\"PATTERN\") || \"\";\n      const suffix = consumeText();\n\n      mustConsume(\"CLOSE\");\n\n      result.push({\n        name: name || (pattern ? key++ : \"\"),\n        pattern: name && !pattern ? safePattern(prefix) : pattern,\n        prefix,\n        suffix,\n        modifier: tryConsume(\"MODIFIER\") || \"\",\n      });\n      continue;\n    }\n\n    mustConsume(\"END\");\n  }\n\n  return result;\n}\n\nexport interface TokensToFunctionOptions {\n  /**\n   * When `true` the regexp will be case sensitive. (default: `false`)\n   */\n  sensitive?: boolean;\n  /**\n   * Function for encoding input strings for output.\n   */\n  encode?: (value: string, token: Key) => string;\n  /**\n   * When `false` the function can produce an invalid (unmatched) path. (default: `true`)\n   */\n  validate?: boolean;\n}\n\n/**\n * Compile a string to a template function for the path.\n */\nexport function compile<P extends object = object>(\n  str: string,\n  options?: ParseOptions & TokensToFunctionOptions,\n) {\n  return tokensToFunction<P>(parse(str, options), options);\n}\n\nexport type PathFunction<P extends object = object> = (data?: P) => string;\n\n/**\n * Expose a method for transforming tokens into the path function.\n */\nexport function tokensToFunction<P extends object = object>(\n  tokens: Token[],\n  options: TokensToFunctionOptions = {},\n): PathFunction<P> {\n  const reFlags = flags(options);\n  const { encode = (x: string) => x, validate = true } = options;\n\n  // Compile all the tokens into regexps.\n  const matches = tokens.map((token) => {\n    if (typeof token === \"object\") {\n      return new RegExp(`^(?:${token.pattern})$`, reFlags);\n    }\n  });\n\n  return (data: Record<string, any> | null | undefined) => {\n    let path = \"\";\n\n    for (let i = 0; i < tokens.length; i++) {\n      const token = tokens[i];\n\n      if (typeof token === \"string\") {\n        path += token;\n        continue;\n      }\n\n      const value = data ? data[token.name] : undefined;\n      const optional = token.modifier === \"?\" || token.modifier === \"*\";\n      const repeat = token.modifier === \"*\" || token.modifier === \"+\";\n\n      if (Array.isArray(value)) {\n        if (!repeat) {\n          throw new TypeError(\n            `Expected \"${token.name}\" to not repeat, but got an array`,\n          );\n        }\n\n        if (value.length === 0) {\n          if (optional) continue;\n\n          throw new TypeError(`Expected \"${token.name}\" to not be empty`);\n        }\n\n        for (let j = 0; j < value.length; j++) {\n          const segment = encode(value[j], token);\n\n          if (validate && !(matches[i] as RegExp).test(segment)) {\n            throw new TypeError(\n              `Expected all \"${token.name}\" to match \"${token.pattern}\", but got \"${segment}\"`,\n            );\n          }\n\n          path += token.prefix + segment + token.suffix;\n        }\n\n        continue;\n      }\n\n      if (typeof value === \"string\" || typeof value === \"number\") {\n        const segment = encode(String(value), token);\n\n        if (validate && !(matches[i] as RegExp).test(segment)) {\n          throw new TypeError(\n            `Expected \"${token.name}\" to match \"${token.pattern}\", but got \"${segment}\"`,\n          );\n        }\n\n        path += token.prefix + segment + token.suffix;\n        continue;\n      }\n\n      if (optional) continue;\n\n      const typeOfMessage = repeat ? \"an array\" : \"a string\";\n      throw new TypeError(`Expected \"${token.name}\" to be ${typeOfMessage}`);\n    }\n\n    return path;\n  };\n}\n\nexport interface RegexpToFunctionOptions {\n  /**\n   * Function for decoding strings for params.\n   */\n  decode?: (value: string, token: Key) => string;\n}\n\n/**\n * A match result contains data about the path match.\n */\nexport interface MatchResult<P extends object = object> {\n  path: string;\n  index: number;\n  params: P;\n}\n\n/**\n * A match is either `false` (no match) or a match result.\n */\nexport type Match<P extends object = object> = false | MatchResult<P>;\n\n/**\n * The match function takes a string and returns whether it matched the path.\n */\nexport type MatchFunction<P extends object = object> = (\n  path: string,\n) => Match<P>;\n\n/**\n * Create path match function from `path-to-regexp` spec.\n */\nexport function match<P extends object = object>(\n  str: Path,\n  options?: ParseOptions & TokensToRegexpOptions & RegexpToFunctionOptions,\n) {\n  const keys: Key[] = [];\n  const re = pathToRegexp(str, keys, options);\n  return regexpToFunction<P>(re, keys, options);\n}\n\n/**\n * Create a path match function from `path-to-regexp` output.\n */\nexport function regexpToFunction<P extends object = object>(\n  re: RegExp,\n  keys: Key[],\n  options: RegexpToFunctionOptions = {},\n): MatchFunction<P> {\n  const { decode = (x: string) => x } = options;\n\n  return function (pathname: string) {\n    const m = re.exec(pathname);\n    if (!m) return false;\n\n    const { 0: path, index } = m;\n    const params = Object.create(null);\n\n    for (let i = 1; i < m.length; i++) {\n      if (m[i] === undefined) continue;\n\n      const key = keys[i - 1];\n\n      if (key.modifier === \"*\" || key.modifier === \"+\") {\n        params[key.name] = m[i].split(key.prefix + key.suffix).map((value) => {\n          return decode(value, key);\n        });\n      } else {\n        params[key.name] = decode(m[i], key);\n      }\n    }\n\n    return { path, index, params };\n  };\n}\n\n/**\n * Escape a regular expression string.\n */\nfunction escapeString(str: string) {\n  return str.replace(/([.+*?=^!:${}()[\\]|/\\\\])/g, \"\\\\$1\");\n}\n\n/**\n * Get the flags for a regexp from the options.\n */\nfunction flags(options?: { sensitive?: boolean }) {\n  return options && options.sensitive ? \"\" : \"i\";\n}\n\n/**\n * Metadata about a key.\n */\nexport interface Key {\n  name: string | number;\n  prefix: string;\n  suffix: string;\n  pattern: string;\n  modifier: string;\n}\n\n/**\n * A token is a string (nothing special) or key metadata (capture group).\n */\nexport type Token = string | Key;\n\n/**\n * Pull out keys from a regexp.\n */\nfunction regexpToRegexp(path: RegExp, keys?: Key[]): RegExp {\n  if (!keys) return path;\n\n  const groupsRegex = /\\((?:\\?<(.*?)>)?(?!\\?)/g;\n\n  let index = 0;\n  let execResult = groupsRegex.exec(path.source);\n  while (execResult) {\n    keys.push({\n      // Use parenthesized substring match if available, index otherwise\n      name: execResult[1] || index++,\n      prefix: \"\",\n      suffix: \"\",\n      modifier: \"\",\n      pattern: \"\",\n    });\n    execResult = groupsRegex.exec(path.source);\n  }\n\n  return path;\n}\n\n/**\n * Transform an array into a regexp.\n */\nfunction arrayToRegexp(\n  paths: Array<string | RegExp>,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n): RegExp {\n  const parts = paths.map((path) => pathToRegexp(path, keys, options).source);\n  return new RegExp(`(?:${parts.join(\"|\")})`, flags(options));\n}\n\n/**\n * Create a path regexp from string input.\n */\nfunction stringToRegexp(\n  path: string,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n) {\n  return tokensToRegexp(parse(path, options), keys, options);\n}\n\nexport interface TokensToRegexpOptions {\n  /**\n   * When `true` the regexp will be case sensitive. (default: `false`)\n   */\n  sensitive?: boolean;\n  /**\n   * When `true` the regexp won't allow an optional trailing delimiter to match. (default: `false`)\n   */\n  strict?: boolean;\n  /**\n   * When `true` the regexp will match to the end of the string. (default: `true`)\n   */\n  end?: boolean;\n  /**\n   * When `true` the regexp will match from the beginning of the string. (default: `true`)\n   */\n  start?: boolean;\n  /**\n   * Sets the final character for non-ending optimistic matches. (default: `/`)\n   */\n  delimiter?: string;\n  /**\n   * List of characters that can also be \"end\" characters.\n   */\n  endsWith?: string;\n  /**\n   * Encode path tokens for use in the `RegExp`.\n   */\n  encode?: (value: string) => string;\n}\n\n/**\n * Expose a function for taking tokens and returning a RegExp.\n */\nexport function tokensToRegexp(\n  tokens: Token[],\n  keys?: Key[],\n  options: TokensToRegexpOptions = {},\n) {\n  const {\n    strict = false,\n    start = true,\n    end = true,\n    encode = (x: string) => x,\n    delimiter = \"/#?\",\n    endsWith = \"\",\n  } = options;\n  const endsWithRe = `[${escapeString(endsWith)}]|$`;\n  const delimiterRe = `[${escapeString(delimiter)}]`;\n  let route = start ? \"^\" : \"\";\n\n  // Iterate over the tokens and create our regexp string.\n  for (const token of tokens) {\n    if (typeof token === \"string\") {\n      route += escapeString(encode(token));\n    } else {\n      const prefix = escapeString(encode(token.prefix));\n      const suffix = escapeString(encode(token.suffix));\n\n      if (token.pattern) {\n        if (keys) keys.push(token);\n\n        if (prefix || suffix) {\n          if (token.modifier === \"+\" || token.modifier === \"*\") {\n            const mod = token.modifier === \"*\" ? \"?\" : \"\";\n            route += `(?:${prefix}((?:${token.pattern})(?:${suffix}${prefix}(?:${token.pattern}))*)${suffix})${mod}`;\n          } else {\n            route += `(?:${prefix}(${token.pattern})${suffix})${token.modifier}`;\n          }\n        } else {\n          if (token.modifier === \"+\" || token.modifier === \"*\") {\n            throw new TypeError(\n              `Can not repeat \"${token.name}\" without a prefix and suffix`,\n            );\n          }\n\n          route += `(${token.pattern})${token.modifier}`;\n        }\n      } else {\n        route += `(?:${prefix}${suffix})${token.modifier}`;\n      }\n    }\n  }\n\n  if (end) {\n    if (!strict) route += `${delimiterRe}?`;\n\n    route += !options.endsWith ? \"$\" : `(?=${endsWithRe})`;\n  } else {\n    const endToken = tokens[tokens.length - 1];\n    const isEndDelimited =\n      typeof endToken === \"string\"\n        ? delimiterRe.indexOf(endToken[endToken.length - 1]) > -1\n        : endToken === undefined;\n\n    if (!strict) {\n      route += `(?:${delimiterRe}(?=${endsWithRe}))?`;\n    }\n\n    if (!isEndDelimited) {\n      route += `(?=${delimiterRe}|${endsWithRe})`;\n    }\n  }\n\n  return new RegExp(route, flags(options));\n}\n\n/**\n * Supported `path-to-regexp` input types.\n */\nexport type Path = string | RegExp | Array<string | RegExp>;\n\n/**\n * Normalize the given path string, returning a regular expression.\n *\n * An empty array can be passed in for the keys, which will hold the\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\n */\nexport function pathToRegexp(\n  path: Path,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n) {\n  if (path instanceof RegExp) return regexpToRegexp(path, keys);\n  if (Array.isArray(path)) return arrayToRegexp(path, keys, options);\n  return stringToRegexp(path, keys, options);\n}\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "/**\n * @param pathname A pathname string, such as `/foo` or `/foo/bar`\n * @param routingRule The routing rule, such as `/foo/*`\n * @returns True if pathname matches the routing rule\n *\n * /       ->  /\n * /*      ->  /*\n * /foo    ->  /foo\n * /foo*   ->  /foo, /foo-bar, /foo/*\n * /foo/*  ->  /foo, /foo/bar\n */\nexport function isRoutingRuleMatch(\n\tpathname: string,\n\troutingRule: string\n): boolean {\n\t// sanity checks\n\tif (!pathname) {\n\t\tthrow new Error(\"Pathname is undefined.\");\n\t}\n\tif (!routingRule) {\n\t\tthrow new Error(\"Routing rule is undefined.\");\n\t}\n\n\tconst ruleRegExp = transformRoutingRuleToRegExp(routingRule);\n\treturn pathname.match(ruleRegExp) !== null;\n}\n\nfunction transformRoutingRuleToRegExp(rule: string): RegExp {\n\tlet transformedRule;\n\n\tif (rule === \"/\" || rule === \"/*\") {\n\t\ttransformedRule = rule;\n\t} else if (rule.endsWith(\"/*\")) {\n\t\t// make `/*` an optional group so we can match both /foo/* and /foo\n\t\t// /foo/* => /foo(/*)?\n\t\ttransformedRule = `${rule.substring(0, rule.length - 2)}(/*)?`;\n\t} else if (rule.endsWith(\"/\")) {\n\t\t// make `/` an optional group so we can match both /foo/ and /foo\n\t\t// /foo/ => /foo(/)?\n\t\ttransformedRule = `${rule.substring(0, rule.length - 1)}(/)?`;\n\t} else if (rule.endsWith(\"*\")) {\n\t\ttransformedRule = rule;\n\t} else {\n\t\ttransformedRule = `${rule}(/)?`;\n\t}\n\n\t// /foo* => /foo.* => ^/foo.*$\n\t// /*.* => /*\\.* => /.*\\..* => ^/.*\\..*$\n\ttransformedRule = `^${transformedRule\n\t\t.replaceAll(/\\./g, \"\\\\.\")\n\t\t.replaceAll(/\\*/g, \".*\")}$`;\n\n\t// ^/foo.*$ => /^\\/foo.*$/\n\treturn new RegExp(transformedRule);\n}\n", "{\n  \"version\": 1,\n  \"include\": [\n    \"/*\"\n  ],\n  \"exclude\": [\n    \"/assets/*\",\n    \"/images/*\",\n    \"/docs/*\",\n    \"/scripts/*\",\n    \"/components/*\",\n    \"/database/*\",\n    \"/superdesign/*\",\n    \"/claude-code-mcp/*\",\n    \"/pages/*\"\n  ]\n}", "// @ts-ignore entry point will get replaced\nimport worker from \"__ENTRY_POINT__\";\nimport { isRoutingRuleMatch } from \"./pages-dev-util\";\n\n// @ts-ignore entry point will get replaced\nexport * from \"__ENTRY_POINT__\";\n\n// @ts-ignore routes are injected\nconst routes = __ROUTES__;\n\nexport default <ExportedHandler<{ ASSETS: Fetcher }>>{\n\tfetch(request, env, context) {\n\t\tconst { pathname } = new URL(request.url);\n\n\t\tfor (const exclude of routes.exclude) {\n\t\t\tif (isRoutingRuleMatch(pathname, exclude)) {\n\t\t\t\treturn env.ASSETS.fetch(request);\n\t\t\t}\n\t\t}\n\n\t\tfor (const include of routes.include) {\n\t\t\tif (isRoutingRuleMatch(pathname, include)) {\n\t\t\t\tconst workerAsHandler = worker as ExportedHandler;\n\t\t\t\tif (workerAsHandler.fetch === undefined) {\n\t\t\t\t\tthrow new TypeError(\"Entry point missing `fetch` handler\");\n\t\t\t\t}\n\t\t\t\treturn workerAsHandler.fetch(request, env, context);\n\t\t\t}\n\t\t}\n\n\t\treturn env.ASSETS.fetch(request);\n\t},\n};\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"/home/lium/chatsvtr/.wrangler/tmp/pages-OJR4sx/hz10vb0iz8.js\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"/home/lium/chatsvtr/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"/home/lium/chatsvtr/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"/home/lium/chatsvtr/.wrangler/tmp/pages-OJR4sx/hz10vb0iz8.js\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"/home/lium/chatsvtr/.wrangler/tmp/bundle-TGYKaw/middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"/home/lium/chatsvtr/node_modules/wrangler/templates/middleware/common.ts\";\nimport type { WorkerEntrypointConstructor } from \"/home/lium/chatsvtr/.wrangler/tmp/bundle-TGYKaw/middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"/home/lium/chatsvtr/.wrangler/tmp/bundle-TGYKaw/middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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",
  "names": ["checkURL", "urls", "__name", "originalDomain", "stateData", "error", "createUserSession", "getCurrentDomain", "onRequestGet", "unifiedCallbackDomain", "onRequestOptions", "AWSEmailService", "match", "onRequestPost", "isValidEmail", "value", "_a", "result", "char", "prefix", "i", "routes", "drainBody", "middleware_ensure_req_body_drained_default", "reduceError", "jsonError", "middleware_miniflare3_json_error_default", "__INTERNAL_WRANGLER_MIDDLEWARE__", "middleware_ensure_req_body_drained_default", "middleware_miniflare3_json_error_default", "middleware_insertion_facade_default", "__facade_middleware__", "__facade_register__", "__facade_invokeChain__", "__facade_invoke__", "__facade_middleware__", "__Facade_ScheduledController__", "___Facade_ScheduledController__", "wrapExportedHandler", "__INTERNAL_WRANGLER_MIDDLEWARE__", "__facade_register__", "__facade_invoke__", "wrapWorkerEntrypoint", "WRAPPED_ENTRY", "middleware_insertion_facade_default", "middleware_loader_entry_default"]
}
