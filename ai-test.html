<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæ¨¡å‹è°ƒç”¨æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-area {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #007bff;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        #results {
            margin: 20px 0;
            padding: 15px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            min-height: 200px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª SVTR.AI æ¨¡å‹è°ƒç”¨æµ‹è¯•</h1>
        <p>æµ‹è¯•èŠå¤©APIæ˜¯å¦çœŸçš„åœ¨è°ƒç”¨Cloudflare AIæ¨¡å‹</p>

        <div class="test-area">
            <h3>æµ‹è¯•é—®é¢˜</h3>
            <p>æˆ‘ä»¬å°†å‘é€ä»¥ä¸‹é—®é¢˜æ¥æµ‹è¯•AIæ¨¡å‹çš„å“åº”è´¨é‡ï¼š</p>
            <ul>
                <li><strong>ç®€å•æµ‹è¯•</strong>ï¼šAnthropicçš„æŠ•èµ„æƒ…å†µå¦‚ä½•ï¼Ÿ</li>
                <li><strong>ä¸“ä¸šæµ‹è¯•</strong>ï¼šè¯¦ç»†åˆ†æOpenAIçš„å•†ä¸šæ¨¡å¼å’Œç«äº‰ä¼˜åŠ¿</li>
                <li><strong>æ•°æ®æµ‹è¯•</strong>ï¼šScale AIå‡†å¤‡IPOäº†å—ï¼Ÿç»™å‡ºå…·ä½“æ•°æ®</li>
            </ul>
            
            <button onclick="testSimple()">æµ‹è¯•1: ç®€å•é—®é¢˜</button>
            <button onclick="testProfessional()">æµ‹è¯•2: ä¸“ä¸šåˆ†æ</button>
            <button onclick="testData()">æµ‹è¯•3: æ•°æ®æŸ¥è¯¢</button>
            <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        </div>

        <div id="status" class="status info">
            å‡†å¤‡æµ‹è¯•...
        </div>

        <div id="results">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•</div>
    </div>

    <script>
        let currentTest = 0;

        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.className = `status ${type}`;
            status.textContent = message;
        }

        function appendResults(text) {
            const results = document.getElementById('results');
            results.textContent += text;
            results.scrollTop = results.scrollHeight;
        }

        function clearResults() {
            document.getElementById('results').textContent = '';
            updateStatus('å·²æ¸…é™¤ç»“æœï¼Œå‡†å¤‡æ–°æµ‹è¯•');
        }

        async function testAPI(question, testName) {
            currentTest++;
            const testId = currentTest;
            
            updateStatus(`æ­£åœ¨æ‰§è¡Œ${testName}...`, 'info');
            appendResults(`\n=== ${testName} (æµ‹è¯• #${testId}) ===\n`);
            appendResults(`é—®é¢˜: ${question}\n`);
            appendResults(`æ—¶é—´: ${new Date().toLocaleTimeString()}\n`);
            appendResults(`çŠ¶æ€: å‘é€è¯·æ±‚...\n\n`);

            try {
                const startTime = Date.now();
                
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        messages: [
                            { role: 'user', content: question }
                        ]
                    })
                });

                appendResults(`å“åº”çŠ¶æ€: ${response.status}\n`);
                appendResults(`å“åº”å¤´: ${response.headers.get('content-type')}\n\n`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                if (response.headers.get('content-type')?.includes('text/event-stream')) {
                    appendResults('AIå›å¤:\n---\n');
                    
                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let fullResponse = '';
                    let hasRealContent = false;

                    while (true) {
                        const { done, value } = await reader.read();
                        if (done) break;

                        const chunk = decoder.decode(value);
                        const lines = chunk.split('\n');

                        for (const line of lines) {
                            if (line.startsWith('data: ') && !line.includes('[DONE]')) {
                                try {
                                    const data = JSON.parse(line.slice(6));
                                    let content = '';
                                    
                                    if (data.response) {
                                        content = data.response;
                                    } else if (data.delta?.content) {
                                        content = data.delta.content;
                                    }
                                    
                                    if (content) {
                                        appendResults(content);
                                        fullResponse += content;
                                        hasRealContent = true;
                                    }
                                } catch (e) {
                                    // å¿½ç•¥è§£æé”™è¯¯
                                }
                            }
                        }
                    }

                    const endTime = Date.now();
                    const duration = endTime - startTime;

                    appendResults(`\n---\n`);
                    appendResults(`å“åº”æ—¶é—´: ${duration}ms\n`);
                    appendResults(`å“åº”é•¿åº¦: ${fullResponse.length} å­—ç¬¦\n`);

                    // åˆ†æå“åº”è´¨é‡
                    const hasSpecificData = fullResponse.includes('äº¿ç¾å…ƒ') || 
                                          fullResponse.includes('ä¼°å€¼') || 
                                          fullResponse.includes('èèµ„');
                    
                    const hasAIAnalysis = fullResponse.includes('åˆ†æ') || 
                                        fullResponse.includes('å»ºè®®') ||
                                        fullResponse.includes('è¯„ä¼°') ||
                                        fullResponse.includes('è§‚å¯Ÿ');

                    const hasRAGInfo = fullResponse.includes('åŸºäºSVTRçŸ¥è¯†åº“') ||
                                      fullResponse.includes('é£ä¹¦çŸ¥è¯†åº“') ||
                                      fullResponse.includes('ç½®ä¿¡åº¦');

                    appendResults(`\nè´¨é‡åˆ†æ:\n`);
                    appendResults(`- åŒ…å«å…·ä½“æ•°æ®: ${hasSpecificData ? 'âœ…' : 'âŒ'}\n`);
                    appendResults(`- å…·å¤‡ä¸“ä¸šåˆ†æ: ${hasAIAnalysis ? 'âœ…' : 'âŒ'}\n`);
                    appendResults(`- æ˜¾ç¤ºRAGæ¥æº: ${hasRAGInfo ? 'âœ…' : 'âŒ'}\n`);
                    appendResults(`- å“åº”é•¿åº¦å……åˆ†: ${fullResponse.length > 200 ? 'âœ…' : 'âŒ'}\n`);

                    if (hasSpecificData && hasAIAnalysis && fullResponse.length > 200) {
                        updateStatus(`${testName} æˆåŠŸ - AIæ¨¡å‹æ­£å¸¸å·¥ä½œï¼`, 'success');
                        appendResults(`\nç»“è®º: âœ… ç¡®è®¤è¿™æ˜¯çœŸæ­£çš„AIæ¨¡å‹å“åº”ï¼\n`);
                    } else if (fullResponse.length < 50 || fullResponse.includes('æ¼”ç¤º')) {
                        updateStatus(`${testName} å¯ç–‘ - å¯èƒ½æ˜¯æ¼”ç¤ºæ¨¡å¼`, 'warning');
                        appendResults(`\nç»“è®º: âš ï¸ å“åº”å¯èƒ½æ¥è‡ªæ¼”ç¤ºæ¨¡å¼ï¼ŒéçœŸæ­£AIæ¨¡å‹\n`);
                    } else {
                        updateStatus(`${testName} éƒ¨åˆ†æˆåŠŸ - éœ€è¦è¿›ä¸€æ­¥éªŒè¯`, 'warning');
                        appendResults(`\nç»“è®º: ğŸ¤” å“åº”è´¨é‡ä¸€èˆ¬ï¼Œå¯èƒ½æ˜¯åŸºç¡€AIæ¨¡å‹\n`);
                    }

                } else {
                    const data = await response.json();
                    appendResults('JSONå“åº”:\n');
                    appendResults(JSON.stringify(data, null, 2));
                    
                    if (data.error || data.fallback) {
                        updateStatus(`${testName} å¤±è´¥ - ç³»ç»Ÿå›é€€åˆ°æ¼”ç¤ºæ¨¡å¼`, 'error');
                        appendResults(`\nç»“è®º: âŒ æœªè°ƒç”¨AIæ¨¡å‹ï¼Œä½¿ç”¨äº†æ¼”ç¤ºå“åº”\n`);
                    }
                }

            } catch (error) {
                updateStatus(`${testName} é”™è¯¯: ${error.message}`, 'error');
                appendResults(`\né”™è¯¯: ${error.message}\n`);
            }

            appendResults(`\n${'='.repeat(60)}\n`);
        }

        function testSimple() {
            testAPI('Anthropicçš„æŠ•èµ„æƒ…å†µå¦‚ä½•ï¼Ÿ', 'ç®€å•æµ‹è¯•');
        }

        function testProfessional() {
            testAPI('è¯¦ç»†åˆ†æOpenAIçš„å•†ä¸šæ¨¡å¼å’Œç«äº‰ä¼˜åŠ¿ï¼ŒåŒ…æ‹¬æ”¶å…¥ç»“æ„ã€æŠ€æœ¯æŠ¤åŸæ²³å’Œé¢ä¸´çš„æŒ‘æˆ˜', 'ä¸“ä¸šåˆ†ææµ‹è¯•');
        }

        function testData() {
            testAPI('Scale AIå‡†å¤‡IPOäº†å—ï¼Ÿç»™å‡ºå…·ä½“çš„èèµ„æ•°æ®ã€ä¼°å€¼å’Œæ—¶é—´è®¡åˆ’', 'æ•°æ®æŸ¥è¯¢æµ‹è¯•');
        }
    </script>
</body>
</html>