<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿäº§ç¯å¢ƒæ•°å­—æ˜¾ç¤ºè°ƒè¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { border: 1px solid #ccc; margin: 10px 0; padding: 15px; }
        .debug-output { background: #f5f5f5; padding: 10px; font-family: monospace; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>ğŸ” ç”Ÿäº§ç¯å¢ƒæ•°å­—æ˜¾ç¤ºè°ƒè¯•</h1>

    <div class="test-section">
        <h3>1. åŸºç¡€æ•°å­—æ¸²æŸ“æµ‹è¯•</h3>
        <p>HTMLä¸­çš„æ•°å­—ï¼š1+1=2, 2024å¹´, 500äº¿ç¾å…ƒ, 45%</p>
        <div id="js-numbers">ç­‰å¾…JavaScript...</div>
    </div>

    <div class="test-section">
        <h3>2. æ¨¡æ‹ŸèŠå¤©æ ¼å¼åŒ–æµ‹è¯•</h3>
        <div id="formatted-test">ç­‰å¾…æ ¼å¼åŒ–...</div>
    </div>

    <div class="test-section">
        <h3>3. æ•°å­¦é—®é¢˜åŒ¹é…æµ‹è¯•</h3>
        <div id="math-match-test">ç­‰å¾…æµ‹è¯•...</div>
    </div>

    <div class="test-section">
        <h3>4. å­—ä½“æ¸²æŸ“æ£€æµ‹</h3>
        <div style="font-family: system-ui;">system-ui: 1234567890</div>
        <div style="font-family: Arial;">Arial: 1234567890</div>
        <div style="font-family: 'Helvetica Neue';">Helvetica Neue: 1234567890</div>
    </div>

    <div class="debug-output" id="debug-log">
        è°ƒè¯•æ—¥å¿—ï¼š<br>
    </div>

    <script>
        function log(message) {
            const debugLog = document.getElementById('debug-log');
            debugLog.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
        }

        // æµ‹è¯•1: JSæ•°å­—æ’å…¥
        document.getElementById('js-numbers').innerHTML = 'JSæ’å…¥æ•°å­—: 1+1=2, 2024å¹´, 500äº¿ç¾å…ƒ, 45%';
        log('âœ… åŸºç¡€æ•°å­—æ’å…¥å®Œæˆ');

        // æµ‹è¯•2: æ¨¡æ‹ŸformatMessageå‡½æ•°
        function formatMessage(content) {
            return content
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/\n/g, '<br>')
                .replace(/â€¢/g, 'â€¢');
        }

        const testContent = "â€¢ **ç®€å•æ•°å­¦**ï¼š1+1=2 âœ“\\nâ€¢ **èµ„é‡‘è§„æ¨¡**ï¼š2024å¹´AIåˆåˆ›å…¬å¸èèµ„è¶…è¿‡500äº¿ç¾å…ƒ";
        const formatted = formatMessage(testContent);
        document.getElementById('formatted-test').innerHTML = formatted;
        log('âœ… æ ¼å¼åŒ–æµ‹è¯•: ' + (formatted.includes('1+1=2') ? 'åŒ…å«æ•°å­—' : 'âŒ æ•°å­—ä¸¢å¤±'));

        // æµ‹è¯•3: æ•°å­¦é—®é¢˜åŒ¹é…
        function testMathMatching(input) {
            const mathPattern = /^\\s*\\d+\\s*[\\+\\-\\*\\/\\=\\(\\)]+\\s*\\d*\\s*\\=?\\s*$/;
            const hasNumbers = /\\d/.test(input);
            const isMathQuestion = mathPattern.test(input);
            
            return {
                input: input,
                hasNumbers: hasNumbers,
                isMathQuestion: isMathQuestion,
                pattern: mathPattern.toString()
            };
        }

        const mathTests = ['1+1=', '2+2=4', 'hello', '2024å¹´'];
        let mathResults = mathTests.map(testMathMatching);
        
        document.getElementById('math-match-test').innerHTML = mathResults.map(r => 
            `è¾“å…¥: "${r.input}" | åŒ…å«æ•°å­—: ${r.hasNumbers} | æ•°å­¦é—®é¢˜: ${r.isMathQuestion}`
        ).join('<br>');

        // æµ‹è¯•4: æ£€æµ‹å®é™…ä½¿ç”¨çš„å­—ä½“
        setTimeout(() => {
            const testElement = document.createElement('div');
            testElement.style.font = 'system-ui';
            testElement.textContent = '1234567890';
            document.body.appendChild(testElement);
            
            const computedStyle = window.getComputedStyle(testElement);
            log('ğŸ”¤ å®é™…å­—ä½“: ' + computedStyle.fontFamily);
            log('ğŸ“ å­—ç¬¦å®½åº¦: ' + testElement.offsetWidth + 'px');
            
            document.body.removeChild(testElement);
        }, 100);

        // æµ‹è¯•5: æ£€æŸ¥ç”Ÿäº§ç¯å¢ƒæ–‡ä»¶
        fetch('/assets/js/chat-optimized.js')
            .then(response => response.text())
            .then(content => {
                const hasMathQuestion = content.includes('math_question');
                const hasNumberRegex = content.includes('\\\\d+');
                log('ğŸ“ ç”Ÿäº§æ–‡ä»¶æ£€æŸ¥:');
                log('  - åŒ…å«math_question: ' + (hasMathQuestion ? 'âœ…' : 'âŒ'));
                log('  - åŒ…å«æ•°å­—æ­£åˆ™: ' + (hasNumberRegex ? 'âœ…' : 'âŒ'));
                log('  - æ–‡ä»¶å¤§å°: ' + Math.round(content.length/1024) + 'KB');
            })
            .catch(err => {
                log('âŒ æ— æ³•åŠ è½½ç”Ÿäº§æ–‡ä»¶: ' + err.message);
            });

        log('ğŸš€ æ‰€æœ‰æµ‹è¯•å¯åŠ¨å®Œæˆ');
    </script>
</body>
</html>