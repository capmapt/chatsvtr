<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试项目提交表单</title>
    <style>
        :root {
            --primary-color: #FA8C32;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f7fa;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .test-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 0;
            display: inline-block;
        }
        
        .test-btn:hover {
            background: #e17a28;
        }
        
        .result {
            background: #f8f9fa;
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            margin: 15px 0;
        }
        
        .success {
            border-left-color: #4caf50;
            background: #f1f8e9;
        }
        
        .error {
            border-left-color: #f44336;
            background: #ffebee;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🧪 项目提交功能测试</h1>
        
        <div class="result">
            <strong>测试目标:</strong><br>
            ✅ 项目需求多选功能<br>
            ✅ 文件上传功能<br>
            ✅ API数据提交<br>
            ✅ 管理中心数据显示<br>
        </div>
        
        <button class="test-btn" onclick="testProjectSubmission()">🚀 打开项目提交表单</button>
        <button class="test-btn" onclick="testAPIConnection()">🔗 测试API连接</button>
        <button class="test-btn" onclick="checkAdminCenter()">📊 查看管理中心</button>
        
        <div id="testResults"></div>
        
        <h2>📋 功能说明</h2>
        <ul>
            <li><strong>项目需求:</strong> 支持多选 "找人"、"找钱"、"找方向"、"其他"</li>
            <li><strong>文件上传:</strong> 支持拖拽上传，最多5个文件，每个最大10MB</li>
            <li><strong>支持格式:</strong> PDF, DOC, PPT, TXT, JPG, PNG</li>
            <li><strong>数据同步:</strong> 提交后立即在管理中心显示</li>
        </ul>
        
        <h2>🔧 技术实现</h2>
        <ul>
            <li>前端表单增强: checkbox多选 + 文件拖拽</li>
            <li>API数据结构: needs数组 + files数组</li>
            <li>管理界面优化: 新增需求列和附件列</li>
            <li>实时数据同步: KV存储 + 刷新按钮</li>
        </ul>
    </div>

    <!-- 引入header-enhancements.js以使用项目提交功能 -->
    <script>
        // 模拟header-enhancements.js的项目提交功能
        function testProjectSubmission() {
            // 直接重定向到主页并触发项目提交
            window.location.href = '/#submit-project';
        }
        
        async function testAPIConnection() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<div class="result">正在测试API连接...</div>';
            
            try {
                // 测试统计API
                const statsResponse = await fetch('/api/projects?action=stats');
                const statsData = await statsResponse.json();
                
                // 测试列表API
                const listResponse = await fetch('/api/projects?action=list');
                const listData = await listResponse.json();
                
                resultsDiv.innerHTML = `
                    <div class="result success">
                        <h3>✅ API连接测试成功!</h3>
                        <p><strong>项目统计:</strong> 总计 ${statsData.totalProjects} 个项目，待审核 ${statsData.pendingProjects} 个</p>
                        <p><strong>项目列表:</strong> 成功获取 ${listData.length} 个项目记录</p>
                        <details>
                            <summary>详细数据 (点击展开)</summary>
                            <pre>${JSON.stringify(statsData, null, 2)}</pre>
                        </details>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="result error">
                        <h3>❌ API连接失败</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        function checkAdminCenter() {
            window.open('/pages/admin-center.html', '_blank');
        }
        
        // 自动运行API测试
        window.addEventListener('load', () => {
            setTimeout(testAPIConnection, 1000);
        });
    </script>
</body>
</html>