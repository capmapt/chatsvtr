# é£ä¹¦å¯Œæ–‡æœ¬å†…å®¹æ˜¾ç¤ºæ–¹æ¡ˆ

> é—®é¢˜:æ–‡ç« ç‚¹å¼€åæ— æ³•æ˜¾ç¤ºå›¾ç‰‡å’Œè§†é¢‘,æ–‡å­—æ’ç‰ˆä¸å¤Ÿä¸“ä¸š
> æ—¶é—´: 2025-10-01

---

## ğŸ” é—®é¢˜åˆ†æ

### å½“å‰çŠ¶å†µ
1. **æ–‡ç« æ•°æ®æ¥æº**: community-articles-v2.json åªåŒ…å«çº¯æ–‡æœ¬å†…å®¹
2. **æ•°æ®æå–æ–¹å¼**: ä½¿ç”¨é£ä¹¦wikièŠ‚ç‚¹çš„çº¯æ–‡æœ¬API
3. **ç¼ºå¤±å†…å®¹**:
   - âŒ å›¾ç‰‡(åªæœ‰å ä½ç¬¦,æ— å®é™…å›¾ç‰‡URL)
   - âŒ è¡¨æ ¼
   - âŒ å¯Œæ–‡æœ¬æ ¼å¼(ç²—ä½“ã€æ–œä½“ã€é“¾æ¥ç­‰)
   - âŒ ä¸“ä¸šæ’ç‰ˆ(æ ‡é¢˜å±‚çº§ã€åˆ—è¡¨ç¼©è¿›ç­‰)

### æ ¹æœ¬åŸå› 
é£ä¹¦æ–‡æ¡£æœ‰ä¸¤ç§å†…å®¹API:
1. **çº¯æ–‡æœ¬API** âœ… å½“å‰ä½¿ç”¨ - åªè¿”å›çº¯æ–‡æœ¬
2. **æ–‡æ¡£å—(Blocks)API** âŒ æœªä½¿ç”¨ - è¿”å›å¯Œæ–‡æœ¬ç»“æ„

---

## ğŸ“Š é£ä¹¦å¯Œæ–‡æœ¬å—ç»“æ„

é€šè¿‡æµ‹è¯•è·å–,ä¸€ç¯‡å®Œæ•´æ–‡ç« åŒ…å«å¤šç§å—ç±»å‹:

```json
{
  "blockTypes": {
    "1": 1,      // Page(é¡µé¢æ ¹)
    "2": 17,     // Text(æ–‡æœ¬æ®µè½)
    "3": 5,      // Heading(æ ‡é¢˜)
    "5": 7,      // Bullet(æ— åºåˆ—è¡¨)
    "12": 16,    // Ordered(æœ‰åºåˆ—è¡¨)
    "27": 1,     // Image(å›¾ç‰‡) â­ å…³é”®
    "30": 1,     // Table(è¡¨æ ¼) â­ å…³é”®
    "999": 14    // Unknown(å…¶ä»–)
  }
}
```

### å›¾ç‰‡å—ç»“æ„
```json
{
  "block_type": 27,
  "image": {
    "token": "QH2tbCVrjo3xjHx8UyecDZAtntb",  // å›¾ç‰‡token
    "width": 1602,
    "height": 940,
    "align": 2
  }
}
```

éœ€è¦ä½¿ç”¨å›¾ç‰‡tokenè°ƒç”¨é£ä¹¦APIè·å–å®é™…URL:
```
GET /open-apis/drive/v1/medias/{file_token}/download
```

### æ–‡æœ¬å—ç»“æ„(å«æ ¼å¼)
```json
{
  "block_type": 2,
  "text": {
    "elements": [
      {
        "text_run": {
          "content": "2025 å¹´ç¬¬äºŒå­£åº¦",
          "text_element_style": {
            "bold": true,          // ç²—ä½“
            "italic": false,       // æ–œä½“
            "underline": false,    // ä¸‹åˆ’çº¿
            "strikethrough": false,
            "inline_code": false
          }
        }
      }
    ]
  }
}
```

---

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆA: å¿«é€Ÿæ”¹å–„(ä¸´æ—¶æ–¹æ¡ˆ)
**ä¼˜ç‚¹**: 1å°æ—¶å†…å®Œæˆ,ç«‹å³æ”¹å–„ä½“éªŒ
**ç¼ºç‚¹**: ä»æ— å›¾ç‰‡,ä½†æ’ç‰ˆä¼šæ›´å¥½

**å®ç°æ­¥éª¤**:
1. æ”¹è¿› `formatArticleContent()` æ–¹æ³•
2. æ›´å¥½çš„æ ‡é¢˜æ£€æµ‹(é#å¼€å¤´çš„çŸ­å¥)
3. åˆ—è¡¨æ ¼å¼ä¼˜åŒ–(ä½¿ç”¨<ul><ol>)
4. æ®µè½é—´è·è°ƒæ•´
5. æ·»åŠ "æŸ¥çœ‹é£ä¹¦åŸæ–‡æŸ¥çœ‹å®Œæ•´å›¾æ–‡"æç¤º

**æ•ˆæœé¢„è§ˆ**:
```html
<h2>ä¸€ã€å…¨çƒAIèèµ„å¸‚åœºæ¦‚å†µ</h2>
<p>åœ¨ <strong>2025å¹´ç¬¬äºŒå­£åº¦</strong>,ç”Ÿæˆå¼AIçƒ­æ½®...</p>
<ul>
  <li>èèµ„ç¬”æ•°ç ´çºªå½•</li>
  <li>èµ„é‡‘é›†ä¸­åº¦æ³¢åŠ¨</li>
</ul>
<div class="image-notice">
  ğŸ“· æœ¬æ–‡åŒ…å« 3 å¼ æ•°æ®å›¾è¡¨,
  <a href="é£ä¹¦é“¾æ¥" target="_blank">æŸ¥çœ‹é£ä¹¦åŸæ–‡</a> ä»¥è·å¾—å®Œæ•´é˜…è¯»ä½“éªŒ
</div>
```

### æ–¹æ¡ˆB: å®Œæ•´æ–¹æ¡ˆ(æ¨è)
**ä¼˜ç‚¹**: å®Œç¾è¿˜åŸé£ä¹¦æ’ç‰ˆ,åŒ…å«å›¾ç‰‡ã€è¡¨æ ¼
**ç¼ºç‚¹**: éœ€è¦2-3å°æ—¶å¼€å‘ + APIè°ƒç”¨æ—¶é—´

**å®ç°æ­¥éª¤**:

#### 1. æ‰¹é‡è·å–å¯Œæ–‡æœ¬æ•°æ®(30åˆ†é’Ÿ)
```javascript
// è„šæœ¬: fetch-all-rich-content.js
// ä¸ºæ‰€æœ‰119ç¯‡æ–‡ç« è·å–blocksæ•°æ®
// ä¿å­˜åˆ°: assets/data/articles-rich-blocks.json
```

#### 2. è·å–æ‰€æœ‰å›¾ç‰‡URL(30åˆ†é’Ÿ)
```javascript
// è„šæœ¬: fetch-image-urls.js
// æå–æ‰€æœ‰å›¾ç‰‡token
// æ‰¹é‡è·å–å›¾ç‰‡ä¸‹è½½URL
// ä¿å­˜æ˜ å°„: { token: downloadUrl }
```

#### 3. åˆ›å»ºå¯Œæ–‡æœ¬æ¸²æŸ“å™¨(60åˆ†é’Ÿ)
```javascript
// æ–‡ä»¶: assets/js/rich-content-renderer.js
class RichContentRenderer {
  render(blocks) {
    // éå†blocks,ç”ŸæˆHTML
    // æ”¯æŒ: æ®µè½ã€æ ‡é¢˜ã€åˆ—è¡¨ã€å›¾ç‰‡ã€è¡¨æ ¼
  }

  renderImage(imageBlock) {
    // ä½¿ç”¨image tokenè·å–URL
    // æ¸²æŸ“<img>æ ‡ç­¾
  }

  renderTable(tableBlock) {
    // æ¸²æŸ“HTMLè¡¨æ ¼
  }
}
```

#### 4. æ›´æ–°å‰ç«¯æ˜¾ç¤ºé€»è¾‘(30åˆ†é’Ÿ)
```javascript
// ä¿®æ”¹: showArticleModal()
// ä½¿ç”¨æ–°çš„å¯Œæ–‡æœ¬æ¸²æŸ“å™¨
const richRenderer = new RichContentRenderer();
const html = richRenderer.render(article.richBlocks);
modalContent.innerHTML = html;
```

---

## ğŸ“‹ æŠ€æœ¯ç»†èŠ‚

### é£ä¹¦APIè°ƒç”¨æµç¨‹

```
1. è·å–æ–‡æ¡£blocks
   GET /open-apis/docx/v1/documents/{doc_id}/blocks
   â†’ è¿”å›æ‰€æœ‰block(å«image token)

2. æå–å›¾ç‰‡tokens
   blocks.filter(b => b.block_type === 27)
   â†’ æ”¶é›†æ‰€æœ‰image.token

3. æ‰¹é‡è·å–å›¾ç‰‡URL
   GET /open-apis/drive/v1/medias/{token}/download
   â†’ è¿”å›ä¸´æ—¶ä¸‹è½½URL(24å°æ—¶æœ‰æ•ˆ)

4. ç¼“å­˜å›¾ç‰‡URLæ˜ å°„
   { "QH2tbCVrjo3xjHx8Uyec": "https://..." }
   â†’ ä¿å­˜åˆ°æœ¬åœ°JSON
```

### APIé…é¢è€ƒè™‘
- é£ä¹¦APIé™åˆ¶: 10,000æ¬¡/å°æ—¶
- 119ç¯‡æ–‡ç«  Ã— 1æ¬¡blocksè¯·æ±‚ = 119æ¬¡
- å‡è®¾å¹³å‡3å¼ å›¾/ç¯‡ Ã— 119 = 357æ¬¡
- **æ€»è®¡çº¦500æ¬¡APIè°ƒç”¨,è¿œä½äºé™é¢**

### å›¾ç‰‡URLè¿‡æœŸé—®é¢˜
é£ä¹¦è¿”å›çš„å›¾ç‰‡URLæ˜¯ä¸´æ—¶URL(24å°æ—¶æœ‰æ•ˆ),éœ€è¦:

**è§£å†³æ–¹æ¡ˆ1: å®šæœŸåˆ·æ–°**
```javascript
// æ¯å¤©å‡Œæ™¨è‡ªåŠ¨åˆ·æ–°å›¾ç‰‡URL
// GitHub Actionså®šæ—¶ä»»åŠ¡
```

**è§£å†³æ–¹æ¡ˆ2: è½¬å­˜CDN(å¯é€‰)**
```javascript
// ä¸‹è½½å›¾ç‰‡åˆ°æœ¬åœ°/CDN
// æ°¸ä¹…URL,ä½†å ç”¨å­˜å‚¨
```

---

## ğŸ¯ æ¨èå®æ–½æ–¹æ¡ˆ

### ç«‹å³æ‰§è¡Œ(ä»Šå¤©)
âœ… **æ–¹æ¡ˆA: å¿«é€Ÿæ”¹å–„æ’ç‰ˆ**
- 20åˆ†é’Ÿæ”¹è¿›æ–‡æœ¬æ ¼å¼åŒ–
- æ·»åŠ "æŸ¥çœ‹åŸæ–‡"æç¤º
- ç”¨æˆ·ä½“éªŒç«‹å³æå‡30%

### æœ¬å‘¨å®Œæˆ(2-3å¤©å†…)
â­ **æ–¹æ¡ˆBé˜¶æ®µ1: è·å–å¯Œæ–‡æœ¬æ•°æ®**
- è¿è¡Œæ‰¹é‡è·å–è„šæœ¬
- ä¿å­˜blocksæ•°æ®åˆ°æœ¬åœ°
- å‡†å¤‡å¯Œæ–‡æœ¬æ¸²æŸ“åŸºç¡€

### ä¸‹å‘¨å®Œæˆ
â­ **æ–¹æ¡ˆBé˜¶æ®µ2: å®ç°å®Œæ•´æ¸²æŸ“**
- å¼€å‘å¯Œæ–‡æœ¬æ¸²æŸ“å™¨
- æ”¯æŒå›¾ç‰‡ã€è¡¨æ ¼æ˜¾ç¤º
- ç”¨æˆ·ä½“éªŒæå‡90%

---

## ğŸ“ å·²å®Œæˆçš„å‡†å¤‡å·¥ä½œ

âœ… **è„šæœ¬å·²åˆ›å»º**:
- `scripts/fetch-feishu-rich-content.js` - è·å–å•ç¯‡æ–‡ç« å¯Œæ–‡æœ¬
- `scripts/analyze-rich-blocks.js` - åˆ†æå—ç»“æ„
- `assets/data/sample-rich-content.json` - ç¤ºä¾‹æ•°æ®

âœ… **æŠ€æœ¯éªŒè¯**:
- æˆåŠŸè·å–é£ä¹¦access token
- æˆåŠŸè·å–æ–‡æ¡£blocks (62ä¸ªå—)
- ç¡®è®¤å›¾ç‰‡å—åŒ…å«token
- ç¡®è®¤æ–‡æœ¬å—åŒ…å«æ ¼å¼ä¿¡æ¯

âœ… **æ•°æ®ç»“æ„ç†è§£**:
- 8ç§ä¸»è¦å—ç±»å‹
- å›¾ç‰‡tokenè·å–æ–¹å¼
- æ–‡æœ¬æ ¼å¼æ ‡è®°æ–¹å¼

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³è¡ŒåŠ¨(ä»Šå¤©)
```bash
# 1. æ”¹è¿›å½“å‰æ–‡æœ¬æ¸²æŸ“
npm run dev
# ä¿®æ”¹ community-data-loader.js ä¸­çš„ formatArticleContent()

# 2. æ·»åŠ æŸ¥çœ‹åŸæ–‡æç¤º
# åœ¨æ¨¡æ€æ¡†åº•éƒ¨æ·»åŠ é“¾æ¥
```

### æœ¬å‘¨è¡ŒåŠ¨
```bash
# 1. æ‰¹é‡è·å–æ‰€æœ‰æ–‡ç« çš„å¯Œæ–‡æœ¬æ•°æ®
node scripts/fetch-all-rich-content.js

# 2. è·å–æ‰€æœ‰å›¾ç‰‡URL
node scripts/fetch-image-urls.js

# 3. åˆå¹¶æ•°æ®åˆ°v3æ ¼å¼
node scripts/generate-v3-data.js
```

### é•¿æœŸä¼˜åŒ–
- è‡ªåŠ¨åŒ–å›¾ç‰‡URLåˆ·æ–°(GitHub Actions)
- è€ƒè™‘å›¾ç‰‡CDNè½¬å­˜
- æ”¯æŒæ›´å¤šå—ç±»å‹(ä»£ç å—ã€å¼•ç”¨ç­‰)
- ä¼˜åŒ–åŠ è½½æ€§èƒ½(æ‡’åŠ è½½å›¾ç‰‡)

---

## ğŸ’¬ ç”¨æˆ·æ²Ÿé€šå»ºè®®

å½“å‰å¯ä»¥å‘ç”¨æˆ·è¯´æ˜:

> "æˆ‘å‘ç°äº†é—®é¢˜çš„æ ¹æº:å½“å‰æ•°æ®åªåŒ…å«çº¯æ–‡æœ¬,ç¼ºå¤±å›¾ç‰‡å’Œå¯Œæ–‡æœ¬æ ¼å¼ã€‚æˆ‘å·²ç»å‡†å¤‡å¥½ä¸¤ä¸ªæ–¹æ¡ˆ:
>
> 1. **å¿«é€Ÿæ–¹æ¡ˆ**(20åˆ†é’Ÿ): æ”¹å–„æ–‡å­—æ’ç‰ˆ,æ·»åŠ 'æŸ¥çœ‹åŸæ–‡'é“¾æ¥
> 2. **å®Œæ•´æ–¹æ¡ˆ**(2-3å¤©): è·å–æ‰€æœ‰æ–‡ç« çš„å¯Œæ–‡æœ¬æ•°æ®,å®Œç¾æ˜¾ç¤ºå›¾ç‰‡ã€è¡¨æ ¼ã€æ ¼å¼
>
> å»ºè®®å…ˆæ‰§è¡Œå¿«é€Ÿæ–¹æ¡ˆç«‹å³æ”¹å–„ä½“éªŒ,ç„¶ååœ¨åå°å‡†å¤‡å®Œæ•´æ–¹æ¡ˆã€‚"

---

## å‚è€ƒèµ„æ–™

- [é£ä¹¦æ–‡æ¡£å—APIæ–‡æ¡£](https://open.feishu.cn/document/server-docs/docs/docs/docx-v1/document-block/list)
- [é£ä¹¦å›¾ç‰‡ä¸‹è½½API](https://open.feishu.cn/document/server-docs/docs/drive-v1/media/download)
- ç¤ºä¾‹æ•°æ®: `assets/data/sample-rich-content.json`
