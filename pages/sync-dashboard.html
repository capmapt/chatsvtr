<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVTR.AI çŸ¥è¯†åº“åŒæ­¥çŠ¶æ€</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .status-card { background: white; border-radius: 8px; padding: 20px; margin: 15px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .status-good { border-left: 4px solid #28a745; }
        .status-warning { border-left: 4px solid #ffc107; }
        .status-error { border-left: 4px solid #dc3545; }
        .metric { display: inline-block; margin: 10px 20px 10px 0; }
        .metric-value { font-size: 2em; font-weight: bold; color: #007bff; }
        .metric-label { color: #666; font-size: 0.9em; }
        .sync-log { background: #f8f9fa; padding: 15px; border-radius: 4px; font-family: monospace; font-size: 0.9em; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>ğŸš€ SVTR.AI çŸ¥è¯†åº“åŒæ­¥çŠ¶æ€</h1>
    
    <div class="status-card status-good">
        <h3>ğŸ“Š åŒæ­¥æ•°æ®æ¦‚è§ˆ</h3>
        <div class="metric">
            <div class="metric-value" id="totalDocs">-</div>
            <div class="metric-label">æ€»æ–‡æ¡£æ•°</div>
        </div>
        <div class="metric">
            <div class="metric-value" id="weeklyIssues">-</div>
            <div class="metric-label">AIå‘¨æŠ¥æœŸæ•°</div>
        </div>
        <div class="metric">
            <div class="metric-value" id="companies">-</div>
            <div class="metric-label">å…¬å¸æ•°æ®</div>
        </div>
        <div class="metric">
            <div class="metric-value" id="lastSync">-</div>
            <div class="metric-label">ä¸Šæ¬¡åŒæ­¥</div>
        </div>
    </div>
    
    <div class="status-card">
        <h3>ğŸ”„ åŒæ­¥æ§åˆ¶</h3>
        <button onclick="triggerSync('daily')">æ¯æ—¥åŒæ­¥</button>
        <button onclick="triggerSync('full')">å…¨é‡åŒæ­¥</button>
        <button onclick="checkStatus()">æ£€æŸ¥çŠ¶æ€</button>
        <button onclick="viewLogs()">æŸ¥çœ‹æ—¥å¿—</button>
    </div>
    
    <div class="status-card">
        <h3>ğŸ“ åŒæ­¥æ—¥å¿—</h3>
        <div class="sync-log" id="syncLog">
            æ­£åœ¨åŠ è½½åŒæ­¥çŠ¶æ€...
        </div>
    </div>
    
    <script>
        // åŒæ­¥çŠ¶æ€ç›‘æ§è„šæœ¬
        async function loadSyncStatus() {
            try {
                const response = await fetch('/api/sync-status');
                const data = await response.json();
                
                document.getElementById('totalDocs').textContent = data.totalDocs || 0;
                document.getElementById('weeklyIssues').textContent = data.weeklyIssues || 0;
                document.getElementById('companies').textContent = data.companies || 0;
                document.getElementById('lastSync').textContent = data.lastSync || 'æœªçŸ¥';
                
                const logElement = document.getElementById('syncLog');
                logElement.textContent = data.logs || 'æš‚æ— æ—¥å¿—';
                
            } catch (error) {
                console.error('åŠ è½½åŒæ­¥çŠ¶æ€å¤±è´¥:', error);
                document.getElementById('syncLog').textContent = 'åŠ è½½çŠ¶æ€å¤±è´¥: ' + error.message;
            }
        }
        
        async function triggerSync(type) {
            try {
                const response = await fetch('/api/trigger-sync', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type })
                });
                
                const result = await response.json();
                alert(result.success ? 'åŒæ­¥å·²è§¦å‘' : 'åŒæ­¥è§¦å‘å¤±è´¥: ' + result.error);
                
                if (result.success) {
                    setTimeout(loadSyncStatus, 3000); // 3ç§’ååˆ·æ–°çŠ¶æ€
                }
                
            } catch (error) {
                alert('è§¦å‘åŒæ­¥å¤±è´¥: ' + error.message);
            }
        }
        
        function checkStatus() {
            loadSyncStatus();
        }
        
        function viewLogs() {
            window.open('/admin/sync-logs', '_blank');
        }
        
        // é¡µé¢åŠ è½½æ—¶è·å–çŠ¶æ€
        loadSyncStatus();
        
        // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°çŠ¶æ€
        setInterval(loadSyncStatus, 30000);
    </script>
</body>
</html>