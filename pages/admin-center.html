<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVTR ç®¡ç†ä¸­å¿ƒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }
        
        .admin-layout {
            display: flex;
            min-height: 100vh;
        }
        
        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 260px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: transform 0.3s ease;
        }
        
        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .sidebar-header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .sidebar-header p {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .nav-menu {
            padding: 20px 0;
        }
        
        .nav-section {
            margin-bottom: 30px;
        }
        
        .nav-section-title {
            padding: 0 20px 10px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.6;
            font-weight: 600;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .nav-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .nav-item.active {
            background: rgba(255,255,255,0.2);
            border-right: 3px solid white;
        }
        
        .nav-item-icon {
            font-size: 1.2rem;
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }
        
        .nav-item-text {
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        /* å­èœå•æ ·å¼ */
        .nav-item[style*="padding-left: 32px"] {
            background: rgba(255,255,255,0.05);
            border-left: 2px solid rgba(255,255,255,0.2);
            font-size: 0.85rem;
        }
        
        .nav-item[style*="padding-left: 32px"]:hover {
            background: rgba(255,255,255,0.15);
            border-left-color: rgba(255,255,255,0.4);
        }
        
        .nav-item[style*="padding-left: 32px"].active {
            background: rgba(255,255,255,0.25);
            border-left-color: white;
        }

        /* è®¢é˜…çŠ¶æ€æ ·å¼ */
        .subscription-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
        }
        
        .subscription-badge.subscribed {
            background: rgba(34, 197, 94, 0.1);
            color: #059669;
            border: 1px solid rgba(34, 197, 94, 0.2);
        }
        
        .subscription-badge.not-subscribed {
            background: rgba(107, 114, 128, 0.1);
            color: #6b7280;
            border: 1px solid rgba(107, 114, 128, 0.2);
        }
        
        /* åœ°ç†ä½ç½®æ ·å¼ */
        .location-icon {
            font-size: 1rem;
        }
        
        .location-text {
            font-size: 0.9rem;
            color: #374151;
        }
        
        /* ä¸»å†…å®¹åŒº */
        .main-content {
            margin-left: 260px;
            flex: 1;
            background: #f5f7fa;
        }
        
        .content-header {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid #e1e5e9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .content-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #333;
        }
        
        .content-subtitle {
            font-size: 1rem;
            color: #666;
            margin-top: 5px;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: background 0.3s ease;
        }
        
        .btn-primary:hover {
            background: #5a6fd8;
        }
        
        .btn-secondary {
            background: white;
            color: #667eea;
            border: 1px solid #667eea;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }
        
        .content-body {
            padding: 30px;
        }
        
        /* ä»ªè¡¨æ¿å¡ç‰‡ */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #e1e5e9;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-icon {
            font-size: 2rem;
            margin-right: 15px;
        }
        
        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
        }
        
        .card-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .card-description {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.5;
        }
        
        .card-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 10px;
            font-size: 0.85rem;
        }
        
        .trend-up {
            color: #10a37f;
        }
        
        .trend-down {
            color: #d73502;
        }
        
        /* å†…å®¹æ¨¡å— */
        .content-module {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #e1e5e9;
            overflow: hidden;
            display: none;
        }
        
        .content-module.active {
            display: block;
        }
        
        .module-header {
            padding: 20px 25px;
            border-bottom: 1px solid #e1e5e9;
            background: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .module-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .module-subtitle {
            font-size: 0.9rem;
            color: #666;
        }
        
        .module-content {
            padding: 25px;
        }
        
        /* è¡¨æ ¼æ ·å¼ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th,
        .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e1e5e9;
        }
        
        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }
        
        /* å¯æ’åºè¡¨å¤´æ ·å¼ */
        .sortable-header {
            cursor: pointer;
            position: relative;
            user-select: none;
            transition: background-color 0.2s ease;
        }
        
        .sortable-header:hover {
            background-color: #e9ecef;
        }
        
        .sortable-header::after {
            content: '';
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-bottom: 6px solid #999;
            opacity: 0.5;
        }
        
        .sortable-header.sort-asc::after {
            border-bottom: 6px solid #007bff;
            border-top: none;
            opacity: 1;
        }
        
        .sortable-header.sort-desc::after {
            border-top: 6px solid #007bff;
            border-bottom: none;
            opacity: 1;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }

        /* è®¢é˜…ç®¡ç†ä¸“ç”¨æ ·å¼ */
        .email-cell {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .email-cell small {
            color: #666;
            font-size: 0.75rem;
        }

        .preferences-cell {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .preference-tag {
            background: #e3f2fd;
            color: #1565c0;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            white-space: nowrap;
        }

        .language-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .language-badge.zh {
            background: #ffebee;
            color: #c62828;
        }

        .language-badge.en {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .date-cell {
            font-family: monospace;
            font-size: 0.85rem;
        }

        .ip-cell {
            font-family: monospace;
            font-size: 0.8rem;
            color: #666;
        }

        .action-buttons {
            display: flex;
            gap: 6px;
        }

        .btn-small {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .btn-info {
            background: #e3f2fd;
            color: #1565c0;
        }

        .btn-info:hover {
            background: #bbdefb;
        }

        .btn-danger {
            background: #ffebee;
            color: #c62828;
        }

        .btn-danger:hover {
            background: #ffcdd2;
        }

        .module-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .toolbar-filters {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .toolbar-actions {
            display: flex;
            gap: 10px;
        }

        .table-info {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 0.9rem;
            color: #666;
            text-align: center;
        }
        
        /* çŠ¶æ€æ ‡ç­¾ */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-active {
            background: #e8f5e8;
            color: #388e3c;
        }
        
        .status-pending {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .status-inactive {
            background: #ffebee;
            color: #d32f2f;
        }
        
        /* ç§»åŠ¨ç«¯å“åº”å¼ */
        .mobile-menu-btn {
            display: none;
            background: #667eea;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .content-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .content-body {
                padding: 20px;
            }
        }
        
        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #e1e5e9;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="admin-layout">
        <!-- ä¾§è¾¹æ  -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>ğŸš€ SVTR</h1>
                <p>ç®¡ç†ä¸­å¿ƒ</p>
            </div>
            
            <div class="nav-menu">
                <div class="nav-section">
                    <div class="nav-section-title">æ¦‚è§ˆ</div>
                    <a class="nav-item active" onclick="showModule('dashboard')">
                        <span class="nav-item-icon">ğŸ“Š</span>
                        <span class="nav-item-text">ä»ªè¡¨æ¿</span>
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">å†…å®¹ç®¡ç†</div>
                    <a class="nav-item" onclick="showModule('content')">
                        <span class="nav-item-icon">âœï¸</span>
                        <span class="nav-item-text">å†…å®¹åˆ›ä½œ</span>
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">å¹³å°ç®¡ç†</div>
                    <a class="nav-item" onclick="showModule('users')">
                        <span class="nav-item-icon">ğŸ‘¥</span>
                        <span class="nav-item-text">ç”¨æˆ·ç®¡ç†</span>
                    </a>
                    <a class="nav-item" onclick="showModule('subscription')">
                        <span class="nav-item-icon">ğŸ“§</span>
                        <span class="nav-item-text">è®¢é˜…ç®¡ç†</span>
                    </a>
                    <a class="nav-item" onclick="showModule('projects')">
                        <span class="nav-item-icon">ğŸ’¼</span>
                        <span class="nav-item-text">é¡¹ç›®ç®¡ç†</span>
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">æ•°æ®åˆ†æ</div>
                    <a class="nav-item" onclick="showModule('analytics')">
                        <span class="nav-item-icon">ğŸ“ˆ</span>
                        <span class="nav-item-text">æ•°æ®åˆ†æ</span>
                    </a>
                    <a class="nav-item" onclick="showModule('reports')">
                        <span class="nav-item-icon">ğŸ“‹</span>
                        <span class="nav-item-text">æŠ¥å‘Šç”Ÿæˆ</span>
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">ç³»ç»Ÿ</div>
                    <a class="nav-item" onclick="showModule('settings')">
                        <span class="nav-item-icon">âš™ï¸</span>
                        <span class="nav-item-text">ç³»ç»Ÿè®¾ç½®</span>
                    </a>
                    <a class="nav-item" onclick="showModule('logs')">
                        <span class="nav-item-icon">ğŸ“</span>
                        <span class="nav-item-text">æ“ä½œæ—¥å¿—</span>
                    </a>
                </div>
            </div>
        </nav>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            <header class="content-header">
                <div>
                    <button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>
                    <h1 class="content-title" id="pageTitle">ä»ªè¡¨æ¿</h1>
                    <p class="content-subtitle" id="pageSubtitle">SVTR å¹³å°è¿è¥æ¦‚è§ˆ</p>
                </div>
                <div class="header-actions">
                    <button class="btn-secondary" onclick="refreshData()">ğŸ”„ åˆ·æ–°</button>
                    <button class="btn-primary" onclick="showQuickActions()">âš¡ å¿«æ·æ“ä½œ</button>
                </div>
            </header>
            
            <div class="content-body">
                <!-- ä»ªè¡¨æ¿æ¨¡å— -->
                <div id="dashboard-module" class="content-module active">
                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <div class="card-header">
                                <span class="card-icon">ğŸ‘¥</span>
                                <span class="card-title">æ³¨å†Œç”¨æˆ·</span>
                            </div>
                            <div class="card-value" id="totalUsers">-</div>
                            <div class="card-description">å¹³å°æ³¨å†Œç”¨æˆ·æ€»æ•°</div>
                            <div class="card-trend trend-up">
                                <span>â†— +12%</span>
                                <span>æœ¬æœˆå¢é•¿</span>
                            </div>
                        </div>
                        
                        <div class="dashboard-card">
                            <div class="card-header">
                                <span class="card-icon">ğŸ“§</span>
                                <span class="card-title">è®¢é˜…ç”¨æˆ·</span>
                            </div>
                            <div class="card-value" id="subscribers">-</div>
                            <div class="card-description">AIå‘¨æŠ¥è®¢é˜…ç”¨æˆ·æ•°</div>
                            <div class="card-trend trend-up">
                                <span>â†— +24%</span>
                                <span>æœ¬å‘¨å¢é•¿</span>
                            </div>
                        </div>
                        
                        <div class="dashboard-card">
                            <div class="card-header">
                                <span class="card-icon">ğŸ’¼</span>
                                <span class="card-title">æ€»é¡¹ç›®æ•°</span>
                            </div>
                            <div class="card-value" id="totalProjects">-</div>
                            <div class="card-description">å¹³å°æ‰€æœ‰é¡¹ç›®æ€»æ•°</div>
                            <div class="card-trend trend-up">
                                <span>â†— +8%</span>
                                <span>æœ¬æœˆæ–°å¢</span>
                            </div>
                        </div>
                        
                        <div class="dashboard-card">
                            <div class="card-header">
                                <span class="card-icon">ğŸ’°</span>
                                <span class="card-title">æŠ•èµ„æ€»é¢</span>
                            </div>
                            <div class="card-value" id="totalInvestment">-</div>
                            <div class="card-description">å¹³å°ä¿ƒæˆæŠ•èµ„é‡‘é¢</div>
                            <div class="card-trend trend-up">
                                <span>â†— +18%</span>
                                <span>æœ¬å­£åº¦å¢é•¿</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-header">
                            <span class="card-icon">ğŸ“Š</span>
                            <span class="card-title">æœ€è¿‘æ´»åŠ¨</span>
                        </div>
                        <div id="recentActivities">
                            <div class="loading-spinner"></div>
                            <span style="margin-left: 10px;">åŠ è½½æœ€è¿‘æ´»åŠ¨...</span>
                        </div>
                    </div>
                </div>
                
                <!-- å†…å®¹åˆ›ä½œæ¨¡å— -->
                <div id="content-module" class="content-module">
                    <div class="module-header">
                        <div class="module-title">å†…å®¹åˆ›ä½œç®¡ç†</div>
                        <div class="module-subtitle">ç®¡ç†AIå‘¨æŠ¥ã€æŠ•èµ„æ´å¯Ÿç­‰å†…å®¹åˆ›ä½œ</div>
                    </div>
                    <div class="module-content">
                        <div class="empty-state">
                            <div class="empty-state-icon">âœï¸</div>
                            <h3>å†…å®¹åˆ›ä½œåŠŸèƒ½</h3>
                            <p>æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…...</p>
                        </div>
                    </div>
                </div>
                
                <!-- è®¢é˜…ç®¡ç†æ¨¡å— -->
                <div id="subscription-module" class="content-module">
                    <div class="module-header">
                        <div class="module-title">è®¢é˜…ç®¡ç†</div>
                        <div class="module-subtitle">ç®¡ç†AIå‘¨æŠ¥è®¢é˜…è€…å’Œç›¸å…³æ•°æ®</div>
                    </div>
                    <div class="module-content">
                        <!-- è®¢é˜…è€…ç»Ÿè®¡å¡ç‰‡ -->
                        <div class="dashboard-grid" style="margin-bottom: 30px;">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <span class="card-icon">ğŸ“§</span>
                                    <span class="card-title">æ€»è®¢é˜…è€…</span>
                                </div>
                                <div class="card-value" id="subscription-total-subscribers">-</div>
                                <div class="card-description">AIå‘¨æŠ¥è®¢é˜…ç”¨æˆ·</div>
                                <div class="card-trend trend-up">
                                    <span>â†— +24%</span>
                                    <span>æœ¬æœˆå¢é•¿</span>
                                </div>
                            </div>
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <span class="card-icon">ğŸ‡¨ğŸ‡³</span>
                                    <span class="card-title">ä¸­æ–‡ç”¨æˆ·</span>
                                </div>
                                <div class="card-value" id="subscription-zh-users">-</div>
                                <div class="card-description">ä¸­æ–‡è®¢é˜…ç”¨æˆ·</div>
                                <div class="card-trend">
                                    <span id="subscription-zh-percentage">0%</span>
                                    <span>å æ¯”</span>
                                </div>
                            </div>
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <span class="card-icon">ğŸ‡ºğŸ‡¸</span>
                                    <span class="card-title">è‹±æ–‡ç”¨æˆ·</span>
                                </div>
                                <div class="card-value" id="subscription-en-users">-</div>
                                <div class="card-description">è‹±æ–‡è®¢é˜…ç”¨æˆ·</div>
                                <div class="card-trend">
                                    <span id="subscription-en-percentage">0%</span>
                                    <span>å æ¯”</span>
                                </div>
                            </div>
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <span class="card-icon">ğŸ“ˆ</span>
                                    <span class="card-title">ä»Šæ—¥æ–°å¢</span>
                                </div>
                                <div class="card-value" id="subscription-today-new">-</div>
                                <div class="card-description">ä»Šæ—¥æ–°å¢è®¢é˜…</div>
                                <div class="card-trend trend-up">
                                    <span>+æ–°å¢</span>
                                    <span>æŒç»­å¢é•¿</span>
                                </div>
                            </div>
                        </div>

                        <!-- è®¢é˜…è€…ç®¡ç†æ“ä½œåŒº -->
                        <div class="module-toolbar">
                            <div class="toolbar-filters">
                                <select id="subscriptionLanguageFilter" onchange="filterSubscriptions()" class="form-input" style="width: auto;">
                                    <option value="">æ‰€æœ‰è¯­è¨€</option>
                                    <option value="zh-CN">ä¸­æ–‡</option>
                                    <option value="en-US">è‹±æ–‡</option>
                                </select>
                                <input type="text" id="subscriptionSearchInput" placeholder="æœç´¢é‚®ç®±..." onkeyup="filterSubscriptions()" class="form-input" style="width: 200px;">
                                <input type="date" id="subscriptionDateFilter" onchange="filterSubscriptions()" class="form-input" style="width: auto;">
                            </div>
                            <div class="toolbar-actions">
                                <button class="btn-secondary" onclick="exportSubscriptions()">ğŸ“¥ å¯¼å‡ºæ•°æ®</button>
                                <button class="btn-primary" onclick="refreshSubscriptions()">ğŸ”„ åˆ·æ–°</button>
                            </div>
                        </div>
                        
                        <!-- è®¢é˜…è€…åˆ—è¡¨ -->
                        <div id="subscriptionsTableContainer">
                            <div class="loading-spinner"></div>
                            <span style="margin-left: 10px;">åŠ è½½è®¢é˜…æ•°æ®...</span>
                        </div>
                    </div>
                </div>
                
                <!-- é¡¹ç›®ç®¡ç†æ¨¡å— -->
                <div id="projects-module" class="content-module">
                    <div class="module-header">
                        <div>
                            <div class="module-title">æŠ•èµ„é¡¹ç›®ç®¡ç†</div>
                            <div class="module-subtitle">ç®¡ç†å¹³å°ä¸Šçš„æ‰€æœ‰æŠ•èµ„é¡¹ç›®å’Œç”³è¯·</div>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button class="btn-secondary" onclick="loadProjectsData()" style="padding: 8px 16px; font-size: 14px;">
                                ğŸ”„ åˆ·æ–°æ•°æ®
                            </button>
                            <small id="lastUpdateTime" style="color: #666; font-size: 12px;"></small>
                        </div>
                    </div>
                    <div class="module-content">
                        <!-- é¡¹ç›®ç»Ÿè®¡å¡ç‰‡ -->
                        <div class="dashboard-grid" style="margin-bottom: 30px;">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <span class="card-icon">ğŸ“Š</span>
                                    <span class="card-title">æ€»é¡¹ç›®æ•°</span>
                                </div>
                                <div class="card-value" id="totalProjectsCount">-</div>
                                <div class="card-description">å¹³å°æ‰€æœ‰é¡¹ç›®</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <span class="card-icon">âœ…</span>
                                    <span class="card-title">æ´»è·ƒé¡¹ç›®</span>
                                </div>
                                <div class="card-value" id="activeProjectsCount">-</div>
                                <div class="card-description">æ­£åœ¨è¿›è¡Œçš„é¡¹ç›®</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <span class="card-icon">â³</span>
                                    <span class="card-title">å¾…å®¡æ ¸</span>
                                </div>
                                <div class="card-value" id="pendingProjectsCount">-</div>
                                <div class="card-description">ç­‰å¾…å®¡æ ¸çš„é¡¹ç›®</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <span class="card-icon">ğŸ’°</span>
                                    <span class="card-title">æ€»èèµ„é¢</span>
                                </div>
                                <div class="card-value" id="totalFundingAmount">-</div>
                                <div class="card-description">ç´¯è®¡èèµ„é‡‘é¢</div>
                            </div>
                        </div>
                        
                        <!-- æ“ä½œæ  -->
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <select id="projectStatusFilter" onchange="filterProjects()" class="form-input" style="width: auto;">
                                    <option value="">æ‰€æœ‰çŠ¶æ€</option>
                                    <option value="active">æ´»è·ƒ</option>
                                    <option value="pending">å¾…å®¡æ ¸</option>
                                    <option value="completed">å·²å®Œæˆ</option>
                                    <option value="paused">æš‚åœ</option>
                                    <option value="rejected">å·²æ‹’ç»</option>
                                </select>
                                <select id="projectCategoryFilter" onchange="filterProjects()" class="form-input" style="width: auto;">
                                    <option value="">æ‰€æœ‰ç±»åˆ«</option>
                                    <option value="AI">AI</option>
                                    <option value="Fintech">é‡‘èç§‘æŠ€</option>
                                    <option value="Healthcare">åŒ»ç–—å¥åº·</option>
                                    <option value="E-commerce">ç”µå­å•†åŠ¡</option>
                                    <option value="Enterprise">ä¼ä¸šæœåŠ¡</option>
                                    <option value="Consumer">æ¶ˆè´¹è€…</option>
                                    <option value="Other">å…¶ä»–</option>
                                </select>
                                <input type="text" id="projectSearchInput" placeholder="æœç´¢é¡¹ç›®åç§°..." onkeyup="filterProjects()" class="form-input" style="width: 200px;">
                            </div>
                            <button class="btn-primary" onclick="showCreateProjectModal()">â• åˆ›å»ºé¡¹ç›®</button>
                        </div>
                        
                        <!-- é¡¹ç›®åˆ—è¡¨ -->
                        <div id="projectsTableContainer">
                            <div class="loading-spinner"></div>
                            <span style="margin-left: 10px;">åŠ è½½é¡¹ç›®æ•°æ®...</span>
                        </div>
                    </div>
                </div>
                
                <!-- ç”¨æˆ·ç®¡ç†æ¨¡å— -->
                <div id="users-module" class="content-module">
                    <div class="module-header">
                        <div class="module-title">ç”¨æˆ·ç®¡ç†</div>
                        <div class="module-subtitle">ç®¡ç†åˆ›ä¸šè€…ã€æŠ•èµ„äººç­‰å¹³å°ç”¨æˆ·</div>
                    </div>
                    <div class="module-content">
                        <!-- ç”¨æˆ·ç»Ÿè®¡å¡ç‰‡ -->
                        <div class="dashboard-grid" style="margin-bottom: 30px;">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <span class="card-icon">ğŸ‘¥</span>
                                    <span class="card-title">æ€»ç”¨æˆ·æ•°</span>
                                </div>
                                <div class="card-value" id="totalUsersCount">-</div>
                                <div class="card-description">æ³¨å†Œç”¨æˆ·æ€»æ•°</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <span class="card-icon">âœ…</span>
                                    <span class="card-title">æ´»è·ƒç”¨æˆ·</span>
                                </div>
                                <div class="card-value" id="activeUsersCount">-</div>
                                <div class="card-description">å½“å‰æ´»è·ƒç”¨æˆ·</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <span class="card-icon">ğŸ“ˆ</span>
                                    <span class="card-title">ä»Šæ—¥æ³¨å†Œ</span>
                                </div>
                                <div class="card-value" id="todayRegistrations">-</div>
                                <div class="card-description">ä»Šæ—¥æ–°å¢ç”¨æˆ·</div>
                            </div>
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <span class="card-icon">ğŸ“§</span>
                                    <span class="card-title">é‚®ç®±ç”¨æˆ·</span>
                                </div>
                                <div class="card-value" id="emailUsersCount">-</div>
                                <div class="card-description">é‚®ç®±æ³¨å†Œç”¨æˆ·</div>
                            </div>
                        </div>
                        
                        <!-- ç”¨æˆ·ç®¡ç†æ“ä½œåŒº -->
                        <div class="module-toolbar">
                            <div class="toolbar-filters">
                                <select id="userProviderFilter" onchange="filterUsers()" class="form-input" style="width: auto;">
                                    <option value="">æ‰€æœ‰æ¥æº</option>
                                    <option value="email">é‚®ç®±ç™»å½•</option>
                                    <option value="google">Google</option>
                                    <option value="github">GitHub</option>
                                </select>
                                <select id="userSubscriptionFilter" onchange="filterUsers()" class="form-input" style="width: auto;">
                                    <option value="">è®¢é˜…çŠ¶æ€</option>
                                    <option value="true">å·²è®¢é˜…</option>
                                    <option value="false">æœªè®¢é˜…</option>
                                </select>
                                <select id="userLocationFilter" onchange="filterUsers()" class="form-input" style="width: auto;">
                                    <option value="">æ‰€æœ‰åœ°åŒº</option>
                                    <option value="ä¸­å›½">ä¸­å›½</option>
                                    <option value="å…¨çƒ">å…¨çƒ</option>
                                    <option value="ç¾å›½">ç¾å›½</option>
                                    <option value="æœ¬åœ°ç¯å¢ƒ">æœ¬åœ°ç¯å¢ƒ</option>
                                    <option value="å…¶ä»–åœ°åŒº">å…¶ä»–åœ°åŒº</option>
                                </select>
                                <select id="userStatusFilter" onchange="filterUsers()" class="form-input" style="width: auto;">
                                    <option value="">æ‰€æœ‰çŠ¶æ€</option>
                                    <option value="true">æ´»è·ƒ</option>
                                    <option value="false">ç¦ç”¨</option>
                                </select>
                                <input type="text" id="userSearchInput" placeholder="æœç´¢ç”¨æˆ·..." onkeyup="filterUsers()" class="form-input" style="width: 150px;">
                                <input type="date" id="userDateFilter" onchange="filterUsers()" class="form-input" style="width: auto;">
                            </div>
                            <div class="toolbar-actions">
                                <button class="btn-secondary" onclick="exportUsers()">ğŸ“¥ å¯¼å‡ºç”¨æˆ·</button>
                                <button class="btn-primary" onclick="refreshUsers()">ğŸ”„ åˆ·æ–°</button>
                            </div>
                        </div>
                        
                        <!-- ç”¨æˆ·åˆ—è¡¨ -->
                        <div id="usersTableContainer">
                            <div class="loading-spinner"></div>
                            <span style="margin-left: 10px;">åŠ è½½ç”¨æˆ·æ•°æ®...</span>
                        </div>
                    </div>
                </div>
                
                <!-- æ•°æ®åˆ†ææ¨¡å— -->
                <div id="analytics-module" class="content-module">
                    <div class="module-header">
                        <div class="module-title">æ•°æ®åˆ†æ</div>
                        <div class="module-subtitle">æŸ¥çœ‹å¹³å°è¿è¥æ•°æ®å’ŒæŠ•èµ„ç»Ÿè®¡</div>
                    </div>
                    <div class="module-content">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“ˆ</div>
                            <h3>æ•°æ®åˆ†æåŠŸèƒ½</h3>
                            <p>æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…...</p>
                        </div>
                    </div>
                </div>
                
                <!-- æŠ¥å‘Šç”Ÿæˆæ¨¡å— -->
                <div id="reports-module" class="content-module">
                    <div class="module-header">
                        <div class="module-title">æŠ¥å‘Šç”Ÿæˆ</div>
                        <div class="module-subtitle">ç”Ÿæˆè¿è¥æŠ¥å‘Šå’ŒæŠ•èµ„åˆ†ææŠ¥å‘Š</div>
                    </div>
                    <div class="module-content">
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“‹</div>
                            <h3>æŠ¥å‘Šç”ŸæˆåŠŸèƒ½</h3>
                            <p>æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…...</p>
                        </div>
                    </div>
                </div>
                
                <!-- ç³»ç»Ÿè®¾ç½®æ¨¡å— -->
                <div id="settings-module" class="content-module">
                    <div class="module-header">
                        <div class="module-title">ç³»ç»Ÿè®¾ç½®</div>
                        <div class="module-subtitle">é…ç½®å¹³å°å‚æ•°å’Œç³»ç»Ÿè®¾ç½®</div>
                    </div>
                    <div class="module-content">
                        <div class="empty-state">
                            <div class="empty-state-icon">âš™ï¸</div>
                            <h3>ç³»ç»Ÿè®¾ç½®åŠŸèƒ½</h3>
                            <p>æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…...</p>
                        </div>
                    </div>
                </div>
                
                <!-- æ“ä½œæ—¥å¿—æ¨¡å— -->
                <div id="logs-module" class="content-module">
                    <div class="module-header">
                        <div class="module-title">æ“ä½œæ—¥å¿—</div>
                        <div class="module-subtitle">æŸ¥çœ‹ç³»ç»Ÿå’Œç”¨æˆ·æ“ä½œè®°å½•</div>
                        <div class="module-actions">
                            <button onclick="refreshUserBehaviorData()" class="btn btn-primary">
                                ğŸ”„ åˆ·æ–°æ•°æ®
                            </button>
                            <button onclick="exportUserBehaviorData()" class="btn btn-secondary">
                                ğŸ“Š å¯¼å‡ºæŠ¥å‘Š
                            </button>
                        </div>
                    </div>
                    
                    <div class="module-content">
                        <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
                        <div class="stats-overview" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                            <div class="stat-card">
                                <div class="stat-icon">ğŸ‘¥</div>
                                <div class="stat-content">
                                    <div class="stat-label">ä»Šæ—¥æ´»è·ƒç”¨æˆ·</div>
                                    <div class="stat-value" id="todayActiveUsers">-</div>
                                    <div class="stat-change">+12% vs æ˜¨æ—¥</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">ğŸ“„</div>
                                <div class="stat-content">
                                    <div class="stat-label">ä»Šæ—¥é¡µé¢æµè§ˆ</div>
                                    <div class="stat-value" id="todayPageViews">-</div>
                                    <div class="stat-change">+8% vs æ˜¨æ—¥</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">â±ï¸</div>
                                <div class="stat-content">
                                    <div class="stat-label">å¹³å‡åœç•™æ—¶é—´</div>
                                    <div class="stat-value" id="avgSessionTime">-</div>
                                    <div class="stat-change">+15% vs æ˜¨æ—¥</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">ğŸ¯</div>
                                <div class="stat-content">
                                    <div class="stat-label">ç”¨æˆ·å‚ä¸åº¦</div>
                                    <div class="stat-value" id="engagementRate">-</div>
                                    <div class="stat-change">+3% vs æ˜¨æ—¥</div>
                                </div>
                            </div>
                        </div>

                        <!-- è¿‡æ»¤å’Œæœç´¢ -->
                        <div class="logs-filters" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                                <div class="filter-group">
                                    <label class="form-label">ç”¨æˆ·ç±»å‹</label>
                                    <select id="userTypeFilter" class="form-input" onchange="filterUserBehaviorLogs()">
                                        <option value="">å…¨éƒ¨ç”¨æˆ·</option>
                                        <option value="member">æ³¨å†Œä¼šå‘˜</option>
                                        <option value="anonymous">åŒ¿åç”¨æˆ·</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label class="form-label">è¡Œä¸ºç±»å‹</label>
                                    <select id="behaviorTypeFilter" class="form-input" onchange="filterUserBehaviorLogs()">
                                        <option value="">å…¨éƒ¨è¡Œä¸º</option>
                                        <option value="page_view">é¡µé¢è®¿é—®</option>
                                        <option value="click">ç‚¹å‡»äº‹ä»¶</option>
                                        <option value="form_submit">è¡¨å•æäº¤</option>
                                        <option value="scroll_milestone">æ»šåŠ¨è¡Œä¸º</option>
                                        <option value="link_click">é“¾æ¥ç‚¹å‡»</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label class="form-label">æ—¶é—´èŒƒå›´</label>
                                    <select id="timeRangeFilter" class="form-input" onchange="filterUserBehaviorLogs()">
                                        <option value="today">ä»Šå¤©</option>
                                        <option value="yesterday">æ˜¨å¤©</option>
                                        <option value="week">æœ¬å‘¨</option>
                                        <option value="month">æœ¬æœˆ</option>
                                        <option value="custom">è‡ªå®šä¹‰</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label class="form-label">æœç´¢ç”¨æˆ·</label>
                                    <input type="text" id="userSearchInput" class="form-input" placeholder="è¾“å…¥ç”¨æˆ·IDæˆ–é‚®ç®±..." onkeyup="filterUserBehaviorLogs()">
                                </div>
                            </div>
                            
                            <!-- è‡ªå®šä¹‰æ—¶é—´èŒƒå›´ -->
                            <div id="customTimeRange" style="display: none; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                                <div class="filter-group">
                                    <label class="form-label">å¼€å§‹æ—¥æœŸ</label>
                                    <input type="date" id="startDate" class="form-input" onchange="filterUserBehaviorLogs()">
                                </div>
                                <div class="filter-group">
                                    <label class="form-label">ç»“æŸæ—¥æœŸ</label>
                                    <input type="date" id="endDate" class="form-input" onchange="filterUserBehaviorLogs()">
                                </div>
                            </div>
                        </div>

                        <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
                        <div class="logs-tabs" style="display: flex; background: #fff; border-radius: 10px 10px 0 0; border-bottom: 1px solid #eee; margin-bottom: 0;">
                            <button class="logs-tab active" data-tab="realtime" onclick="switchLogsTab('realtime')">
                                ğŸ”´ å®æ—¶æ´»åŠ¨
                            </button>
                            <button class="logs-tab" data-tab="sessions" onclick="switchLogsTab('sessions')">
                                ğŸ‘¥ ç”¨æˆ·ä¼šè¯
                            </button>
                            <button class="logs-tab" data-tab="pages" onclick="switchLogsTab('pages')">
                                ğŸ“„ é¡µé¢åˆ†æ
                            </button>
                            <button class="logs-tab" data-tab="heatmap" onclick="switchLogsTab('heatmap')">
                                ğŸ”¥ çƒ­åŠ›å›¾
                            </button>
                        </div>

                        <!-- æ ‡ç­¾é¡µå†…å®¹ -->
                        <div class="logs-tab-content" style="background: #fff; border-radius: 0 0 10px 10px; padding: 20px;">
                            <!-- å®æ—¶æ´»åŠ¨æ ‡ç­¾é¡µ -->
                            <div id="realtime-tab" class="logs-tab-panel active">
                                <div class="realtime-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                    <div>
                                        <h4 style="margin: 0;">å®æ—¶ç”¨æˆ·æ´»åŠ¨</h4>
                                        <p style="margin: 5px 0 0; color: #666;">å®æ—¶ç›‘æ§ç”¨æˆ·è¡Œä¸ºå’Œé¡µé¢è®¿é—®</p>
                                    </div>
                                    <div class="realtime-indicator" style="display: flex; align-items: center; color: #28a745;">
                                        <span class="pulse" style="width: 8px; height: 8px; background: #28a745; border-radius: 50%; margin-right: 8px; animation: pulse 1s infinite;"></span>
                                        <span id="realtimeCount">0</span> ä½ç”¨æˆ·åœ¨çº¿
                                    </div>
                                </div>
                                
                                <div id="realtimeActivities" class="realtime-activities">
                                    <div class="loading-state" style="text-align: center; padding: 40px; color: #666;">
                                        <div class="loading-spinner" style="margin: 0 auto 15px; width: 40px; height: 40px; border: 3px solid #f3f3f3; border-top: 3px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                                        <p>æ­£åœ¨åŠ è½½å®æ—¶æ•°æ®...</p>
                                    </div>
                                </div>
                            </div>

                            <!-- ç”¨æˆ·ä¼šè¯æ ‡ç­¾é¡µ -->
                            <div id="sessions-tab" class="logs-tab-panel">
                                <div class="sessions-header" style="margin-bottom: 20px;">
                                    <h4 style="margin: 0;">ç”¨æˆ·ä¼šè¯åˆ†æ</h4>
                                    <p style="margin: 5px 0 0; color: #666;">æŸ¥çœ‹ç”¨æˆ·ä¼šè¯è¯¦æƒ…ã€åœç•™æ—¶é—´å’Œè¡Œä¸ºè·¯å¾„</p>
                                </div>
                                
                                <div id="sessionsTable" class="sessions-table">
                                    <div class="loading-state" style="text-align: center; padding: 40px; color: #666;">
                                        <div class="loading-spinner" style="margin: 0 auto 15px; width: 40px; height: 40px; border: 3px solid #f3f3f3; border-top: 3px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                                        <p>æ­£åœ¨åŠ è½½ä¼šè¯æ•°æ®...</p>
                                    </div>
                                </div>
                            </div>

                            <!-- é¡µé¢åˆ†ææ ‡ç­¾é¡µ -->
                            <div id="pages-tab" class="logs-tab-panel">
                                <div class="pages-header" style="margin-bottom: 20px;">
                                    <h4 style="margin: 0;">é¡µé¢è®¿é—®åˆ†æ</h4>
                                    <p style="margin: 5px 0 0; color: #666;">åˆ†æé¡µé¢è®¿é—®é‡ã€åœç•™æ—¶é—´å’Œè·³å‡ºç‡</p>
                                </div>
                                
                                <div id="pagesAnalysis" class="pages-analysis">
                                    <div class="loading-state" style="text-align: center; padding: 40px; color: #666;">
                                        <div class="loading-spinner" style="margin: 0 auto 15px; width: 40px; height: 40px; border: 3px solid #f3f3f3; border-top: 3px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                                        <p>æ­£åœ¨åŠ è½½é¡µé¢æ•°æ®...</p>
                                    </div>
                                </div>
                            </div>

                            <!-- çƒ­åŠ›å›¾æ ‡ç­¾é¡µ -->
                            <div id="heatmap-tab" class="logs-tab-panel">
                                <div class="heatmap-header" style="margin-bottom: 20px;">
                                    <h4 style="margin: 0;">ç”¨æˆ·ç‚¹å‡»çƒ­åŠ›å›¾</h4>
                                    <p style="margin: 5px 0 0; color: #666;">å¯è§†åŒ–ç”¨æˆ·ç‚¹å‡»è¡Œä¸ºå’Œäº¤äº’çƒ­ç‚¹</p>
                                </div>
                                
                                <div class="heatmap-controls" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                    <label class="form-label">é€‰æ‹©é¡µé¢:</label>
                                    <select id="heatmapPageSelect" class="form-input" style="width: 300px;" onchange="loadHeatmapData()">
                                        <option value="">é€‰æ‹©è¦åˆ†æçš„é¡µé¢...</option>
                                        <option value="/">é¦–é¡µ</option>
                                        <option value="/pages/ai100.html">AI100</option>
                                        <option value="/pages/investment-camp.html">æŠ•èµ„è¥</option>
                                        <option value="/pages/content-community.html">å†…å®¹ç¤¾åŒº</option>
                                    </select>
                                </div>
                                
                                <div id="heatmapVisualization" class="heatmap-visualization">
                                    <div class="empty-state" style="text-align: center; padding: 60px; color: #666;">
                                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ”¥</div>
                                        <h4>é€‰æ‹©é¡µé¢æŸ¥çœ‹çƒ­åŠ›å›¾</h4>
                                        <p>é€‰æ‹©ä¸Šæ–¹çš„é¡µé¢æ¥æŸ¥çœ‹ç”¨æˆ·ç‚¹å‡»çƒ­åŠ›å›¾åˆ†æ</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€
        let currentModule = 'dashboard';
        let dashboardData = {};
        let projectsData = [];
        let filteredProjectsData = [];

        // é¡µé¢åŠ è½½åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            setInterval(loadDashboardData, 5 * 60 * 1000); // æ¯5åˆ†é’Ÿåˆ·æ–°
        });

        // åŠ è½½ä»ªè¡¨æ¿æ•°æ®
        async function loadDashboardData() {
            try {
                console.log('[ä»ªè¡¨æ¿] å¼€å§‹åŠ è½½æ•°æ®...');
                
                // 1. è·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ®
                try {
                    const userStatsResponse = await fetch('/api/users?action=stats');
                    if (userStatsResponse.ok) {
                        const userStats = await userStatsResponse.json();
                        document.getElementById('totalUsers').textContent = userStats.totalUsers || 0;
                        console.log('[ä»ªè¡¨æ¿] ç”¨æˆ·æ•°æ®åŠ è½½æˆåŠŸ:', userStats.totalUsers);
                    } else {
                        console.warn('[ä»ªè¡¨æ¿] ç”¨æˆ·ç»Ÿè®¡APIå¤±è´¥:', userStatsResponse.status);
                        document.getElementById('totalUsers').textContent = '0';
                    }
                } catch (userError) {
                    console.error('[ä»ªè¡¨æ¿] è·å–ç”¨æˆ·æ•°æ®å¤±è´¥:', userError);
                    document.getElementById('totalUsers').textContent = '0';
                }

                // 2. è·å–è®¢é˜…æ•°æ®
                try {
                    const subscriptionResponse = await fetch('/api/subscribe?action=stats');
                    if (subscriptionResponse.ok) {
                        const subscriptionData = await subscriptionResponse.json();
                        document.getElementById('subscribers').textContent = subscriptionData.totalSubscribers || 0;
                        console.log('[ä»ªè¡¨æ¿] è®¢é˜…æ•°æ®åŠ è½½æˆåŠŸ:', subscriptionData.totalSubscribers);
                    } else {
                        console.warn('[ä»ªè¡¨æ¿] è®¢é˜…ç»Ÿè®¡APIå¤±è´¥:', subscriptionResponse.status);
                        document.getElementById('subscribers').textContent = '0';
                    }
                } catch (subscriptionError) {
                    console.error('[ä»ªè¡¨æ¿] è·å–è®¢é˜…æ•°æ®å¤±è´¥:', subscriptionError);
                    document.getElementById('subscribers').textContent = '0';
                }

                // 3. è·å–é¡¹ç›®ç»Ÿè®¡æ•°æ®
                try {
                    const projectStatsResponse = await fetch('/api/projects?action=stats');
                    if (projectStatsResponse.ok) {
                        const projectStats = await projectStatsResponse.json();
                        document.getElementById('totalProjects').textContent = projectStats.totalProjects || 0;
                        console.log('[ä»ªè¡¨æ¿] é¡¹ç›®æ•°æ®åŠ è½½æˆåŠŸ:', projectStats.totalProjects);
                    } else {
                        console.warn('[ä»ªè¡¨æ¿] é¡¹ç›®ç»Ÿè®¡APIå¤±è´¥:', projectStatsResponse.status);
                        document.getElementById('totalProjects').textContent = '0';
                    }
                } catch (projectError) {
                    console.error('[ä»ªè¡¨æ¿] è·å–é¡¹ç›®æ•°æ®å¤±è´¥:', projectError);
                    document.getElementById('totalProjects').textContent = '0';
                }

                // ä¿ç•™æŠ•èµ„æ€»é¢çš„æ¨¡æ‹Ÿæ•°æ®
                document.getElementById('totalInvestment').textContent = '$42.8M';

                // æ¨¡æ‹Ÿæœ€è¿‘æ´»åŠ¨
                setTimeout(() => {
                    const activitiesHtml = `
                        <div style="space-y: 15px;">
                            <div style="padding: 10px 0; border-bottom: 1px solid #e1e5e9;">
                                <strong>æ–°é¡¹ç›®æäº¤:</strong> AIåŒ»ç–—è¯Šæ–­å¹³å° - TechHealth
                                <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">2å°æ—¶å‰</div>
                            </div>
                            <div style="padding: 10px 0; border-bottom: 1px solid #e1e5e9;">
                                <strong>ç”¨æˆ·æ³¨å†Œ:</strong> 5åæ–°ç”¨æˆ·åŠ å…¥å¹³å°
                                <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">4å°æ—¶å‰</div>
                            </div>
                            <div style="padding: 10px 0; border-bottom: 1px solid #e1e5e9;">
                                <strong>æŠ•èµ„å®Œæˆ:</strong> æ™ºèƒ½ç‰©æµé¡¹ç›®è·å¾—Aè½®æŠ•èµ„
                                <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">æ˜¨å¤©</div>
                            </div>
                            <div style="padding: 10px 0;">
                                <strong>å†…å®¹å‘å¸ƒ:</strong> AIå‘¨æŠ¥ç¬¬42æœŸå·²å‘é€
                                <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">2å¤©å‰</div>
                            </div>
                        </div>
                    `;
                    document.getElementById('recentActivities').innerHTML = activitiesHtml;
                }, 1500);

            } catch (error) {
                console.error('åŠ è½½ä»ªè¡¨æ¿æ•°æ®å¤±è´¥:', error);
            }
        }

        // æ˜¾ç¤ºæ¨¡å—
        function showModule(moduleId) {
            // éšè—æ‰€æœ‰æ¨¡å—
            document.querySelectorAll('.content-module').forEach(module => {
                module.classList.remove('active');
            });

            // ç§»é™¤æ‰€æœ‰å¯¼èˆªé¡¹çš„activeçŠ¶æ€
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // æ˜¾ç¤ºç›®æ ‡æ¨¡å—
            const targetModule = document.getElementById(moduleId + '-module');
            if (targetModule) {
                targetModule.classList.add('active');
            }

            // è®¾ç½®å¯¼èˆªé¡¹activeçŠ¶æ€
            event.target.closest('.nav-item').classList.add('active');

            // æ›´æ–°é¡µé¢æ ‡é¢˜
            const titles = {
                dashboard: { title: 'ä»ªè¡¨æ¿', subtitle: 'SVTR å¹³å°è¿è¥æ¦‚è§ˆ' },
                content: { title: 'å†…å®¹åˆ›ä½œ', subtitle: 'ç®¡ç†AIå‘¨æŠ¥å’ŒæŠ•èµ„æ´å¯Ÿå†…å®¹' },
                subscription: { title: 'è®¢é˜…ç®¡ç†', subtitle: 'ç®¡ç†AIå‘¨æŠ¥è®¢é˜…ç”¨æˆ·å’Œé‚®ä»¶åˆ—è¡¨' },
                projects: { title: 'é¡¹ç›®ç®¡ç†', subtitle: 'ç®¡ç†æŠ•èµ„é¡¹ç›®å’Œç”³è¯·' },
                users: { title: 'ç”¨æˆ·ç®¡ç†', subtitle: 'ç®¡ç†å¹³å°ç”¨æˆ·å’Œæƒé™' },
                analytics: { title: 'æ•°æ®åˆ†æ', subtitle: 'å¹³å°è¿è¥æ•°æ®å’ŒæŠ•èµ„ç»Ÿè®¡' },
                reports: { title: 'æŠ¥å‘Šç”Ÿæˆ', subtitle: 'ç”Ÿæˆè¿è¥å’ŒæŠ•èµ„åˆ†ææŠ¥å‘Š' },
                settings: { title: 'ç³»ç»Ÿè®¾ç½®', subtitle: 'é…ç½®å¹³å°å‚æ•°å’Œç³»ç»Ÿè®¾ç½®' },
                logs: { title: 'æ“ä½œæ—¥å¿—', subtitle: 'æŸ¥çœ‹ç³»ç»Ÿå’Œç”¨æˆ·æ“ä½œè®°å½•' }
            };

            const titleData = titles[moduleId] || titles.dashboard;
            document.getElementById('pageTitle').textContent = titleData.title;
            document.getElementById('pageSubtitle').textContent = titleData.subtitle;

            currentModule = moduleId;

            // åŠ è½½æ¨¡å—ç‰¹å®šæ•°æ®
            if (moduleId === 'projects') {
                loadProjectsData();
            } else if (moduleId === 'subscription') {
                console.log('[æ¨¡å—åˆ‡æ¢] æ­£åœ¨åˆ‡æ¢åˆ°è®¢é˜…ç®¡ç†æ¨¡å—');
                loadSubscriptionsData();
            } else if (moduleId === 'users') {
                loadUsersData();
            }

            // å…³é—­ç§»åŠ¨ç«¯ä¾§è¾¹æ 
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('mobile-open');
            }
        }

        // åˆ‡æ¢ä¾§è¾¹æ  (ç§»åŠ¨ç«¯)
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('mobile-open');
        }

        // åˆ·æ–°æ•°æ®
        function refreshData() {
            const refreshBtn = event.target;
            const originalText = refreshBtn.innerHTML;
            
            refreshBtn.innerHTML = '<span class="loading-spinner"></span> åˆ·æ–°ä¸­...';
            refreshBtn.disabled = true;

            loadDashboardData().finally(() => {
                setTimeout(() => {
                    refreshBtn.innerHTML = originalText;
                    refreshBtn.disabled = false;
                }, 1000);
            });
        }

        // å¿«æ·æ“ä½œ
        function showQuickActions() {
            alert('å¿«æ·æ“ä½œåŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...\n\nè®¡åˆ’åŒ…æ‹¬:\nâ€¢ å¿«é€Ÿåˆ›å»ºé¡¹ç›®\nâ€¢ å‘é€é€šçŸ¥\nâ€¢ ç”ŸæˆæŠ¥å‘Š\nâ€¢ æ•°æ®å¯¼å‡º');
        }

        // ç‚¹å‡»ä¾§è¾¹æ å¤–éƒ¨å…³é—­ (ç§»åŠ¨ç«¯)
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            
            if (window.innerWidth <= 768 && 
                sidebar.classList.contains('mobile-open') && 
                !sidebar.contains(event.target) && 
                !mobileMenuBtn.contains(event.target)) {
                sidebar.classList.remove('mobile-open');
            }
        });

        // çª—å£å¤§å°æ”¹å˜æ—¶é‡ç½®ä¾§è¾¹æ çŠ¶æ€
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                document.getElementById('sidebar').classList.remove('mobile-open');
            }
        });

        // è®¢é˜…ç®¡ç†ç›¸å…³å‡½æ•°
        let subscriptionsData = [];
        let filteredSubscriptionsData = [];

        async function loadSubscriptionsData() {
            try {
                console.log('[è®¢é˜…ç®¡ç†] å¼€å§‹åŠ è½½è®¢é˜…æ•°æ®...');
                
                // è·å–è®¢é˜…ç»Ÿè®¡
                const statsResponse = await fetch('/api/subscribe?action=stats');
                console.log('[è®¢é˜…ç®¡ç†] ç»Ÿè®¡APIå“åº”çŠ¶æ€:', statsResponse.status);
                
                if (statsResponse.ok) {
                    const stats = await statsResponse.json();
                    console.log('[è®¢é˜…ç®¡ç†] ç»Ÿè®¡æ•°æ®:', stats);
                    updateSubscriptionStats(stats);
                } else {
                    console.error('[è®¢é˜…ç®¡ç†] ç»Ÿè®¡APIå¤±è´¥:', statsResponse.status, statsResponse.statusText);
                }
                
                // è·å–è®¢é˜…è€…åˆ—è¡¨
                const listResponse = await fetch('/api/subscribe?action=list');
                console.log('[è®¢é˜…ç®¡ç†] åˆ—è¡¨APIå“åº”çŠ¶æ€:', listResponse.status);
                
                if (listResponse.ok) {
                    const subscribers = await listResponse.json();
                    console.log('[è®¢é˜…ç®¡ç†] è®¢é˜…è€…åˆ—è¡¨:', subscribers);
                    subscriptionsData = Array.isArray(subscribers) ? subscribers : [];
                    filteredSubscriptionsData = [...subscriptionsData];
                    console.log('[è®¢é˜…ç®¡ç†] å‡†å¤‡æ¸²æŸ“è¡¨æ ¼ï¼Œæ•°æ®æ•°é‡:', filteredSubscriptionsData.length);
                    renderSubscriptionsTable();
                } else {
                    console.error('[è®¢é˜…ç®¡ç†] åˆ—è¡¨APIå¤±è´¥:', listResponse.status, listResponse.statusText);
                }
                
            } catch (error) {
                console.error('[è®¢é˜…ç®¡ç†] åŠ è½½æ•°æ®å¤±è´¥:', error);
                document.getElementById('subscriptionsTableContainer').innerHTML = `
                    <div class="error-message">
                        <div style="color: #dc3545; text-align: center; padding: 20px;">
                            <div>âŒ åŠ è½½è®¢é˜…æ•°æ®å¤±è´¥</div>
                            <div style="font-size: 14px; margin-top: 5px;">é”™è¯¯: ${error.message}</div>
                            <button class="btn-primary" onclick="loadSubscriptionsData()" style="margin-top: 10px;">é‡è¯•</button>
                        </div>
                    </div>
                `;
            }
        }

        function updateSubscriptionStats(stats) {
            // æ›´æ–°ç»Ÿè®¡å¡ç‰‡æ•°æ®
            document.getElementById('subscription-total-subscribers').textContent = stats.totalSubscribers || 0;
            document.getElementById('subscription-today-new').textContent = stats.todaySubscribers || 0;
            
            const zhUsers = stats.languageDistribution?.['zh-CN'] || 0;
            const enUsers = stats.languageDistribution?.['en-US'] || 0;
            const total = stats.totalSubscribers || 1;
            
            document.getElementById('subscription-zh-users').textContent = zhUsers;
            document.getElementById('subscription-en-users').textContent = enUsers;
            document.getElementById('subscription-zh-percentage').textContent = `${Math.round(zhUsers / total * 100)}%`;
            document.getElementById('subscription-en-percentage').textContent = `${Math.round(enUsers / total * 100)}%`;
            
            console.log('[è®¢é˜…ç»Ÿè®¡] æ•°æ®å·²æ›´æ–°:', {
                total: stats.totalSubscribers,
                today: stats.todaySubscribers,
                zh: zhUsers,
                en: enUsers
            });
        }

        function renderSubscriptionsTable() {
            const container = document.getElementById('subscriptionsTableContainer');
            
            if (filteredSubscriptionsData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <h3>æš‚æ— è®¢é˜…æ•°æ®</h3>
                        <p>è¿˜æ²¡æœ‰ç”¨æˆ·è®¢é˜…AIå‘¨æŠ¥</p>
                    </div>
                `;
                return;
            }

            const tableHTML = `
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th class="sortable-header" onclick="sortSubscriptions('email')">é‚®ç®±åœ°å€</th>
                                <th class="sortable-header" onclick="sortSubscriptions('preferences')">è®¢é˜…åå¥½</th>
                                <th class="sortable-header" onclick="sortSubscriptions('language')">è¯­è¨€</th>
                                <th class="sortable-header" onclick="sortSubscriptions('subscribedAt')">è®¢é˜…æ—¶é—´</th>
                                <th class="sortable-header" onclick="sortSubscriptions('location')">åœ°ç†ä½ç½®</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredSubscriptionsData.map(subscriber => `
                                <tr>
                                    <td>
                                        <div class="email-cell">
                                            <strong>${subscriber.email}</strong>
                                            <small>${subscriber.email.split('@')[1]}</small>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="preferences-cell">
                                            ${(subscriber.preferences || []).map(pref => 
                                                `<span class="preference-tag">${pref}</span>`
                                            ).join('')}
                                        </div>
                                    </td>
                                    <td>
                                        <span class="language-badge ${subscriber.language === 'zh-CN' ? 'zh' : 'en'}">
                                            ${subscriber.language === 'zh-CN' ? 'ğŸ‡¨ğŸ‡³ ä¸­æ–‡' : 'ğŸ‡ºğŸ‡¸ è‹±æ–‡'}
                                        </span>
                                    </td>
                                    <td class="date-cell">${formatSubscriptionDate(subscriber.subscribedAt)}</td>
                                    <td class="location-cell">${subscriber.location || 'æœªçŸ¥åœ°åŒº'}</td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn-small btn-info" onclick="viewSubscriptionDetails('${subscriber.email}')" title="æŸ¥çœ‹è¯¦æƒ…">
                                                ğŸ‘ï¸
                                            </button>
                                            <button class="btn-small btn-danger" onclick="removeSubscription('${subscriber.email}')" title="å–æ¶ˆè®¢é˜…">
                                                ğŸ—‘ï¸
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                <div class="table-info">
                    <span>å…± ${filteredSubscriptionsData.length} ä¸ªè®¢é˜…è€… (æ€»è®¡ ${subscriptionsData.length} ä¸ª)</span>
                </div>
            `;
            
            container.innerHTML = tableHTML;
        }

        // è®¢é˜…ç®¡ç†è¡¨æ ¼æ’åºåŠŸèƒ½
        let subscriptionsSortField = null;
        let subscriptionsSortDirection = 'asc';

        function sortSubscriptions(field) {
            // æ›´æ–°æ’åºçŠ¶æ€
            if (subscriptionsSortField === field) {
                subscriptionsSortDirection = subscriptionsSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                subscriptionsSortField = field;
                subscriptionsSortDirection = 'asc';
            }

            // æ‰§è¡Œæ’åº
            filteredSubscriptionsData.sort((a, b) => {
                let valueA, valueB;
                
                switch (field) {
                    case 'email':
                        valueA = a.email.toLowerCase();
                        valueB = b.email.toLowerCase();
                        break;
                    case 'preferences':
                        valueA = (a.preferences || []).join('');
                        valueB = (b.preferences || []).join('');
                        break;
                    case 'language':
                        valueA = a.language || '';
                        valueB = b.language || '';
                        break;
                    case 'subscribedAt':
                        valueA = new Date(a.subscribedAt).getTime();
                        valueB = new Date(b.subscribedAt).getTime();
                        break;
                    case 'location':
                        valueA = (a.location || '').toLowerCase();
                        valueB = (b.location || '').toLowerCase();
                        break;
                    default:
                        return 0;
                }

                if (valueA < valueB) return subscriptionsSortDirection === 'asc' ? -1 : 1;
                if (valueA > valueB) return subscriptionsSortDirection === 'asc' ? 1 : -1;
                return 0;
            });

            // é‡æ–°æ¸²æŸ“è¡¨æ ¼
            renderSubscriptionsTable();

            // æ›´æ–°è¡¨å¤´æ ·å¼
            updateSubscriptionsSortHeaders();
        }

        function updateSubscriptionsSortHeaders() {
            // æ¸…é™¤æ‰€æœ‰æ’åºæ ·å¼
            const headers = document.querySelectorAll('#subscription-module .sortable-header');
            headers.forEach(header => {
                header.classList.remove('sort-asc', 'sort-desc');
            });

            // æ·»åŠ å½“å‰æ’åºæ ·å¼
            if (subscriptionsSortField) {
                const fieldMap = {
                    'email': 0,
                    'preferences': 1,
                    'language': 2,
                    'subscribedAt': 3,
                    'location': 4
                };
                
                const headerIndex = fieldMap[subscriptionsSortField];
                if (headerIndex !== undefined) {
                    const header = headers[headerIndex];
                    if (header) {
                        header.classList.add(subscriptionsSortDirection === 'asc' ? 'sort-asc' : 'sort-desc');
                    }
                }
            }
        }

        function filterSubscriptions() {
            const languageFilter = document.getElementById('subscriptionLanguageFilter').value;
            const searchInput = document.getElementById('subscriptionSearchInput').value.toLowerCase();
            const dateFilter = document.getElementById('subscriptionDateFilter').value;
            
            filteredSubscriptionsData = subscriptionsData.filter(subscriber => {
                const matchesLanguage = !languageFilter || subscriber.language === languageFilter;
                const matchesSearch = !searchInput || subscriber.email.toLowerCase().includes(searchInput);
                const matchesDate = !dateFilter || subscriber.subscribedAt?.startsWith(dateFilter);
                
                return matchesLanguage && matchesSearch && matchesDate;
            });
            
            renderSubscriptionsTable();
        }

        function refreshSubscriptions() {
            loadSubscriptionsData();
        }

        function exportSubscriptions() {
            try {
                const csvContent = [
                    ['é‚®ç®±åœ°å€', 'è®¢é˜…åå¥½', 'è¯­è¨€', 'è®¢é˜…æ—¶é—´', 'åœ°ç†ä½ç½®', 'User Agent'],
                    ...filteredSubscriptionsData.map(sub => [
                        sub.email,
                        (sub.preferences || []).join('; '),
                        sub.language,
                        sub.subscribedAt,
                        sub.location || 'æœªçŸ¥åœ°åŒº',
                        sub.userAgent || ''
                    ])
                ].map(row => row.map(field => `"${String(field).replace(/"/g, '""')}"`).join(',')).join('\n');
                
                const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `SVTRè®¢é˜…è€…æ•°æ®_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                
                console.log('è®¢é˜…æ•°æ®å¯¼å‡ºæˆåŠŸ');
            } catch (error) {
                console.error('å¯¼å‡ºå¤±è´¥:', error);
                alert('å¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        function viewSubscriptionDetails(email) {
            const subscriber = subscriptionsData.find(sub => sub.email === email);
            if (!subscriber) return;
            
            const detailsHTML = `
                <div class="modal-content">
                    <h3>è®¢é˜…è€…è¯¦æƒ…</h3>
                    <div class="details-grid">
                        <div class="detail-item">
                            <label>é‚®ç®±åœ°å€:</label>
                            <span>${subscriber.email}</span>
                        </div>
                        <div class="detail-item">
                            <label>è®¢é˜…åå¥½:</label>
                            <span>${(subscriber.preferences || []).join(', ')}</span>
                        </div>
                        <div class="detail-item">
                            <label>è¯­è¨€è®¾ç½®:</label>
                            <span>${subscriber.language === 'zh-CN' ? 'ä¸­æ–‡' : 'è‹±æ–‡'}</span>
                        </div>
                        <div class="detail-item">
                            <label>è®¢é˜…æ—¶é—´:</label>
                            <span>${formatSubscriptionDate(subscriber.subscribedAt)}</span>
                        </div>
                        <div class="detail-item">
                            <label>åœ°ç†ä½ç½®:</label>
                            <span>${subscriber.location || 'æœªçŸ¥åœ°åŒº'}</span>
                        </div>
                        <div class="detail-item">
                            <label>æµè§ˆå™¨:</label>
                            <span>${subscriber.userAgent || 'æœªè®°å½•'}</span>
                        </div>
                    </div>
                </div>
            `;
            
            showModal('è®¢é˜…è€…è¯¦æƒ…', detailsHTML);
        }

        function removeSubscription(email) {
            if (confirm(`ç¡®å®šè¦å–æ¶ˆ ${email} çš„è®¢é˜…å—ï¼Ÿ`)) {
                // è¿™é‡Œå¯ä»¥æ·»åŠ å–æ¶ˆè®¢é˜…çš„APIè°ƒç”¨
                alert('å–æ¶ˆè®¢é˜…åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
            }
        }

        function formatSubscriptionDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('zh-CN') + ' ' + date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            } catch (error) {
                return 'æ— æ•ˆæ—¥æœŸ';
            }
        }

        // é¡¹ç›®ç®¡ç†ç›¸å…³å‡½æ•°
        async function loadProjectsData() {
            try {
                console.log('åŠ è½½é¡¹ç›®æ•°æ®...');
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                const refreshBtn = document.querySelector('button[onclick="loadProjectsData()"]');
                const originalText = refreshBtn?.textContent;
                if (refreshBtn) {
                    refreshBtn.textContent = 'ğŸ”„ åŠ è½½ä¸­...';
                    refreshBtn.disabled = true;
                }
                
                // è·å–é¡¹ç›®ç»Ÿè®¡
                const statsResponse = await fetch('/api/projects?action=stats');
                if (statsResponse.ok) {
                    const stats = await statsResponse.json();
                    updateProjectStats(stats);
                }
                
                // è·å–é¡¹ç›®åˆ—è¡¨
                const listResponse = await fetch('/api/projects?action=list');
                if (listResponse.ok) {
                    const projects = await listResponse.json();
                    projectsData = Array.isArray(projects) ? projects : [];
                    filteredProjectsData = [...projectsData];
                    renderProjectsTable();
                }
                
                // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
                const lastUpdateElement = document.getElementById('lastUpdateTime');
                if (lastUpdateElement) {
                    lastUpdateElement.textContent = `æœ€åæ›´æ–°: ${new Date().toLocaleString('zh-CN')}`;
                }
                
                console.log(`é¡¹ç›®æ•°æ®åŠ è½½å®Œæˆï¼Œå…± ${projectsData.length} ä¸ªé¡¹ç›®`);
                
            } catch (error) {
                console.error('åŠ è½½é¡¹ç›®æ•°æ®å¤±è´¥:', error);
                document.getElementById('projectsTableContainer').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #d32f2f;">
                        <h3>âš ï¸ åŠ è½½å¤±è´¥</h3>
                        <p>æ— æ³•åŠ è½½é¡¹ç›®æ•°æ®: ${error.message}</p>
                        <button class="btn-primary" onclick="loadProjectsData()">é‡æ–°åŠ è½½</button>
                    </div>
                `;
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                const refreshBtn = document.querySelector('button[onclick="loadProjectsData()"]');
                if (refreshBtn && originalText) {
                    refreshBtn.textContent = originalText;
                    refreshBtn.disabled = false;
                }
            }
        }

        function updateProjectStats(stats) {
            document.getElementById('totalProjectsCount').textContent = stats.totalProjects || 0;
            document.getElementById('activeProjectsCount').textContent = stats.activeProjects || 0;
            document.getElementById('pendingProjectsCount').textContent = stats.pendingProjects || 0;
            
            const totalFunding = stats.totalFunding || 0;
            document.getElementById('totalFundingAmount').textContent = formatCurrency(totalFunding);
        }

        function renderProjectsTable() {
            const container = document.getElementById('projectsTableContainer');
            
            if (filteredProjectsData.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px; color: #666;">
                        <div style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;">ğŸ’¼</div>
                        <h3>æš‚æ— é¡¹ç›®æ•°æ®</h3>
                        <p>ç‚¹å‡»"åˆ›å»ºé¡¹ç›®"å¼€å§‹æ·»åŠ ç¬¬ä¸€ä¸ªé¡¹ç›®</p>
                    </div>
                `;
                return;
            }

            const tableHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th class="sortable-header" onclick="sortProjects('name')">é¡¹ç›®åç§°</th>
                            <th class="sortable-header" onclick="sortProjects('founder')">åˆ›å§‹äºº</th>
                            <th class="sortable-header" onclick="sortProjects('category')">ç±»åˆ«</th>
                            <th class="sortable-header" onclick="sortProjects('need')">éœ€æ±‚</th>
                            <th>é™„ä»¶</th>
                            <th class="sortable-header" onclick="sortProjects('stage')">é˜¶æ®µ</th>
                            <th class="sortable-header" onclick="sortProjects('status')">çŠ¶æ€</th>
                            <th class="sortable-header" onclick="sortProjects('fundingGoal')">èèµ„ç›®æ ‡</th>
                            <th class="sortable-header" onclick="sortProjects('createdAt')">åˆ›å»ºæ—¶é—´</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredProjectsData.map(project => `
                            <tr>
                                <td>
                                    <strong>${project.name}</strong>
                                    <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                                        ${project.description.substring(0, 50)}...
                                    </div>
                                </td>
                                <td>
                                    <div>${project.founder}</div>
                                    <div style="font-size: 0.8rem; color: #666;">${project.founderEmail}</div>
                                </td>
                                <td>
                                    <span style="background: #e3f2fd; color: #1976d2; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">
                                        ${project.category}
                                    </span>
                                </td>
                                <td>
                                    ${project.needs && project.needs.length > 0 ? 
                                        project.needs.map(need => 
                                            `<span style="background: #f3e5f5; color: #7b1fa2; padding: 2px 6px; border-radius: 10px; font-size: 0.75rem; margin: 1px; display: inline-block;">${need}</span>`
                                        ).join('') : 
                                        '<span style="color: #999; font-size: 0.8rem;">æ— </span>'
                                    }
                                </td>
                                <td>
                                    ${project.files && project.files.length > 0 ? 
                                        `<div>
                                            <span style="color: #4caf50; font-size: 0.8rem; cursor: pointer;" onclick="showProjectFiles('${project.id}')">ğŸ“ ${project.files.length} ä¸ªæ–‡ä»¶</span>
                                            <div style="font-size: 0.7rem; color: #666; margin-top: 2px;">
                                                ${project.files.slice(0, 2).map(file => 
                                                    `<div>${file.name.length > 20 ? file.name.substring(0, 20) + '...' : file.name}</div>`
                                                ).join('')}
                                                ${project.files.length > 2 ? `<div>+${project.files.length - 2} ä¸ªæ›´å¤š...</div>` : ''}
                                            </div>
                                         </div>` : 
                                        '<span style="color: #999; font-size: 0.8rem;">æ— é™„ä»¶</span>'
                                    }
                                </td>
                                <td>${formatStage(project.stage)}</td>
                                <td>
                                    <span class="status-badge ${getStatusClass(project.status)}">
                                        ${formatStatus(project.status)}
                                    </span>
                                </td>
                                <td>${formatCurrency(project.fundingGoal)}</td>
                                <td>${formatDateTime(project.createdAt)}</td>
                                <td>
                                    <button onclick="viewProjectDetails('${project.id}')" class="btn-secondary" style="padding: 4px 8px; font-size: 0.8rem; margin-right: 5px;">æŸ¥çœ‹</button>
                                    <button onclick="editProject('${project.id}')" class="btn-primary" style="padding: 4px 8px; font-size: 0.8rem;">ç¼–è¾‘</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = tableHTML;
        }

        // é¡¹ç›®ç®¡ç†è¡¨æ ¼æ’åºåŠŸèƒ½
        let projectsSortField = null;
        let projectsSortDirection = 'asc';

        function sortProjects(field) {
            // æ›´æ–°æ’åºçŠ¶æ€
            if (projectsSortField === field) {
                projectsSortDirection = projectsSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                projectsSortField = field;
                projectsSortDirection = 'asc';
            }

            // æ‰§è¡Œæ’åº
            filteredProjectsData.sort((a, b) => {
                let valueA, valueB;
                
                switch (field) {
                    case 'name':
                        valueA = (a.name || '').toLowerCase();
                        valueB = (b.name || '').toLowerCase();
                        break;
                    case 'founder':
                        valueA = (a.founder || '').toLowerCase();
                        valueB = (b.founder || '').toLowerCase();
                        break;
                    case 'category':
                        valueA = a.category || '';
                        valueB = b.category || '';
                        break;
                    case 'need':
                        valueA = a.need || '';
                        valueB = b.need || '';
                        break;
                    case 'stage':
                        valueA = a.stage || '';
                        valueB = b.stage || '';
                        break;
                    case 'status':
                        valueA = a.status || '';
                        valueB = b.status || '';
                        break;
                    case 'fundingGoal':
                        valueA = parseFloat(a.fundingGoal) || 0;
                        valueB = parseFloat(b.fundingGoal) || 0;
                        break;
                    case 'createdAt':
                        valueA = new Date(a.createdAt).getTime();
                        valueB = new Date(b.createdAt).getTime();
                        break;
                    default:
                        return 0;
                }

                if (valueA < valueB) return projectsSortDirection === 'asc' ? -1 : 1;
                if (valueA > valueB) return projectsSortDirection === 'asc' ? 1 : -1;
                return 0;
            });

            // é‡æ–°æ¸²æŸ“è¡¨æ ¼
            renderProjectsTable();

            // æ›´æ–°è¡¨å¤´æ ·å¼
            updateProjectsSortHeaders();
        }

        function updateProjectsSortHeaders() {
            // æ¸…é™¤æ‰€æœ‰æ’åºæ ·å¼
            const headers = document.querySelectorAll('#projects-module .sortable-header');
            headers.forEach(header => {
                header.classList.remove('sort-asc', 'sort-desc');
            });

            // æ·»åŠ å½“å‰æ’åºæ ·å¼
            if (projectsSortField) {
                const fieldMap = {
                    'name': 0,
                    'founder': 1,
                    'category': 2,
                    'need': 3,
                    'stage': 5,  // è·³è¿‡é™„ä»¶åˆ—
                    'status': 6,
                    'fundingGoal': 7,
                    'createdAt': 8
                };
                
                const headerIndex = fieldMap[projectsSortField];
                if (headerIndex !== undefined) {
                    const header = headers[headerIndex];
                    if (header) {
                        header.classList.add(projectsSortDirection === 'asc' ? 'sort-asc' : 'sort-desc');
                    }
                }
            }
        }

        function filterProjects() {
            const statusFilter = document.getElementById('projectStatusFilter').value;
            const categoryFilter = document.getElementById('projectCategoryFilter').value;
            const searchTerm = document.getElementById('projectSearchInput').value.toLowerCase();
            
            filteredProjectsData = projectsData.filter(project => {
                if (statusFilter && project.status !== statusFilter) return false;
                if (categoryFilter && project.category !== categoryFilter) return false;
                if (searchTerm && !project.name.toLowerCase().includes(searchTerm)) return false;
                return true;
            });
            
            renderProjectsTable();
        }

        function showCreateProjectModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); display: flex; align-items: center; 
                justify-content: center; z-index: 2000; overflow-y: auto;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white; padding: 30px; border-radius: 15px; 
                max-width: 700px; width: 90%; max-height: 90vh; overflow-y: auto;
                box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            `;
            
            modalContent.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h3 style="margin: 0; color: #333;">ğŸ“ åˆ›å»ºæ–°é¡¹ç›®</h3>
                    <button onclick="this.closest('[data-modal]').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">&times;</button>
                </div>
                <form id="createProjectForm" onsubmit="return false;">
                    <div class="form-group">
                        <label class="form-label">é¡¹ç›®åç§° *</label>
                        <input type="text" id="projectName" name="name" class="form-input" required placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°ï¼ˆè‡³å°‘2ä¸ªå­—ç¬¦ï¼‰">
                        <small class="form-help" style="display: none; color: #666;">é¡¹ç›®åç§°è‡³å°‘éœ€è¦2ä¸ªå­—ç¬¦</small>
                        <small class="form-error" style="display: none; color: #e74c3c;"></small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">é¡¹ç›®éœ€æ±‚ *</label>
                        <div class="checkbox-group" style="display: flex; gap: 15px; margin-top: 8px;">
                            <label class="checkbox-item" style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" name="projectNeeds" value="æ‰¾äºº" style="margin-right: 8px;">
                                <span>æ‰¾äºº</span>
                            </label>
                            <label class="checkbox-item" style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" name="projectNeeds" value="æ‰¾é’±" style="margin-right: 8px;">
                                <span>æ‰¾é’±</span>
                            </label>
                            <label class="checkbox-item" style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" name="projectNeeds" value="æ‰¾æ–¹å‘" style="margin-right: 8px;">
                                <span>æ‰¾æ–¹å‘</span>
                            </label>
                            <label class="checkbox-item" style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" name="projectNeeds" value="å…¶ä»–" id="needOther" style="margin-right: 8px;">
                                <span>å…¶ä»–</span>
                            </label>
                        </div>
                        <input type="text" id="otherNeed" placeholder="è¯·æè¿°å…¶ä»–éœ€æ±‚..." style="display: none; margin-top: 8px; width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <small class="form-error" style="display: none; color: #e74c3c;">è‡³å°‘é€‰æ‹©ä¸€ä¸ªé¡¹ç›®éœ€æ±‚</small>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label class="form-label">é¡¹ç›®ç±»åˆ« *</label>
                            <select id="projectCategory" name="category" class="form-input" required>
                                <option value="">è¯·é€‰æ‹©ç±»åˆ«</option>
                                <option value="ai">äººå·¥æ™ºèƒ½ (AI)</option>
                                <option value="fintech">é‡‘èç§‘æŠ€ (Fintech)</option>
                                <option value="healthcare">åŒ»ç–—å¥åº· (Healthcare)</option>
                                <option value="ecommerce">ç”µå­å•†åŠ¡ (E-commerce)</option>
                                <option value="enterprise">ä¼ä¸šæœåŠ¡ (Enterprise)</option>
                                <option value="consumer">æ¶ˆè´¹ç§‘æŠ€ (Consumer)</option>
                                <option value="other">å…¶ä»– (Other)</option>
                            </select>
                            <small class="form-error" style="display: none; color: #e74c3c;">è¯·é€‰æ‹©æœ‰æ•ˆçš„é¡¹ç›®ç±»åˆ«</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">èèµ„é˜¶æ®µ *</label>
                            <select id="projectStage" name="stage" class="form-input" required>
                                <option value="">è¯·é€‰æ‹©é˜¶æ®µ</option>
                                <option value="idea">åˆ›æ„é˜¶æ®µ</option>
                                <option value="seed">ç§å­è½®</option>
                                <option value="series-a">Aè½®</option>
                                <option value="series-b">Bè½®</option>
                                <option value="series-c">Cè½®</option>
                                <option value="ipo">IPO</option>
                            </select>
                            <small class="form-error" style="display: none; color: #e74c3c;">è¯·é€‰æ‹©æœ‰æ•ˆçš„èèµ„é˜¶æ®µ</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">é¡¹ç›®æè¿° *</label>
                        <textarea id="projectDescription" name="description" class="form-input form-textarea" required placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„é¡¹ç›®ï¼ˆè‡³å°‘5ä¸ªå­—ç¬¦ï¼‰" rows="4"></textarea>
                        <small class="form-help" style="display: none; color: #666;">é¡¹ç›®æè¿°è‡³å°‘éœ€è¦5ä¸ªå­—ç¬¦</small>
                        <small class="form-error" style="display: none; color: #e74c3c;"></small>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label class="form-label">åˆ›å§‹äººå§“å *</label>
                            <input type="text" id="founderName" name="founder" class="form-input" required placeholder="è¯·è¾“å…¥åˆ›å§‹äººå§“åï¼ˆè‡³å°‘2ä¸ªå­—ç¬¦ï¼‰">
                            <small class="form-error" style="display: none; color: #e74c3c;">åˆ›å§‹äººå§“åè‡³å°‘éœ€è¦2ä¸ªå­—ç¬¦</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">åˆ›å§‹äººé‚®ç®± *</label>
                            <input type="email" id="founderEmail" name="founderEmail" class="form-input" required placeholder="you@company.com">
                            <small class="form-error" style="display: none; color: #e74c3c;">è¯·æä¾›æœ‰æ•ˆçš„é‚®ç®±åœ°å€</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">èèµ„ç›®æ ‡ (USD) *</label>
                        <input type="number" id="fundingGoal" name="fundingGoal" class="form-input" min="1" required placeholder="ä¾‹å¦‚ï¼š1000000">
                        <small class="form-help" style="color: #666;">è¯·è¾“å…¥èèµ„ç›®æ ‡é‡‘é¢ï¼ˆç¾å…ƒï¼‰</small>
                        <small class="form-error" style="display: none; color: #e74c3c;">èèµ„ç›®æ ‡å¿…é¡»å¤§äº0</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ä¸Šä¼ é™„ä»¶</label>
                        <div class="file-upload-area" id="fileUploadArea" style="border: 2px dashed #ddd; border-radius: 8px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s ease;">
                            <input type="file" id="projectFiles" multiple accept=".pdf,.doc,.docx,.ppt,.pptx,.txt,.jpg,.png" style="display: none;">
                            <div class="upload-placeholder">
                                <div class="upload-icon" style="font-size: 2rem; margin-bottom: 10px;">ğŸ“</div>
                                <div class="upload-text" style="font-weight: 500; margin-bottom: 5px;">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ é™„ä»¶</div>
                                <div class="upload-hint" style="font-size: 0.9rem; color: #666;">æ”¯æŒ PDF, DOC, PPT, TXT, å›¾ç‰‡ç­‰æ ¼å¼ï¼Œæœ€å¤š5ä¸ªæ–‡ä»¶</div>
                            </div>
                            <div class="uploaded-files" id="uploadedFiles"></div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 25px;">
                        <button type="button" onclick="this.closest('[data-modal]').remove()" class="btn-secondary" style="margin-right: 10px;">å–æ¶ˆ</button>
                        <button type="button" onclick="createProject()" class="btn-primary" id="createProjectBtn">åˆ›å»ºé¡¹ç›®</button>
                    </div>
                </form>
            `;
            
            modal.setAttribute('data-modal', 'true');
            modal.appendChild(modalContent);
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
            
            document.body.appendChild(modal);
            
            // åˆå§‹åŒ–è¡¨å•éªŒè¯å’Œæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
            initializeAdminFormValidation();
        }

        // è¡¨å•éªŒè¯å’Œæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½åˆå§‹åŒ–
        function initializeAdminFormValidation() {
            // "å…¶ä»–"é€‰é¡¹çš„æ˜¾ç¤º/éšè—é€»è¾‘
            const otherCheckbox = document.getElementById('needOther');
            const otherInput = document.getElementById('otherNeed');
            
            if (otherCheckbox && otherInput) {
                otherCheckbox.addEventListener('change', function() {
                    if (this.checked) {
                        otherInput.style.display = 'block';
                        otherInput.focus();
                    } else {
                        otherInput.style.display = 'none';
                        otherInput.value = '';
                    }
                });
            }
            
            // æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
            const fileUploadArea = document.getElementById('fileUploadArea');
            const fileInput = document.getElementById('projectFiles');
            const uploadedFiles = document.getElementById('uploadedFiles');
            
            let selectedFiles = [];
            
            if (fileUploadArea && fileInput) {
                // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©
                fileUploadArea.addEventListener('click', () => fileInput.click());
                
                // æ‹–æ‹½ä¸Šä¼ 
                fileUploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    fileUploadArea.style.borderColor = '#FA8C32';
                    fileUploadArea.style.backgroundColor = '#fef9f5';
                });
                
                fileUploadArea.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    fileUploadArea.style.borderColor = '#ddd';
                    fileUploadArea.style.backgroundColor = 'transparent';
                });
                
                fileUploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    fileUploadArea.style.borderColor = '#ddd';
                    fileUploadArea.style.backgroundColor = 'transparent';
                    
                    const files = Array.from(e.dataTransfer.files);
                    handleFileSelection(files);
                });
                
                // æ–‡ä»¶é€‰æ‹©
                fileInput.addEventListener('change', (e) => {
                    const files = Array.from(e.target.files);
                    handleFileSelection(files);
                });
                
                function handleFileSelection(files) {
                    const allowedTypes = ['.pdf', '.doc', '.docx', '.ppt', '.pptx', '.txt', '.jpg', '.jpeg', '.png'];
                    const maxFiles = 5;
                    const maxFileSize = 10 * 1024 * 1024; // 10MB
                    
                    files.forEach(file => {
                        if (selectedFiles.length >= maxFiles) {
                            alert(`æœ€å¤šåªèƒ½ä¸Šä¼ ${maxFiles}ä¸ªæ–‡ä»¶`);
                            return;
                        }
                        
                        if (file.size > maxFileSize) {
                            alert(`æ–‡ä»¶ "${file.name}" è¶…è¿‡10MBå¤§å°é™åˆ¶`);
                            return;
                        }
                        
                        const fileExt = '.' + file.name.split('.').pop().toLowerCase();
                        if (!allowedTypes.includes(fileExt)) {
                            alert(`æ–‡ä»¶ "${file.name}" æ ¼å¼ä¸æ”¯æŒã€‚æ”¯æŒçš„æ ¼å¼ï¼š${allowedTypes.join(', ')}`);
                            return;
                        }
                        
                        selectedFiles.push(file);
                    });
                    
                    updateFilesList();
                }
                
                function updateFilesList() {
                    if (selectedFiles.length === 0) {
                        uploadedFiles.innerHTML = '';
                        return;
                    }
                    
                    const filesHTML = selectedFiles.map((file, index) => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #f8f9fa; border-radius: 4px; margin-top: 8px;">
                            <div>
                                <strong>${file.name}</strong>
                                <span style="color: #666; margin-left: 10px;">(${formatFileSize(file.size)})</span>
                            </div>
                            <button type="button" onclick="removeFile(${index})" style="background: #e74c3c; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 12px;">
                                åˆ é™¤
                            </button>
                        </div>
                    `).join('');
                    
                    uploadedFiles.innerHTML = filesHTML;
                }
                
                window.removeFile = function(index) {
                    selectedFiles.splice(index, 1);
                    updateFileSelection();
                    updateFilesList();
                }
                
                function updateFileSelection() {
                    const dt = new DataTransfer();
                    selectedFiles.forEach(file => dt.items.add(file));
                    fileInput.files = dt.files;
                }
                
                window.getAdminSelectedFiles = function() {
                    return selectedFiles;
                }
            }
            
            // å®æ—¶éªŒè¯
            setupFieldValidation('projectName', validateName);
            setupFieldValidation('projectDescription', validateDescription);
            setupFieldValidation('founderName', validateFounder);
            setupFieldValidation('founderEmail', validateEmail);
            setupFieldValidation('fundingGoal', validateFundingGoal);
            
            function setupFieldValidation(fieldId, validator) {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', () => {
                        const result = validator(field.value.trim());
                        showFieldValidation(field, result);
                    });
                    
                    field.addEventListener('blur', () => {
                        const result = validator(field.value.trim());
                        showFieldValidation(field, result);
                    });
                }
            }
            
            function showFieldValidation(field, result) {
                const formGroup = field.closest('.form-group');
                const helpText = formGroup.querySelector('.form-help');
                const errorText = formGroup.querySelector('.form-error');
                
                field.style.borderColor = result.valid ? '#28a745' : '#e74c3c';
                
                if (helpText) {
                    helpText.style.display = result.valid && result.showHelp ? 'block' : 'none';
                }
                
                if (errorText) {
                    if (result.valid) {
                        errorText.style.display = 'none';
                    } else {
                        errorText.style.display = 'block';
                        errorText.textContent = result.message;
                    }
                }
            }
        }
        
        // éªŒè¯å‡½æ•°
        function validateName(value) {
            if (!value || value.length < 2) {
                return { valid: false, message: 'é¡¹ç›®åç§°è‡³å°‘éœ€è¦2ä¸ªå­—ç¬¦' };
            }
            return { valid: true, showHelp: true };
        }
        
        function validateDescription(value) {
            if (!value || value.length < 5) {
                return { valid: false, message: 'é¡¹ç›®æè¿°è‡³å°‘éœ€è¦5ä¸ªå­—ç¬¦' };
            }
            return { valid: true, showHelp: true };
        }
        
        function validateFounder(value) {
            if (!value || value.length < 2) {
                return { valid: false, message: 'åˆ›å§‹äººå§“åè‡³å°‘éœ€è¦2ä¸ªå­—ç¬¦' };
            }
            return { valid: true };
        }
        
        function validateEmail(value) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!value || !emailRegex.test(value)) {
                return { valid: false, message: 'è¯·æä¾›æœ‰æ•ˆçš„é‚®ç®±åœ°å€' };
            }
            return { valid: true };
        }
        
        function validateFundingGoal(value) {
            const num = Number(value);
            if (!value || isNaN(num) || num <= 0) {
                return { valid: false, message: 'èèµ„ç›®æ ‡å¿…é¡»å¤§äº0' };
            }
            return { valid: true };
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function mapCategoryToAPI(category) {
            const categoryMap = {
                'ai': 'AI',
                'fintech': 'Fintech',
                'healthcare': 'Healthcare',
                'ecommerce': 'E-commerce',
                'enterprise': 'Enterprise',
                'consumer': 'Consumer',
                'other': 'Other'
            };
            return categoryMap[category] || 'Other';
        }
        
        function extractNameFromEmail(email) {
            const username = email.split('@')[0];
            return username.replace(/[._]/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        async function createProject() {
            const submitBtn = document.getElementById('createProjectBtn');
            const originalText = submitBtn.textContent;
            
            // æ˜¾ç¤ºæäº¤ä¸­çŠ¶æ€
            submitBtn.textContent = 'åˆ›å»ºä¸­...';
            submitBtn.disabled = true;
            
            try {
                // æ”¶é›†é¡¹ç›®éœ€æ±‚
                const needs = [];
                const needCheckboxes = document.querySelectorAll('input[name="projectNeeds"]:checked');
                needCheckboxes.forEach(checkbox => {
                    if (checkbox.value === 'å…¶ä»–') {
                        const otherNeed = document.getElementById('otherNeed').value.trim();
                        if (otherNeed) {
                            needs.push(`å…¶ä»–: ${otherNeed}`);
                        }
                    } else {
                        needs.push(checkbox.value);
                    }
                });
                
                // æ£€æŸ¥é¡¹ç›®éœ€æ±‚
                if (needs.length === 0) {
                    alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªé¡¹ç›®éœ€æ±‚');
                    return;
                }
                
                const form = document.getElementById('createProjectForm');
                const formData = new FormData(form);
                
                const projectData = {
                    name: document.getElementById('projectName').value.trim(),
                    description: document.getElementById('projectDescription').value.trim(),
                    category: mapCategoryToAPI(document.getElementById('projectCategory').value),
                    founder: document.getElementById('founderName').value.trim() || extractNameFromEmail(document.getElementById('founderEmail').value),
                    founderEmail: document.getElementById('founderEmail').value.trim(),
                    fundingGoal: Number(document.getElementById('fundingGoal').value),
                    stage: document.getElementById('projectStage').value,
                    tags: [document.getElementById('projectCategory').value],
                    needs: needs,
                    files: window.getAdminSelectedFiles ? window.getAdminSelectedFiles().map(file => ({
                        name: file.name,
                        size: file.size,
                        type: file.type
                    })) : [],
                    submittedAt: new Date().toISOString()
                };
                
                console.log('å‡†å¤‡åˆ›å»ºé¡¹ç›®æ•°æ®:', projectData);
                
                const response = await fetch('/api/projects', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(projectData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('é¡¹ç›®åˆ›å»ºæˆåŠŸï¼é¡¹ç›®ID: ' + result.data.projectId);
                    document.querySelector('[data-modal]').remove();
                    loadProjectsData(); // é‡æ–°åŠ è½½æ•°æ®
                } else {
                    let errorMessage = 'åˆ›å»ºå¤±è´¥: ' + (result.message || 'æœªçŸ¥é”™è¯¯');
                    
                    if (result.errors && result.errors.length > 0) {
                        errorMessage += '\n\nè¯¦ç»†é”™è¯¯ï¼š\n' + result.errors.join('\n');
                    }
                    
                    if (result.debug) {
                        errorMessage += '\n\nè°ƒè¯•ä¿¡æ¯ï¼š\n' + JSON.stringify(result.debug, null, 2);
                    }
                    
                    alert(errorMessage);
                }
            } catch (error) {
                console.error('é¡¹ç›®åˆ›å»ºå¤±è´¥:', error);
                alert('åˆ›å»ºå¤±è´¥: ' + error.message + '\nè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•ã€‚');
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        function viewProjectDetails(projectId) {
            const project = projectsData.find(p => p.id === projectId);
            if (!project) {
                alert('é¡¹ç›®ä¸å­˜åœ¨');
                return;
            }
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); display: flex; align-items: center; 
                justify-content: center; z-index: 2000; overflow-y: auto;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white; border-radius: 15px; 
                max-width: 900px; width: 95%; max-height: 90vh; overflow-y: auto;
                box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            `;
            
            // é¡¹ç›®çŠ¶æ€æ ·å¼æ˜ å°„
            const statusStyles = {
                'ç”³è¯·ä¸­': { bg: '#fef3c7', color: '#d97706', icon: 'â³' },
                'å·²é€šè¿‡': { bg: '#d1fae5', color: '#059669', icon: 'âœ…' },
                'å·²æ‹’ç»': { bg: '#fee2e2', color: '#dc2626', icon: 'âŒ' },
                'è¿›è¡Œä¸­': { bg: '#dbeafe', color: '#2563eb', icon: 'ğŸš€' },
                'å·²å®Œæˆ': { bg: '#f3e8ff', color: '#7c3aed', icon: 'ğŸ¯' }
            };
            
            const status = statusStyles[project.status] || { bg: '#f3f4f6', color: '#6b7280', icon: 'ğŸ“‹' };
            
            modalContent.innerHTML = `
                <div style="padding: 0; border-radius: 15px; overflow: hidden;">
                    <!-- é¡¹ç›®å¤´éƒ¨ -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div style="flex: 1;">
                                <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 10px; line-height: 1.2;">${project.name}</h2>
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                    <span style="background: ${status.bg}; color: ${status.color}; padding: 6px 12px; border-radius: 20px; font-size: 0.9rem; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                                        ${status.icon} ${project.status}
                                    </span>
                                    <span style="background: rgba(255,255,255,0.2); padding: 6px 12px; border-radius: 20px; font-size: 0.9rem; font-weight: 500;">
                                        ğŸ“ ${project.category}
                                    </span>
                                </div>
                                <div style="display: flex; flex-wrap: wrap; gap: 15px; font-size: 0.95rem; opacity: 0.9;">
                                    <span><strong>åˆ›å§‹äºº:</strong> ${project.founder}</span>
                                    <span><strong>ç”³è¯·æ—¶é—´:</strong> ${project.submitTime}</span>
                                    <span><strong>é¡¹ç›®ID:</strong> ${project.id}</span>
                                </div>
                            </div>
                            <button onclick="this.closest('[data-modal]').remove()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; transition: background 0.3s;">Ã—</button>
                        </div>
                    </div>
                    
                    <!-- é¡¹ç›®å†…å®¹ -->
                    <div style="padding: 30px;">
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px; margin-bottom: 30px;">
                            <!-- å·¦ä¾§è¯¦æƒ… -->
                            <div>
                                <div style="margin-bottom: 25px;">
                                    <h3 style="color: #1f2937; font-size: 1.3rem; font-weight: 600; margin-bottom: 15px; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px;">ğŸ“ é¡¹ç›®æè¿°</h3>
                                    <p style="color: #4b5563; line-height: 1.6; font-size: 1rem; background: #f9fafb; padding: 20px; border-radius: 10px; border-left: 4px solid #667eea;">${project.description || 'æš‚æ— æè¿°'}</p>
                                </div>
                                
                                <div style="margin-bottom: 25px;">
                                    <h3 style="color: #1f2937; font-size: 1.3rem; font-weight: 600; margin-bottom: 15px; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px;">ğŸ¯ éœ€æ±‚æ¸…å•</h3>
                                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                        ${(project.needs || []).map(need => `
                                            <span style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 8px 16px; border-radius: 25px; font-size: 0.9rem; font-weight: 500; display: inline-block; box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);">${need}</span>
                                        `).join('')}
                                        ${(!project.needs || project.needs.length === 0) ? '<span style="color: #9ca3af; font-style: italic;">æš‚æ— éœ€æ±‚ä¿¡æ¯</span>' : ''}
                                    </div>
                                </div>
                                
                                <div>
                                    <h3 style="color: #1f2937; font-size: 1.3rem; font-weight: 600; margin-bottom: 15px; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px;">ğŸ“ é¡¹ç›®é™„ä»¶</h3>
                                    <div id="projectFilesContainer">
                                        ${project.files && project.files.length > 0 ? 
                                            project.files.map((file, index) => `
                                                <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 10px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; transition: all 0.3s;">
                                                    <div style="display: flex; align-items: center; gap: 12px;">
                                                        <div style="width: 40px; height: 40px; background: #667eea; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.9rem;">
                                                            ${file.name.split('.').pop().toUpperCase()}
                                                        </div>
                                                        <div>
                                                            <div style="font-weight: 600; color: #1f2937; margin-bottom: 2px;">${file.name}</div>
                                                            <div style="font-size: 0.85rem; color: #6b7280;">ä¸Šä¼ æ—¶é—´: ${file.uploadTime || 'æœªçŸ¥'}</div>
                                                        </div>
                                                    </div>
                                                    <button onclick="downloadProjectFile('${project.id}', ${index})" style="background: #667eea; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.85rem; transition: background 0.3s;">ğŸ“¥ ä¸‹è½½</button>
                                                </div>
                                            `).join('') : 
                                            '<div style="text-align: center; color: #9ca3af; padding: 30px; font-style: italic;">ğŸ“‹ æš‚æ— ä¸Šä¼ æ–‡ä»¶</div>'
                                        }
                                    </div>
                                </div>
                            </div>
                            
                            <!-- å³ä¾§æ“ä½œé¢æ¿ -->
                            <div>
                                <div style="background: #f8fafc; border-radius: 15px; padding: 25px; border: 1px solid #e2e8f0;">
                                    <h3 style="color: #1f2937; font-size: 1.2rem; font-weight: 600; margin-bottom: 20px; text-align: center;">âš™ï¸ ç®¡ç†æ“ä½œ</h3>
                                    
                                    <div style="space-y: 15px;">
                                        <button onclick="editProject('${project.id}')" style="width: 100%; background: #667eea; color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; margin-bottom: 10px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                            âœï¸ ç¼–è¾‘é¡¹ç›®
                                        </button>
                                        
                                        <button onclick="changeProjectStatus('${project.id}')" style="width: 100%; background: #059669; color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; margin-bottom: 10px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                            ğŸ”„ æ›´æ”¹çŠ¶æ€
                                        </button>
                                        
                                        <button onclick="addProjectComment('${project.id}')" style="width: 100%; background: #7c3aed; color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; margin-bottom: 10px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                            ğŸ’¬ æ·»åŠ å¤‡æ³¨
                                        </button>
                                        
                                        <button onclick="exportProjectData('${project.id}')" style="width: 100%; background: #0891b2; color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; margin-bottom: 15px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                            ğŸ“Š å¯¼å‡ºæ•°æ®
                                        </button>
                                        
                                        <hr style="border: none; height: 1px; background: #e2e8f0; margin: 20px 0;">
                                        
                                        <button onclick="deleteProject('${project.id}')" style="width: 100%; background: #dc2626; color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                            ğŸ—‘ï¸ åˆ é™¤é¡¹ç›®
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- é¡¹ç›®ç»Ÿè®¡ä¿¡æ¯ -->
                                <div style="background: #f0f9ff; border-radius: 15px; padding: 20px; margin-top: 20px; border: 1px solid #bae6fd;">
                                    <h4 style="color: #0c4a6e; font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; text-align: center;">ğŸ“ˆ é¡¹ç›®ç»Ÿè®¡</h4>
                                    <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="color: #0369a1;">æ–‡ä»¶æ•°é‡:</span>
                                            <strong style="color: #0c4a6e;">${project.files ? project.files.length : 0}</strong>
                                        </div>
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="color: #0369a1;">éœ€æ±‚æ•°é‡:</span>
                                            <strong style="color: #0c4a6e;">${project.needs ? project.needs.length : 0}</strong>
                                        </div>
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="color: #0369a1;">ç”³è¯·å¤©æ•°:</span>
                                            <strong style="color: #0c4a6e;">${calculateDaysSinceSubmit(project.submitTime)}</strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.setAttribute('data-modal', 'project-details');
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­æ¨¡æ€æ¡†
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        function editProject(projectId) {
            const project = projectsData.find(p => p.id === projectId);
            if (!project) {
                alert('é¡¹ç›®ä¸å­˜åœ¨');
                return;
            }
            
            // å…³é—­è¯¦æƒ…æ¨¡æ€æ¡†
            const detailsModal = document.querySelector('[data-modal="project-details"]');
            if (detailsModal) {
                detailsModal.remove();
            }
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); display: flex; align-items: center; 
                justify-content: center; z-index: 2000; overflow-y: auto;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white; border-radius: 15px; 
                max-width: 800px; width: 95%; max-height: 90vh; overflow-y: auto;
                box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            `;
            
            modalContent.innerHTML = `
                <div style="padding: 0; border-radius: 15px; overflow: hidden;">
                    <!-- ç¼–è¾‘å¤´éƒ¨ -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px 30px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h2 style="font-size: 1.6rem; font-weight: 700; margin-bottom: 8px;">âœï¸ ç¼–è¾‘é¡¹ç›®</h2>
                                <p style="opacity: 0.9; font-size: 1rem;">é¡¹ç›®ID: ${project.id}</p>
                            </div>
                            <button onclick="this.closest('[data-modal]').remove()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center;">Ã—</button>
                        </div>
                    </div>
                    
                    <!-- ç¼–è¾‘è¡¨å• -->
                    <div style="padding: 30px;">
                        <form id="editProjectForm" onsubmit="saveProjectChanges(event, '${project.id}')">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                                <div>
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">é¡¹ç›®åç§° *</label>
                                    <input type="text" id="editProjectName" value="${project.name}" required 
                                        style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s; outline: none;" 
                                        onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e5e7eb'">
                                </div>
                                
                                <div>
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">åˆ›å§‹äºº *</label>
                                    <input type="text" id="editProjectFounder" value="${project.founder}" required
                                        style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s; outline: none;"
                                        onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e5e7eb'">
                                </div>
                                
                                <div>
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">é¡¹ç›®ç±»åˆ« *</label>
                                    <select id="editProjectCategory" required
                                        style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; background: white; transition: border-color 0.3s; outline: none;"
                                        onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e5e7eb'">
                                        <option value="">è¯·é€‰æ‹©ç±»åˆ«</option>
                                        <option value="AIæŠ€æœ¯" ${project.category === 'AIæŠ€æœ¯' ? 'selected' : ''}>AIæŠ€æœ¯</option>
                                        <option value="åŒºå—é“¾" ${project.category === 'åŒºå—é“¾' ? 'selected' : ''}>åŒºå—é“¾</option>
                                        <option value="é‡‘èç§‘æŠ€" ${project.category === 'é‡‘èç§‘æŠ€' ? 'selected' : ''}>é‡‘èç§‘æŠ€</option>
                                        <option value="ä¼ä¸šæœåŠ¡" ${project.category === 'ä¼ä¸šæœåŠ¡' ? 'selected' : ''}>ä¼ä¸šæœåŠ¡</option>
                                        <option value="æ¶ˆè´¹ç”µå­" ${project.category === 'æ¶ˆè´¹ç”µå­' ? 'selected' : ''}>æ¶ˆè´¹ç”µå­</option>
                                        <option value="åŒ»ç–—å¥åº·" ${project.category === 'åŒ»ç–—å¥åº·' ? 'selected' : ''}>åŒ»ç–—å¥åº·</option>
                                        <option value="æ•™è‚²ç§‘æŠ€" ${project.category === 'æ•™è‚²ç§‘æŠ€' ? 'selected' : ''}>æ•™è‚²ç§‘æŠ€</option>
                                        <option value="å…¶ä»–" ${project.category === 'å…¶ä»–' ? 'selected' : ''}>å…¶ä»–</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">é¡¹ç›®çŠ¶æ€ *</label>
                                    <select id="editProjectStatus" required
                                        style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; background: white; transition: border-color 0.3s; outline: none;"
                                        onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e5e7eb'">
                                        <option value="ç”³è¯·ä¸­" ${project.status === 'ç”³è¯·ä¸­' ? 'selected' : ''}>â³ ç”³è¯·ä¸­</option>
                                        <option value="å·²é€šè¿‡" ${project.status === 'å·²é€šè¿‡' ? 'selected' : ''}>âœ… å·²é€šè¿‡</option>
                                        <option value="å·²æ‹’ç»" ${project.status === 'å·²æ‹’ç»' ? 'selected' : ''}>âŒ å·²æ‹’ç»</option>
                                        <option value="è¿›è¡Œä¸­" ${project.status === 'è¿›è¡Œä¸­' ? 'selected' : ''}>ğŸš€ è¿›è¡Œä¸­</option>
                                        <option value="å·²å®Œæˆ" ${project.status === 'å·²å®Œæˆ' ? 'selected' : ''}>ğŸ¯ å·²å®Œæˆ</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 25px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">é¡¹ç›®æè¿°</label>
                                <textarea id="editProjectDescription" rows="4" placeholder="è¯·è¯¦ç»†æè¿°é¡¹ç›®å†…å®¹ã€ç›®æ ‡ã€ä¼˜åŠ¿ç­‰..."
                                    style="width: 100%; padding: 15px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; line-height: 1.5; resize: vertical; transition: border-color 0.3s; outline: none;"
                                    onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e5e7eb'">${project.description || ''}</textarea>
                            </div>
                            
                            <div style="margin-bottom: 25px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">éœ€æ±‚æ¸…å•</label>
                                <div style="background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 8px; padding: 15px;">
                                    <div style="display: flex; gap: 10px; margin-bottom: 15px; align-items: center;">
                                        <input type="text" id="newNeedInput" placeholder="æ·»åŠ æ–°éœ€æ±‚..." 
                                            style="flex: 1; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; font-size: 0.9rem; outline: none;"
                                            onkeypress="if(event.key==='Enter'){event.preventDefault();addProjectNeed();}">
                                        <button type="button" onclick="addProjectNeed()" 
                                            style="background: #667eea; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 500;">+ æ·»åŠ </button>
                                    </div>
                                    <div id="editProjectNeeds" style="display: flex; flex-wrap: wrap; gap: 8px; min-height: 40px;">
                                        ${(project.needs || []).map((need, index) => `
                                            <span style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 500; display: flex; align-items: center; gap: 6px;">
                                                ${need}
                                                <button type="button" onclick="removeProjectNeed(${index})" style="background: rgba(255,255,255,0.3); border: none; color: white; width: 18px; height: 18px; border-radius: 50%; cursor: pointer; font-size: 0.7rem; display: flex; align-items: center; justify-content: center; line-height: 1;">Ã—</button>
                                            </span>
                                        `).join('')}
                                        ${(!project.needs || project.needs.length === 0) ? '<span style="color: #9ca3af; font-style: italic; padding: 8px 0;">æš‚æ— éœ€æ±‚ï¼Œç‚¹å‡»ä¸Šæ–¹æ·»åŠ ...</span>' : ''}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- æ“ä½œæŒ‰é’® -->
                            <div style="display: flex; gap: 12px; justify-content: flex-end; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                                <button type="button" onclick="this.closest('[data-modal]').remove()" 
                                    style="background: #6b7280; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;">å–æ¶ˆ</button>
                                <button type="submit" id="saveProjectBtn"
                                    style="background: #059669; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                    ğŸ’¾ ä¿å­˜æ›´æ”¹
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            modal.setAttribute('data-modal', 'edit-project');
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // å­˜å‚¨åŸå§‹éœ€æ±‚æ•°æ®ä»¥ä¾¿ç¼–è¾‘
            window.editingProjectNeeds = [...(project.needs || [])];
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­æ¨¡æ€æ¡†
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // å·¥å…·å‡½æ•°
        function formatCurrency(amount) {
            if (amount >= 1000000) {
                return '$' + (amount / 1000000).toFixed(1) + 'M';
            } else if (amount >= 1000) {
                return '$' + (amount / 1000).toFixed(1) + 'K';
            }
            return '$' + amount.toLocaleString();
        }

        function formatStage(stage) {
            const stages = {
                'idea': 'åˆ›æ„é˜¶æ®µ',
                'seed': 'ç§å­è½®',
                'series-a': 'Aè½®',
                'series-b': 'Bè½®',
                'series-c': 'Cè½®',
                'ipo': 'IPO'
            };
            return stages[stage] || stage;
        }

        function formatStatus(status) {
            const statuses = {
                'active': 'æ´»è·ƒ',
                'pending': 'å¾…å®¡æ ¸',
                'completed': 'å·²å®Œæˆ',
                'paused': 'æš‚åœ',
                'rejected': 'å·²æ‹’ç»'
            };
            return statuses[status] || status;
        }

        function getStatusClass(status) {
            const classes = {
                'active': 'status-active',
                'pending': 'status-pending',
                'completed': 'status-active',
                'paused': 'status-pending',
                'rejected': 'status-inactive'
            };
            return classes[status] || 'status-pending';
        }

        function formatDateTime(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('zh-CN') + ' ' + date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            } catch (error) {
                return 'æ— æ•ˆæ—¥æœŸ';
            }
        }

        // ç”¨æˆ·ç®¡ç†ç›¸å…³å‡½æ•°
        let usersData = [];
        let filteredUsersData = [];

        async function loadUsersData() {
            try {
                console.log('åŠ è½½ç”¨æˆ·æ•°æ®...');
                
                // è·å–ç”¨æˆ·ç»Ÿè®¡
                const statsResponse = await fetch('/api/users?action=stats');
                if (statsResponse.ok) {
                    const stats = await statsResponse.json();
                    console.log('ç”¨æˆ·ç»Ÿè®¡æ•°æ®:', stats);
                    updateUserStats(stats);
                }
                
                // è·å–ç”¨æˆ·åˆ—è¡¨
                const listResponse = await fetch('/api/users?action=list');
                if (listResponse.ok) {
                    const users = await listResponse.json();
                    console.log('ç”¨æˆ·åˆ—è¡¨:', users);
                    usersData = Array.isArray(users) ? users : [];
                    filteredUsersData = [...usersData];
                    renderUsersTable();
                }
                
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
                document.getElementById('usersTableContainer').innerHTML = `
                    <div class="error-message">
                        <div style="color: #dc3545; text-align: center; padding: 20px;">
                            <div>âŒ åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥</div>
                            <div style="font-size: 14px; margin-top: 5px;">è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•</div>
                        </div>
                    </div>
                `;
            }
        }

        function updateUserStats(stats) {
            document.getElementById('totalUsersCount').textContent = stats.totalUsers || 0;
            document.getElementById('activeUsersCount').textContent = stats.activeUsers || 0;
            document.getElementById('todayRegistrations').textContent = stats.todayRegistrations || 0;
            document.getElementById('emailUsersCount').textContent = stats.providerDistribution?.email || 0;
        }

        function renderUsersTable() {
            const container = document.getElementById('usersTableContainer');
            
            if (filteredUsersData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ‘¤</div>
                        <h3>æš‚æ— ç”¨æˆ·æ•°æ®</h3>
                        <p>è¿˜æ²¡æœ‰ç”¨æˆ·æ³¨å†Œ</p>
                    </div>
                `;
                return;
            }

            const tableHTML = `
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th class="sortable-header" onclick="sortUsers('email')">ç”¨æˆ·ä¿¡æ¯</th>
                                <th class="sortable-header" onclick="sortUsers('provider')">ç™»å½•æ–¹å¼</th>
                                <th class="sortable-header" onclick="sortUsers('isSubscriber')">è®¢é˜…çŠ¶æ€</th>
                                <th class="sortable-header" onclick="sortUsers('location')">åœ°ç†ä½ç½®</th>
                                <th class="sortable-header" onclick="sortUsers('createdAt')">æ³¨å†Œæ—¶é—´</th>
                                <th class="sortable-header" onclick="sortUsers('lastLoginAt')">æœ€åç™»å½•</th>
                                <th class="sortable-header" onclick="sortUsers('isActive')">çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredUsersData.map(user => `
                                <tr>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <img src="${user.avatar}" alt="å¤´åƒ" style="width: 32px; height: 32px; border-radius: 50%; background: #f0f0f0;" onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(user.name || user.email)}&background=FA8C32&color=fff'">
                                            <div>
                                                <div style="font-weight: 500;">${user.name || 'æœªè®¾ç½®'}</div>
                                                <div style="font-size: 0.85rem; color: #666;">${user.email}</div>
                                                <div style="font-size: 0.75rem; color: #999;">${user.id}</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            ${getProviderIcon(user.provider)}
                                            <span>${getProviderName(user.provider)}</span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="subscription-badge ${user.isSubscriber ? 'subscribed' : 'not-subscribed'}">
                                            ${user.isSubscriber ? 'âœ… å·²è®¢é˜…' : 'âŒ æœªè®¢é˜…'}
                                        </span>
                                    </td>
                                    <td>
                                        <div style="display: flex; align-items: center; gap: 6px;">
                                            <span class="location-icon">${getLocationIcon(user.location)}</span>
                                            <span class="location-text">${user.location || 'æœªçŸ¥'}</span>
                                        </div>
                                    </td>
                                    <td class="date-cell">${formatDateTime(user.createdAt)}</td>
                                    <td class="date-cell">${formatDateTime(user.lastLoginAt)}</td>
                                    <td>
                                        <span class="status-badge ${user.isActive ? 'status-active' : 'status-inactive'}">
                                            ${user.isActive ? 'æ´»è·ƒ' : 'ç¦ç”¨'}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn-small btn-info" onclick="viewUserDetails('${user.id}')" title="æŸ¥çœ‹è¯¦æƒ…">
                                                ğŸ‘ï¸
                                            </button>
                                            <button class="btn-small ${user.isActive ? 'btn-danger' : 'status-active'}" 
                                                    onclick="toggleUserStatus('${user.id}', ${!user.isActive})" 
                                                    title="${user.isActive ? 'ç¦ç”¨ç”¨æˆ·' : 'æ¿€æ´»ç”¨æˆ·'}">
                                                ${user.isActive ? 'ğŸš«' : 'âœ…'}
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                <div class="table-info">
                    <span>å…± ${filteredUsersData.length} ä¸ªç”¨æˆ· (æ€»è®¡ ${usersData.length} ä¸ª)</span>
                </div>
            `;
            
            container.innerHTML = tableHTML;
        }

        // ç”¨æˆ·è¡¨æ ¼æ’åºåŠŸèƒ½
        let usersSortField = null;
        let usersSortDirection = 'asc';

        function sortUsers(field) {
            // æ›´æ–°æ’åºçŠ¶æ€
            if (usersSortField === field) {
                usersSortDirection = usersSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                usersSortField = field;
                usersSortDirection = 'asc';
            }

            // æ‰§è¡Œæ’åº
            filteredUsersData.sort((a, b) => {
                let valueA, valueB;
                
                switch (field) {
                    case 'email':
                        valueA = a.email.toLowerCase();
                        valueB = b.email.toLowerCase();
                        break;
                    case 'provider':
                        valueA = a.provider;
                        valueB = b.provider;
                        break;
                    case 'isSubscriber':
                        valueA = a.isSubscriber ? 1 : 0;
                        valueB = b.isSubscriber ? 1 : 0;
                        break;
                    case 'location':
                        valueA = (a.location || '').toLowerCase();
                        valueB = (b.location || '').toLowerCase();
                        break;
                    case 'createdAt':
                    case 'lastLoginAt':
                        valueA = new Date(a[field]).getTime();
                        valueB = new Date(b[field]).getTime();
                        break;
                    case 'isActive':
                        valueA = a.isActive ? 1 : 0;
                        valueB = b.isActive ? 1 : 0;
                        break;
                    default:
                        return 0;
                }

                if (valueA < valueB) return usersSortDirection === 'asc' ? -1 : 1;
                if (valueA > valueB) return usersSortDirection === 'asc' ? 1 : -1;
                return 0;
            });

            // é‡æ–°æ¸²æŸ“è¡¨æ ¼
            renderUsersTable();

            // æ›´æ–°è¡¨å¤´æ ·å¼
            updateUsersSortHeaders();
        }

        function updateUsersSortHeaders() {
            // æ¸…é™¤æ‰€æœ‰æ’åºæ ·å¼
            const headers = document.querySelectorAll('#users-module .sortable-header');
            headers.forEach(header => {
                header.classList.remove('sort-asc', 'sort-desc');
            });

            // æ·»åŠ å½“å‰æ’åºæ ·å¼
            if (usersSortField) {
                const fieldMap = {
                    'email': 0,
                    'provider': 1,
                    'isSubscriber': 2,
                    'location': 3,
                    'createdAt': 4,
                    'lastLoginAt': 5,
                    'isActive': 6
                };
                
                const headerIndex = fieldMap[usersSortField];
                if (headerIndex !== undefined) {
                    const header = headers[headerIndex];
                    if (header) {
                        header.classList.add(usersSortDirection === 'asc' ? 'sort-asc' : 'sort-desc');
                    }
                }
            }
        }

        function filterUsers() {
            const providerFilter = document.getElementById('userProviderFilter').value;
            const subscriptionFilter = document.getElementById('userSubscriptionFilter').value;
            const locationFilter = document.getElementById('userLocationFilter').value;
            const statusFilter = document.getElementById('userStatusFilter').value;
            const searchInput = document.getElementById('userSearchInput').value.toLowerCase();
            const dateFilter = document.getElementById('userDateFilter').value;
            
            filteredUsersData = usersData.filter(user => {
                const matchesProvider = !providerFilter || user.provider === providerFilter;
                const matchesSubscription = !subscriptionFilter || user.isSubscriber.toString() === subscriptionFilter;
                const matchesLocation = !locationFilter || user.location === locationFilter;
                const matchesStatus = !statusFilter || user.isActive.toString() === statusFilter;
                const matchesSearch = !searchInput || 
                    user.email.toLowerCase().includes(searchInput) ||
                    user.name?.toLowerCase().includes(searchInput) ||
                    user.id.toLowerCase().includes(searchInput);
                const matchesDate = !dateFilter || user.createdAt.startsWith(dateFilter);
                
                return matchesProvider && matchesSubscription && matchesLocation && matchesStatus && matchesSearch && matchesDate;
            });
            
            renderUsersTable();
        }

        function refreshUsers() {
            loadUsersData();
        }

        function exportUsers() {
            try {
                const csvContent = [
                    ['ç”¨æˆ·ID', 'é‚®ç®±åœ°å€', 'ç”¨æˆ·å', 'ç™»å½•æ–¹å¼', 'è®¢é˜…çŠ¶æ€', 'åœ°ç†ä½ç½®', 'æ³¨å†Œæ—¶é—´', 'æœ€åç™»å½•', 'çŠ¶æ€'],
                    ...filteredUsersData.map(user => [
                        user.id,
                        user.email,
                        user.name || '',
                        user.provider,
                        user.isSubscriber ? 'å·²è®¢é˜…' : 'æœªè®¢é˜…',
                        user.location || 'æœªçŸ¥',
                        user.createdAt,
                        user.lastLoginAt,
                        user.isActive ? 'æ´»è·ƒ' : 'ç¦ç”¨'
                    ])
                ].map(row => row.map(field => `"${String(field).replace(/"/g, '""')}"`).join(',')).join('\n');
                
                const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `SVTRç”¨æˆ·æ•°æ®_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                
                console.log('ç”¨æˆ·æ•°æ®å¯¼å‡ºæˆåŠŸ');
            } catch (error) {
                console.error('å¯¼å‡ºå¤±è´¥:', error);
                alert('å¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        function viewUserDetails(userId) {
            const user = usersData.find(u => u.id === userId);
            if (!user) return;
            
            const detailsHTML = `
                <div style="text-align: left;">
                    <h3 style="margin-bottom: 20px;">ç”¨æˆ·è¯¦æƒ…</h3>
                    <div style="display: grid; gap: 15px;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                            <img src="${user.avatar}" alt="å¤´åƒ" style="width: 60px; height: 60px; border-radius: 50%;" onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(user.name || user.email)}&background=FA8C32&color=fff'">
                            <div>
                                <div style="font-size: 1.2rem; font-weight: 600;">${user.name || 'æœªè®¾ç½®å§“å'}</div>
                                <div style="color: #666; margin-top: 5px;">${user.email}</div>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 120px 1fr; gap: 10px; align-items: center;">
                            <label style="font-weight: 500;">ç”¨æˆ·ID:</label>
                            <span style="font-family: monospace; background: #f5f5f5; padding: 4px 8px; border-radius: 4px;">${user.id}</span>
                        </div>
                        <div style="display: grid; grid-template-columns: 120px 1fr; gap: 10px; align-items: center;">
                            <label style="font-weight: 500;">ç™»å½•æ–¹å¼:</label>
                            <span style="display: flex; align-items: center; gap: 8px;">
                                ${getProviderIcon(user.provider)}
                                ${getProviderName(user.provider)}
                            </span>
                        </div>
                        <div style="display: grid; grid-template-columns: 120px 1fr; gap: 10px; align-items: center;">
                            <label style="font-weight: 500;">æ³¨å†Œæ—¶é—´:</label>
                            <span>${formatDateTime(user.createdAt)}</span>
                        </div>
                        <div style="display: grid; grid-template-columns: 120px 1fr; gap: 10px; align-items: center;">
                            <label style="font-weight: 500;">æœ€åç™»å½•:</label>
                            <span>${formatDateTime(user.lastLoginAt)}</span>
                        </div>
                        <div style="display: grid; grid-template-columns: 120px 1fr; gap: 10px; align-items: center;">
                            <label style="font-weight: 500;">è®¢é˜…çŠ¶æ€:</label>
                            <span class="subscription-badge ${user.isSubscriber ? 'subscribed' : 'not-subscribed'}">
                                ${user.isSubscriber ? 'âœ… å·²è®¢é˜…' : 'âŒ æœªè®¢é˜…'}
                            </span>
                        </div>
                        <div style="display: grid; grid-template-columns: 120px 1fr; gap: 10px; align-items: center;">
                            <label style="font-weight: 500;">åœ°ç†ä½ç½®:</label>
                            <span style="display: flex; align-items: center; gap: 8px;">
                                <span>${getLocationIcon(user.location)}</span>
                                <span>${user.location || 'æœªçŸ¥'}</span>
                            </span>
                        </div>
                        <div style="display: grid; grid-template-columns: 120px 1fr; gap: 10px; align-items: center;">
                            <label style="font-weight: 500;">è´¦æˆ·çŠ¶æ€:</label>
                            <span class="status-badge ${user.isActive ? 'status-active' : 'status-inactive'}">
                                ${user.isActive ? 'âœ… æ´»è·ƒ' : 'ğŸš« ç¦ç”¨'}
                            </span>
                        </div>
                    </div>
                </div>
            `;
            
            showModal('ç”¨æˆ·è¯¦æƒ…', detailsHTML);
        }

        async function toggleUserStatus(userId, newStatus) {
            const user = usersData.find(u => u.id === userId);
            if (!user) return;
            
            const action = newStatus ? 'æ¿€æ´»' : 'ç¦ç”¨';
            if (!confirm(`ç¡®å®šè¦${action}ç”¨æˆ· ${user.email} å—ï¼Ÿ`)) {
                return;
            }
            
            try {
                const response = await fetch('/api/users', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'update_status',
                        userId: userId,
                        isActive: newStatus
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`ç”¨æˆ·çŠ¶æ€å·²${action}`);
                    loadUsersData(); // é‡æ–°åŠ è½½æ•°æ®
                } else {
                    alert(`${action}å¤±è´¥ï¼š` + (result.message || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                alert(`${action}å¤±è´¥ï¼š` + error.message);
            }
        }

        function getProviderIcon(provider) {
            const icons = {
                'email': 'ğŸ“§',
                'google': 'ğŸ”',
                'github': 'ğŸ™'
            };
            return icons[provider] || 'â“';
        }

        function getProviderName(provider) {
            const names = {
                'email': 'é‚®ç®±',
                'google': 'Google',
                'github': 'GitHub'
            };
            return names[provider] || provider;
        }

        function getLocationIcon(location) {
            const icons = {
                'ä¸­å›½': 'ğŸ‡¨ğŸ‡³',
                'å…¨çƒ': 'ğŸŒ',
                'ç¾å›½': 'ğŸ‡ºğŸ‡¸',
                'æœ¬åœ°ç¯å¢ƒ': 'ğŸ’»',
                'å¹³å°å†…éƒ¨': 'ğŸ ',
                'æµ‹è¯•ç¯å¢ƒ': 'ğŸ§ª',
                'å¾…å®šä½': 'ğŸ“',
                'å…¶ä»–åœ°åŒº': 'ğŸŒ',
                'æœªçŸ¥': 'â“'
            };
            return icons[location] || 'ğŸŒ';
        }

        // ç®€å•çš„æ¨¡æ€æ¡†å‡½æ•°
        function showModal(title, content) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); display: flex; align-items: center; 
                justify-content: center; z-index: 2000;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white; padding: 30px; border-radius: 15px; 
                max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;
                box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            `;
            
            modalContent.innerHTML = `
                ${content}
                <div style="text-align: center; margin-top: 25px;">
                    <button onclick="this.closest('[data-modal]').remove()" class="btn-primary">å…³é—­</button>
                </div>
            `;
            
            modal.setAttribute('data-modal', 'true');
            modal.appendChild(modalContent);
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
            
            document.body.appendChild(modal);
        }

        // æ˜¾ç¤ºé¡¹ç›®æ–‡ä»¶è¯¦æƒ…
        function showProjectFiles(projectId) {
            const project = projectsData.find(p => p.id === projectId);
            if (!project || !project.files || project.files.length === 0) {
                alert('è¯¥é¡¹ç›®æ²¡æœ‰ä¸Šä¼ ä»»ä½•æ–‡ä»¶');
                return;
            }

            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); display: flex; align-items: center; 
                justify-content: center; z-index: 2000; overflow-y: auto;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white; padding: 30px; border-radius: 15px; 
                max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;
                box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            `;
            
            const filesListHTML = project.files.map((file, index) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #eee; border-radius: 8px; margin-bottom: 10px;">
                    <div style="flex: 1;">
                        <div style="font-weight: 500; color: #333; margin-bottom: 5px;">
                            ğŸ“„ ${file.name}
                        </div>
                        <div style="font-size: 0.8rem; color: #666;">
                            <span>ç±»å‹: ${file.type}</span> | 
                            <span>å¤§å°: ${formatFileSize(file.size)}</span>
                            ${file.uploadedAt ? `| <span>ä¸Šä¼ : ${formatDateTime(file.uploadedAt)}</span>` : ''}
                        </div>
                    </div>
                    <div style="font-size: 1.2rem; color: #ccc;">
                        ${getFileIcon(file.type)}
                    </div>
                </div>
            `).join('');
            
            modalContent.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0; color: #333;">ğŸ“ é¡¹ç›®é™„ä»¶</h3>
                    <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">&times;</button>
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>${project.name}</strong>
                    <div style="font-size: 0.9rem; color: #666;">å…± ${project.files.length} ä¸ªæ–‡ä»¶</div>
                </div>
                ${filesListHTML}
                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" class="btn-secondary">å…³é—­</button>
                </div>
            `;
            
            modal.appendChild(modalContent);
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
            
            document.body.appendChild(modal);
        }

        // æ ¹æ®æ–‡ä»¶ç±»å‹è¿”å›å›¾æ ‡
        function getFileIcon(fileType) {
            if (fileType.includes('pdf')) return 'ğŸ“•';
            if (fileType.includes('doc')) return 'ğŸ“˜';
            if (fileType.includes('image')) return 'ğŸ–¼ï¸';
            if (fileType.includes('text')) return 'ğŸ“„';
            if (fileType.includes('presentation') || fileType.includes('ppt')) return 'ğŸ“Š';
            return 'ğŸ“';
        }
        // é¡¹ç›®ç®¡ç†è¾…åŠ©å‡½æ•°
        
        // è®¡ç®—ç”³è¯·å¤©æ•°
        function calculateDaysSinceSubmit(submitTime) {
            try {
                const submitDate = new Date(submitTime);
                const currentDate = new Date();
                const diffTime = Math.abs(currentDate - submitDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays + ' å¤©';
            } catch (error) {
                return 'æœªçŸ¥';
            }
        }
        
        // æ·»åŠ é¡¹ç›®éœ€æ±‚
        function addProjectNeed() {
            const input = document.getElementById('newNeedInput');
            const need = input.value.trim();
            
            if (!need) {
                alert('è¯·è¾“å…¥éœ€æ±‚å†…å®¹');
                return;
            }
            
            if (window.editingProjectNeeds.includes(need)) {
                alert('è¯¥éœ€æ±‚å·²å­˜åœ¨');
                return;
            }
            
            window.editingProjectNeeds.push(need);
            input.value = '';
            renderProjectNeeds();
        }
        
        // ç§»é™¤é¡¹ç›®éœ€æ±‚
        function removeProjectNeed(index) {
            window.editingProjectNeeds.splice(index, 1);
            renderProjectNeeds();
        }
        
        // æ¸²æŸ“é¡¹ç›®éœ€æ±‚
        function renderProjectNeeds() {
            const container = document.getElementById('editProjectNeeds');
            if (!container) return;
            
            if (window.editingProjectNeeds.length === 0) {
                container.innerHTML = '<span style="color: #9ca3af; font-style: italic; padding: 8px 0;">æš‚æ— éœ€æ±‚ï¼Œç‚¹å‡»ä¸Šæ–¹æ·»åŠ ...</span>';
                return;
            }
            
            container.innerHTML = window.editingProjectNeeds.map((need, index) => `
                <span style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 6px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 500; display: flex; align-items: center; gap: 6px;">
                    ${need}
                    <button type="button" onclick="removeProjectNeed(${index})" style="background: rgba(255,255,255,0.3); border: none; color: white; width: 18px; height: 18px; border-radius: 50%; cursor: pointer; font-size: 0.7rem; display: flex; align-items: center; justify-content: center; line-height: 1;">Ã—</button>
                </span>
            `).join('');
        }
        
        // ä¿å­˜é¡¹ç›®æ›´æ”¹
        async function saveProjectChanges(event, projectId) {
            event.preventDefault();
            
            const saveBtn = document.getElementById('saveProjectBtn');
            const originalText = saveBtn.innerHTML;
            saveBtn.disabled = true;
            saveBtn.innerHTML = 'ğŸ’¾ ä¿å­˜ä¸­...';
            
            try {
                const formData = {
                    id: projectId,
                    name: document.getElementById('editProjectName').value.trim(),
                    founder: document.getElementById('editProjectFounder').value.trim(),
                    category: document.getElementById('editProjectCategory').value,
                    status: document.getElementById('editProjectStatus').value,
                    description: document.getElementById('editProjectDescription').value.trim(),
                    needs: window.editingProjectNeeds || []
                };
                
                // éªŒè¯å¿…å¡«å­—æ®µ
                if (!formData.name || !formData.founder || !formData.category || !formData.status) {
                    alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
                    return;
                }
                
                // å‘é€æ›´æ–°è¯·æ±‚
                const response = await fetch('/api/projects', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // æ›´æ–°æœ¬åœ°æ•°æ®
                    const projectIndex = projectsData.findIndex(p => p.id === projectId);
                    if (projectIndex !== -1) {
                        projectsData[projectIndex] = { ...projectsData[projectIndex], ...formData };
                    }
                    
                    // åˆ·æ–°è¡¨æ ¼
                    filterProjects();
                    
                    // å…³é—­æ¨¡æ€æ¡†
                    document.querySelector('[data-modal="edit-project"]').remove();
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    showNotification('é¡¹ç›®æ›´æ–°æˆåŠŸï¼', 'success');
                } else {
                    alert('æ›´æ–°å¤±è´¥: ' + (result.message || 'æœªçŸ¥é”™è¯¯'));
                }
                
            } catch (error) {
                console.error('æ›´æ–°é¡¹ç›®å¤±è´¥:', error);
                alert('æ›´æ–°å¤±è´¥: ' + error.message);
            } finally {
                saveBtn.disabled = false;
                saveBtn.innerHTML = originalText;
            }
        }
        
        // æ›´æ”¹é¡¹ç›®çŠ¶æ€
        function changeProjectStatus(projectId) {
            const project = projectsData.find(p => p.id === projectId);
            if (!project) {
                alert('é¡¹ç›®ä¸å­˜åœ¨');
                return;
            }
            
            const statusOptions = [
                { value: 'ç”³è¯·ä¸­', label: 'â³ ç”³è¯·ä¸­', color: '#d97706' },
                { value: 'å·²é€šè¿‡', label: 'âœ… å·²é€šè¿‡', color: '#059669' },
                { value: 'å·²æ‹’ç»', label: 'âŒ å·²æ‹’ç»', color: '#dc2626' },
                { value: 'è¿›è¡Œä¸­', label: 'ğŸš€ è¿›è¡Œä¸­', color: '#2563eb' },
                { value: 'å·²å®Œæˆ', label: 'ğŸ¯ å·²å®Œæˆ', color: '#7c3aed' }
            ];
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); display: flex; align-items: center; 
                justify-content: center; z-index: 2000;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white; border-radius: 15px; padding: 30px;
                max-width: 400px; width: 90%; box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            `;
            
            modalContent.innerHTML = `
                <div>
                    <h3 style="margin-bottom: 20px; color: #1f2937; font-size: 1.3rem; font-weight: 600; text-align: center;">ğŸ”„ æ›´æ”¹é¡¹ç›®çŠ¶æ€</h3>
                    <p style="margin-bottom: 20px; color: #6b7280; text-align: center;">é¡¹ç›®: ${project.name}</p>
                    <p style="margin-bottom: 20px; color: #6b7280; text-align: center;">å½“å‰çŠ¶æ€: <strong>${project.status}</strong></p>
                    
                    <div style="display: grid; gap: 10px; margin-bottom: 25px;">
                        ${statusOptions.map(option => `
                            <button onclick="updateProjectStatus('${projectId}', '${option.value}')" 
                                style="width: 100%; padding: 12px; border: 2px solid ${option.value === project.status ? option.color : '#e5e7eb'}; 
                                background: ${option.value === project.status ? option.color : 'white'}; 
                                color: ${option.value === project.status ? 'white' : '#374151'}; 
                                border-radius: 8px; cursor: pointer; font-weight: 600; text-align: left; transition: all 0.3s;">
                                ${option.label}
                            </button>
                        `).join('')}
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="this.closest('[data-modal]').remove()" 
                            style="background: #6b7280; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">å–æ¶ˆ</button>
                    </div>
                </div>
            `;
            
            modal.setAttribute('data-modal', 'change-status');
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        
        // æ›´æ–°é¡¹ç›®çŠ¶æ€
        async function updateProjectStatus(projectId, newStatus) {
            try {
                const response = await fetch('/api/projects', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: projectId, status: newStatus })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // æ›´æ–°æœ¬åœ°æ•°æ®
                    const project = projectsData.find(p => p.id === projectId);
                    if (project) {
                        project.status = newStatus;
                    }
                    
                    // åˆ·æ–°æ˜¾ç¤º
                    filterProjects();
                    
                    // å…³é—­æ¨¡æ€æ¡†
                    document.querySelector('[data-modal="change-status"]').remove();
                    
                    // å¦‚æœè¯¦æƒ…æ¨¡æ€æ¡†æ‰“å¼€ï¼Œä¹Ÿå…³é—­å¹¶é‡æ–°æ‰“å¼€ä»¥åˆ·æ–°çŠ¶æ€æ˜¾ç¤º
                    const detailsModal = document.querySelector('[data-modal="project-details"]');
                    if (detailsModal) {
                        detailsModal.remove();
                        setTimeout(() => viewProjectDetails(projectId), 100);
                    }
                    
                    showNotification('é¡¹ç›®çŠ¶æ€æ›´æ–°æˆåŠŸï¼', 'success');
                } else {
                    alert('çŠ¶æ€æ›´æ–°å¤±è´¥: ' + (result.message || 'æœªçŸ¥é”™è¯¯'));
                }
                
            } catch (error) {
                console.error('æ›´æ–°çŠ¶æ€å¤±è´¥:', error);
                alert('çŠ¶æ€æ›´æ–°å¤±è´¥: ' + error.message);
            }
        }
        
        // æ·»åŠ é¡¹ç›®å¤‡æ³¨
        function addProjectComment(projectId) {
            const project = projectsData.find(p => p.id === projectId);
            if (!project) {
                alert('é¡¹ç›®ä¸å­˜åœ¨');
                return;
            }
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); display: flex; align-items: center; 
                justify-content: center; z-index: 2000;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white; border-radius: 15px; padding: 30px;
                max-width: 500px; width: 90%; box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            `;
            
            modalContent.innerHTML = `
                <div>
                    <h3 style="margin-bottom: 20px; color: #1f2937; font-size: 1.3rem; font-weight: 600; text-align: center;">ğŸ’¬ æ·»åŠ é¡¹ç›®å¤‡æ³¨</h3>
                    <p style="margin-bottom: 15px; color: #6b7280;">é¡¹ç›®: <strong>${project.name}</strong></p>
                    
                    <textarea id="commentInput" rows="4" placeholder="è¯·è¾“å…¥å¤‡æ³¨å†…å®¹..." 
                        style="width: 100%; padding: 15px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; line-height: 1.5; resize: vertical; outline: none; margin-bottom: 20px;"
                        onfocus="this.style.borderColor='#667eea'" onblur="this.style.borderColor='#e5e7eb'"></textarea>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="this.closest('[data-modal]').remove()" 
                            style="background: #6b7280; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">å–æ¶ˆ</button>
                        <button onclick="saveProjectComment('${projectId}')"
                            style="background: #7c3aed; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">ä¿å­˜å¤‡æ³¨</button>
                    </div>
                </div>
            `;
            
            modal.setAttribute('data-modal', 'add-comment');
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        
        // ä¿å­˜é¡¹ç›®å¤‡æ³¨
        async function saveProjectComment(projectId) {
            const comment = document.getElementById('commentInput').value.trim();
            if (!comment) {
                alert('è¯·è¾“å…¥å¤‡æ³¨å†…å®¹');
                return;
            }
            
            try {
                const response = await fetch('/api/projects/comment', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        projectId: projectId, 
                        comment: comment,
                        timestamp: new Date().toISOString()
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.querySelector('[data-modal="add-comment"]').remove();
                    showNotification('å¤‡æ³¨æ·»åŠ æˆåŠŸï¼', 'success');
                } else {
                    alert('å¤‡æ³¨ä¿å­˜å¤±è´¥: ' + (result.message || 'æœªçŸ¥é”™è¯¯'));
                }
                
            } catch (error) {
                console.error('ä¿å­˜å¤‡æ³¨å¤±è´¥:', error);
                alert('å¤‡æ³¨ä¿å­˜å¤±è´¥: ' + error.message);
            }
        }
        
        // å¯¼å‡ºé¡¹ç›®æ•°æ®
        function exportProjectData(projectId) {
            const project = projectsData.find(p => p.id === projectId);
            if (!project) {
                alert('é¡¹ç›®ä¸å­˜åœ¨');
                return;
            }
            
            const exportData = {
                åŸºæœ¬ä¿¡æ¯: {
                    é¡¹ç›®åç§°: project.name,
                    åˆ›å§‹äºº: project.founder,
                    é¡¹ç›®ç±»åˆ«: project.category,
                    é¡¹ç›®çŠ¶æ€: project.status,
                    ç”³è¯·æ—¶é—´: project.submitTime,
                    é¡¹ç›®ID: project.id
                },
                é¡¹ç›®æè¿°: project.description || 'æš‚æ— æè¿°',
                éœ€æ±‚æ¸…å•: project.needs || [],
                æ–‡ä»¶ä¿¡æ¯: (project.files || []).map(file => ({
                    æ–‡ä»¶å: file.name,
                    ä¸Šä¼ æ—¶é—´: file.uploadTime || 'æœªçŸ¥'
                })),
                ç»Ÿè®¡ä¿¡æ¯: {
                    æ–‡ä»¶æ•°é‡: project.files ? project.files.length : 0,
                    éœ€æ±‚æ•°é‡: project.needs ? project.needs.length : 0,
                    ç”³è¯·å¤©æ•°: calculateDaysSinceSubmit(project.submitTime)
                },
                å¯¼å‡ºæ—¶é—´: new Date().toLocaleString('zh-CN')
            };
            
            // åˆ›å»ºå¹¶ä¸‹è½½JSONæ–‡ä»¶
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `é¡¹ç›®æ•°æ®_${project.name}_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showNotification('é¡¹ç›®æ•°æ®å¯¼å‡ºæˆåŠŸï¼', 'success');
        }
        
        // åˆ é™¤é¡¹ç›®
        function deleteProject(projectId) {
            const project = projectsData.find(p => p.id === projectId);
            if (!project) {
                alert('é¡¹ç›®ä¸å­˜åœ¨');
                return;
            }
            
            const confirmed = confirm(`ç¡®å®šè¦åˆ é™¤é¡¹ç›®"${project.name}"å—ï¼Ÿ\n\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œï¼`);
            if (!confirmed) return;
            
            // äºŒæ¬¡ç¡®è®¤
            const doubleConfirm = confirm(`æœ€åç¡®è®¤ï¼šçœŸçš„è¦åˆ é™¤é¡¹ç›®"${project.name}"å—ï¼Ÿ\n\né¡¹ç›®ID: ${project.id}\nåˆ›å§‹äºº: ${project.founder}`);
            if (!doubleConfirm) return;
            
            deleteProjectConfirmed(projectId);
        }
        
        // ç¡®è®¤åˆ é™¤é¡¹ç›®
        async function deleteProjectConfirmed(projectId) {
            try {
                const response = await fetch('/api/projects', {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ id: projectId })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // ä»æœ¬åœ°æ•°æ®ä¸­ç§»é™¤
                    projectsData = projectsData.filter(p => p.id !== projectId);
                    filteredProjectsData = filteredProjectsData.filter(p => p.id !== projectId);
                    
                    // åˆ·æ–°è¡¨æ ¼
                    renderProjectsTable();
                    
                    // å…³é—­è¯¦æƒ…æ¨¡æ€æ¡†
                    const detailsModal = document.querySelector('[data-modal="project-details"]');
                    if (detailsModal) {
                        detailsModal.remove();
                    }
                    
                    showNotification('é¡¹ç›®åˆ é™¤æˆåŠŸï¼', 'success');
                } else {
                    alert('åˆ é™¤å¤±è´¥: ' + (result.message || 'æœªçŸ¥é”™è¯¯'));
                }
                
            } catch (error) {
                console.error('åˆ é™¤é¡¹ç›®å¤±è´¥:', error);
                alert('åˆ é™¤å¤±è´¥: ' + error.message);
            }
        }
        
        // ä¸‹è½½é¡¹ç›®æ–‡ä»¶
        async function downloadProjectFile(projectId, fileIndex) {
            const project = projectsData.find(p => p.id === projectId);
            if (!project || !project.files || !project.files[fileIndex]) {
                alert('æ–‡ä»¶ä¸å­˜åœ¨');
                return;
            }
            
            const file = project.files[fileIndex];
            console.log('å¼€å§‹ä¸‹è½½æ–‡ä»¶:', { projectId, fileIndex, fileName: file.name });
            
            try {
                // æ˜¾ç¤ºä¸‹è½½ä¸­çŠ¶æ€
                showNotification('æ­£åœ¨å‡†å¤‡ä¸‹è½½...', 'info');
                
                // ä½¿ç”¨æ­£ç¡®çš„APIè·¯å¾„
                const downloadUrl = `/api/projects/${projectId}/files/${fileIndex}`;
                console.log('ä¸‹è½½URL:', downloadUrl);
                
                const response = await fetch(downloadUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': '*/*',
                    }
                });
                
                console.log('ä¸‹è½½å“åº”çŠ¶æ€:', response.status, response.statusText);
                
                if (response.ok) {
                    const blob = await response.blob();
                    console.log('æ–‡ä»¶blobå¤§å°:', blob.size, 'bytes', 'ç±»å‹:', blob.type);
                    
                    // è·å–æ–‡ä»¶åï¼ˆä»å“åº”å¤´æˆ–ä½¿ç”¨é»˜è®¤åç§°ï¼‰
                    const contentDisposition = response.headers.get('content-disposition');
                    let fileName = file.name || `é¡¹ç›®æ–‡ä»¶_${fileIndex + 1}`;
                    
                    if (contentDisposition) {
                        const fileNameMatch = contentDisposition.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);
                        if (fileNameMatch && fileNameMatch[1]) {
                            fileName = fileNameMatch[1].replace(/['"]/g, '');
                        }
                    }
                    
                    // åˆ›å»ºä¸‹è½½é“¾æ¥
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = fileName;
                    link.style.display = 'none';
                    
                    // æ·»åŠ åˆ°DOMï¼Œç‚¹å‡»ï¼Œç„¶åç§»é™¤
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    // æ¸…ç†URLå¯¹è±¡
                    setTimeout(() => {
                        URL.revokeObjectURL(url);
                    }, 1000);
                    
                    showNotification(`æ–‡ä»¶ "${fileName}" ä¸‹è½½æˆåŠŸï¼`, 'success');
                    console.log('æ–‡ä»¶ä¸‹è½½å®Œæˆ:', fileName);
                    
                } else {
                    // å°è¯•è§£æé”™è¯¯å“åº”
                    let errorMessage = 'æ–‡ä»¶ä¸‹è½½å¤±è´¥';
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.message || errorMessage;
                    } catch (e) {
                        errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                    }
                    
                    console.error('ä¸‹è½½å¤±è´¥:', errorMessage);
                    showNotification(errorMessage, 'error');
                }
                
            } catch (error) {
                console.error('ä¸‹è½½æ–‡ä»¶å¤±è´¥:', error);
                showNotification('ç½‘ç»œé”™è¯¯ï¼Œæ–‡ä»¶ä¸‹è½½å¤±è´¥', 'error');
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥æ¶ˆæ¯
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const colors = {
                success: { bg: '#d1fae5', color: '#065f46', icon: 'âœ…' },
                error: { bg: '#fee2e2', color: '#991b1b', icon: 'âŒ' },
                info: { bg: '#dbeafe', color: '#1e40af', icon: 'â„¹ï¸' }
            };
            const style = colors[type] || colors.info;
            
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 3000;
                background: ${style.bg}; color: ${style.color}; padding: 15px 20px;
                border-radius: 8px; border-left: 4px solid ${style.color};
                box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 300px;
                font-weight: 600; display: flex; align-items: center; gap: 10px;
                animation: slideIn 0.3s ease-out;
            `;
            
            notification.innerHTML = `${style.icon} ${message}`;
            document.body.appendChild(notification);
            
            // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // æ·»åŠ åŠ¨ç”»æ ·å¼
        if (!document.getElementById('notificationStyles')) {
            const style = document.createElement('style');
            style.id = 'notificationStyles';
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }

        // ================== ç”¨æˆ·è¡Œä¸ºè·Ÿè¸ªç®¡ç†åŠŸèƒ½ ==================
        let userBehaviorData = [];
        let filteredBehaviorData = [];
        let currentLogsTab = 'realtime';
        let realtimeInterval = null;

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchLogsTab(tabId) {
            // æ›´æ–°æ ‡ç­¾æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.logs-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');

            // æ›´æ–°å†…å®¹é¢æ¿
            document.querySelectorAll('.logs-tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById(`${tabId}-tab`).classList.add('active');

            currentLogsTab = tabId;

            // åŠ è½½å¯¹åº”çš„æ•°æ®
            switch (tabId) {
                case 'realtime':
                    startRealtimeMonitoring();
                    break;
                case 'sessions':
                    loadSessionsData();
                    break;
                case 'pages':
                    loadPagesAnalysis();
                    break;
                case 'heatmap':
                    loadHeatmapData();
                    break;
            }
        }

        // å¼€å§‹å®æ—¶ç›‘æ§
        function startRealtimeMonitoring() {
            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            if (realtimeInterval) {
                clearInterval(realtimeInterval);
            }

            // ç«‹å³åŠ è½½ä¸€æ¬¡æ•°æ®
            loadRealtimeActivities();

            // æ¯10ç§’åˆ·æ–°ä¸€æ¬¡å®æ—¶æ•°æ®
            realtimeInterval = setInterval(() => {
                loadRealtimeActivities();
            }, 10000);
        }

        // åœæ­¢å®æ—¶ç›‘æ§
        function stopRealtimeMonitoring() {
            if (realtimeInterval) {
                clearInterval(realtimeInterval);
                realtimeInterval = null;
            }
        }

        // åŠ è½½å®æ—¶æ´»åŠ¨æ•°æ®
        async function loadRealtimeActivities() {
            try {
                const container = document.getElementById('realtimeActivities');
                
                // æ¨¡æ‹Ÿå®æ—¶æ•°æ®ï¼ˆå®é™…åº”ç”¨ä¸­ä»APIè·å–ï¼‰
                const mockRealtimeData = generateMockRealtimeData();
                
                let activitiesHtml = '';
                mockRealtimeData.forEach(activity => {
                    const timeAgo = getTimeAgo(activity.timestamp);
                    const typeIcon = getActivityIcon(activity.type);
                    const typeLabel = getActivityLabel(activity.type);
                    
                    activitiesHtml += `
                        <div class="realtime-activity" style="padding: 12px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 12px;">
                            <div class="activity-icon" style="font-size: 18px;">${typeIcon}</div>
                            <div class="activity-content" style="flex: 1;">
                                <div class="activity-title" style="font-weight: 500; margin-bottom: 2px;">
                                    ${typeLabel}: ${activity.details}
                                </div>
                                <div class="activity-meta" style="color: #666; font-size: 12px;">
                                    ç”¨æˆ·: ${activity.userId} â€¢ é¡µé¢: ${activity.page} â€¢ ${timeAgo}
                                </div>
                            </div>
                            <div class="activity-status" style="padding: 2px 8px; background: #e8f5e8; color: #2e7d2e; border-radius: 12px; font-size: 11px;">
                                å®æ—¶
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = activitiesHtml || '<div class="empty-state" style="text-align: center; padding: 40px; color: #666;"><p>æš‚æ— å®æ—¶æ´»åŠ¨æ•°æ®</p></div>';
                
                // æ›´æ–°åœ¨çº¿ç”¨æˆ·æ•°
                document.getElementById('realtimeCount').textContent = Math.floor(Math.random() * 25) + 5;

            } catch (error) {
                console.error('åŠ è½½å®æ—¶æ´»åŠ¨æ•°æ®å¤±è´¥:', error);
                document.getElementById('realtimeActivities').innerHTML = 
                    '<div class="error-state" style="text-align: center; padding: 40px; color: #dc3545;"><p>åŠ è½½å®æ—¶æ•°æ®å¤±è´¥</p></div>';
            }
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿå®æ—¶æ•°æ®
        function generateMockRealtimeData() {
            const activities = [];
            const now = Date.now();
            const types = ['page_view', 'click', 'form_submit', 'link_click', 'scroll_milestone'];
            const pages = ['/', '/pages/ai100.html', '/pages/investment-camp.html', '/pages/content-community.html'];
            const userIds = ['user_001', 'user_002', 'anonymous_123', 'member_456', 'admin_001'];

            for (let i = 0; i < 10; i++) {
                const type = types[Math.floor(Math.random() * types.length)];
                const page = pages[Math.floor(Math.random() * pages.length)];
                const userId = userIds[Math.floor(Math.random() * userIds.length)];
                
                activities.push({
                    type: type,
                    userId: userId,
                    page: page,
                    timestamp: now - (Math.random() * 300000), // æœ€è¿‘5åˆ†é’Ÿå†…
                    details: getActivityDetails(type, page)
                });
            }

            return activities.sort((a, b) => b.timestamp - a.timestamp);
        }

        // è·å–æ´»åŠ¨è¯¦æƒ…æè¿°
        function getActivityDetails(type, page) {
            const pageNames = {
                '/': 'é¦–é¡µ',
                '/pages/ai100.html': 'AI100é¡µé¢',
                '/pages/investment-camp.html': 'æŠ•èµ„è¥é¡µé¢',
                '/pages/content-community.html': 'å†…å®¹ç¤¾åŒºé¡µé¢'
            };

            const pageName = pageNames[page] || page;

            switch (type) {
                case 'page_view':
                    return `è®¿é—®äº†${pageName}`;
                case 'click':
                    return `åœ¨${pageName}è¿›è¡Œäº†ç‚¹å‡»æ“ä½œ`;
                case 'form_submit':
                    return `åœ¨${pageName}æäº¤äº†è¡¨å•`;
                case 'link_click':
                    return `åœ¨${pageName}ç‚¹å‡»äº†é“¾æ¥`;
                case 'scroll_milestone':
                    return `åœ¨${pageName}æ»šåŠ¨é˜…è¯»`;
                default:
                    return `åœ¨${pageName}æ‰§è¡Œäº†æ“ä½œ`;
            }
        }

        // è·å–æ´»åŠ¨å›¾æ ‡
        function getActivityIcon(type) {
            const icons = {
                'page_view': 'ğŸ“„',
                'click': 'ğŸ‘†',
                'form_submit': 'ğŸ“',
                'link_click': 'ğŸ”—',
                'scroll_milestone': 'ğŸ“'
            };
            return icons[type] || 'âš¡';
        }

        // è·å–æ´»åŠ¨æ ‡ç­¾
        function getActivityLabel(type) {
            const labels = {
                'page_view': 'é¡µé¢è®¿é—®',
                'click': 'ç‚¹å‡»äº‹ä»¶',
                'form_submit': 'è¡¨å•æäº¤',
                'link_click': 'é“¾æ¥ç‚¹å‡»',
                'scroll_milestone': 'æ»šåŠ¨è¡Œä¸º'
            };
            return labels[type] || 'å…¶ä»–æ“ä½œ';
        }

        // è·å–ç›¸å¯¹æ—¶é—´
        function getTimeAgo(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            
            if (diff < 60000) return 'åˆšåˆš';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'åˆ†é’Ÿå‰';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'å°æ—¶å‰';
            return Math.floor(diff / 86400000) + 'å¤©å‰';
        }

        // åŠ è½½ä¼šè¯æ•°æ®
        async function loadSessionsData() {
            try {
                const container = document.getElementById('sessionsTable');
                
                // æ¨¡æ‹Ÿä¼šè¯æ•°æ®
                const mockSessions = generateMockSessionsData();
                
                let sessionsHtml = `
                    <div class="table-container">
                        <table class="data-table" style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #f8f9fa;">
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left;">ä¼šè¯ID</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left;">ç”¨æˆ·</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left;">å¼€å§‹æ—¶é—´</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left;">æŒç»­æ—¶é•¿</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left;">é¡µé¢æ•°</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left;">ç‚¹å‡»æ•°</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left;">å‚ä¸åº¦</th>
                                    <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left;">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                mockSessions.forEach(session => {
                    const duration = formatDuration(session.duration);
                    const engagementColor = session.engagement >= 70 ? '#28a745' : session.engagement >= 40 ? '#ffc107' : '#dc3545';
                    
                    sessionsHtml += `
                        <tr style="border-bottom: 1px solid #dee2e6;">
                            <td style="padding: 12px; border: 1px solid #dee2e6;">${session.sessionId.substring(0, 8)}...</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="width: 32px; height: 32px; border-radius: 50%; background: #007bff; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px;">
                                        ${session.userId.charAt(0).toUpperCase()}
                                    </div>
                                    <div>
                                        <div style="font-weight: 500;">${session.userId}</div>
                                        <div style="color: #666; font-size: 12px;">${session.userType}</div>
                                    </div>
                                </div>
                            </td>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">${new Date(session.startTime).toLocaleString()}</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">${duration}</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">${session.pageViews}</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">${session.clicks}</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="width: 60px; height: 6px; background: #e9ecef; border-radius: 3px; overflow: hidden;">
                                        <div style="width: ${session.engagement}%; height: 100%; background: ${engagementColor};"></div>
                                    </div>
                                    <span style="color: ${engagementColor}; font-weight: 500;">${session.engagement}%</span>
                                </div>
                            </td>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">
                                <button onclick="viewSessionDetails('${session.sessionId}')" class="btn btn-sm btn-outline-primary" style="padding: 4px 8px; font-size: 12px;">
                                    æŸ¥çœ‹è¯¦æƒ…
                                </button>
                            </td>
                        </tr>
                    `;
                });

                sessionsHtml += `
                            </tbody>
                        </table>
                    </div>
                `;

                container.innerHTML = sessionsHtml;

            } catch (error) {
                console.error('åŠ è½½ä¼šè¯æ•°æ®å¤±è´¥:', error);
                document.getElementById('sessionsTable').innerHTML = 
                    '<div class="error-state" style="text-align: center; padding: 40px; color: #dc3545;"><p>åŠ è½½ä¼šè¯æ•°æ®å¤±è´¥</p></div>';
            }
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿä¼šè¯æ•°æ®
        function generateMockSessionsData() {
            const sessions = [];
            const now = Date.now();
            
            for (let i = 0; i < 20; i++) {
                const startTime = now - (Math.random() * 86400000 * 7); // æœ€è¿‘7å¤©å†…
                const duration = Math.random() * 1800000 + 60000; // 1-30åˆ†é’Ÿ
                const pageViews = Math.floor(Math.random() * 10) + 1;
                const clicks = Math.floor(Math.random() * 50) + 1;
                const engagement = Math.floor(Math.random() * 100);
                
                sessions.push({
                    sessionId: 'session_' + Date.now() + '_' + i,
                    userId: ['ç”¨æˆ·' + (i + 1), 'anonymous_' + i, 'member_' + i][Math.floor(Math.random() * 3)],
                    userType: ['æ³¨å†Œç”¨æˆ·', 'åŒ¿åç”¨æˆ·', 'é«˜çº§ä¼šå‘˜'][Math.floor(Math.random() * 3)],
                    startTime: startTime,
                    duration: duration,
                    pageViews: pageViews,
                    clicks: clicks,
                    engagement: engagement
                });
            }

            return sessions.sort((a, b) => b.startTime - a.startTime);
        }

        // æ ¼å¼åŒ–æŒç»­æ—¶é•¿
        function formatDuration(ms) {
            const minutes = Math.floor(ms / 60000);
            const seconds = Math.floor((ms % 60000) / 1000);
            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // æŸ¥çœ‹ä¼šè¯è¯¦æƒ…
        function viewSessionDetails(sessionId) {
            alert(`æŸ¥çœ‹ä¼šè¯è¯¦æƒ…: ${sessionId}\n\nè¿™é‡Œå°†æ˜¾ç¤ºç”¨æˆ·åœ¨è¯¥ä¼šè¯ä¸­çš„è¯¦ç»†è¡Œä¸ºè·¯å¾„å’Œæ“ä½œè®°å½•ã€‚`);
        }

        // åŠ è½½é¡µé¢åˆ†ææ•°æ®
        async function loadPagesAnalysis() {
            try {
                const container = document.getElementById('pagesAnalysis');
                
                // æ¨¡æ‹Ÿé¡µé¢åˆ†ææ•°æ®
                const mockPagesData = generateMockPagesData();
                
                let pagesHtml = `
                    <div class="pages-stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                `;

                mockPagesData.forEach(page => {
                    const bounceRateColor = page.bounceRate > 60 ? '#dc3545' : page.bounceRate > 40 ? '#ffc107' : '#28a745';
                    
                    pagesHtml += `
                        <div class="page-stat-card" style="background: #fff; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px;">
                            <div class="page-header" style="display: flex; justify-content: between; align-items: center; margin-bottom: 15px;">
                                <div>
                                    <h5 style="margin: 0; font-weight: 600;">${page.title}</h5>
                                    <p style="margin: 2px 0 0; color: #666; font-size: 12px;">${page.path}</p>
                                </div>
                                <div class="page-views" style="text-align: right;">
                                    <div style="font-size: 24px; font-weight: 600; color: #007bff;">${page.views.toLocaleString()}</div>
                                    <div style="font-size: 12px; color: #666;">æµè§ˆé‡</div>
                                </div>
                            </div>
                            
                            <div class="page-metrics" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="metric">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 4px;">å¹³å‡åœç•™æ—¶é—´</div>
                                    <div style="font-size: 16px; font-weight: 500;">${formatDuration(page.avgTime)}</div>
                                </div>
                                <div class="metric">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 4px;">è·³å‡ºç‡</div>
                                    <div style="font-size: 16px; font-weight: 500; color: ${bounceRateColor};">${page.bounceRate}%</div>
                                </div>
                                <div class="metric">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 4px;">ç‹¬ç«‹è®¿å®¢</div>
                                    <div style="font-size: 16px; font-weight: 500;">${page.uniqueVisitors}</div>
                                </div>
                                <div class="metric">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 4px;">è½¬åŒ–ç‡</div>
                                    <div style="font-size: 16px; font-weight: 500; color: #28a745;">${page.conversionRate}%</div>
                                </div>
                            </div>
                            
                            <div class="page-actions" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                                <button onclick="viewPageDetails('${page.path}')" class="btn btn-sm btn-outline-primary" style="width: 100%; padding: 6px 12px; font-size: 12px;">
                                    æŸ¥çœ‹è¯¦ç»†åˆ†æ
                                </button>
                            </div>
                        </div>
                    `;
                });

                pagesHtml += `</div>`;

                container.innerHTML = pagesHtml;

            } catch (error) {
                console.error('åŠ è½½é¡µé¢åˆ†ææ•°æ®å¤±è´¥:', error);
                document.getElementById('pagesAnalysis').innerHTML = 
                    '<div class="error-state" style="text-align: center; padding: 40px; color: #dc3545;"><p>åŠ è½½é¡µé¢æ•°æ®å¤±è´¥</p></div>';
            }
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿé¡µé¢æ•°æ®
        function generateMockPagesData() {
            return [
                {
                    path: '/',
                    title: 'é¦–é¡µ',
                    views: 12580,
                    uniqueVisitors: 8943,
                    avgTime: 185000, // 3åˆ†5ç§’
                    bounceRate: 35,
                    conversionRate: 8.5
                },
                {
                    path: '/pages/ai100.html',
                    title: 'AI100 - å…¨çƒAIä¼ä¸šæ¦œå•',
                    views: 8432,
                    uniqueVisitors: 6221,
                    avgTime: 340000, // 5åˆ†40ç§’
                    bounceRate: 28,
                    conversionRate: 12.3
                },
                {
                    path: '/pages/investment-camp.html',
                    title: 'SVTRæŠ•èµ„è¥',
                    views: 5671,
                    uniqueVisitors: 4103,
                    avgTime: 260000, // 4åˆ†20ç§’
                    bounceRate: 42,
                    conversionRate: 15.7
                },
                {
                    path: '/pages/content-community.html',
                    title: 'å†…å®¹ç¤¾åŒº',
                    views: 3254,
                    uniqueVisitors: 2187,
                    avgTime: 420000, // 7åˆ†é’Ÿ
                    bounceRate: 25,
                    conversionRate: 9.8
                }
            ];
        }

        // æŸ¥çœ‹é¡µé¢è¯¦æƒ…
        function viewPageDetails(pagePath) {
            alert(`æŸ¥çœ‹é¡µé¢è¯¦ç»†åˆ†æ: ${pagePath}\n\nè¿™é‡Œå°†æ˜¾ç¤ºè¯¥é¡µé¢çš„è¯¦ç»†è®¿é—®æ•°æ®ã€ç”¨æˆ·è¡Œä¸ºæµå’Œè½¬åŒ–æ¼æ–—ã€‚`);
        }

        // åŠ è½½çƒ­åŠ›å›¾æ•°æ®
        function loadHeatmapData() {
            const pageSelect = document.getElementById('heatmapPageSelect');
            const selectedPage = pageSelect.value;
            const container = document.getElementById('heatmapVisualization');
            
            if (!selectedPage) {
                container.innerHTML = `
                    <div class="empty-state" style="text-align: center; padding: 60px; color: #666;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ”¥</div>
                        <h4>é€‰æ‹©é¡µé¢æŸ¥çœ‹çƒ­åŠ›å›¾</h4>
                        <p>é€‰æ‹©ä¸Šæ–¹çš„é¡µé¢æ¥æŸ¥çœ‹ç”¨æˆ·ç‚¹å‡»çƒ­åŠ›å›¾åˆ†æ</p>
                    </div>
                `;
                return;
            }

            // æ¨¡æ‹Ÿçƒ­åŠ›å›¾æ•°æ®
            const mockHeatmapData = generateMockHeatmapData();
            
            let heatmapHtml = `
                <div class="heatmap-container" style="position: relative; background: #f8f9fa; border-radius: 8px; padding: 20px; min-height: 400px;">
                    <div class="heatmap-legend" style="position: absolute; top: 20px; right: 20px; background: white; padding: 10px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="font-size: 12px; font-weight: 600; margin-bottom: 8px;">ç‚¹å‡»å¼ºåº¦</div>
                        <div style="display: flex; align-items: center; gap: 4px;">
                            <span style="font-size: 10px;">ä½</span>
                            <div style="width: 80px; height: 8px; background: linear-gradient(to right, #4CAF50, #FFEB3B, #FF9800, #F44336); border-radius: 4px;"></div>
                            <span style="font-size: 10px;">é«˜</span>
                        </div>
                    </div>
                    
                    <div class="heatmap-title" style="margin-bottom: 20px;">
                        <h5 style="margin: 0;">${pageSelect.options[pageSelect.selectedIndex].text} - ç‚¹å‡»çƒ­åŠ›å›¾</h5>
                        <p style="margin: 4px 0 0; color: #666; font-size: 12px;">åŸºäºæœ€è¿‘7å¤©çš„ç”¨æˆ·ç‚¹å‡»æ•°æ®ç”Ÿæˆ</p>
                    </div>
                    
                    <div class="heatmap-visualization" style="position: relative; background: white; border-radius: 6px; padding: 20px; min-height: 300px;">
            `;

            // æ·»åŠ æ¨¡æ‹Ÿçƒ­ç‚¹
            mockHeatmapData.forEach(point => {
                const intensity = Math.min(point.clicks / 100, 1); // å½’ä¸€åŒ–å¼ºåº¦
                const color = getHeatmapColor(intensity);
                const size = Math.max(20 + intensity * 40, 20);
                
                heatmapHtml += `
                    <div class="heatmap-point" style="
                        position: absolute;
                        left: ${point.x}px;
                        top: ${point.y}px;
                        width: ${size}px;
                        height: ${size}px;
                        background: ${color};
                        border-radius: 50%;
                        opacity: 0.7;
                        transform: translate(-50%, -50%);
                        cursor: pointer;
                    " title="ç‚¹å‡»æ¬¡æ•°: ${point.clicks}" onclick="showHeatmapDetail(${point.x}, ${point.y}, ${point.clicks})"></div>
                `;
            });

            heatmapHtml += `
                        <div class="heatmap-placeholder" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 200px; color: #999; border: 2px dashed #ddd; border-radius: 6px;">
                            <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“Š</div>
                            <div style="font-size: 16px; font-weight: 500; margin-bottom: 4px;">${pageSelect.options[pageSelect.selectedIndex].text}</div>
                            <div style="font-size: 12px;">é¡µé¢ç»“æ„å’Œçƒ­ç‚¹åˆ†å¸ƒå›¾</div>
                        </div>
                    </div>
                    
                    <div class="heatmap-stats" style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div class="stat-item" style="background: white; padding: 12px; border-radius: 6px; text-align: center;">
                            <div style="font-size: 18px; font-weight: 600; color: #007bff;">${mockHeatmapData.reduce((sum, p) => sum + p.clicks, 0)}</div>
                            <div style="font-size: 12px; color: #666;">æ€»ç‚¹å‡»æ•°</div>
                        </div>
                        <div class="stat-item" style="background: white; padding: 12px; border-radius: 6px; text-align: center;">
                            <div style="font-size: 18px; font-weight: 600; color: #28a745;">${mockHeatmapData.length}</div>
                            <div style="font-size: 12px; color: #666;">çƒ­ç‚¹åŒºåŸŸ</div>
                        </div>
                        <div class="stat-item" style="background: white; padding: 12px; border-radius: 6px; text-align: center;">
                            <div style="font-size: 18px; font-weight: 600; color: #ffc107;">${Math.max(...mockHeatmapData.map(p => p.clicks))}</div>
                            <div style="font-size: 12px; color: #666;">æœ€é«˜ç‚¹å‡»</div>
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = heatmapHtml;
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿçƒ­åŠ›å›¾æ•°æ®
        function generateMockHeatmapData() {
            const points = [];
            for (let i = 0; i < 15; i++) {
                points.push({
                    x: Math.random() * 600 + 50,
                    y: Math.random() * 400 + 50,
                    clicks: Math.floor(Math.random() * 500) + 10
                });
            }
            return points;
        }

        // è·å–çƒ­åŠ›å›¾é¢œè‰²
        function getHeatmapColor(intensity) {
            const colors = [
                'rgba(76, 175, 80, 0.6)',   // ç»¿è‰² - ä½
                'rgba(255, 235, 59, 0.6)',  // é»„è‰² - ä¸­ä½
                'rgba(255, 152, 0, 0.6)',   // æ©™è‰² - ä¸­é«˜
                'rgba(244, 67, 54, 0.6)'    // çº¢è‰² - é«˜
            ];
            
            const index = Math.floor(intensity * (colors.length - 1));
            return colors[Math.min(index, colors.length - 1)];
        }

        // æ˜¾ç¤ºçƒ­åŠ›å›¾è¯¦æƒ…
        function showHeatmapDetail(x, y, clicks) {
            alert(`çƒ­ç‚¹è¯¦æƒ…:\nåæ ‡: (${x}, ${y})\nç‚¹å‡»æ¬¡æ•°: ${clicks}\n\nè¿™é‡Œå¯ä»¥æ˜¾ç¤ºè¯¥çƒ­ç‚¹åŒºåŸŸçš„è¯¦ç»†åˆ†ææ•°æ®ã€‚`);
        }

        // è¿‡æ»¤ç”¨æˆ·è¡Œä¸ºæ—¥å¿—
        function filterUserBehaviorLogs() {
            const userTypeFilter = document.getElementById('userTypeFilter').value;
            const behaviorTypeFilter = document.getElementById('behaviorTypeFilter').value;
            const timeRangeFilter = document.getElementById('timeRangeFilter').value;
            const userSearchInput = document.getElementById('userSearchInput').value.toLowerCase();
            
            // å¤„ç†è‡ªå®šä¹‰æ—¶é—´èŒƒå›´æ˜¾ç¤º
            const customTimeRange = document.getElementById('customTimeRange');
            if (timeRangeFilter === 'custom') {
                customTimeRange.style.display = 'grid';
            } else {
                customTimeRange.style.display = 'none';
            }
            
            // è¿™é‡Œåº”è¯¥æ ¹æ®è¿‡æ»¤æ¡ä»¶é‡æ–°åŠ è½½æ•°æ®
            console.log('è¿‡æ»¤æ¡ä»¶:', {
                userType: userTypeFilter,
                behaviorType: behaviorTypeFilter,
                timeRange: timeRangeFilter,
                searchTerm: userSearchInput
            });
            
            // é‡æ–°åŠ è½½å½“å‰æ ‡ç­¾é¡µçš„æ•°æ®
            switch (currentLogsTab) {
                case 'realtime':
                    loadRealtimeActivities();
                    break;
                case 'sessions':
                    loadSessionsData();
                    break;
                case 'pages':
                    loadPagesAnalysis();
                    break;
            }
        }

        // åˆ·æ–°ç”¨æˆ·è¡Œä¸ºæ•°æ®
        function refreshUserBehaviorData() {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const containers = ['realtimeActivities', 'sessionsTable', 'pagesAnalysis', 'heatmapVisualization'];
            containers.forEach(containerId => {
                const container = document.getElementById(containerId);
                if (container) {
                    container.innerHTML = `
                        <div class="loading-state" style="text-align: center; padding: 40px; color: #666;">
                            <div class="loading-spinner" style="margin: 0 auto 15px; width: 40px; height: 40px; border: 3px solid #f3f3f3; border-top: 3px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                            <p>æ­£åœ¨åˆ·æ–°æ•°æ®...</p>
                        </div>
                    `;
                }
            });

            // æ›´æ–°ç»Ÿè®¡æ¦‚è§ˆ
            setTimeout(() => {
                document.getElementById('todayActiveUsers').textContent = Math.floor(Math.random() * 500) + 200;
                document.getElementById('todayPageViews').textContent = (Math.floor(Math.random() * 5000) + 2000).toLocaleString();
                document.getElementById('avgSessionTime').textContent = Math.floor(Math.random() * 5) + 3 + ':' + (Math.floor(Math.random() * 60)).toString().padStart(2, '0');
                document.getElementById('engagementRate').textContent = Math.floor(Math.random() * 30) + 60 + '%';

                // é‡æ–°åŠ è½½å½“å‰æ ‡ç­¾é¡µæ•°æ®
                switch (currentLogsTab) {
                    case 'realtime':
                        loadRealtimeActivities();
                        break;
                    case 'sessions':
                        loadSessionsData();
                        break;
                    case 'pages':
                        loadPagesAnalysis();
                        break;
                    case 'heatmap':
                        loadHeatmapData();
                        break;
                }
            }, 1500);
        }

        // å¯¼å‡ºç”¨æˆ·è¡Œä¸ºæ•°æ®
        function exportUserBehaviorData() {
            const today = new Date().toISOString().split('T')[0];
            const filename = `SVTRç”¨æˆ·è¡Œä¸ºæŠ¥å‘Š_${today}.csv`;
            
            // æ¨¡æ‹Ÿå¯¼å‡ºæ•°æ®
            const csvContent = `
ç”¨æˆ·è¡Œä¸ºåˆ†ææŠ¥å‘Š,${today}
,
ç»Ÿè®¡æ¦‚è§ˆ,
ä»Šæ—¥æ´»è·ƒç”¨æˆ·,${document.getElementById('todayActiveUsers').textContent}
ä»Šæ—¥é¡µé¢æµè§ˆ,${document.getElementById('todayPageViews').textContent}
å¹³å‡åœç•™æ—¶é—´,${document.getElementById('avgSessionTime').textContent}
ç”¨æˆ·å‚ä¸åº¦,${document.getElementById('engagementRate').textContent}
,
é¡µé¢åˆ†æ,
é¡µé¢,æµè§ˆé‡,ç‹¬ç«‹è®¿å®¢,å¹³å‡åœç•™æ—¶é—´,è·³å‡ºç‡,è½¬åŒ–ç‡
é¦–é¡µ,12580,8943,3:05,35%,8.5%
AI100é¡µé¢,8432,6221,5:40,28%,12.3%
æŠ•èµ„è¥é¡µé¢,5671,4103,4:20,42%,15.7%
å†…å®¹ç¤¾åŒºé¡µé¢,3254,2187,7:00,25%,9.8%
            `.trim();

            // åˆ›å»ºå¹¶ä¸‹è½½æ–‡ä»¶
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed; top: 20px; right: 20px; background: #28a745; color: white;
                padding: 12px 20px; border-radius: 6px; z-index: 10000; animation: slideIn 0.3s ease;
            `;
            toast.textContent = `ğŸ“Š ç”¨æˆ·è¡Œä¸ºæŠ¥å‘Šå·²å¯¼å‡º: ${filename}`;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // ç›‘å¬æ¨¡å—åˆ‡æ¢ï¼Œåœ¨åˆ‡æ¢åˆ°æ“ä½œæ—¥å¿—æ¨¡å—æ—¶åˆå§‹åŒ–æ•°æ®
        const originalShowModule = showModule;
        showModule = function(moduleId) {
            originalShowModule(moduleId);
            
            if (moduleId === 'logs') {
                // åˆå§‹åŒ–æ“ä½œæ—¥å¿—æ¨¡å—
                setTimeout(() => {
                    refreshUserBehaviorData();
                    startRealtimeMonitoring();
                }, 500);
            } else if (currentModule === 'logs' && moduleId !== 'logs') {
                // ç¦»å¼€æ“ä½œæ—¥å¿—æ¨¡å—æ—¶åœæ­¢å®æ—¶ç›‘æ§
                stopRealtimeMonitoring();
            }
        };
        
    </script>
</body>
</html>