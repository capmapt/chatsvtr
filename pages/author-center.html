<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>作者中心 - SVTR</title>
  <meta name="description" content="SVTR作者中心，创作和管理您的AI创投内容">
  
  <link rel="stylesheet" href="../assets/css/style-optimized.css">
  <link rel="icon" type="image/x-icon" href="../assets/images/favicon.ico">
  
  <!-- 富文本编辑器样式 -->
  <style>
    #editor {
      min-height: 400px;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      background: #fff;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      font-size: 14px;
      line-height: 1.6;
      overflow-y: auto;
      resize: vertical;
    }
    #editor:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
    }
    
    .editor-toolbar {
      border: 1px solid #ddd;
      border-bottom: none;
      border-radius: 8px 8px 0 0;
      background: #f8f9fa;
      padding: 8px;
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
    }
    
    .editor-btn {
      background: none;
      border: 1px solid transparent;
      padding: 5px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .editor-btn:hover {
      background: #e9ecef;
      border-color: #dee2e6;
    }
    
    .editor-btn.active {
      background: #007bff;
      color: white;
    }
  </style>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f8f9fa;
      color: #333;
    }

    .author-layout {
      display: flex;
      min-height: 100vh;
    }

    /* 侧边栏 */
    .author-sidebar {
      width: 280px;
      background: white;
      border-right: 1px solid #e9ecef;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 100;
    }

    .author-profile {
      padding: 30px 20px;
      border-bottom: 1px solid #e9ecef;
      text-align: center;
    }

    .author-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 2rem;
      font-weight: 600;
      margin: 0 auto 15px;
    }

    .author-name {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .author-role {
      color: #666;
      font-size: 0.9rem;
    }

    .author-stats {
      display: flex;
      justify-content: space-around;
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid #f0f0f0;
    }

    .stat-item {
      text-align: center;
    }

    .stat-number {
      font-size: 1.3rem;
      font-weight: 600;
      color: #FA8C32;
    }

    .stat-label {
      font-size: 0.8rem;
      color: #666;
      margin-top: 2px;
    }

    /* 导航菜单 */
    .author-nav {
      padding: 20px 0;
    }

    .nav-item {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      color: #666;
      text-decoration: none;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .nav-item:hover {
      background: #f8f9fa;
      color: #FA8C32;
    }

    .nav-item.active {
      background: rgba(250, 140, 50, 0.1);
      color: #FA8C32;
      border-right: 3px solid #FA8C32;
    }

    .nav-icon {
      font-size: 1.1rem;
      margin-right: 12px;
      width: 20px;
      text-align: center;
    }

    /* 主内容区 */
    .author-main {
      flex: 1;
      margin-left: 280px;
      padding: 30px;
    }

    .page-header {
      display: flex;
      justify-content: between;
      align-items: center;
      margin-bottom: 30px;
    }

    .page-title {
      font-size: 1.8rem;
      font-weight: 600;
      color: #2c3e50;
    }

    .page-subtitle {
      color: #666;
      margin-top: 5px;
    }

    .header-actions {
      display: flex;
      gap: 15px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #FA8C32, #FF7519);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(250, 140, 50, 0.3);
    }

    .btn-secondary {
      background: white;
      color: #666;
      border: 1px solid #ddd;
    }

    .btn-secondary:hover {
      background: #f8f9fa;
      border-color: #FA8C32;
    }

    /* 内容模块 */
    .content-module {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .content-module.active {
      display: block;
    }

    /* 文章列表 */
    .article-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .article-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid #e9ecef;
      transition: all 0.3s ease;
    }

    .article-card:hover {
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transform: translateY(-2px);
    }

    .article-header {
      display: flex;
      justify-content: between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .article-status {
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    .status-draft { background: #ffc107; color: white; }
    .status-pending { background: #17a2b8; color: white; }
    .status-published { background: #28a745; color: white; }
    .status-rejected { background: #dc3545; color: white; }

    .article-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 10px;
      line-height: 1.4;
    }

    .article-excerpt {
      color: #666;
      font-size: 0.9rem;
      line-height: 1.5;
      margin-bottom: 15px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .article-meta {
      display: flex;
      justify-content: between;
      align-items: center;
      font-size: 0.8rem;
      color: #888;
    }

    .article-actions {
      display: flex;
      gap: 10px;
    }

    .action-btn {
      padding: 6px 12px;
      font-size: 0.8rem;
      border: 1px solid #ddd;
      background: white;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .action-btn:hover {
      background: #f8f9fa;
    }

    /* 编辑器容器 */
    .editor-container {
      background: white;
      border-radius: 12px;
      padding: 30px;
      border: 1px solid #e9ecef;
    }

    .editor-header {
      margin-bottom: 25px;
    }

    .editor-title-input {
      width: 100%;
      font-size: 1.5rem;
      font-weight: 600;
      border: none;
      outline: none;
      padding: 15px 0;
      border-bottom: 2px solid #e9ecef;
      transition: border-color 0.3s ease;
    }

    .editor-title-input:focus {
      border-bottom-color: #FA8C32;
    }

    .editor-meta {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }

    .meta-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .meta-label {
      font-size: 0.9rem;
      font-weight: 500;
      color: #666;
    }

    .meta-select, .meta-input {
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 0.9rem;
      transition: border-color 0.3s ease;
    }

    .meta-select:focus, .meta-input:focus {
      outline: none;
      border-color: #FA8C32;
    }

    .editor-content {
      margin: 25px 0;
    }

    .ql-editor {
      min-height: 400px;
      font-size: 1rem;
      line-height: 1.6;
    }

    .editor-actions {
      display: flex;
      justify-content: between;
      align-items: center;
      margin-top: 25px;
      padding-top: 20px;
      border-top: 1px solid #e9ecef;
    }

    .editor-actions-left {
      display: flex;
      gap: 15px;
    }

    .editor-actions-right {
      display: flex;
      gap: 10px;
    }

    /* 统计面板 */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stats-card {
      background: white;
      border-radius: 12px;
      padding: 25px;
      border: 1px solid #e9ecef;
      text-align: center;
    }

    .stats-icon {
      font-size: 2.5rem;
      margin-bottom: 15px;
    }

    .stats-number {
      font-size: 2rem;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 5px;
    }

    .stats-label {
      color: #666;
      font-size: 0.9rem;
    }

    .stats-trend {
      margin-top: 10px;
      font-size: 0.8rem;
    }

    .trend-up { color: #28a745; }
    .trend-down { color: #dc3545; }

    /* 设置面板 */
    .settings-form {
      background: white;
      border-radius: 12px;
      padding: 30px;
      border: 1px solid #e9ecef;
    }

    .form-section {
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 15px;
      color: #2c3e50;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-label {
      font-size: 0.9rem;
      font-weight: 500;
      color: #666;
    }

    .form-input, .form-textarea {
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-input:focus, .form-textarea:focus {
      outline: none;
      border-color: #FA8C32;
      box-shadow: 0 0 0 3px rgba(250, 140, 50, 0.1);
    }

    /* 响应式设计 */
    @media (max-width: 768px) {
      .author-sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }

      .author-sidebar.mobile-open {
        transform: translateX(0);
      }

      .author-main {
        margin-left: 0;
        padding: 20px 15px;
      }

      .editor-meta {
        grid-template-columns: 1fr;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .article-grid {
        grid-template-columns: 1fr;
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }

    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .back-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.2rem;
      color: #666;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      z-index: 1000;
      transition: all 0.3s ease;
    }

    .back-btn:hover {
      background: #FA8C32;
      color: white;
      border-color: #FA8C32;
    }

    @media (min-width: 769px) {
      .back-btn {
        display: none;
      }
    }
  </style>
</head>

<body>
  <!-- 返回按钮（移动端） -->
  <button class="back-btn" onclick="window.history.back()" title="返回">←</button>

  <div class="author-layout">
    <!-- 侧边栏 -->
    <div class="author-sidebar" id="authorSidebar">
      <!-- 作者资料 -->
      <div class="author-profile">
        <div class="author-avatar" id="authorAvatar">A</div>
        <div class="author-name" id="authorName">加载中...</div>
        <div class="author-role">内容创作者</div>
        <div class="author-stats">
          <div class="stat-item">
            <div class="stat-number" id="articleCount">0</div>
            <div class="stat-label">文章</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="viewCount">0</div>
            <div class="stat-label">阅读</div>
          </div>
          <div class="stat-item">
            <div class="stat-number" id="fanCount">0</div>
            <div class="stat-label">粉丝</div>
          </div>
        </div>
      </div>

      <!-- 导航菜单 -->
      <nav class="author-nav">
        <a class="nav-item active" onclick="showModule('dashboard')">
          <span class="nav-icon">📊</span>
          <span>仪表板</span>
        </a>
        <a class="nav-item" onclick="showModule('articles')">
          <span class="nav-icon">📝</span>
          <span>我的文章</span>
        </a>
        <a class="nav-item" onclick="showModule('create')">
          <span class="nav-icon">✏️</span>
          <span>写文章</span>
        </a>
        <a class="nav-item" onclick="showModule('drafts')">
          <span class="nav-icon">📄</span>
          <span>草稿箱</span>
        </a>
        <a class="nav-item" onclick="showModule('analytics')">
          <span class="nav-icon">📈</span>
          <span>数据分析</span>
        </a>
        <a class="nav-item" onclick="showModule('settings')">
          <span class="nav-icon">⚙️</span>
          <span>个人设置</span>
        </a>
      </nav>
    </div>

    <!-- 主内容区 -->
    <main class="author-main">
      <!-- 仪表板 -->
      <div id="dashboard-module" class="content-module active">
        <div class="page-header">
          <div>
            <h1 class="page-title">仪表板</h1>
            <p class="page-subtitle">欢迎回来，查看您的创作概况</p>
          </div>
          <div class="header-actions">
            <button class="btn btn-primary" onclick="showModule('create')">
              <span>✏️</span> 写文章
            </button>
          </div>
        </div>

        <!-- 统计卡片 -->
        <div class="stats-grid">
          <div class="stats-card">
            <div class="stats-icon">📝</div>
            <div class="stats-number" id="dashTotalArticles">12</div>
            <div class="stats-label">总文章数</div>
            <div class="stats-trend trend-up">↑ 较上月 +2</div>
          </div>
          <div class="stats-card">
            <div class="stats-icon">👀</div>
            <div class="stats-number" id="dashTotalViews">2,845</div>
            <div class="stats-label">总阅读量</div>
            <div class="stats-trend trend-up">↑ 较上月 +15%</div>
          </div>
          <div class="stats-card">
            <div class="stats-icon">❤️</div>
            <div class="stats-number" id="dashTotalLikes">156</div>
            <div class="stats-label">获赞总数</div>
            <div class="stats-trend trend-up">↑ 较上月 +8</div>
          </div>
          <div class="stats-card">
            <div class="stats-icon">👥</div>
            <div class="stats-number" id="dashFollowers">89</div>
            <div class="stats-label">粉丝数量</div>
            <div class="stats-trend trend-up">↑ 较上月 +12</div>
          </div>
        </div>

        <!-- 最近文章 -->
        <h3 style="margin-bottom: 20px;">最近文章</h3>
        <div class="article-grid" id="recentArticles">
          <!-- 文章卡片将通过JavaScript动态生成 -->
        </div>
      </div>

      <!-- 我的文章 -->
      <div id="articles-module" class="content-module">
        <div class="page-header">
          <div>
            <h1 class="page-title">我的文章</h1>
            <p class="page-subtitle">管理您已发布和待审核的文章</p>
          </div>
          <div class="header-actions">
            <button class="btn btn-secondary">
              <span>🔍</span> 搜索
            </button>
            <button class="btn btn-primary" onclick="showModule('create')">
              <span>✏️</span> 写文章
            </button>
          </div>
        </div>

        <div class="article-grid" id="allArticles">
          <!-- 文章列表 -->
        </div>
      </div>

      <!-- 写文章 -->
      <div id="create-module" class="content-module">
        <div class="page-header">
          <div>
            <h1 class="page-title">写文章</h1>
            <p class="page-subtitle">创作您的AI创投内容</p>
          </div>
        </div>

        <div class="editor-container">
          <div class="editor-header">
            <input type="text" class="editor-title-input" id="articleTitle" placeholder="请输入文章标题...">
            
            <div class="editor-meta">
              <div class="meta-group">
                <label class="meta-label">分类</label>
                <select class="meta-select" id="articleCategory">
                  <option value="">请选择分类</option>
                  <option value="startups">AI初创公司</option>
                  <option value="public">AI上市公司</option>
                  <option value="analysis">AI行业分析</option>
                  <option value="investors">AI投资机构</option>
                </select>
              </div>
              <div class="meta-group">
                <label class="meta-label">标签</label>
                <input type="text" class="meta-input" id="articleTags" placeholder="多个标签用逗号分隔">
              </div>
              <div class="meta-group">
                <label class="meta-label">发布状态</label>
                <select class="meta-select" id="articleStatus">
                  <option value="draft">保存为草稿</option>
                  <option value="pending">提交审核</option>
                  <option value="scheduled">定时发布</option>
                </select>
              </div>
            </div>
          </div>

          <div class="editor-content">
            <div class="editor-toolbar">
              <button type="button" class="editor-btn" onclick="formatText('bold')"><b>B</b></button>
              <button type="button" class="editor-btn" onclick="formatText('italic')"><i>I</i></button>
              <button type="button" class="editor-btn" onclick="formatText('underline')"><u>U</u></button>
              <button type="button" class="editor-btn" onclick="formatText('justifyLeft')">←</button>
              <button type="button" class="editor-btn" onclick="formatText('justifyCenter')">⟷</button>
              <button type="button" class="editor-btn" onclick="formatText('justifyRight')">→</button>
              <button type="button" class="editor-btn" onclick="insertList('unordered')">• 列表</button>
              <button type="button" class="editor-btn" onclick="insertList('ordered')">1. 列表</button>
            </div>
            <div id="editor" contenteditable="true" style="height: 400px; border-radius: 0 0 8px 8px;">开始写作您的内容...</div>
          </div>

          <div class="editor-actions">
            <div class="editor-actions-left">
              <span style="color: #666; font-size: 0.9rem;" id="wordCount">字数: 0</span>
              <span style="color: #666; font-size: 0.9rem;">最后保存: 从未</span>
            </div>
            <div class="editor-actions-right">
              <button class="btn btn-secondary" onclick="saveArticle('draft')">保存草稿</button>
              <button class="btn btn-secondary" onclick="previewArticle()">预览</button>
              <button class="btn btn-primary" onclick="saveArticle('pending')">提交审核</button>
            </div>
          </div>
        </div>
      </div>

      <!-- 草稿箱 -->
      <div id="drafts-module" class="content-module">
        <div class="page-header">
          <div>
            <h1 class="page-title">草稿箱</h1>
            <p class="page-subtitle">管理您的草稿文章</p>
          </div>
        </div>

        <div class="article-grid" id="draftsContainer">
          <div class="empty-state">
            <div class="empty-state-icon">📄</div>
            <h3>暂无草稿</h3>
            <p>开始写作，创建您的第一篇文章</p>
            <button class="btn btn-primary" onclick="showModule('create')" style="margin-top: 20px;">
              <span>✏️</span> 开始写作
            </button>
          </div>
        </div>
      </div>

      <!-- 数据分析 -->
      <div id="analytics-module" class="content-module">
        <div class="page-header">
          <div>
            <h1 class="page-title">数据分析</h1>
            <p class="page-subtitle">深入了解您的内容表现</p>
          </div>
        </div>

        <div class="empty-state">
          <div class="empty-state-icon">📈</div>
          <h3>数据分析功能</h3>
          <p>详细的数据分析功能正在开发中...</p>
        </div>
      </div>

      <!-- 个人设置 -->
      <div id="settings-module" class="content-module">
        <div class="page-header">
          <div>
            <h1 class="page-title">个人设置</h1>
            <p class="page-subtitle">管理您的个人信息和偏好</p>
          </div>
        </div>

        <form class="settings-form" id="settingsForm">
          <div class="form-section">
            <h3 class="section-title">基本信息</h3>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">显示名称</label>
                <input type="text" class="form-input" id="settingsDisplayName" placeholder="您的显示名称">
              </div>
              <div class="form-group">
                <label class="form-label">邮箱地址</label>
                <input type="email" class="form-input" id="settingsEmail" placeholder="your@email.com">
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">个人简介</label>
              <textarea class="form-textarea" id="settingsBio" placeholder="介绍一下您自己..."></textarea>
            </div>
          </div>

          <div class="form-section">
            <h3 class="section-title">专业信息</h3>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">公司/机构</label>
                <input type="text" class="form-input" id="settingsCompany" placeholder="您的公司或机构">
              </div>
              <div class="form-group">
                <label class="form-label">职位</label>
                <input type="text" class="form-input" id="settingsPosition" placeholder="您的职位">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">专业领域</label>
                <select class="meta-select" id="settingsExpertise">
                  <option value="">请选择专业领域</option>
                  <option value="ai-research">AI研究</option>
                  <option value="venture-capital">风险投资</option>
                  <option value="startup">创业公司</option>
                  <option value="industry-analysis">行业分析</option>
                  <option value="technology">技术开发</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">个人网站</label>
                <input type="url" class="form-input" id="settingsWebsite" placeholder="https://your-website.com">
              </div>
            </div>
          </div>

          <div style="text-align: right; padding-top: 20px; border-top: 1px solid #e9ecef;">
            <button type="submit" class="btn btn-primary">保存设置</button>
          </div>
        </form>
      </div>
    </main>
  </div>

  <script>
    // 全局变量
    let quillEditor;
    let currentUser = null;
    let articles = [];
    let drafts = [];

    // 页面初始化
    document.addEventListener('DOMContentLoaded', function() {
      initializeUser();
      initializeEditor();
      loadArticles();
      bindEvents();
    });

    // 初始化用户信息
    function initializeUser() {
      const storedUser = localStorage.getItem('svtr_user');
      if (storedUser) {
        currentUser = JSON.parse(storedUser);
        updateUserProfile();
      } else {
        // 模拟用户数据
        currentUser = {
          id: 1,
          name: 'AI创投分析师',
          email: 'analyst@svtr.ai',
          avatar: 'A',
          company: 'SVTR',
          position: '资深分析师'
        };
        updateUserProfile();
      }
    }

    // 更新用户资料显示
    function updateUserProfile() {
      document.getElementById('authorName').textContent = currentUser.name;
      document.getElementById('authorAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
      
      // 更新统计数据（模拟数据）
      document.getElementById('articleCount').textContent = articles.length;
      document.getElementById('viewCount').textContent = '2,845';
      document.getElementById('fanCount').textContent = '89';
    }

    // 初始化富文本编辑器
    function initializeEditor() {
      const editor = document.getElementById('editor');
      
      // 监听内容变化，更新字数统计
      editor.addEventListener('input', function() {
        const text = editor.textContent || editor.innerText || '';
        const wordCount = text.trim().length;
        document.getElementById('wordCount').textContent = `字数: ${wordCount}`;
        
        // 自动保存草稿
        autoSaveDraft();
      });

      // 清除默认内容
      editor.addEventListener('focus', function() {
        if (editor.textContent === '开始写作您的内容...') {
          editor.textContent = '';
        }
      });

      editor.addEventListener('blur', function() {
        if (editor.textContent.trim() === '') {
          editor.textContent = '开始写作您的内容...';
        }
      });
    }

    // 格式化文本
    function formatText(command) {
      document.execCommand(command, false, null);
      document.getElementById('editor').focus();
    }

    // 插入列表
    function insertList(type) {
      const command = type === 'ordered' ? 'insertOrderedList' : 'insertUnorderedList';
      document.execCommand(command, false, null);
      document.getElementById('editor').focus();
    }

    // 显示模块
    function showModule(moduleId) {
      // 隐藏所有模块
      document.querySelectorAll('.content-module').forEach(module => {
        module.classList.remove('active');
      });
      
      // 显示指定模块
      document.getElementById(moduleId + '-module').classList.add('active');
      
      // 更新导航状态
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      event.target.closest('.nav-item').classList.add('active');
      
      // 根据模块执行特定操作
      switch(moduleId) {
        case 'dashboard':
          loadDashboard();
          break;
        case 'articles':
          loadAllArticles();
          break;
        case 'drafts':
          loadDrafts();
          break;
        case 'create':
          resetEditor();
          break;
        case 'settings':
          loadSettings();
          break;
      }
    }

    // 加载仪表板数据
    function loadDashboard() {
      loadRecentArticles();
      updateDashboardStats();
    }

    // 加载最近文章
    function loadRecentArticles() {
      const recentContainer = document.getElementById('recentArticles');
      const recentArticles = articles.slice(0, 6); // 显示最近6篇文章
      
      if (recentArticles.length === 0) {
        recentContainer.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">📝</div>
            <h3>还没有文章</h3>
            <p>开始写作，创建您的第一篇文章</p>
            <button class="btn btn-primary" onclick="showModule('create')" style="margin-top: 20px;">
              <span>✏️</span> 开始写作
            </button>
          </div>
        `;
        return;
      }

      recentContainer.innerHTML = recentArticles.map(article => createArticleCard(article)).join('');
    }

    // 创建文章卡片HTML
    function createArticleCard(article) {
      const statusClass = `status-${article.status}`;
      const statusText = {
        'draft': '草稿',
        'pending': '待审核',
        'published': '已发布',
        'rejected': '被拒绝'
      };

      return `
        <div class="article-card">
          <div class="article-header">
            <span class="article-status ${statusClass}">${statusText[article.status]}</span>
          </div>
          <h3 class="article-title">${article.title}</h3>
          <p class="article-excerpt">${article.excerpt}</p>
          <div class="article-meta">
            <span>${article.createdAt}</span>
            <div class="article-actions">
              <button class="action-btn" onclick="editArticle(${article.id})">编辑</button>
              <button class="action-btn" onclick="viewArticle(${article.id})">查看</button>
              ${article.status === 'published' ? '<button class="action-btn" onclick="shareArticle(' + article.id + ')">分享</button>' : ''}
            </div>
          </div>
        </div>
      `;
    }

    // 更新仪表板统计
    function updateDashboardStats() {
      const published = articles.filter(a => a.status === 'published').length;
      const totalViews = articles.reduce((sum, a) => sum + (a.views || 0), 0);
      const totalLikes = articles.reduce((sum, a) => sum + (a.likes || 0), 0);
      
      document.getElementById('dashTotalArticles').textContent = articles.length;
      document.getElementById('dashTotalViews').textContent = totalViews.toLocaleString();
      document.getElementById('dashTotalLikes').textContent = totalLikes;
    }

    // 加载所有文章
    function loadAllArticles() {
      const container = document.getElementById('allArticles');
      if (articles.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">📝</div>
            <h3>还没有文章</h3>
            <p>开始写作，分享您的见解</p>
            <button class="btn btn-primary" onclick="showModule('create')" style="margin-top: 20px;">
              <span>✏️</span> 写文章
            </button>
          </div>
        `;
        return;
      }

      container.innerHTML = articles.map(article => createArticleCard(article)).join('');
    }

    // 加载草稿
    function loadDrafts() {
      const draftArticles = articles.filter(a => a.status === 'draft');
      const container = document.getElementById('draftsContainer');
      
      if (draftArticles.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">📄</div>
            <h3>暂无草稿</h3>
            <p>开始写作，创建您的第一篇文章</p>
            <button class="btn btn-primary" onclick="showModule('create')" style="margin-top: 20px;">
              <span>✏️</span> 开始写作
            </button>
          </div>
        `;
        return;
      }

      container.innerHTML = draftArticles.map(article => createArticleCard(article)).join('');
    }

    // 重置编辑器
    function resetEditor() {
      document.getElementById('articleTitle').value = '';
      document.getElementById('articleCategory').value = '';
      document.getElementById('articleTags').value = '';
      document.getElementById('articleStatus').value = 'draft';
      quillEditor.setContents([]);
      document.getElementById('wordCount').textContent = '字数: 0';
    }

    // 保存文章
    function saveArticle(status = 'draft') {
      const title = document.getElementById('articleTitle').value.trim();
      const category = document.getElementById('articleCategory').value;
      const tags = document.getElementById('articleTags').value.trim();
      const editor = document.getElementById('editor');
      const content = editor.innerHTML;
      const text = (editor.textContent || editor.innerText || '').trim();

      if (!title) {
        showToast('请输入文章标题', 'error');
        return;
      }

      if (!text || text.length < 100) {
        showToast('文章内容至少需要100字', 'error');
        return;
      }

      const article = {
        id: Date.now(),
        title: title,
        category: category,
        tags: tags.split(',').map(tag => tag.trim()).filter(tag => tag),
        content: content,
        excerpt: text.substring(0, 200) + (text.length > 200 ? '...' : ''),
        status: status,
        createdAt: new Date().toLocaleDateString('zh-CN'),
        updatedAt: new Date().toLocaleDateString('zh-CN'),
        author: currentUser.name,
        views: 0,
        likes: 0
      };

      // 保存到本地存储
      articles.unshift(article);
      localStorage.setItem('svtr_articles', JSON.stringify(articles));

      // 显示成功消息
      const statusText = {
        'draft': '草稿已保存',
        'pending': '文章已提交审核',
        'scheduled': '文章已计划发布'
      };
      
      showToast(statusText[status], 'success');

      // 如果是提交审核，切换到文章列表
      if (status === 'pending') {
        setTimeout(() => {
          showModule('articles');
        }, 1000);
      }

      // 重置编辑器
      if (status !== 'draft') {
        resetEditor();
      }

      // 更新统计
      updateUserProfile();
    }

    // 自动保存草稿
    let autoSaveTimeout;
    function autoSaveDraft() {
      clearTimeout(autoSaveTimeout);
      autoSaveTimeout = setTimeout(() => {
        const title = document.getElementById('articleTitle').value.trim();
        const editor = document.getElementById('editor');
        const content = (editor.textContent || editor.innerText || '').trim();
        
        if (title && content.length > 50) {
          // 这里可以实现自动保存逻辑
          console.log('自动保存草稿...');
        }
      }, 3000); // 3秒后自动保存
    }

    // 预览文章
    function previewArticle() {
      const title = document.getElementById('articleTitle').value.trim();
      const content = quillEditor.root.innerHTML;
      
      if (!title || !content) {
        showToast('请先编写文章内容', 'error');
        return;
      }

      // 打开预览窗口
      const previewWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes');
      previewWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="UTF-8">
          <title>预览: ${title}</title>
          <style>
            body { 
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
              max-width: 800px; 
              margin: 0 auto; 
              padding: 40px 20px; 
              line-height: 1.6;
            }
            h1 { color: #2c3e50; margin-bottom: 20px; }
            .preview-meta { 
              color: #666; 
              font-size: 0.9rem; 
              margin-bottom: 30px; 
              padding-bottom: 20px; 
              border-bottom: 1px solid #eee; 
            }
            .preview-content { font-size: 1.1rem; }
          </style>
        </head>
        <body>
          <h1>${title}</h1>
          <div class="preview-meta">
            作者: ${currentUser.name} | 预览时间: ${new Date().toLocaleString('zh-CN')}
          </div>
          <div class="preview-content">${content}</div>
        </body>
        </html>
      `);
    }

    // 编辑文章
    function editArticle(articleId) {
      const article = articles.find(a => a.id === articleId);
      if (!article) return;

      // 切换到编辑模式
      showModule('create');

      // 填充编辑器
      document.getElementById('articleTitle').value = article.title;
      document.getElementById('articleCategory').value = article.category || '';
      document.getElementById('articleTags').value = article.tags ? article.tags.join(', ') : '';
      const editor = document.getElementById('editor');
      editor.innerHTML = article.content;

      // 更新字数统计
      const wordCount = (editor.textContent || editor.innerText || '').trim().length;
      document.getElementById('wordCount').textContent = `字数: ${wordCount}`;

      showToast('文章已加载到编辑器', 'info');
    }

    // 查看文章
    function viewArticle(articleId) {
      const article = articles.find(a => a.id === articleId);
      if (!article) return;

      // 这里可以跳转到文章详情页或打开模态框
      showToast('查看文章功能开发中', 'info');
    }

    // 分享文章
    function shareArticle(articleId) {
      const article = articles.find(a => a.id === articleId);
      if (!article) return;

      // 复制分享链接
      const shareUrl = `${window.location.origin}/article/${articleId}`;
      navigator.clipboard.writeText(shareUrl).then(() => {
        showToast('分享链接已复制到剪贴板', 'success');
      });
    }

    // 加载设置
    function loadSettings() {
      document.getElementById('settingsDisplayName').value = currentUser.name || '';
      document.getElementById('settingsEmail').value = currentUser.email || '';
      document.getElementById('settingsBio').value = currentUser.bio || '';
      document.getElementById('settingsCompany').value = currentUser.company || '';
      document.getElementById('settingsPosition').value = currentUser.position || '';
      document.getElementById('settingsWebsite').value = currentUser.website || '';
    }

    // 绑定事件
    function bindEvents() {
      // 设置表单提交
      document.getElementById('settingsForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // 更新用户信息
        currentUser.name = document.getElementById('settingsDisplayName').value;
        currentUser.email = document.getElementById('settingsEmail').value;
        currentUser.bio = document.getElementById('settingsBio').value;
        currentUser.company = document.getElementById('settingsCompany').value;
        currentUser.position = document.getElementById('settingsPosition').value;
        currentUser.website = document.getElementById('settingsWebsite').value;
        
        // 保存到本地存储
        localStorage.setItem('svtr_user', JSON.stringify(currentUser));
        
        // 更新界面显示
        updateUserProfile();
        
        showToast('设置已保存', 'success');
      });
    }

    // 加载文章数据
    function loadArticles() {
      const storedArticles = localStorage.getItem('svtr_articles');
      if (storedArticles) {
        articles = JSON.parse(storedArticles);
      } else {
        // 模拟一些示例文章
        articles = [
          {
            id: 1,
            title: 'OpenAI最新融资轮详解：估值1570亿美元背后的故事',
            category: 'startups',
            tags: ['OpenAI', '融资', '估值'],
            excerpt: 'OpenAI在新一轮融资中获得65亿美元投资，公司估值达到创纪录的1570亿美元。本文深入分析这轮融资的细节、投资方构成以及对AI行业的影响...',
            status: 'published',
            createdAt: '2024-10-15',
            author: currentUser.name,
            views: 1250,
            likes: 89
          },
          {
            id: 2,
            title: '2024年Q3 AI芯片市场分析报告',
            category: 'analysis',
            tags: ['AI芯片', '市场分析', 'NVIDIA'],
            excerpt: 'Q3季度AI芯片市场继续保持强劲增长，NVIDIA数据中心业务收入达309亿美元。本报告分析市场格局变化、竞争态势及未来趋势...',
            status: 'pending',
            createdAt: '2024-10-14',
            author: currentUser.name,
            views: 0,
            likes: 0
          }
        ];
        localStorage.setItem('svtr_articles', JSON.stringify(articles));
      }
    }

    // 显示提示消息
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 24px;
        border-radius: 6px;
        color: white;
        font-weight: 500;
        z-index: 10000;
        transition: all 0.3s ease;
        transform: translateX(100%);
      `;
      
      const colors = {
        success: '#28a745',
        error: '#dc3545',
        info: '#17a2b8'
      };
      
      toast.style.background = colors[type] || colors.info;
      toast.textContent = message;
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.transform = 'translateX(0)';
      }, 100);
      
      setTimeout(() => {
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 300);
      }, 3000);
    }

    // 移动端侧边栏切换
    function toggleSidebar() {
      const sidebar = document.getElementById('authorSidebar');
      sidebar.classList.toggle('mobile-open');
    }

    // 移动端响应
    if (window.innerWidth <= 768) {
      document.querySelector('.back-btn').style.display = 'flex';
    }
  </script>
</body>
</html>