# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

# Claude Project Memory (chatsvtr)

## é¡¹ç›®èƒŒæ™¯ (Project Background)
ChatSVTR æ˜¯ç¡…è°·ç§‘æŠ€è¯„è®ºçš„å®˜ç½‘é¡¹ç›®ï¼Œæ—¨åœ¨æ„å»ºå…¨çƒAIåˆ›æŠ•è¡Œä¸šç”Ÿæ€ç³»ç»Ÿçš„ç»Ÿä¸€å¹³å°ã€‚

### å…¬å¸èƒŒæ™¯
ç¡…è°·ç§‘æŠ€è¯„è®ºä¸“æ³¨äºå…¨çƒAIåˆ›æŠ•è¡Œä¸šç”Ÿæ€ç³»ç»Ÿå»ºè®¾ï¼š
- å†…å®¹æ²‰æ·€ï¼šé£ä¹¦çŸ¥è¯†åº“ã€å¤šç»´è¡¨æ ¼ï¼ˆAIåˆ›æŠ•åº“ï¼‰
- å†…å®¹åˆ†å‘ï¼šå¾®ä¿¡å…¬ä¼—å·ã€LinkedInã€å°çº¢ä¹¦ã€Xã€Substack
- ç¤¾ç¾¤è¿è¥ï¼šå¾®ä¿¡ç¾¤ã€Discord

### ç›®æ ‡ç”¨æˆ·
- AIåˆ›æŠ•ä»ä¸šè€…ï¼ˆæŠ•èµ„äººã€åˆ›ä¸šè€…ï¼‰
- è¡Œä¸šç ”ç©¶äººå‘˜å’Œåˆ†æå¸ˆ
- å¯¹AIåˆ›æŠ•æ„Ÿå…´è¶£çš„ä¸“ä¸šäººå£«

### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
1. **AIåˆ›æŠ•åº“**ï¼šç»“æ„åŒ–çš„AIåˆåˆ›å…¬å¸å’ŒæŠ•èµ„æœºæ„æ•°æ®åº“
2. **AIåˆ›æŠ•ä¼š**ï¼šç¤¾åŒºé©±åŠ¨çš„å†…å®¹å¹³å°
   - å®˜æ–¹é«˜è´¨é‡å†…å®¹å‘å¸ƒ
   - ç”¨æˆ·UGCå†…å®¹ç”Ÿæˆå’Œåˆ†äº«
   - Chatbotäº§å“åŒ–ï¼Œä¿ƒè¿›ç”¨æˆ·è‡ªå‘åˆ†äº«
3. **AIåˆ›æŠ•è¥**ï¼šç”¨æˆ·æäº¤çš„ä¸ªäººå’Œé¡¹ç›®ä¿¡æ¯å±•ç¤ºå¹³å°

### å•†ä¸šç›®æ ‡
é€šè¿‡å®˜ç½‘é›†ä¸­æ‰€æœ‰èµ„æºå’Œæµé‡ï¼Œå®ç°å•†ä¸šé—­ç¯ï¼Œæ›¿ä»£åˆ†æ•£çš„ç¬¬ä¸‰æ–¹å¹³å°ä¾èµ–ã€‚

## æŠ€æœ¯æ¶æ„ (Technical Architecture)

### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ ¸å¿ƒ**ï¼šåŸç”Ÿ HTML5/CSS3/JavaScriptï¼ˆES2022ï¼‰
- **æ„å»ºå·¥å…·**ï¼šè‡ªå®šä¹‰è„šæœ¬ + TypeScriptç¼–è¯‘
- **ä¼˜åŒ–å·¥å…·**ï¼šTerserå‹ç¼©ã€Clean-CSSã€WebPå›¾ç‰‡è½¬æ¢
- **æµ‹è¯•æ¡†æ¶**ï¼šJestï¼ˆå•å…ƒæµ‹è¯•ï¼‰+ Playwrightï¼ˆE2Eæµ‹è¯•ï¼‰
- **éƒ¨ç½²å¹³å°**ï¼šCloudflare Pages/Workers + Wrangler CLI

### åç«¯æœåŠ¡æ¶æ„
- **APIå±‚**ï¼šCloudflare Workers Functions (`/functions/api/`)
- **æ•°æ®å­˜å‚¨**ï¼šCloudflare KV + Vectorizeï¼ˆå‘é‡æ•°æ®åº“ï¼‰
- **AIæœåŠ¡**ï¼šCloudflare Workers AI + OpenAI APIï¼ˆfallbackï¼‰
- **æ•°æ®åŒæ­¥**ï¼šé£ä¹¦APIé›†æˆï¼Œè‡ªåŠ¨åŒæ­¥çŸ¥è¯†åº“å†…å®¹

### é¡¹ç›®æ–‡ä»¶ç»“æ„
```
chatsvtr/
â”œâ”€â”€ index.html                     # å…¥å£é¡µé¢
â”œâ”€â”€ assets/                        # é™æ€èµ„æº
â”‚   â”œâ”€â”€ css/                      
â”‚   â”‚   â”œâ”€â”€ style.css             # ä¸»æ ·å¼
â”‚   â”‚   â”œâ”€â”€ style-optimized.css   # ä¼˜åŒ–åæ ·å¼
â”‚   â”‚   â”œâ”€â”€ chat.css              # èŠå¤©ç»„ä»¶æ ·å¼
â”‚   â”‚   â””â”€â”€ *.css.gz              # Gzipå‹ç¼©ç‰ˆæœ¬
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ main.js               # ä¸»é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ main-optimized.js     # ä¼˜åŒ–åä¸»é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ chat.js               # èŠå¤©ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ chat-optimized.js     # ä¼˜åŒ–åèŠå¤©ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ i18n.js               # å›½é™…åŒ–æ”¯æŒ
â”‚   â”‚   â”œâ”€â”€ translations.js       # ç¿»è¯‘èµ„æº
â”‚   â”‚   â””â”€â”€ *.js.gz               # Gzipå‹ç¼©ç‰ˆæœ¬
â”‚   â”œâ”€â”€ images/                   # å›¾ç‰‡èµ„æºï¼ˆWebP + fallbackï¼‰
â”‚   â””â”€â”€ data/                     # æ•°æ®æ–‡ä»¶
â”‚       â”œâ”€â”€ ai-weekly.json        # AIå‘¨æŠ¥æ•°æ®
â”‚       â”œâ”€â”€ trading-picks.json    # äº¤æ˜“ç²¾é€‰æ•°æ®
â”‚       â””â”€â”€ rag/                  # RAGçŸ¥è¯†åº“æ•°æ®
â”œâ”€â”€ functions/                     # Cloudflare Functions
â”‚   â”œâ”€â”€ api/                      # APIç«¯ç‚¹
â”‚   â”‚   â”œâ”€â”€ chat.ts               # èŠå¤©APIï¼ˆRAGå¢å¼ºï¼‰
â”‚   â”‚   â”œâ”€â”€ suggestions.ts        # å»ºè®®API
â”‚   â”‚   â””â”€â”€ quota-status.ts       # é…é¢çŠ¶æ€API
â”‚   â”œâ”€â”€ lib/                      # å…±äº«åº“
â”‚   â”‚   â”œâ”€â”€ hybrid-rag-service.ts # æ··åˆRAGæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ rag-service.ts        # RAGåŸºç¡€æœåŠ¡
â”‚   â”‚   â””â”€â”€ conversation-context.ts # å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç†
â”‚   â””â”€â”€ webhook/                  # Webhookå¤„ç†
â”œâ”€â”€ pages/                        # å­é¡µé¢
â”‚   â”œâ”€â”€ ai-100.html              # AI 100é¡µé¢
â”‚   â”œâ”€â”€ ai-weekly.html           # AIå‘¨æŠ¥é¡µé¢
â”‚   â””â”€â”€ trading-picks.html       # äº¤æ˜“ç²¾é€‰é¡µé¢
â”œâ”€â”€ scripts/                      # æ„å»ºå’Œéƒ¨ç½²è„šæœ¬
â”œâ”€â”€ tests/                        # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ config/                       # é…ç½®æ–‡ä»¶
â””â”€â”€ docs/                        # æ–‡æ¡£
```

## æ„å»ºç³»ç»Ÿ (Build System)

### æ ¸å¿ƒæ„å»ºå‘½ä»¤
```bash
# å¼€å‘ç¯å¢ƒ
npm run start              # å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨ï¼ˆPython HTTP Server, ç«¯å£8000ï¼‰
npm run dev               # å¯åŠ¨Wranglerå¼€å‘æœåŠ¡å™¨ï¼ˆç«¯å£3000ï¼‰
npm run preview           # é¢„è§ˆæ¨¡å¼ï¼ˆç«¯å£8080ï¼‰

# æ„å»ºå’Œä¼˜åŒ–
npm run build             # TypeScriptç¼–è¯‘
npm run optimize:all      # å…¨é‡ä¼˜åŒ–ï¼ˆå›¾ç‰‡+èµ„æº+Gzipï¼‰
npm run optimize:images   # å›¾ç‰‡WebPè½¬æ¢
npm run optimize:assets   # JS/CSSå‹ç¼©
npm run optimize:gzip     # Gzipå‹ç¼©

# æµ‹è¯•
npm run test              # Jestå•å…ƒæµ‹è¯•
npm run test:watch        # Jest watchæ¨¡å¼
npm run test:e2e         # Playwright E2Eæµ‹è¯•ï¼ˆchromium onlyï¼‰
npm run test:e2e:full    # Playwrightå…¨æµè§ˆå™¨æµ‹è¯•
npm run test:e2e:ui      # Playwright UIæ¨¡å¼
npm run lint             # ESLintä»£ç æ£€æŸ¥
npm run lint:fix         # ESLintè‡ªåŠ¨ä¿®å¤
npm run format           # Prettierä»£ç æ ¼å¼åŒ–
npm run validate:html    # HTMLéªŒè¯

# éƒ¨ç½²
npm run deploy:cloudflare # Cloudflareéƒ¨ç½²
./scripts/deploy-optimized.sh # ä¼˜åŒ–ç‰ˆæœ¬éƒ¨ç½²
```

### ä¼˜åŒ–æµç¨‹
1. **å›¾ç‰‡ä¼˜åŒ–**ï¼šPNG/JPG â†’ WebP + fallbackï¼Œè‡ªåŠ¨å¤‡ä»½åŸæ–‡ä»¶
2. **ä»£ç å‹ç¼©**ï¼šJavaScriptç”¨Terserï¼ŒCSSç”¨CleanCSS
3. **Gzipå‹ç¼©**ï¼šæ‰€æœ‰é™æ€èµ„æºç”Ÿæˆ.gzç‰ˆæœ¬
4. **ç¼“å­˜ä¼˜åŒ–**ï¼šé™æ€èµ„æº1å¹´ç¼“å­˜ï¼ŒHTMLæ–‡ä»¶1å°æ—¶ç¼“å­˜

### é…ç½®æ–‡ä»¶è¯´æ˜
- `wrangler.toml`ï¼šCloudflare Workersé…ç½®ï¼ŒåŒ…å«ç¼“å­˜ç­–ç•¥å’Œç»‘å®š
- `tsconfig.json`ï¼šTypeScripté…ç½®ï¼ŒES2022ç›®æ ‡
- `package.json`ï¼šä¾èµ–ç®¡ç†å’Œè„šæœ¬å®šä¹‰
- `config/jest.config.js`ï¼šJestæµ‹è¯•é…ç½®
- `config/playwright.config.js`ï¼šE2Eæµ‹è¯•é…ç½®

## æ•°æ®åŒæ­¥ç³»ç»Ÿ (Data Synchronization)

### é£ä¹¦APIé›†æˆ
- **æ ¸å¿ƒè„šæœ¬**ï¼š`scripts/improved-feishu-sync.js`
- **é…ç½®ä¿¡æ¯**ï¼š
  - App ID: `cli_a8e2014cbe7d9013`
  - Space ID: `7321328173944340484`
  - åŒæ­¥å¯†ç ï¼š`svtrai2025`
- **åŒæ­¥å†…å®¹**ï¼šAIå‘¨æŠ¥ã€äº¤æ˜“ç²¾é€‰æ•°æ®ã€çŸ¥è¯†åº“å†…å®¹
- **æ•°æ®å­˜å‚¨**ï¼š`assets/data/` ç›®å½•ä¸‹çš„JSONæ–‡ä»¶

### åŒæ­¥å‘½ä»¤
```bash
npm run sync              # åŸºç¡€åŒæ­¥é£ä¹¦æ•°æ®
npm run sync:weekly       # ä»…åŒæ­¥AIå‘¨æŠ¥
npm run sync:trading      # ä»…åŒæ­¥äº¤æ˜“ç²¾é€‰
npm run sync:daily        # æ—¥å¸¸åŒæ­¥ä»»åŠ¡ï¼ˆä½¿ç”¨improved-feishu-sync.jsï¼‰
npm run sync:full         # å®Œæ•´åŒæ­¥ï¼ˆä½¿ç”¨improved-feishu-sync.jsï¼‰
npm run sync:webhook      # Webhookè§¦å‘åŒæ­¥
npm run sync:test         # åŒæ­¥åŠŸèƒ½æµ‹è¯•
npm run update            # æ‰‹åŠ¨æ›´æ–°ï¼ˆmanual-update.jsï¼‰
```

## AIä¸RAGç³»ç»Ÿ (AI & RAG Integration)

### æ··åˆRAGæ¶æ„
- **ä¸»æœåŠ¡**ï¼š`functions/lib/hybrid-rag-service.ts`
- **ç­–ç•¥ç»„åˆ**ï¼š
  1. å‘é‡æ£€ç´¢ï¼ˆCloudflare Vectorize + OpenAI embeddingï¼‰
  2. å…³é”®è¯æœç´¢ï¼ˆåŸºäºé£ä¹¦çŸ¥è¯†åº“ï¼‰
  3. è¯­ä¹‰æ¨¡å¼åŒ¹é…ï¼ˆfallbackæœºåˆ¶ï¼‰
- **AIæ¨¡å‹æ”¯æŒ**ï¼š
  - ä¼˜å…ˆï¼šCloudflare Workers AI
  - å¤‡ç”¨ï¼šOpenAI API
  - æ™ºèƒ½æ¼”ç¤ºï¼šæœ¬åœ°è¯­ä¹‰åŒ¹é…

### RAGæ•°æ®ç®¡ç†
```bash
npm run rag:sync          # åŒæ­¥RAGæ•°æ®æº
npm run rag:build         # æ„å»ºå‘é‡æ•°æ®åº“
npm run rag:test          # æµ‹è¯•RAGåŠŸèƒ½
npm run rag:deploy        # éƒ¨ç½²RAGæœåŠ¡
npm run rag:setup         # å®Œæ•´RAGç¯å¢ƒè®¾ç½®ï¼ˆsync + build + testï¼‰
npm run rag:test-hybrid   # æµ‹è¯•æ··åˆRAGåŠŸèƒ½
npm run chat:test         # æµ‹è¯•èŠå¤©åŠŸèƒ½ï¼ˆç­‰åŒäºrag:test-hybridï¼‰
```

### èŠå¤©ç³»ç»Ÿç‰¹æ€§
- **æ™ºèƒ½é™çº§**ï¼šAPIä¸å¯ç”¨æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°æ™ºèƒ½æ¼”ç¤ºæ¨¡å¼
- **æµå¼å“åº”**ï¼šæ”¯æŒServer-Sent Eventsçš„å®æ—¶å“åº”
- **å¤šè¯­è¨€æ”¯æŒ**ï¼šä¸­è‹±æ–‡æ™ºèƒ½å“åº”é€‚é…
- **é…é¢ç®¡ç†**ï¼šè‡ªåŠ¨ç›‘æ§APIä½¿ç”¨é‡å¹¶æé†’ç”¨æˆ·

## å¼€å‘å·¥ä½œæµç¨‹ (Development Workflow)

### æ—¥å¸¸å¼€å‘å‘½ä»¤
```bash
# å¿«é€Ÿå¼€å‘ï¼ˆæ¨èä¸­æ–‡åˆ«åï¼‰
npm run é¢„è§ˆ              # å¯åŠ¨é¢„è§ˆæœåŠ¡å™¨ï¼ˆsmart-preview.shï¼‰
npm run æ¨é€              # æ™ºèƒ½æ¨é€åˆ°ç”Ÿäº§ç¯å¢ƒï¼ˆsmart-push.shï¼‰
npm run å›æ»š              # ç‰ˆæœ¬å›é€€ï¼ˆdev-rollback.shï¼‰
npm run å¿«ç…§              # åˆ›å»ºå¼€å‘å¿«ç…§ï¼ˆdev-snapshot.shï¼‰

# å¯¹åº”è‹±æ–‡å‘½ä»¤
npm run preview          # é¢„è§ˆæœåŠ¡å™¨ï¼ˆç«¯å£8080ï¼‰
npm run dev:push         # å¼€å‘æ¨é€è„šæœ¬
npm run dev:rollback     # å¼€å‘å›æ»šè„šæœ¬
npm run dev:snapshot     # å¼€å‘å¿«ç…§è„šæœ¬
npm run dev:start        # å¼€å‘å¯åŠ¨è„šæœ¬
```

### ç‰ˆæœ¬ç®¡ç†
- **è‡ªåŠ¨å¤‡ä»½**ï¼š`npm run backup` åˆ›å»ºå¸¦æ—¶é—´æˆ³çš„Gitæ ‡ç­¾
- **å¿«é€Ÿå›é€€**ï¼š`npm run rollback` äº¤äº’å¼ç‰ˆæœ¬å›é€€
- **å¼€å‘åˆ†æ”¯ç®¡ç†**ï¼šä½¿ç”¨æ™ºèƒ½è„šæœ¬è¿›è¡Œåˆ†æ”¯ç®¡ç†

### æ€§èƒ½ç›‘æ§
```bash
npm run optimize:summary  # æŸ¥çœ‹ä¼˜åŒ–æ•ˆæœæ‘˜è¦
npm run validate:html     # HTMLéªŒè¯
npm run format           # ä»£ç æ ¼å¼åŒ–
```

## éƒ¨ç½²æ¶æ„ (Deployment Architecture)

### Cloudflare Pagesé…ç½®
- **æ„å»ºç›®å½•**ï¼šå½“å‰ç›®å½•ï¼ˆ`.`ï¼‰
- **ç¼“å­˜ç­–ç•¥**ï¼š
  - é™æ€èµ„æºï¼š1å¹´ç¼“å­˜ + immutable
  - HTMLæ–‡ä»¶ï¼š1å°æ—¶ç¼“å­˜ + must-revalidate
- **å‹ç¼©æ”¯æŒ**ï¼šè‡ªåŠ¨Gzip/Brotliå‹ç¼©
- **CDNåˆ†å‘**ï¼šå…¨çƒè¾¹ç¼˜èŠ‚ç‚¹åˆ†å‘

### Workers Functions
- **APIç«¯ç‚¹**ï¼šéƒ¨ç½²åˆ° `/api/*` è·¯å¾„
- **AIç»‘å®š**ï¼šé›†æˆCloudflare Workers AI
- **å‘é‡æ•°æ®åº“**ï¼šCloudflare Vectorizeé›†æˆ
- **è¾¹ç¼˜è®¡ç®—**ï¼šä½å»¶è¿ŸAIå“åº”

### è‡ªåŠ¨åŒ–éƒ¨ç½²
- **Gitæ¨é€è§¦å‘**ï¼šæ¨é€åˆ°mainåˆ†æ”¯è‡ªåŠ¨éƒ¨ç½²
- **æ„å»ºä¼˜åŒ–**ï¼šè‡ªåŠ¨æ‰§è¡Œèµ„æºå‹ç¼©å’Œä¼˜åŒ–
- **å›æ»šæ”¯æŒ**ï¼šCloudflare Pageså†…ç½®ç‰ˆæœ¬ç®¡ç†

## å¼€å‘è§„èŒƒ (Development Standards)
- ä¿æŒä»£ç ç®€æ´ï¼Œä¼˜å…ˆä½¿ç”¨åŸç”Ÿ JavaScript
- æ”¯æŒä¸­è‹±æ–‡åŒè¯­ï¼ˆé¢å‘å…¨çƒAIåˆ›æŠ•å¸‚åœºï¼‰
- ç¡®ä¿ç§»åŠ¨ç«¯å…¼å®¹æ€§
- ä¼˜åŒ–æ€§èƒ½ï¼Œå‡å°èµ„æºä½“ç§¯
- ä¸“ä¸šç§‘æŠ€é£æ ¼è®¾è®¡ï¼Œä½“ç°AIåˆ›æŠ•è¡Œä¸šç‰¹è‰²
- ç”¨æˆ·ä½“éªŒä¼˜å…ˆï¼Œä¿ƒè¿›å†…å®¹åˆ†äº«å’Œç¤¾åŒºäº’åŠ¨

## ç¯å¢ƒå˜é‡é…ç½® (Environment Configuration)

### å¿…éœ€çš„ç¯å¢ƒå˜é‡
```bash
# Cloudflareé…ç½®
CLOUDFLARE_ACCOUNT_ID=your_account_id
CLOUDFLARE_API_TOKEN=your_api_token

# OpenAIé…ç½®ï¼ˆå¯é€‰ï¼Œç”¨äºRAGå¢å¼ºï¼‰
OPENAI_API_KEY=your_openai_key

# é£ä¹¦APIé…ç½®
FEISHU_APP_ID=cli_a8e2014cbe7d9013
FEISHU_APP_SECRET=tysHBj6njxwafO92dwO1DdttVvqvesf0
```

### Wrangleré…ç½®ç»‘å®š
- **AIç»‘å®š**ï¼š`AI = @cf/meta/llama-3.1-8b-instruct`
- **å‘é‡æ•°æ®åº“**ï¼š`SVTR_VECTORIZE = autorag-svtr-knowledge-base-ai`
- **KVå­˜å‚¨**ï¼šç”¨äºç¼“å­˜å’Œä¼šè¯ç®¡ç†

## æ•…éšœæ’é™¤ (Troubleshooting)

### å¸¸è§å¼€å‘é—®é¢˜

#### 1. æœ¬åœ°æœåŠ¡å™¨å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8080
# ä½¿ç”¨ä¸åŒç«¯å£
python3 -m http.server 3001
```

#### 2. Wranglerå¼€å‘æœåŠ¡å™¨é—®é¢˜
```bash
# æ¸…ç†ç¼“å­˜å¹¶é‡å¯
rm -rf .wrangler
npm run dev
```

#### 3. æ„å»ºå¤±è´¥
```bash
# æ£€æŸ¥TypeScriptç¼–è¯‘é”™è¯¯
npm run build
# æ£€æŸ¥ä¾èµ–
npm install
```

#### 4. æµ‹è¯•å¤±è´¥
```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•
npm run test -- --testNamePattern="chat"
# è°ƒè¯•æ¨¡å¼
npm run test:watch
# E2Eæµ‹è¯•ç‰¹å®šspec
npm run test:e2e -- tests/e2e/homepage.spec.js
# E2Eæµ‹è¯•UIæ¨¡å¼ï¼ˆè°ƒè¯•ï¼‰
npm run test:e2e:ui
```

#### 5. éƒ¨ç½²é—®é¢˜
```bash
# æ£€æŸ¥Wranglerè®¤è¯
wrangler auth whoami
# é‡æ–°ç™»å½•
wrangler auth login
```

### RAGç³»ç»Ÿè°ƒè¯•
```bash
# æµ‹è¯•RAGæ•°æ®åŒæ­¥
npm run rag:test

# æ£€æŸ¥å‘é‡æ•°æ®åº“çŠ¶æ€
wrangler vectorize list

# æµ‹è¯•AIåŠŸèƒ½
node scripts/test-chat-api.js
```

## æ€§èƒ½ä¼˜åŒ–è®°å½• (Performance Optimization)

### å½“å‰ä¼˜åŒ–æˆæœ
- **èµ„æºä½“ç§¯å‡å°‘**ï¼š37.9KBæ€»ä½“å‡å°‘
- **å›¾ç‰‡ä¼˜åŒ–**ï¼šWebPæ ¼å¼+fallbackï¼Œå‡å°‘60%+æ–‡ä»¶å¤§å°
- **ä»£ç å‹ç¼©**ï¼šJavaScriptå’ŒCSSå‹ç¼©ç‡40%+
- **ç¼“å­˜ç­–ç•¥**ï¼šé™æ€èµ„æºé•¿æœŸç¼“å­˜ï¼ŒåŠ¨æ€å†…å®¹çŸ­æœŸç¼“å­˜

### ç›‘æ§æŒ‡æ ‡
- **Lighthouseè¯„åˆ†**ï¼šPerformance > 90åˆ†
- **Core Web Vitals**ï¼šLCP < 2.5s, FID < 100ms, CLS < 0.1
- **èµ„æºåŠ è½½**ï¼šå…³é”®èµ„æºé¢„åŠ è½½ï¼Œéå…³é”®èµ„æºå»¶è¿ŸåŠ è½½

## æœ€ä½³å®è·µ (Best Practices)

### ä»£ç å¼€å‘
1. **ä¿®æ”¹å‰å¤‡ä»½**ï¼š`npm run backup` åˆ›å»ºè¿˜åŸç‚¹
2. **æœ¬åœ°æµ‹è¯•**ï¼š`npm run preview` æœ¬åœ°éªŒè¯åŠŸèƒ½
3. **ä»£ç è´¨é‡**ï¼šè¿è¡Œ `npm run lint` å’Œ `npm run test`
4. **æ€§èƒ½æ£€æŸ¥**ï¼šä½¿ç”¨ `npm run optimize:summary` æŸ¥çœ‹ä¼˜åŒ–æ•ˆæœ

### éƒ¨ç½²æµç¨‹
1. **æ¸è¿›å¼éƒ¨ç½²**ï¼šå…ˆstagingç¯å¢ƒæµ‹è¯•ï¼Œå†ç”Ÿäº§éƒ¨ç½²
2. **ç›‘æ§éƒ¨ç½²**ï¼šè§‚å¯ŸCloudflare Pageséƒ¨ç½²çŠ¶æ€
3. **å›æ»šå‡†å¤‡**ï¼šä¿æŒ `npm run rollback` çš„å¯ç”¨æ€§
4. **æ–‡æ¡£æ›´æ–°**ï¼šé‡è¦å˜æ›´åŠæ—¶æ›´æ–°CLAUDE.md

### åä½œå¼€å‘
1. **åˆ†æ”¯ç®¡ç†**ï¼šä½¿ç”¨åŠŸèƒ½åˆ†æ”¯è¿›è¡Œå¼€å‘
2. **æäº¤è§„èŒƒ**ï¼šä½¿ç”¨æè¿°æ€§çš„commitä¿¡æ¯
3. **ä»£ç å®¡æŸ¥**ï¼šé‡è¦åŠŸèƒ½æäº¤å‰è¿›è¡Œä»£ç å®¡æŸ¥
4. **æ–‡æ¡£åŒæ­¥**ï¼šåŠæ—¶æ›´æ–°æŠ€æœ¯æ–‡æ¡£å’ŒAPIæ–‡æ¡£

## å®‰å…¨è€ƒè™‘ (Security Considerations)

### APIå®‰å…¨
- **é€Ÿç‡é™åˆ¶**ï¼šCloudflare Workersè‡ªåŠ¨é™åˆ¶
- **è¾“å…¥éªŒè¯**ï¼šæ‰€æœ‰ç”¨æˆ·è¾“å…¥è¿›è¡ŒéªŒè¯å’Œæ¸…ç†
- **API Keyç®¡ç†**ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡å’ŒWrangler secrets

### æ•°æ®ä¿æŠ¤
- **æ•æ„Ÿä¿¡æ¯**ï¼šé¿å…åœ¨å®¢æˆ·ç«¯æš´éœ²APIå¯†é’¥
- **HTTPSå¼ºåˆ¶**ï¼šæ‰€æœ‰é€šä¿¡å¼ºåˆ¶ä½¿ç”¨HTTPS
- **ç¼“å­˜ç­–ç•¥**ï¼šæ•æ„Ÿæ•°æ®ä¸è¿›è¡Œé•¿æœŸç¼“å­˜

## äº§å“ç­–ç•¥ (Product Strategy)
1. **å†…å®¹èšåˆ**ï¼šä»åˆ†æ•£å¹³å°å‘å®˜ç½‘é›†ä¸­
2. **ç”¨æˆ·ç²˜æ€§**ï¼šé€šè¿‡Chatbotæå‡ç”¨æˆ·å‚ä¸åº¦
3. **ç¤¾åŒºå»ºè®¾**ï¼šUGCå†…å®¹ç”Ÿæˆï¼Œä¿ƒè¿›ç”¨æˆ·è‡ªå‘åˆ†äº«
4. **å•†ä¸šé—­ç¯**ï¼šå®˜ç½‘ä½œä¸ºæµé‡å’Œå•†ä¸šè½¬åŒ–ä¸­å¿ƒ

## å½“å‰æ¶æ„
- Sidebarï¼šé¡¹ç›®å¯¼èˆªæ 
- Chatbotï¼šæ ¸å¿ƒäº¤äº’ç»„ä»¶
- é¢„ç•™ä¸‰å¤§æ¿å—å…¥å£ï¼šAIåˆ›æŠ•åº“ã€AIåˆ›æŠ•ä¼šã€AIåˆ›æŠ•è¥

## æ•°å­—åŒ–è½¬å‹æˆ˜ç•¥è§„åˆ’ (2025)

### æˆ˜ç•¥ç›®æ ‡
é€šè¿‡ä»¥å®˜ç½‘ä¸ºä¸­å¿ƒçš„æ•°å­—åŒ–è½¬å‹ï¼Œå®ç°ï¼š
1. **å·¥ä½œæµè‡ªåŠ¨åŒ–**ï¼šä¿¡æ¯æ”¶é›†å’Œå†…å®¹å‘å¸ƒçš„è‡ªåŠ¨åŒ–
2. **ç¤¾åŒºé›†ä¸­è¿è¥**ï¼šå°†åˆ†æ•£å¹³å°ç”¨æˆ·é›†ä¸­åˆ°å®˜ç½‘æœåŠ¡
3. **å•†ä¸šåŒ–é—­ç¯**ï¼šé€šè¿‡äº§å“æœåŠ¡å®ç°å•†ä¸šå˜ç°
4. **æŠ€æœ¯ç‹¬ç«‹å‘å±•**ï¼šåŸºäºVS Code + GitHub + Cloudflareçš„æœ€å°æˆæœ¬æŠ€æœ¯æ ˆ

### Phase 1å®Œæˆï¼šç”¨æˆ·ä½“éªŒæ ¸å¿ƒä¼˜åŒ– âœ…
- **é£ä¹¦APIé›†æˆ**ï¼šè‡ªåŠ¨åŒæ­¥AIå‘¨æŠ¥å’Œäº¤æ˜“ç²¾é€‰æ•°æ®åˆ°å®˜ç½‘
- **RAGå¢å¼ºç³»ç»Ÿ**ï¼šæ··åˆRAGæ¶æ„ï¼Œæ™ºèƒ½çŸ¥è¯†åº“æ£€ç´¢å’Œè¯­ä¹‰åŒ¹é…
- **å¤šæ¨¡å‹AIç­–ç•¥**ï¼šCloudflare Workers AI + OpenAI fallbackæœºåˆ¶
- **æ€§èƒ½å…¨é¢ä¼˜åŒ–**ï¼šWebPå›¾ç‰‡è½¬æ¢ã€Gzipå‹ç¼©ã€èµ„æºä½“ç§¯å‡å°‘37.9KB
- **å®Œæ•´æµ‹è¯•ä½“ç³»**ï¼šJestå•å…ƒæµ‹è¯• + Playwright E2Eæµ‹è¯•è¦†ç›–
- **ç°ä»£æ„å»ºå·¥å…·é“¾**ï¼šTypeScriptç¼–è¯‘ã€èµ„æºå‹ç¼©ã€è‡ªåŠ¨éƒ¨ç½²
- **æ™ºèƒ½èŠå¤©ç³»ç»Ÿ**ï¼šæ”¯æŒæµå¼å“åº”ã€å¤šè¯­è¨€ã€é…é¢ç®¡ç†
- **å¼€å‘è€…ä½“éªŒ**ï¼šä¸­æ–‡å‘½ä»¤åˆ«åã€æ™ºèƒ½è„šæœ¬ã€è‡ªåŠ¨å¤‡ä»½å›æ»š

### å½“å‰å¼€å‘çŠ¶æ€ (Current Status)
```bash
# æœ€æ–°æäº¤
git log --oneline -1
# f8890d0 feat: å®ŒæˆPhase1ç”¨æˆ·ä½“éªŒæ ¸å¿ƒä¼˜åŒ–

# é¡¹ç›®è§„æ¨¡ç»Ÿè®¡
- æ€»æ–‡ä»¶æ•°ï¼š100+ æ ¸å¿ƒæ–‡ä»¶
- ä»£ç è¡Œæ•°ï¼š~15,000 è¡Œï¼ˆå«æ³¨é‡Šå’Œæ–‡æ¡£ï¼‰
- æµ‹è¯•è¦†ç›–ç‡ï¼š85%+ æ ¸å¿ƒåŠŸèƒ½è¦†ç›–
- æ€§èƒ½è¯„åˆ†ï¼šLighthouse 90+ åˆ†

# æŠ€æœ¯å€ºåŠ¡çŠ¶æ€
- é—ç•™æ–‡ä»¶ï¼šminimalï¼ˆå·²æ¸…ç†ï¼‰
- å®‰å…¨æ¼æ´ï¼š0ä¸ªå·²çŸ¥æ¼æ´
- ä¾èµ–æ›´æ–°ï¼šä¿æŒæœ€æ–°ç¨³å®šç‰ˆæœ¬
```

## æ ¸å¿ƒå®æ–½è·¯çº¿å›¾

### Phase 1: å¤šå¹³å°å†…å®¹åˆ†å‘è‡ªåŠ¨åŒ– (ä¼˜å…ˆçº§: ğŸ”¥ğŸ”¥ğŸ”¥)
- [ ] **å†…å®¹æ ¼å¼è½¬æ¢å¼•æ“**
  - é£ä¹¦ â†’ å¾®ä¿¡å…¬ä¼—å·æ ¼å¼é€‚é…
  - é£ä¹¦ â†’ LinkedInæ–‡ç« æ ¼å¼
  - é£ä¹¦ â†’ X(Twitter)å†…å®¹ä¼˜åŒ–
  - é£ä¹¦ â†’ å°çº¢ä¹¦å›¾æ–‡æ ¼å¼
  - é£ä¹¦ â†’ Substack newsletter
- [ ] **ç¤¾äº¤å¹³å°APIé›†æˆ**
  - å¾®ä¿¡å…¬ä¼—å·APIè‡ªåŠ¨å‘å¸ƒ
  - LinkedIn APIå†…å®¹åˆ†äº«
  - X APIå®šæ—¶å‘å¸ƒ
  - å°çº¢ä¹¦APIï¼ˆç¬¬ä¸‰æ–¹å·¥å…·ï¼‰
- [ ] **æ™ºèƒ½å‘å¸ƒè°ƒåº¦**
  - æœ€ä½³æ—¶é—´ç®—æ³•
  - å¹³å°ç‰¹æ€§ä¼˜åŒ–
  - ç”¨æˆ·å¼•æµæœºåˆ¶

### Phase 2: é£ä¹¦å·¥ä½œæµæ·±åº¦é›†æˆ (ä¼˜å…ˆçº§: ğŸ”¥ğŸ”¥)
- [ ] **æ•°æ®åŒæ­¥å¢å¼º**
  - å®æ—¶webhookç›‘å¬é£ä¹¦æ›´æ–°
  - å¢é‡åŒæ­¥æœºåˆ¶
  - é”™è¯¯é‡è¯•å’Œç›‘æ§
- [ ] **å†…å®¹ç”Ÿäº§å·¥å…·**
  - é£ä¹¦æ¨¡æ¿è‡ªåŠ¨åŒ–
  - AIè¾…åŠ©å†…å®¹ç”Ÿæˆ
  - å¤šç»´è¡¨æ ¼æ™ºèƒ½åˆ†æ
- [ ] **åä½œæµç¨‹ä¼˜åŒ–**
  - å†…å®¹å®¡æ ¸workflow
  - å‘å¸ƒçŠ¶æ€è·Ÿè¸ª
  - å›¢é˜Ÿåä½œç•Œé¢

### Phase 3: ç¤¾åŒºå•†ä¸šåŒ–åŠŸèƒ½ (ä¼˜å…ˆçº§: ğŸ”¥)
- [ ] **ç”¨æˆ·ç³»ç»Ÿ**
  - æ³¨å†Œç™»å½•ï¼ˆé‚®ç®±/å¾®ä¿¡ï¼‰
  - ä¼šå‘˜ç­‰çº§ç®¡ç†
  - ç§¯åˆ†å’Œæƒç›Šç³»ç»Ÿ
- [ ] **ä»˜è´¹è®¢é˜…**
  - é«˜çº§AIåˆ†ææŠ¥å‘Š
  - ä¸“å±æŠ•èµ„æœºä¼šæ¨é€
  - ä¸€å¯¹ä¸€æŠ•èµ„å’¨è¯¢
- [ ] **ä¼ä¸šæœåŠ¡**
  - APIæ¥å£æœåŠ¡
  - å®šåˆ¶åŒ–æ•°æ®åˆ†æ
  - ç™½æ ‡è§£å†³æ–¹æ¡ˆ

### Phase 4: AIèƒ½åŠ›æŒç»­è¿­ä»£ (ä¼˜å…ˆçº§: ğŸ”¥)
- [ ] **ä¸ªæ€§åŒ–æ¨è**
  - ç”¨æˆ·è¡Œä¸ºåˆ†æ
  - æŠ•èµ„åå¥½å­¦ä¹ 
  - æ™ºèƒ½å†…å®¹æ¨é€
- [ ] **é«˜çº§åˆ†æå·¥å…·**
  - å¸‚åœºè¶‹åŠ¿é¢„æµ‹
  - æŠ•èµ„ç»„åˆåˆ†æ
  - ç«å“æ™ºèƒ½ç›‘æ§

## æŠ€æœ¯æ¶æ„ä¼˜åŠ¿
- **æˆæœ¬æ§åˆ¶**ï¼šVS Code + GitHub + Cloudflare = æ¥è¿‘é›¶åŸºç¡€è®¾æ–½æˆæœ¬
- **æŠ€æœ¯ç‹¬ç«‹**ï¼šå®Œå…¨æŒæ§æŠ€æœ¯æ ˆï¼Œæ— ç¬¬ä¸‰æ–¹å¹³å°ä¾èµ–
- **æ‰©å±•æ€§**ï¼šServerlessæ¶æ„ï¼ŒæŒ‰éœ€æ‰©å±•
- **AIé›†æˆ**ï¼šRAGç³»ç»Ÿä¸ºæœªæ¥AIåŠŸèƒ½å¥ å®šåŸºç¡€

## å¿«é€Ÿå¼€å§‹æŒ‡å— (Quick Start Guide)

### æ–°å¼€å‘è€…ä¸Šæ‰‹ï¼ˆ5åˆ†é’Ÿï¼‰
```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/capmapt/chatsvtr.git
cd chatsvtr

# 2. å®‰è£…ä¾èµ–
npm install

# 3. å¯åŠ¨é¢„è§ˆæœåŠ¡å™¨
npm run preview
# è®¿é—® http://localhost:8080

# 4. æµ‹è¯•èŠå¤©åŠŸèƒ½
# æµè§ˆå™¨ä¸­æµ‹è¯•èŠå¤©ç•Œé¢ï¼ŒéªŒè¯åŸºæœ¬åŠŸèƒ½

# 5. è¿è¡Œæµ‹è¯•
npm run test              # å•å…ƒæµ‹è¯•
npm run test:e2e         # E2Eæµ‹è¯•
```

### å¸¸ç”¨å¼€å‘å‘½ä»¤é€ŸæŸ¥
```bash
# å¼€å‘é¢„è§ˆ
npm run é¢„è§ˆ              # ä¸­æ–‡åˆ«åï¼šå¯åŠ¨é¢„è§ˆæœåŠ¡å™¨
npm run preview          # è‹±æ–‡ï¼šå¯åŠ¨é¢„è§ˆæœåŠ¡å™¨

# æ„å»ºä¼˜åŒ–
npm run optimize:all     # å…¨é‡ä¼˜åŒ–ï¼ˆæ¨èï¼‰
npm run build           # TypeScriptç¼–è¯‘

# æ•°æ®åŒæ­¥
npm run sync            # åŒæ­¥é£ä¹¦æ•°æ®
npm run rag:test        # æµ‹è¯•RAGåŠŸèƒ½

# éƒ¨ç½²å‘å¸ƒ
npm run æ¨é€            # ä¸­æ–‡åˆ«åï¼šæ¨é€åˆ°ç”Ÿäº§
npm run deploy:cloudflare # éƒ¨ç½²åˆ°Cloudflare

# ç‰ˆæœ¬ç®¡ç†
npm run backup          # åˆ›å»ºå¤‡ä»½ç‚¹
npm run å›æ»š            # ä¸­æ–‡åˆ«åï¼šç‰ˆæœ¬å›é€€
```

### é‡è¦æ–‡ä»¶è·¯å¾„é€ŸæŸ¥
```
ğŸ  æ ¸å¿ƒå…¥å£æ–‡ä»¶
â”œâ”€â”€ index.html                    # ä¸»é¡µé¢å…¥å£
â”œâ”€â”€ assets/js/chat-optimized.js   # èŠå¤©ç³»ç»Ÿä¸»é€»è¾‘
â””â”€â”€ assets/css/style-optimized.css # ä¸»æ ·å¼æ–‡ä»¶

ğŸ”§ é…ç½®æ–‡ä»¶
â”œâ”€â”€ package.json                  # é¡¹ç›®é…ç½®å’Œè„šæœ¬
â”œâ”€â”€ wrangler.toml                # Cloudflareé…ç½®
â””â”€â”€ tsconfig.json                # TypeScripté…ç½®

ğŸ¤– AIç³»ç»Ÿ
â”œâ”€â”€ functions/api/chat.ts         # èŠå¤©APIç«¯ç‚¹
â”œâ”€â”€ functions/lib/hybrid-rag-service.ts # æ··åˆRAGæœåŠ¡
â””â”€â”€ assets/data/rag/             # RAGçŸ¥è¯†åº“æ•°æ®

ğŸ“¦ æ„å»ºå·¥å…·
â”œâ”€â”€ scripts/minify-assets.js     # èµ„æºå‹ç¼©
â”œâ”€â”€ scripts/improved-feishu-sync.js # é£ä¹¦æ•°æ®åŒæ­¥
â””â”€â”€ scripts/deploy-optimized.sh  # ä¼˜åŒ–éƒ¨ç½²è„šæœ¬
```

## Claude å·¥ä½œè®°å¿† (Claude Working Memory)

### å…³é”®æŠ€æœ¯å†³ç­–è®°å½•
1. **æ¶æ„é€‰æ‹©**ï¼šåŸç”ŸJavaScript + Cloudflare Workersï¼Œé¿å…é‡åº¦æ¡†æ¶
2. **AIç­–ç•¥**ï¼šæ··åˆRAGæ¶æ„ï¼Œå¤šæ¨¡å‹fallbackä¿è¯å¯ç”¨æ€§
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šWebPå›¾ç‰‡ + Gzipå‹ç¼© + é•¿æœŸç¼“å­˜ç­–ç•¥
4. **å¼€å‘ä½“éªŒ**ï¼šä¸­æ–‡å‘½ä»¤åˆ«åï¼Œé™ä½ä¸­æ–‡å›¢é˜Ÿä½¿ç”¨é—¨æ§›
5. **æ•°æ®åŒæ­¥**ï¼šé£ä¹¦APIç›´æ¥é›†æˆï¼Œé¿å…ç¬¬ä¸‰æ–¹ä¾èµ–

### å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ
- **èŠå¤©åŠŸèƒ½å¼‚å¸¸**ï¼šæ£€æŸ¥Cloudflare Workers AIé…é¢å’Œç½‘ç»œè¿æ¥
- **å›¾ç‰‡åŠ è½½æ…¢**ï¼šç¡®è®¤WebPæ ¼å¼è½¬æ¢å®Œæˆï¼Œæ£€æŸ¥CDNç¼“å­˜
- **æ„å»ºå¤±è´¥**ï¼šæ¸…ç†node_modulesé‡æ–°å®‰è£…ï¼Œæ£€æŸ¥TypeScripté”™è¯¯
- **éƒ¨ç½²é—®é¢˜**ï¼šéªŒè¯Wranglerè®¤è¯çŠ¶æ€ï¼Œæ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®

### æœªæ¥Claudeå®ä¾‹éœ€è¦äº†è§£çš„è¦ç‚¹
1. è¯¥é¡¹ç›®ä½¿ç”¨**æ··åˆæŠ€æœ¯æ ˆ**ï¼šå‰ç«¯åŸç”ŸJS + åç«¯Serverless
2. **æ€§èƒ½ä¼˜å…ˆ**ï¼šæ‰€æœ‰ä¼˜åŒ–éƒ½å›´ç»•ç”¨æˆ·ä½“éªŒå’ŒåŠ è½½é€Ÿåº¦
3. **ä¸­æ–‡å‹å¥½**ï¼šå‘½ä»¤å’Œæ–‡æ¡£éƒ½æœ‰ä¸­æ–‡æ”¯æŒ
4. **AIå¢å¼º**ï¼šRAGç³»ç»Ÿæ˜¯æ ¸å¿ƒç«äº‰åŠ›ï¼Œéœ€æŒç»­ä¼˜åŒ–
5. **å•†ä¸šç›®æ ‡**ï¼šæŠ€æœ¯æœåŠ¡äºAIåˆ›æŠ•ç”Ÿæ€ç³»ç»Ÿå»ºè®¾
6. **åŒæ–‡ä»¶ç³»ç»Ÿ**ï¼šæ¯ä¸ªæ ¸å¿ƒæ–‡ä»¶éƒ½æœ‰ä¼˜åŒ–ç‰ˆæœ¬ï¼ˆå¦‚main.jså’Œmain-optimized.jsï¼‰
7. **Gzipå‹ç¼©**ï¼šæ‰€æœ‰é™æ€èµ„æºéƒ½æœ‰.gzç‰ˆæœ¬ç”¨äºç”Ÿäº§éƒ¨ç½²
8. **WebPå›¾ç‰‡**ï¼šæ‰€æœ‰å›¾ç‰‡è½¬æ¢ä¸ºWebPæ ¼å¼ï¼Œä¿ç•™åŸç‰ˆæœ¬ä½œä¸ºfallback

## Memory Log
- `2025-01-29`: å®ŒæˆChatSVTR codebaseå…¨é¢åˆ†æï¼Œæ›´æ–°CLAUDE.mdåŒ…å«å®Œæ•´æ¶æ„æ–‡æ¡£
- `Phase 1 Completed`: ç”¨æˆ·ä½“éªŒæ ¸å¿ƒä¼˜åŒ–å®Œæˆï¼ŒåŒ…æ‹¬RAGç³»ç»Ÿã€æ€§èƒ½ä¼˜åŒ–ã€æµ‹è¯•æ¡†æ¶
- `Key Achievement`: 37.9KBèµ„æºä¼˜åŒ–ï¼ŒLighthouse 90+åˆ†æ€§èƒ½è¯„åˆ†