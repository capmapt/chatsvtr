# SVTRç”¨æˆ·è¡Œä¸ºè·Ÿè¸ªç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ“Š ç³»ç»Ÿæ¦‚è¿°

SVTRç”¨æˆ·è¡Œä¸ºè·Ÿè¸ªç³»ç»Ÿæ˜¯ä¸€å¥—å®Œæ•´çš„ç”¨æˆ·è¡Œä¸ºåˆ†æè§£å†³æ–¹æ¡ˆï¼Œèƒ½å¤Ÿç›‘æµ‹ç½‘ç«™è®¿é—®è€…çš„é¡µé¢è®¿é—®æ—¶é•¿ã€ç‚¹å‡»è¡Œä¸ºã€è¡¨å•äº¤äº’ã€æ»šåŠ¨æ·±åº¦ç­‰è¯¦ç»†æ•°æ®ï¼Œä¸ºç½‘ç«™ä¼˜åŒ–å’Œç”¨æˆ·ä½“éªŒæ”¹è¿›æä¾›æ•°æ®æ”¯æ’‘ã€‚

### æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

âœ… **é¡µé¢è®¿é—®ç›‘æµ‹**
- é¡µé¢è®¿é—®æ—¶é•¿ç»Ÿè®¡
- ç”¨æˆ·æ´»è·ƒæ—¶é—´è®¡ç®—
- é¡µé¢è·³è½¬è·¯å¾„åˆ†æ
- å®æ—¶åœ¨çº¿ç”¨æˆ·ç»Ÿè®¡

âœ… **ç”¨æˆ·äº¤äº’è·Ÿè¸ª**
- ç‚¹å‡»äº‹ä»¶è®°å½•å’Œçƒ­åŠ›å›¾
- æ»šåŠ¨æ·±åº¦é‡Œç¨‹ç¢‘è¿½è¸ª
- è¡¨å•å¡«å†™å’Œæäº¤è¡Œä¸º
- é“¾æ¥ç‚¹å‡»åˆ†æ

âœ… **ä¼šè¯çº§åˆ†æ**
- å®Œæ•´ç”¨æˆ·ä¼šè¯è®°å½•
- ä¼šè¯æŒç»­æ—¶é—´ç»Ÿè®¡
- ç”¨æˆ·å‚ä¸åº¦è¯„ä¼°
- è·¨é¡µé¢è¡Œä¸ºè·¯å¾„

âœ… **ç®¡ç†ä¸­å¿ƒå¯è§†åŒ–**
- å®æ—¶æ´»åŠ¨ç›‘æ§
- ç”¨æˆ·ä¼šè¯è¯¦æƒ…æŸ¥çœ‹
- é¡µé¢æ€§èƒ½åˆ†æ
- ç‚¹å‡»çƒ­åŠ›å›¾å±•ç¤º
- æ•°æ®å¯¼å‡ºåŠŸèƒ½

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç³»ç»Ÿéƒ¨ç½²

ç³»ç»Ÿå·²å®Œå…¨é›†æˆåˆ°SVTRç½‘ç«™ä¸­ï¼Œéƒ¨ç½²åªéœ€ç¡®ä¿ä»¥ä¸‹ç»„ä»¶æ­£å¸¸åŠ è½½ï¼š

```html
<!-- åœ¨index.htmlä¸­å·²è‡ªåŠ¨åŒ…å« -->
<script src="assets/js/user-behavior-tracker.js" defer></script>
```

### 2. Cloudflareé…ç½®

ç¡®ä¿`wrangler.toml`ä¸­é…ç½®äº†KVå‘½åç©ºé—´ï¼š

```toml
[[kv_namespaces]]
binding = "USER_BEHAVIOR_KV"
id = "user-behavior-data-kv-production"
```

### 3. éªŒè¯å®‰è£…

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½ï¼š

```bash
node scripts/testing/test-user-behavior-tracking.js
```

## ğŸ“ˆ ç®¡ç†ä¸­å¿ƒä½¿ç”¨

### è®¿é—®æ“ä½œæ—¥å¿—

1. ç™»å½•ç®¡ç†ä¸­å¿ƒ (`/pages/admin-center.html`)
2. ç‚¹å‡»å·¦ä¾§å¯¼èˆª"æ“ä½œæ—¥å¿—"
3. ç³»ç»Ÿä¼šè‡ªåŠ¨åŠ è½½ç”¨æˆ·è¡Œä¸ºæ•°æ®

### å››ä¸ªæ ¸å¿ƒæ ‡ç­¾é¡µ

#### ğŸ”´ å®æ—¶æ´»åŠ¨
- **åŠŸèƒ½**: ç›‘æ§å½“å‰åœ¨çº¿ç”¨æˆ·çš„å®æ—¶è¡Œä¸º
- **æ›´æ–°é¢‘ç‡**: æ¯10ç§’è‡ªåŠ¨åˆ·æ–°
- **æ•°æ®å†…å®¹**: 
  - é¡µé¢è®¿é—®äº‹ä»¶
  - ç‚¹å‡»å’Œäº¤äº’æ“ä½œ
  - ç”¨æˆ·IDå’Œé¡µé¢è·¯å¾„
  - æ“ä½œæ—¶é—´æˆ³

#### ğŸ‘¥ ç”¨æˆ·ä¼šè¯
- **åŠŸèƒ½**: æŸ¥çœ‹ç”¨æˆ·å®Œæ•´ä¼šè¯ä¿¡æ¯
- **æ•°æ®å†…å®¹**:
  - ä¼šè¯æŒç»­æ—¶é•¿
  - è®¿é—®é¡µé¢æ•°é‡
  - ç‚¹å‡»æ“ä½œç»Ÿè®¡
  - ç”¨æˆ·å‚ä¸åº¦è¯„åˆ†
- **æ“ä½œ**: ç‚¹å‡»"æŸ¥çœ‹è¯¦æƒ…"è·å–ä¼šè¯è·¯å¾„

#### ğŸ“„ é¡µé¢åˆ†æ
- **åŠŸèƒ½**: åˆ†æå„é¡µé¢è®¿é—®æƒ…å†µ
- **æ ¸å¿ƒæŒ‡æ ‡**:
  - é¡µé¢æµè§ˆé‡å’Œç‹¬ç«‹è®¿å®¢
  - å¹³å‡åœç•™æ—¶é—´
  - è·³å‡ºç‡åˆ†æ
  - è½¬åŒ–ç‡ç»Ÿè®¡

#### ğŸ”¥ çƒ­åŠ›å›¾
- **åŠŸèƒ½**: å¯è§†åŒ–ç”¨æˆ·ç‚¹å‡»è¡Œä¸º
- **ä½¿ç”¨æ–¹æ³•**:
  1. é€‰æ‹©è¦åˆ†æçš„é¡µé¢
  2. æŸ¥çœ‹çƒ­ç‚¹åˆ†å¸ƒå›¾
  3. ç‚¹å‡»çƒ­ç‚¹æŸ¥çœ‹è¯¦ç»†æ•°æ®
- **æ•°æ®**: ç‚¹å‡»å¼ºåº¦ã€çƒ­ç‚¹åŒºåŸŸæ•°é‡ã€æœ€é«˜ç‚¹å‡»ä½ç½®

### è¿‡æ»¤å’Œæœç´¢åŠŸèƒ½

**ç”¨æˆ·ç±»å‹è¿‡æ»¤**:
- å…¨éƒ¨ç”¨æˆ·
- æ³¨å†Œä¼šå‘˜
- åŒ¿åç”¨æˆ·

**è¡Œä¸ºç±»å‹è¿‡æ»¤**:
- é¡µé¢è®¿é—®
- ç‚¹å‡»äº‹ä»¶
- è¡¨å•æäº¤
- æ»šåŠ¨è¡Œä¸º
- é“¾æ¥ç‚¹å‡»

**æ—¶é—´èŒƒå›´ç­›é€‰**:
- ä»Šå¤©
- æ˜¨å¤©
- æœ¬å‘¨
- æœ¬æœˆ
- è‡ªå®šä¹‰æ—¶é—´èŒƒå›´

## ğŸ”§ æŠ€æœ¯å®ç°

### æ•°æ®æ”¶é›†æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·è®¿é—®é¡µé¢] --> B[è¡Œä¸ºè·Ÿè¸ªå™¨åˆå§‹åŒ–]
    B --> C[ç›‘å¬ç”¨æˆ·äº¤äº’]
    C --> D[æ•°æ®ç¼“å­˜åˆ°æœ¬åœ°]
    D --> E[æ‰¹é‡å‘é€åˆ°API]
    E --> F[å­˜å‚¨åˆ°Cloudflare KV]
    F --> G[ç®¡ç†ä¸­å¿ƒå±•ç¤º]
```

### æ ¸å¿ƒæ•°æ®ç»“æ„

**åŸºç¡€è¡Œä¸ºæ•°æ®**:
```typescript
interface BehaviorData {
  type: string;          // è¡Œä¸ºç±»å‹
  sessionId: string;     // ä¼šè¯ID
  userId: string;        // ç”¨æˆ·ID
  timestamp: number;     // æ—¶é—´æˆ³
  page: {
    url: string;         // é¡µé¢URL
    path: string;        // é¡µé¢è·¯å¾„
    title: string;       // é¡µé¢æ ‡é¢˜
  };
  // ... å…¶ä»–ç‰¹å®šæ•°æ®
}
```

**ä¼šè¯æ‘˜è¦**:
```typescript
interface SessionSummary {
  sessionId: string;
  userId: string;
  startTime: number;
  endTime?: number;
  totalDuration?: number;
  activeDuration?: number;
  pageViews: number;
  clicks: number;
  maxScrollDepth: number;
  engagement: {
    formSubmissions: number;
    linkClicks: number;
    scrollMilestones: number;
  };
}
```

### APIç«¯ç‚¹

**POST /api/user-behavior**
- æ¥æ”¶ç”¨æˆ·è¡Œä¸ºæ•°æ®æ‰¹æ¬¡
- è‡ªåŠ¨éªŒè¯å’Œå¤„ç†æ•°æ®
- å­˜å‚¨åˆ°KVå¹¶ç”Ÿæˆç»Ÿè®¡

**GET /api/user-behavior**
- æŸ¥è¯¢å‚æ•°:
  - `type`: session/page_stats/user_activity
  - `userId`: ç”¨æˆ·ID
  - `date`: æ—¥æœŸ (YYYY-MM-DD)
  - `sessionId`: ä¼šè¯ID

### å­˜å‚¨ç­–ç•¥

**æ•°æ®åˆ†å±‚å­˜å‚¨**:
- **åŸå§‹æ•°æ®**: `raw:{date}:{hour}:{sessionId}:{timestamp}` (30å¤©è¿‡æœŸ)
- **ä¼šè¯æ‘˜è¦**: `session:{userId}:{sessionId}` (90å¤©è¿‡æœŸ)
- **é¡µé¢ç»Ÿè®¡**: `page_stats:{date}:{path}` (365å¤©è¿‡æœŸ)
- **ç”¨æˆ·æ´»åŠ¨**: `user_activity:{date}:{userId}` (90å¤©è¿‡æœŸ)

## ğŸ“Š æ•°æ®åˆ†æå»ºè®®

### å…³é”®æŒ‡æ ‡è§£è¯»

**ç”¨æˆ·å‚ä¸åº¦è¯„åˆ†**:
- 90%+: æé«˜å‚ä¸ (æ·±åº¦é˜…è¯»ç”¨æˆ·)
- 70-89%: é«˜å‚ä¸ (æ„Ÿå…´è¶£ç”¨æˆ·)  
- 40-69%: ä¸­ç­‰å‚ä¸ (æ™®é€šæµè§ˆ)
- 40%ä»¥ä¸‹: ä½å‚ä¸ (å¿«é€Ÿç¦»å¼€)

**é¡µé¢è·³å‡ºç‡**:
- 25%ä»¥ä¸‹: ä¼˜ç§€ (å†…å®¹é«˜åº¦ç›¸å…³)
- 26-40%: è‰¯å¥½ (å†…å®¹é€‚ä¸­ç›¸å…³)
- 41-60%: ä¸€èˆ¬ (éœ€ä¼˜åŒ–å†…å®¹)
- 60%ä»¥ä¸Š: è¾ƒå·® (å†…å®¹æˆ–ä½“éªŒé—®é¢˜)

**å¹³å‡åœç•™æ—¶é—´**:
- 5åˆ†é’Ÿä»¥ä¸Š: æ·±åº¦å†…å®¹é¡µé¢è¡¨ç°ä¼˜ç§€
- 2-5åˆ†é’Ÿ: æ­£å¸¸çš„å†…å®¹æ¶ˆè´¹æ—¶é—´
- 1-2åˆ†é’Ÿ: å¿«é€Ÿæµè§ˆï¼Œå¯èƒ½éœ€è¦ä¼˜åŒ–
- 1åˆ†é’Ÿä»¥ä¸‹: å†…å®¹åŒ¹é…åº¦è¾ƒä½

### ä¼˜åŒ–å»ºè®®

**åŸºäºçƒ­åŠ›å›¾ä¼˜åŒ–**:
1. é«˜ç‚¹å‡»åŒºåŸŸ â†’ æ”¾ç½®é‡è¦Call-to-Action
2. å†·ç‚¹åŒºåŸŸ â†’ é‡æ–°è®¾è®¡æˆ–ç§»é™¤æ— æ•ˆå…ƒç´ 
3. æ„å¤–çƒ­ç‚¹ â†’ åˆ†æç”¨æˆ·è¡Œä¸ºåå¥½

**åŸºäºä¼šè¯è·¯å¾„ä¼˜åŒ–**:
1. é«˜è·³å‡ºé¡µé¢ â†’ ä¼˜åŒ–å†…å®¹è´¨é‡å’Œç›¸å…³æ€§
2. è½¬åŒ–æ¼æ–— â†’ è¯†åˆ«ç”¨æˆ·æµå¤±å…³é”®èŠ‚ç‚¹
3. æ·±åº¦é˜…è¯»é¡µé¢ â†’ å¤åˆ¶æˆåŠŸæ¨¡å¼åˆ°å…¶ä»–é¡µé¢

## ğŸ”’ éšç§ä¸å®‰å…¨

### æ•°æ®ä¿æŠ¤æªæ–½

**ç”¨æˆ·éšç§ä¿æŠ¤**:
- æ‰€æœ‰æ•æ„Ÿä¸ªäººä¿¡æ¯éƒ½ç»è¿‡åŒ¿ååŒ–å¤„ç†
- é‚®ç®±åœ°å€åªè®°å½•åŸŸåéƒ¨åˆ†ï¼Œä¸è®°å½•å®Œæ•´åœ°å€
- IPåœ°å€ä¸è¿›è¡Œè®°å½•
- è‡ªåŠ¨æ•°æ®è¿‡æœŸåˆ é™¤æœºåˆ¶

**æ•°æ®å®‰å…¨**:
- HTTPSä¼ è¾“åŠ å¯†
- Cloudflare KVå­˜å‚¨åŠ å¯†
- CORSè·¨åŸŸå®‰å…¨é…ç½®
- é”™è¯¯æ—¥å¿—ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯

### åˆè§„æ€§

- ç¬¦åˆGDPRæ•°æ®ä¿æŠ¤è¦æ±‚
- å®æ–½æ•°æ®æœ€å°åŒ–åŸåˆ™
- æä¾›æ•°æ®åˆ é™¤æœºåˆ¶
- é€æ˜çš„æ•°æ®ä½¿ç”¨æ”¿ç­–

## ğŸš€ è¿›é˜¶ä½¿ç”¨

### è‡ªå®šä¹‰è·Ÿè¸ªäº‹ä»¶

å¯ä»¥é€šè¿‡å…¨å±€å˜é‡`svtrBehaviorTracker`æ·»åŠ è‡ªå®šä¹‰è·Ÿè¸ªï¼š

```javascript
// è·Ÿè¸ªè‡ªå®šä¹‰äº‹ä»¶
if (window.svtrBehaviorTracker) {
  window.svtrBehaviorTracker.addToBehaviorCache({
    type: 'custom_event',
    sessionId: window.svtrBehaviorTracker.sessionId,
    userId: window.svtrBehaviorTracker.userId,
    timestamp: Date.now(),
    customData: {
      eventName: 'newsletter_signup',
      eventValue: 'premium_subscription'
    }
  });
}
```

### è·å–å®æ—¶ç»Ÿè®¡

```javascript
// è·å–å½“å‰ä¼šè¯ç»Ÿè®¡
const sessionStats = window.svtrBehaviorTracker.getSessionStats();
console.log('ä¼šè¯ç»Ÿè®¡:', sessionStats);

// è·å–çƒ­åŠ›å›¾æ•°æ®
const heatmapData = window.svtrBehaviorTracker.getClickHeatmapData();
console.log('ç‚¹å‡»çƒ­åŠ›å›¾:', heatmapData);
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚éœ€æŠ€æœ¯æ”¯æŒæˆ–åŠŸèƒ½å®šåˆ¶ï¼Œè¯·è”ç³»SVTRæŠ€æœ¯å›¢é˜Ÿï¼š

- **æµ‹è¯•è„šæœ¬**: `scripts/testing/test-user-behavior-tracking.js`
- **æŠ€æœ¯æ–‡æ¡£**: æœ¬æ–‡æ¡£
- **ä»£ç ä»“åº“**: `/assets/js/user-behavior-tracker.js`
- **APIæ–‡æ¡£**: `/functions/api/user-behavior.ts`

---

**æœ€åæ›´æ–°**: 2025å¹´09æœˆ07æ—¥  
**ç‰ˆæœ¬**: v1.0.0  
**çŠ¶æ€**: ç”Ÿäº§å°±ç»ª âœ…