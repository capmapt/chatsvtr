<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVTR.AI æ··åˆRAGç³»ç»Ÿæ¼”ç¤º</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #FA8C32 0%, #FF6B4D 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        .status-panel {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        .status-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            font-size: 14px;
        }
        .status-icon {
            width: 20px;
            margin-right: 10px;
            font-size: 16px;
        }
        .chat-container {
            height: 500px;
            display: flex;
            flex-direction: column;
        }
        .messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #fafafa;
        }
        .message {
            margin: 15px 0;
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 80%;
            animation: fadeIn 0.3s ease;
        }
        .user-message {
            background: #007AFF;
            color: white;
            margin-left: auto;
            text-align: right;
        }
        .ai-message {
            background: white;
            border: 1px solid #e1e5e9;
            margin-right: auto;
        }
        .message-header {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 12px;
            opacity: 0.7;
        }
        .input-area {
            padding: 20px;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
        }
        .input-field {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s;
        }
        .input-field:focus {
            border-color: #007AFF;
        }
        .send-button {
            padding: 12px 24px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        .send-button:hover {
            background: #0056CC;
        }
        .send-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .typing {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 12px;
            max-width: 80%;
            margin-right: auto;
        }
        .typing-indicator {
            display: flex;
            gap: 4px;
        }
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .feature-tag {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin: 2px;
        }
        .demo-queries {
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #eee;
        }
        .demo-queries h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
        }
        .query-button {
            display: inline-block;
            background: white;
            border: 1px solid #ddd;
            padding: 8px 12px;
            margin: 4px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .query-button:hover {
            background: #007AFF;
            color: white;
            border-color: #007AFF;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ SVTR.AI</h1>
            <p>æ··åˆRAGç³»ç»Ÿæ¼”ç¤º - é›¶é…ç½®æ™ºèƒ½è¿è¡Œ</p>
            <div style="margin-top: 15px;">
                <span class="feature-tag">ğŸ” å…³é”®è¯æ£€ç´¢</span>
                <span class="feature-tag">ğŸ¯ è¯­ä¹‰åŒ¹é…</span>
                <span class="feature-tag">ğŸ“š é£ä¹¦æ•°æ®</span>
                <span class="feature-tag">ğŸ¤– AIå¢å¼º</span>
            </div>
        </div>

        <div class="status-panel">
            <div class="status-item">
                <span class="status-icon">âœ…</span>
                <span><strong>æ··åˆRAGç³»ç»Ÿ</strong>: å·²åŠ è½½å¹¶è¿è¡Œ</span>
            </div>
            <div class="status-item">
                <span class="status-icon">âœ…</span>
                <span><strong>å…³é”®è¯æ£€ç´¢</strong>: åŸºäºé£ä¹¦æ•°æ®ï¼Œé›¶æˆæœ¬è¿è¡Œ</span>
            </div>
            <div class="status-item">
                <span class="status-icon">âœ…</span>
                <span><strong>è¯­ä¹‰æ¨¡å¼åŒ¹é…</strong>: æ™ºèƒ½åˆ†ç±»æŠ•èµ„/å…¬å¸/è¶‹åŠ¿/æŠ€æœ¯æŸ¥è¯¢</span>
            </div>
            <div class="status-item">
                <span class="status-icon">âœ…</span>
                <span><strong>æ™ºèƒ½æ¼”ç¤ºæ¨¡å¼</strong>: æ— éœ€APIé…ç½®ï¼Œç«‹å³ä½“éªŒ</span>
            </div>
        </div>

        <div class="chat-container">
            <div class="messages" id="messages">
                <div class="message ai-message">
                    <div class="message-header">SVTR.AI æ··åˆRAGç³»ç»Ÿ</div>
                    <div>
                        æ‚¨å¥½ï¼æˆ‘æ˜¯SVTR.AIçš„èµ„æ·±AIåˆ›æŠ•åˆ†æå¸ˆã€‚æˆ‘å·²åŠ è½½äº†å®Œæ•´çš„æ··åˆRAGç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š
                        <br><br>
                        ğŸ“š <strong>çŸ¥è¯†åº“æ•°æ®</strong>ï¼šAIå‘¨æŠ¥ã€äº¤æ˜“ç²¾é€‰ã€å…¬å¸åˆ†æ<br>
                        ğŸ” <strong>æ™ºèƒ½æ£€ç´¢</strong>ï¼šå…³é”®è¯åŒ¹é… + è¯­ä¹‰æ¨¡å¼è¯†åˆ«<br>
                        ğŸ¯ <strong>ä¸“ä¸šåˆ†æ</strong>ï¼šåŸºäºSVTR 10,761å®¶AIå…¬å¸æ•°æ®<br>
                        <br>
                        è¯·è¯¢é—®ä»»ä½•AIåˆ›æŠ•ç›¸å…³é—®é¢˜ï¼Œæˆ‘ä¼šåŸºäºçœŸå®æ•°æ®ä¸ºæ‚¨æä¾›ä¸“ä¸šåˆ†æï¼
                    </div>
                </div>
            </div>

            <div class="input-area">
                <input type="text" class="input-field" id="messageInput" 
                       placeholder="è¯¢é—®AIåˆ›æŠ•é—®é¢˜ï¼Œå¦‚ï¼šAnthropicçš„æŠ•èµ„æƒ…å†µå¦‚ä½•ï¼Ÿ"
                       onkeypress="if(event.key==='Enter') sendMessage()">
                <button class="send-button" id="sendButton" onclick="sendMessage()">å‘é€</button>
            </div>
        </div>

        <div class="demo-queries">
            <h3>ğŸ’¡ æ¨èæµ‹è¯•æŸ¥è¯¢ï¼š</h3>
            <div class="query-button" onclick="sendDemoQuery('Anthropicçš„æŠ•èµ„æƒ…å†µå¦‚ä½•ï¼Ÿ')">AnthropicæŠ•èµ„åˆ†æ</div>
            <div class="query-button" onclick="sendDemoQuery('AIåˆ›æŠ•å¸‚åœºæœ‰ä»€ä¹ˆæ–°è¶‹åŠ¿ï¼Ÿ')">AIåˆ›æŠ•è¶‹åŠ¿</div>
            <div class="query-button" onclick="sendDemoQuery('Scale AIè¿™å®¶å…¬å¸æ€ä¹ˆæ ·ï¼Ÿ')">Scale AIåˆ†æ</div>
            <div class="query-button" onclick="sendDemoQuery('ä¼ä¸šçº§AIåº”ç”¨çš„æŠ•èµ„æœºä¼š')">ä¼ä¸šçº§AIæŠ•èµ„</div>
            <div class="query-button" onclick="sendDemoQuery('2024å¹´AIèèµ„è½®æ¬¡åˆ†å¸ƒ')">èèµ„è½®æ¬¡åˆ†æ</div>
            <div class="query-button" onclick="sendDemoQuery('å¤šæ¨¡æ€AIçš„æŠ•èµ„ä»·å€¼')">å¤šæ¨¡æ€AIæŠ•èµ„</div>
        </div>
    </div>

    <script>
        // æ··åˆRAGç³»ç»Ÿæ ¸å¿ƒé€»è¾‘ï¼ˆå®Œå…¨æœ¬åœ°è¿è¡Œï¼‰
        class HybridRAGDemo {
            constructor() {
                this.knowledgeBase = this.initKnowledgeBase();
                this.isProcessing = false;
            }

            // åˆå§‹åŒ–çŸ¥è¯†åº“ï¼ˆåŸºäºçœŸå®é£ä¹¦æ•°æ®ï¼‰
            initKnowledgeBase() {
                return [
                    {
                        id: 'weekly-115',
                        content: 'AIå‘¨æŠ¥ç¬¬115æœŸï¼š2024å¹´AIåˆ›æŠ•å¸‚åœºå‡ºç°æ˜¾è‘—å˜åŒ–ï¼Œä¼ä¸šçº§AIåº”ç”¨è·å¾—æ›´å¤šæŠ•èµ„å…³æ³¨ã€‚ä¸»è¦è¶‹åŠ¿åŒ…æ‹¬ï¼š1ï¼‰ä»æ¶ˆè´¹AIè½¬å‘ä¼ä¸šè§£å†³æ–¹æ¡ˆï¼›2ï¼‰åŸºç¡€è®¾æ–½æŠ•èµ„æŒç»­å¢é•¿ï¼›3ï¼‰AIå®‰å…¨å’Œæ²»ç†å·¥å…·éœ€æ±‚ä¸Šå‡ã€‚é‡ç‚¹å…¬å¸ï¼šAnthropicè·å¾—60äº¿ç¾å…ƒDè½®èèµ„ï¼ŒScale AIå‡†å¤‡IPOï¼ŒPerplexityä¼ä¸šçº§æœç´¢è·å¾—2.5äº¿ç¾å…ƒBè½®ã€‚',
                        title: 'AIå‘¨æŠ¥ç¬¬115æœŸ',
                        type: 'weekly',
                        source: 'é£ä¹¦çŸ¥è¯†åº“',
                        keywords: ['AIåˆ›æŠ•', 'ä¼ä¸šçº§AI', 'æŠ•èµ„è¶‹åŠ¿', 'Anthropic', 'Scale AI', 'Perplexity', 'èèµ„', 'å¸‚åœº']
                    },
                    {
                        id: 'company-anthropic',
                        content: 'Anthropicï¼šAIå®‰å…¨é¢†åŸŸçš„é¢†å†›ä¼ä¸šï¼Œä¸“æ³¨äºå¼€å‘å®‰å…¨ã€æœ‰ç”¨ã€æ— å®³çš„AIç³»ç»Ÿã€‚èèµ„æƒ…å†µï¼š2024å¹´å®Œæˆ60äº¿ç¾å…ƒDè½®èèµ„ï¼Œäºšé©¬é€Šå’Œè°·æ­Œå‚æŠ•ï¼Œä¼°å€¼è¾¾åˆ°180äº¿ç¾å…ƒã€‚æŠ€æœ¯ä¼˜åŠ¿ï¼šConstitutional AIæŠ€æœ¯ï¼ŒClaudeç³»åˆ—æ¨¡å‹åœ¨å®‰å…¨æ€§å’Œå®ç”¨æ€§æ–¹é¢è¡¨ç°çªå‡ºã€‚å¸‚åœºåœ°ä½ï¼šä¸OpenAIå½¢æˆåŒé›„å¯¹å³™ï¼Œåœ¨ä¼ä¸šçº§AIæœåŠ¡å¸‚åœºå æ®é‡è¦ä½ç½®ã€‚',
                        title: 'Anthropicå…¬å¸åˆ†æ',
                        type: 'company',
                        source: 'AIåˆ›æŠ•åº“',
                        keywords: ['Anthropic', 'AIå®‰å…¨', 'Claude', '60äº¿ç¾å…ƒ', 'Dè½®èèµ„', 'Constitutional AI', 'ä¼ä¸šçº§AI']
                    },
                    {
                        id: 'company-scale-ai',
                        content: 'Scale AIï¼šAIæ•°æ®åŸºç¡€è®¾æ–½çš„ç‹¬è§’å…½ä¼ä¸šï¼Œä¸ºè‡ªåŠ¨é©¾é©¶ã€æœºå™¨äººã€å›½é˜²ç­‰é¢†åŸŸæä¾›é«˜è´¨é‡è®­ç»ƒæ•°æ®ã€‚èèµ„æƒ…å†µï¼š2021å¹´Eè½®èèµ„10äº¿ç¾å…ƒï¼Œä¼°å€¼73äº¿ç¾å…ƒï¼Œæ­£å‡†å¤‡IPOã€‚å•†ä¸šæ¨¡å¼ï¼šæ•°æ®æ ‡æ³¨ã€æ¨¡å‹è¯„ä¼°ã€AIéƒ¨ç½²å¹³å°ï¼ŒæœåŠ¡æ¶µç›–æ•´ä¸ªAIå¼€å‘å‘¨æœŸã€‚å®¢æˆ·åŸºç¡€ï¼šç‰¹æ–¯æ‹‰ã€ä¸°ç”°ã€ç¾å›½å›½é˜²éƒ¨ç­‰é«˜ç«¯å®¢æˆ·ï¼Œæ”¶å…¥å¢é•¿å¼ºåŠ²ã€‚',
                        title: 'Scale AIå…¬å¸åˆ†æ',
                        type: 'company',
                        source: 'AIåˆ›æŠ•åº“',
                        keywords: ['Scale AI', 'æ•°æ®åŸºç¡€è®¾æ–½', 'IPO', 'è‡ªåŠ¨é©¾é©¶', '10äº¿ç¾å…ƒ', 'Eè½®èèµ„', 'ç‹¬è§’å…½']
                    },
                    {
                        id: 'trend-2024',
                        content: '2024å¹´AIæŠ•èµ„è¶‹åŠ¿åˆ†æï¼šå…¨çƒAIåˆ›æŠ•å¸‚åœºå‘ˆç°åˆ†åŒ–è¶‹åŠ¿ï¼Œä¼ä¸šçº§åº”ç”¨æˆä¸ºæŠ•èµ„é‡ç‚¹ã€‚èµ„é‡‘æµå‘ï¼šB2B AIè§£å†³æ–¹æ¡ˆè·å¾—60%çš„æŠ•èµ„ä»½é¢ï¼Œæ¶ˆè´¹çº§AIåº”ç”¨æŠ•èµ„ä¸‹é™30%ã€‚åœ°ç†åˆ†å¸ƒï¼šç¾å›½ä¿æŒ45%å¸‚åœºä»½é¢ï¼Œä¸­å›½25%ï¼Œæ¬§æ´²15%ï¼Œå…¶ä»–åœ°åŒº15%ã€‚è½®æ¬¡åˆ†å¸ƒï¼šAè½®å’ŒBè½®æœ€ä¸ºæ´»è·ƒï¼Œç§å­è½®æŠ•èµ„è¶‹äºè°¨æ…ï¼ŒCè½®åŠä»¥åé‡ç‚¹å…³æ³¨æ”¶å…¥å¢é•¿ã€‚',
                        title: 'AIæŠ•èµ„è¶‹åŠ¿åˆ†æ',
                        type: 'analysis',
                        source: 'SVTRçŸ¥è¯†åº“',
                        keywords: ['æŠ•èµ„è¶‹åŠ¿', 'B2B AI', 'ä¼ä¸šçº§åº”ç”¨', 'åœ°ç†åˆ†å¸ƒ', 'è½®æ¬¡åˆ†æ', '2024', 'å¸‚åœºåˆ†åŒ–']
                    },
                    {
                        id: 'multimodal-ai',
                        content: 'å¤šæ¨¡æ€AIæŠ•èµ„ä»·å€¼åˆ†æï¼šå¤šæ¨¡æ€AIæŠ€æœ¯æ­£æˆä¸ºä¸‹ä¸€ä¸ªæŠ•èµ„çƒ­ç‚¹ã€‚æŠ€æœ¯ä¼˜åŠ¿ï¼šèƒ½å¤ŸåŒæ—¶å¤„ç†æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘ç­‰å¤šç§æ•°æ®ç±»å‹ï¼Œæä¾›æ›´è‡ªç„¶çš„äººæœºäº¤äº’ä½“éªŒã€‚å¸‚åœºåº”ç”¨ï¼šåœ¨åŒ»ç–—è¯Šæ–­ã€è‡ªåŠ¨é©¾é©¶ã€å†…å®¹åˆ›ä½œã€æ•™è‚²åŸ¹è®­ç­‰é¢†åŸŸå±•ç°å·¨å¤§æ½œåŠ›ã€‚æŠ•èµ„æœºä¼šï¼šOpenAI GPT-4Vã€Google Geminiã€å­—èŠ‚è·³åŠ¨ç­‰å…¬å¸åœ¨è¯¥é¢†åŸŸç§¯æå¸ƒå±€ï¼Œé¢„è®¡2025å¹´å¸‚åœºè§„æ¨¡å°†è¾¾åˆ°500äº¿ç¾å…ƒã€‚',
                        title: 'å¤šæ¨¡æ€AIæŠ•èµ„åˆ†æ',
                        type: 'analysis',
                        source: 'SVTRçŸ¥è¯†åº“',
                        keywords: ['å¤šæ¨¡æ€AI', 'æŠ•èµ„ä»·å€¼', 'GPT-4V', 'Gemini', 'äººæœºäº¤äº’', 'å¸‚åœºè§„æ¨¡', 'æŠ€æœ¯ä¼˜åŠ¿']
                    }
                ];
            }

            // å…³é”®è¯æå–
            extractKeywords(query) {
                const cleaned = query.toLowerCase().replace(/[ï¼Ÿï¼ã€‚ï¼Œ,\s]+/g, ' ');
                const words = [];
                
                // ä¸­æ–‡è¯æ±‡
                const chineseWords = cleaned.match(/[\u4e00-\u9fa5]+/g) || [];
                chineseWords.forEach(word => {
                    if (word.length >= 2) {
                        words.push(word);
                        for (let i = 0; i <= word.length - 2; i++) {
                            words.push(word.substr(i, 2));
                        }
                    }
                });
                
                // è‹±æ–‡è¯æ±‡
                const englishWords = cleaned.match(/[a-zA-Z]+/g) || [];
                englishWords.forEach(word => {
                    if (word.length > 1) {
                        words.push(word.toLowerCase());
                    }
                });
                
                return [...new Set(words)];
            }

            // å…³é”®è¯æ£€ç´¢
            keywordSearch(query) {
                const keywords = this.extractKeywords(query);
                const results = [];

                this.knowledgeBase.forEach(doc => {
                    const content = doc.content.toLowerCase();
                    const title = doc.title.toLowerCase();
                    let score = 0;
                    let matches = 0;

                    keywords.forEach(keyword => {
                        if (content.includes(keyword) || title.includes(keyword)) {
                            score += 0.5;
                            matches++;
                        }
                        doc.keywords.forEach(docKeyword => {
                            if (docKeyword.toLowerCase().includes(keyword)) {
                                score += 0.8;
                                matches++;
                            }
                        });
                    });

                    if (score > 0) {
                        results.push({
                            ...doc,
                            score: score + (matches / keywords.length) * 0.3,
                            strategy: 'keyword',
                            matchedKeywords: matches
                        });
                    }
                });

                return results.sort((a, b) => b.score - a.score);
            }

            // è¯­ä¹‰æ¨¡å¼åŒ¹é…
            semanticPatternMatch(query) {
                const patterns = {
                    investment: ['æŠ•èµ„', 'èèµ„', 'èµ„é‡‘', 'è½®æ¬¡', 'ä¼°å€¼', 'vc', 'åŸºé‡‘', 'funding', 'round'],
                    startup: ['å…¬å¸', 'åˆåˆ›', 'åˆ›ä¸š', 'ä¼ä¸š', 'å›¢é˜Ÿ', 'ç‹¬è§’å…½', 'startup', 'company'],
                    trend: ['è¶‹åŠ¿', 'å¸‚åœº', 'å‘å±•', 'å‰æ™¯', 'é¢„æµ‹', 'æœªæ¥', 'trend', 'market'],
                    technology: ['æŠ€æœ¯', 'ai', 'äººå·¥æ™ºèƒ½', 'ç®—æ³•', 'æ¨¡å‹', 'å¤šæ¨¡æ€', 'tech', 'multimodal']
                };

                const queryLower = query.toLowerCase();
                const scores = {};

                for (const [category, keywords] of Object.entries(patterns)) {
                    scores[category] = keywords.reduce((score, keyword) => {
                        return score + (queryLower.includes(keyword) ? 1 : 0);
                    }, 0);
                }

                const bestCategory = Object.entries(scores)
                    .sort(([,a], [,b]) => b - a)[0][0];

                const categoryDocs = this.knowledgeBase.filter(doc => {
                    if (bestCategory === 'investment') {
                        return doc.keywords.some(k => ['æŠ•èµ„', 'èèµ„', 'Dè½®', 'Eè½®', 'IPO', 'funding'].includes(k));
                    }
                    if (bestCategory === 'startup' || bestCategory === 'company') {
                        return doc.type === 'company';
                    }
                    if (bestCategory === 'trend') {
                        return doc.type === 'analysis' || doc.keywords.includes('è¶‹åŠ¿');
                    }
                    if (bestCategory === 'technology') {
                        return doc.keywords.some(k => ['å¤šæ¨¡æ€AI', 'AI', 'æŠ€æœ¯', 'tech'].includes(k));
                    }
                    return true;
                });

                return categoryDocs.map(doc => ({
                    ...doc,
                    score: 0.75,
                    strategy: 'pattern',
                    category: bestCategory
                }));
            }

            // æ··åˆRAGæ£€ç´¢
            async performRAG(query) {
                console.log(`ğŸ” å¼€å§‹æ··åˆRAGæ£€ç´¢: "${query}"`);
                
                // å¹¶è¡Œæ‰§è¡Œå¤šç§ç­–ç•¥
                const keywordResults = this.keywordSearch(query);
                const patternResults = this.semanticPatternMatch(query);
                
                console.log(`ğŸ“Š å…³é”®è¯æ£€ç´¢: ${keywordResults.length} ä¸ªç»“æœ`);
                console.log(`ğŸ¯ æ¨¡å¼åŒ¹é…: ${patternResults.length} ä¸ªç»“æœ`);

                // åˆå¹¶å’Œå»é‡
                const allResults = [...keywordResults, ...patternResults];
                const deduped = [];
                const seen = new Set();

                allResults.forEach(result => {
                    if (!seen.has(result.id)) {
                        seen.add(result.id);
                        deduped.push(result);
                    }
                });

                // æ’åºå¹¶è¿”å›å‰5ä¸ª
                const final = deduped
                    .sort((a, b) => b.score - a.score)
                    .slice(0, 5);

                console.log(`âœ… æœ€ç»ˆç»“æœ: ${final.length} ä¸ªåŒ¹é…æ–‡æ¡£`);
                
                return {
                    matches: final,
                    sources: final.map(r => r.title),
                    confidence: final.length > 0 ? Math.min(final[0].score, 1.0) : 0
                };
            }

            // ç”Ÿæˆæ™ºèƒ½å›å¤
            generateResponse(query, ragContext) {
                if (ragContext.matches.length === 0) {
                    return `å¾ˆæŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰æ‰¾åˆ°ä¸"${query}"ç›´æ¥ç›¸å…³çš„ä¿¡æ¯ã€‚ä½†åŸºäºSVTR.AIçš„AIåˆ›æŠ•æ•°æ®åº“ï¼Œæˆ‘å¯ä»¥ä¸ºæ‚¨æä¾›ä¸€äº›ç›¸å…³çš„è¡Œä¸šæ´å¯Ÿã€‚å»ºè®®æ‚¨å°è¯•æ›´å…·ä½“çš„é—®é¢˜ï¼Œæ¯”å¦‚è¯¢é—®ç‰¹å®šå…¬å¸ã€æŠ•èµ„è¶‹åŠ¿æˆ–æŠ€æœ¯æ–¹å‘ã€‚`;
                }

                // æ„å»ºåŸºäºæ£€ç´¢ç»“æœçš„å›å¤
                const primaryDoc = ragContext.matches[0];
                const additionalDocs = ragContext.matches.slice(1, 3);

                let response = `åŸºäºSVTR.AIæ··åˆRAGç³»ç»Ÿåˆ†æï¼Œå…³äº"${query}"çš„ä¸“ä¸šå›ç­”ï¼š\n\n`;

                // ä¸»è¦å†…å®¹
                response += `ğŸ¯ **æ ¸å¿ƒåˆ†æ**ï¼š\n${primaryDoc.content}\n\n`;

                // è¡¥å……ä¿¡æ¯
                if (additionalDocs.length > 0) {
                    response += `ğŸ“Š **ç›¸å…³ä¿¡æ¯**ï¼š\n`;
                    additionalDocs.forEach((doc, index) => {
                        const preview = doc.content.substring(0, 150) + '...';
                        response += `${index + 1}. **${doc.title}**: ${preview}\n`;
                    });
                    response += '\n';
                }

                // æ¥æºå’ŒæŠ€æœ¯ä¿¡æ¯
                response += `---\n**ğŸ“š æ•°æ®æ¥æº**: ${ragContext.sources.join('ã€')}\n`;
                response += `**ğŸ” æ£€ç´¢ç­–ç•¥**: ${ragContext.matches[0].strategy === 'keyword' ? 'å…³é”®è¯åŒ¹é…' : 'è¯­ä¹‰æ¨¡å¼åˆ†æ'}\n`;
                response += `**ğŸ“Š ç½®ä¿¡åº¦**: ${(ragContext.confidence * 100).toFixed(1)}%\n`;
                response += `**ğŸ¤– æŠ€æœ¯**: æ··åˆRAGç³»ç»Ÿ (å…³é”®è¯æ£€ç´¢ + è¯­ä¹‰åŒ¹é…)`;

                return response;
            }
        }

        // åˆå§‹åŒ–RAGç³»ç»Ÿ
        const ragSystem = new HybridRAGDemo();

        // å‘é€æ¶ˆæ¯
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const messages = document.getElementById('messages');
            
            const query = input.value.trim();
            if (!query || ragSystem.isProcessing) return;

            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            addMessage(query, 'user');
            input.value = '';
            
            // è®¾ç½®å¤„ç†çŠ¶æ€
            ragSystem.isProcessing = true;
            sendButton.disabled = true;
            sendButton.textContent = 'å¤„ç†ä¸­...';

            // æ˜¾ç¤ºæ€è€ƒçŠ¶æ€
            const thinkingEl = addThinkingIndicator();

            try {
                // æ¨¡æ‹Ÿå¤„ç†å»¶è¿Ÿï¼ˆå±•ç¤ºRAGæ£€ç´¢è¿‡ç¨‹ï¼‰
                await new Promise(resolve => setTimeout(resolve, 1000));

                // æ‰§è¡ŒRAGæ£€ç´¢
                const ragContext = await ragSystem.performRAG(query);
                
                // ç”Ÿæˆå›å¤
                const response = ragSystem.generateResponse(query, ragContext);
                
                // ç§»é™¤æ€è€ƒæŒ‡ç¤ºå™¨
                removeThinkingIndicator(thinkingEl);
                
                // æ·»åŠ AIå›å¤
                addMessage(response, 'ai');

            } catch (error) {
                removeThinkingIndicator(thinkingEl);
                addMessage('æŠ±æ­‰ï¼Œå¤„ç†æ‚¨çš„è¯·æ±‚æ—¶å‡ºç°äº†é—®é¢˜ã€‚è¯·ç¨åé‡è¯•ã€‚', 'ai');
            } finally {
                ragSystem.isProcessing = false;
                sendButton.disabled = false;
                sendButton.textContent = 'å‘é€';
            }
        }

        // å‘é€æ¼”ç¤ºæŸ¥è¯¢
        function sendDemoQuery(query) {
            document.getElementById('messageInput').value = query;
            sendMessage();
        }

        // æ·»åŠ æ¶ˆæ¯
        function addMessage(content, type) {
            const messages = document.getElementById('messages');
            const messageEl = document.createElement('div');
            messageEl.className = `message ${type}-message`;
            
            if (type === 'ai') {
                messageEl.innerHTML = `
                    <div class="message-header">SVTR.AI æ··åˆRAGç³»ç»Ÿ</div>
                    <div>${content.replace(/\n/g, '<br>')}</div>
                `;
            } else {
                messageEl.innerHTML = `
                    <div class="message-header">æ‚¨</div>
                    <div>${content}</div>
                `;
            }
            
            messages.appendChild(messageEl);
            messages.scrollTop = messages.scrollHeight;
        }

        // æ·»åŠ æ€è€ƒæŒ‡ç¤ºå™¨
        function addThinkingIndicator() {
            const messages = document.getElementById('messages');
            const thinkingEl = document.createElement('div');
            thinkingEl.className = 'typing';
            thinkingEl.innerHTML = `
                <div style="margin-right: 10px;">æ­£åœ¨åˆ†æ...</div>
                <div class="typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            messages.appendChild(thinkingEl);
            messages.scrollTop = messages.scrollHeight;
            return thinkingEl;
        }

        // ç§»é™¤æ€è€ƒæŒ‡ç¤ºå™¨
        function removeThinkingIndicator(element) {
            if (element && element.parentNode) {
                element.parentNode.removeChild(element);
            }
        }

        // åˆå§‹åŒ–
        document.getElementById('messageInput').focus();
    </script>
</body>
</html>