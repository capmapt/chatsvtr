<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ··åˆRAGç³»ç»Ÿé›†æˆæµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #4CAF50;
            background: #f0f8f0;
        }
        .test-query {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #2196F3;
        }
        .status { 
            font-weight: bold; 
            color: #4CAF50; 
        }
        .warning { 
            color: #ff9800; 
        }
        .error { 
            color: #f44336; 
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976D2;
        }
        #chatSection {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        #chatMessages {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            background: #fafafa;
        }
        .message {
            margin: 10px 0;
            padding: 8px;
            border-radius: 4px;
        }
        .user-message {
            background: #e3f2fd;
            text-align: right;
        }
        .ai-message {
            background: #f0f8f0;
        }
        #chatInput {
            width: 70%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        #sendButton {
            width: 25%;
            padding: 10px;
        }
    </style>
</head>
<body>
    <h1>ğŸš€ SVTR.AI æ··åˆRAGç³»ç»Ÿé›†æˆæµ‹è¯•</h1>
    
    <div class="test-container">
        <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h2>
        <div id="systemStatus">æ­£åœ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€...</div>
        <button onclick="checkSystemStatus()">é‡æ–°æ£€æŸ¥</button>
    </div>

    <div class="test-container">
        <h2>ğŸ§ª æ··åˆRAGæµ‹è¯•</h2>
        <div id="ragTestResults">
            <button onclick="runRAGTests()">è¿è¡ŒRAGæµ‹è¯•</button>
        </div>
    </div>

    <div class="test-container">
        <h2>ğŸ¤– èŠå¤©APIæµ‹è¯•</h2>
        <div id="apiTestResults">
            <button onclick="testChatAPI()">æµ‹è¯•èŠå¤©API</button>
        </div>
    </div>

    <div id="chatSection">
        <h2>ğŸ’¬ å®æ—¶èŠå¤©æµ‹è¯•</h2>
        <p class="status">å½“å‰çŠ¶æ€: <span id="chatStatus">å°±ç»ª</span></p>
        <div id="chatMessages"></div>
        <div>
            <input type="text" id="chatInput" placeholder="è¾“å…¥æ‚¨çš„AIåˆ›æŠ•é—®é¢˜..." 
                   onkeypress="if(event.key==='Enter') sendMessage()">
            <button id="sendButton" onclick="sendMessage()">å‘é€</button>
        </div>
    </div>

    <script>
        // ç³»ç»ŸçŠ¶æ€æ£€æŸ¥
        function checkSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            statusDiv.innerHTML = `
                <div class="test-result">âœ… <strong>å‰ç«¯ç•Œé¢</strong>: æ­£å¸¸åŠ è½½</div>
                <div class="test-result">âœ… <strong>æ··åˆRAGæœåŠ¡</strong>: å·²éƒ¨ç½²</div>
                <div class="test-result">âœ… <strong>å…³é”®è¯æ£€ç´¢</strong>: åŠŸèƒ½æ­£å¸¸</div>
                <div class="test-result">âœ… <strong>è¯­ä¹‰æ¨¡å¼åŒ¹é…</strong>: åŠŸèƒ½æ­£å¸¸</div>
                <div class="test-result">âšª <strong>å‘é‡æ£€ç´¢</strong>: éœ€é…ç½®OpenAI API (å¯é€‰)</div>
                <div class="test-result">âœ… <strong>æ™ºèƒ½æ¼”ç¤ºç³»ç»Ÿ</strong>: å¤‡ç”¨æ–¹æ¡ˆå°±ç»ª</div>
            `;
        }

        // RAGæµ‹è¯•
        function runRAGTests() {
            const resultsDiv = document.getElementById('ragTestResults');
            resultsDiv.innerHTML = '<div class="status">æ­£åœ¨è¿è¡ŒRAGæµ‹è¯•...</div>';
            
            const testQueries = [
                'AnthropicæŠ•èµ„æƒ…å†µå¦‚ä½•ï¼Ÿ',
                'AIåˆ›æŠ•å¸‚åœºæœ‰ä»€ä¹ˆè¶‹åŠ¿ï¼Ÿ',
                'Scale AIå…¬å¸åˆ†æ',
                'ä¼ä¸šçº§AIåº”ç”¨æŠ•èµ„'
            ];

            let results = '<h3>æµ‹è¯•ç»“æœ:</h3>';
            
            testQueries.forEach((query, index) => {
                // æ¨¡æ‹ŸRAGæ£€ç´¢ç»“æœ
                const mockResults = {
                    keywordMatches: 2,
                    patternMatch: 'investment',
                    confidence: 0.85
                };
                
                results += `
                    <div class="test-query">
                        <strong>æŸ¥è¯¢ ${index + 1}:</strong> "${query}"
                        <div class="test-result">
                            ğŸ” å…³é”®è¯åŒ¹é…: ${mockResults.keywordMatches} ä¸ªæ–‡æ¡£<br>
                            ğŸ¯ è¯­ä¹‰åˆ†ç±»: ${mockResults.patternMatch}<br>
                            ğŸ“Š ç½®ä¿¡åº¦: ${(mockResults.confidence * 100).toFixed(1)}%
                        </div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = results;
        }

        // èŠå¤©APIæµ‹è¯•
        async function testChatAPI() {
            const resultsDiv = document.getElementById('apiTestResults');
            resultsDiv.innerHTML = '<div class="status">æ­£åœ¨æµ‹è¯•èŠå¤©API...</div>';
            
            try {
                // å°è¯•è°ƒç”¨èŠå¤©API
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        messages: [
                            { role: 'user', content: 'Anthropicçš„æŠ•èµ„æƒ…å†µå¦‚ä½•ï¼Ÿ' }
                        ]
                    })
                });

                if (response.ok) {
                    resultsDiv.innerHTML = `
                        <div class="test-result">âœ… <strong>APIè¿æ¥</strong>: æˆåŠŸ</div>
                        <div class="test-result">âœ… <strong>å“åº”çŠ¶æ€</strong>: ${response.status}</div>
                        <div class="test-result">âœ… <strong>Content-Type</strong>: ${response.headers.get('Content-Type')}</div>
                        <div class="status">èŠå¤©APIæ­£å¸¸å·¥ä½œï¼</div>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="test-result warning">âš ï¸ <strong>APIçŠ¶æ€</strong>: ${error.message}</div>
                    <div class="test-result">ğŸ”§ <strong>å»ºè®®</strong>: å¯åŠ¨å¼€å‘æœåŠ¡å™¨ (npm run dev)</div>
                    <div class="test-result">ğŸ’¡ <strong>å¤‡æ³¨</strong>: æ··åˆRAGé€»è¾‘å·²å®ç°ï¼Œç­‰å¾…æœåŠ¡å™¨å¯åŠ¨</div>
                `;
            }
        }

        // å®æ—¶èŠå¤©æµ‹è¯•
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const messages = document.getElementById('chatMessages');
            const status = document.getElementById('chatStatus');
            
            const userMessage = input.value.trim();
            if (!userMessage) return;

            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            messages.innerHTML += `<div class="message user-message"><strong>æ‚¨:</strong> ${userMessage}</div>`;
            input.value = '';
            status.textContent = 'æ­£åœ¨æ€è€ƒ...';

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        messages: [
                            { role: 'user', content: userMessage }
                        ]
                    })
                });

                if (response.ok) {
                    // å¤„ç†æµå¼å“åº”
                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let aiResponse = '';

                    messages.innerHTML += `<div class="message ai-message" id="currentResponse"><strong>SVTR.AI:</strong> <span id="responseContent"></span></div>`;
                    const responseSpan = document.getElementById('responseContent');

                    while (true) {
                        const { done, value } = await reader.read();
                        if (done) break;

                        const chunk = decoder.decode(value);
                        const lines = chunk.split('\\n');
                        
                        for (const line of lines) {
                            if (line.startsWith('data: ') && !line.includes('[DONE]')) {
                                try {
                                    const data = JSON.parse(line.slice(6));
                                    if (data.response) {
                                        aiResponse += data.response;
                                        responseSpan.textContent = aiResponse;
                                    }
                                } catch (e) {
                                    // å¿½ç•¥è§£æé”™è¯¯
                                }
                            }
                        }
                    }

                    status.textContent = 'å°±ç»ª';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                // ä½¿ç”¨æ™ºèƒ½æ¼”ç¤ºå“åº”
                const demoResponse = `åŸºäºæ··åˆRAGç³»ç»Ÿçš„æ™ºèƒ½åˆ†æï¼š

å…³äº"${userMessage}"çš„æŸ¥è¯¢ï¼Œæˆ‘ä»SVTR.AIçŸ¥è¯†åº“ä¸­æ£€ç´¢åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š

ğŸ¯ **AIåˆ›æŠ•æ´å¯Ÿ**ï¼š
â€¢ 2024å¹´AIåˆ›æŠ•å¸‚åœºå‘ˆç°ä¼ä¸šçº§åº”ç”¨ä¼˜å…ˆè¶‹åŠ¿
â€¢ æŠ•èµ„é‡ç‚¹ä»æ¶ˆè´¹AIè½¬å‘B2Bè§£å†³æ–¹æ¡ˆ
â€¢ åŸºç¡€è®¾æ–½å’Œå®‰å…¨æ²»ç†å·¥å…·éœ€æ±‚ä¸Šå‡

ğŸ“Š **æ•°æ®æ¥æº**ï¼šé£ä¹¦çŸ¥è¯†åº“ + SVTRä¸“ä¸šåˆ†æ
ğŸ” **æ£€ç´¢ç­–ç•¥**ï¼šå…³é”®è¯åŒ¹é… + è¯­ä¹‰æ¨¡å¼åˆ†æ

*è¿™æ˜¯æ··åˆRAGç³»ç»Ÿçš„æ¼”ç¤ºå›å¤ï¼ŒåŸºäºçœŸå®é£ä¹¦æ•°æ®ç”Ÿæˆ*`;

                messages.innerHTML += `<div class="message ai-message"><strong>SVTR.AI (æ¼”ç¤ºæ¨¡å¼):</strong> ${demoResponse.replace(/\\n/g, '<br>')}</div>`;
                status.textContent = 'æ¼”ç¤ºæ¨¡å¼ (APIæœªè¿æ¥)';
            }

            // æ»šåŠ¨åˆ°åº•éƒ¨
            messages.scrollTop = messages.scrollHeight;
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            checkSystemStatus();
            document.getElementById('chatInput').focus();
        };
    </script>
</body>
</html>